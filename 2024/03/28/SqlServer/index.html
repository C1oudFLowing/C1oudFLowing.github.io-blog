
<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <title>SqlServer | 雲流のLowest World</title>
        <meta name="author" content="C1oudfL0w0" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
        <link rel="icon" href="/blog/images/croppedImage_cropped.jpg" />
        <!-- cdn挂掉的时候要可以引用本地 -->
<!-- <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script> -->
<script src="/blog/js/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css" />
<!--<link rel="stylesheet" href="/blog/css/all.min.css" />-->
<link rel="stylesheet" href="/blog/css/fonts.min.css" />
<link rel="stylesheet" href="/blog/css/search.css" />
<script> const mixins = {}; </script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

<!--改成了prismjs高亮-->

<script src="/blog/js/lib/prism.js"></script>
<link rel="stylesheet" href="/blog/css/prism.css" rel="stylesheet" />



<script src="/blog/js/lib/preview.js"></script>










<script src="/blog/js/lib/home.js"></script>

<link rel="stylesheet" href="/blog/css/main.css" />
<!-- 引入jQuery-->
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<!--<script src="/blog/js/jquery.min.js"></script>-->
<!-- 引入不蒜子-->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
        <script type="text/javascript" src="/blog/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<!-- 引入clipboard -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
<script type="text/javascript" src="/blog/libs/codeBlock/codeCopy.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>
    <meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/blog/atom.xml" title="雲流のLowest World" type="application/atom+xml">
</head>
    <body>
        <!--flag{never_g0nna g1ve_you up}-->
        
        <!-- 页面点击特效 -->
        <script type = "text/javascript" src = "/blog/js/love-click.js"></script>

        <!-- 浏览器标题 -->
         <script async type="text/javascript" src="/blog/js/FunnyTitle.js"></script>
         
        <!--动态背景-->
        <script type="text/javascript"
        color="0,0,255" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

        <!--文章目录-->
        
    <div id="toc" class="toc-article">
    <h3><i class="fas fa-stream"></i>  目录</h3>
      <div class="toc-title"></div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%AA%E8%AE%BA"><span class="toc-number">2.</span> <span class="toc-text">绪论</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.1.</span> <span class="toc-text">关系模型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.</span> <span class="toc-text">关系数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8A%E5%BD%A2%E5%BC%8F%E5%8C%96%E5%AE%9A%E4%B9%89"><span class="toc-number">3.1.</span> <span class="toc-text">关系数据结构及形式化定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.2.</span> <span class="toc-text">关系模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93-1"><span class="toc-number">3.3.</span> <span class="toc-text">关系数据库</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E6%93%8D%E4%BD%9C"><span class="toc-number">4.</span> <span class="toc-text">关系操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%85%B3%E7%B3%BB%E6%93%8D%E4%BD%9C"><span class="toc-number">4.1.</span> <span class="toc-text">基本关系操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E8%AF%AD%E8%A8%80%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">4.2.</span> <span class="toc-text">关系数据语言的分类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-number">5.</span> <span class="toc-text">关系的完整性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-number">5.1.</span> <span class="toc-text">实体完整性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E7%85%A7%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-number">5.2.</span> <span class="toc-text">参照完整性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%AE%9A%E4%B9%89%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-number">5.3.</span> <span class="toc-text">用户定义的完整性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E4%BB%A3%E6%95%B0"><span class="toc-number">6.</span> <span class="toc-text">关系代数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97"><span class="toc-number">6.1.</span> <span class="toc-text">集合运算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E8%BF%90%E7%AE%97"><span class="toc-number">6.2.</span> <span class="toc-text">关系运算</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL"><span class="toc-number">7.</span> <span class="toc-text">SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89"><span class="toc-number">7.1.</span> <span class="toc-text">数据定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%9F%BA%E6%9C%AC%E8%A1%A8"><span class="toc-number">7.1.1.</span> <span class="toc-text">定义基本表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.2.</span> <span class="toc-text">数据查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.2.1.</span> <span class="toc-text">单表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E8%A1%A8%E4%B8%AD%E7%9A%84%E8%8B%A5%E5%B9%B2%E5%88%97"><span class="toc-number">7.2.1.1.</span> <span class="toc-text">选择表中的若干列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E8%A1%A8%E4%B8%AD%E7%9A%84%E8%8B%A5%E5%B9%B2%E5%85%83%E7%BB%84"><span class="toc-number">7.2.1.2.</span> <span class="toc-text">选择表中的若干元组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ORDER-BY%E5%AD%90%E5%8F%A5"><span class="toc-number">7.2.1.3.</span> <span class="toc-text">ORDER BY子句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.1.4.</span> <span class="toc-text">聚集函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GROUP-BY-%E5%AD%90%E5%8F%A5"><span class="toc-number">7.2.1.5.</span> <span class="toc-text">GROUP BY 子句</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.2.2.</span> <span class="toc-text">连接查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.2.3.</span> <span class="toc-text">嵌套查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.2.4.</span> <span class="toc-text">集合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%B4%BE%E7%94%9F%E8%A1%A8%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.2.5.</span> <span class="toc-text">基于派生表的查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0"><span class="toc-number">7.3.</span> <span class="toc-text">数据更新</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">7.4.</span> <span class="toc-text">视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E8%A7%86%E5%9B%BE"><span class="toc-number">7.4.1.</span> <span class="toc-text">定义视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%A7%86%E5%9B%BE"><span class="toc-number">7.4.2.</span> <span class="toc-text">查询视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE"><span class="toc-number">7.4.3.</span> <span class="toc-text">更新视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">7.4.4.</span> <span class="toc-text">视图的作用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-number">8.</span> <span class="toc-text">数据库完整性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E5%AE%8C%E6%95%B4%E6%80%A7-1"><span class="toc-number">8.1.</span> <span class="toc-text">实体完整性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E7%85%A7%E5%AE%8C%E6%95%B4%E6%80%A7-1"><span class="toc-number">8.2.</span> <span class="toc-text">参照完整性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-number">9.</span> <span class="toc-text">数据库安全性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%A0%87%E5%87%86"><span class="toc-number">9.1.</span> <span class="toc-text">安全标准</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%80%A7%E6%8E%A7%E5%88%B6"><span class="toc-number">9.2.</span> <span class="toc-text">安全性控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%BA%AB%E4%BB%BD%E9%89%B4%E5%88%AB"><span class="toc-number">9.2.1.</span> <span class="toc-text">用户身份鉴别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%8F%96%E6%8E%A7%E5%88%B6"><span class="toc-number">9.2.2.</span> <span class="toc-text">存取控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E4%B8%BB%E5%AD%98%E5%8F%96%E6%8E%A7%E5%88%B6%E6%96%B9%E6%B3%95"><span class="toc-number">9.2.3.</span> <span class="toc-text">自主存取控制方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%88%E6%9D%83%EF%BC%9A%E6%8E%88%E4%BA%88%E4%B8%8E%E6%94%B6%E5%9B%9E"><span class="toc-number">9.2.4.</span> <span class="toc-text">授权：授予与收回</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A7%92%E8%89%B2"><span class="toc-number">9.2.5.</span> <span class="toc-text">数据库角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%BA%E5%88%B6%E5%AD%98%E5%8F%96%E6%8E%A7%E5%88%B6%E6%96%B9%E6%B3%95"><span class="toc-number">9.2.6.</span> <span class="toc-text">强制存取控制方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E6%9C%BA%E5%88%B6"><span class="toc-number">9.3.</span> <span class="toc-text">视图机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A1%E8%AE%A1"><span class="toc-number">9.4.</span> <span class="toc-text">审计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86"><span class="toc-number">9.5.</span> <span class="toc-text">数据加密</span></a></li></ol></li></ol>
    </div>
  
        
        <!--返回顶部-->
        <div id="totop" style="position:fixed;bottom:50px;right:60px;font-size: 48px;cursor: pointer;z-index: 10;">
            <a title="返回顶部">↑</a>
            </div>
        <script src="/blog/js/totop.js"></script>

        <div id="layout">
            <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>第一次加载文章图片可能会花费较长时间</p>
                    <p>要不挂个梯子试试？（x</p>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/blog/images/loading.gif" />
                </div>
            </div>
            </transition>
            <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/blog/">
            <span>雲流のLOWEST WORLD</span>
        </a>
        
        <a href="/blog/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/blog/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/blog/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/blog/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/blog/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/blog/links">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
        <a href="/blog/search">
            <i class="fa-solid fa-search fa-fw"></i>
            <span>&ensp;Search</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;雲流のLOWEST WORLD</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/blog/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/blog/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/blog/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
            <a href="/blog/links">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-link fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                </div>
            </a>
            
            <a href="/blog/search">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-search fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Search</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>SqlServer</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2024/3/28
        </span>
        
        <span class="category">
            <a href="/blog/categories/Basic/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Basic
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/Sql/" style="color: #00bcd4">Sql</a>
            </span>
            
        </span>
        
        <!--文章字数统计-->
        
            
<div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <!-- 安装插件npm install hexo-wordcount --save -->
        <span class="post-count">5.6k字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">21分</span>
      </span>
    </span>
    
    <!--不蒜子统计访问数-->
    <span id="busuanzi_container_page_pv">
    &nbsp; | &nbsp;
    总文章阅读量：<span id="busuanzi_value_page_pv"></span>次
    </span>
</div>

          
    </div>
    
    <div class="content" v-pre>
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>学业所迫，<del>教的居然不是Mysql</del></p>
<span id="more"></span>

<h1 id="绪论"><a href="#绪论" class="headerlink" title="绪论"></a>绪论</h1><h2 id="关系模型"><a href="#关系模型" class="headerlink" title="关系模型"></a>关系模型</h2><p>数据结构：</p>
<ul>
<li>关系（relation）：即一张表</li>
<li>元组（tuple）：表中的一行</li>
<li>属性（attribute）：表中的一列</li>
<li>码（key）：表中的某个<strong>属性组</strong>（属性+元组），如：学号确定学生</li>
<li>域（domain）：一组具有相同数据类型的值的集合。属性的取值范围来自某个域</li>
<li>分量：元组中的一个属性值。关系的每一个分量必须是一个不可分的数据项</li>
<li>关系模式：对关系的描述，如：<code>学生（学号，姓名，年龄，性别，系名，年级）</code></li>
</ul>
<p>数据操纵：查询、插入、删除和更新数据</p>
<p>完整性约束：实体完整性、参照完整性和用户定义的完整性</p>
<hr>
<h1 id="关系数据库"><a href="#关系数据库" class="headerlink" title="关系数据库"></a>关系数据库</h1><h2 id="关系数据结构及形式化定义"><a href="#关系数据结构及形式化定义" class="headerlink" title="关系数据结构及形式化定义"></a>关系数据结构及形式化定义</h2><ul>
<li><p><code>域（domain）</code>：一组具有相同数据类型的值的集合，例：<code>&#123;0,1&#125;</code>、<code>&#123;男、女&#125;</code></p>
</li>
<li><p><code>笛卡尔积</code>：域上的一种集合运算</p>
<blockquote>
<p>给定一组域D1，D2，…，Dn，允许其中的某些域是相同的，其笛卡尔积为：D1*D2*…*Dn &#x3D; {(d1，d2，…，dn) | di ∈ Di，i&#x3D;1,2,…,n}</p>
</blockquote>
<p>其中每一个元素叫做一个<strong>n元组</strong>（tuple），元素中的每一个值叫做一个<strong>分量</strong>（component）</p>
<p>一个域允许的不同取值个数称为这个域的<strong>基数</strong></p>
</li>
</ul>
<p><img src="/blog/2024/03/28/SqlServer/Screenshot_2024-03-29-08-34-30-360_com.orion.notein-edit.jpg" alt="Screenshot_2024-03-29-08-34-30-360_com.orion.notein-edit"></p>
<ul>
<li><p><code>关系</code>：D1*D2*…*Dn的子集叫做在域D1，D2，…，Dn上的<strong>关系</strong>，表示为<code>R(D1，D2，...，Dn)</code>。这里R表示关系的名字，n是关系的<strong>目</strong>或<strong>度</strong></p>
<p>单元关系：n&#x3D;1</p>
<p>二元关系：n&#x3D;2</p>
<p><code>候选码（candidate key）</code>：关系中的某一属性组的值能唯一地标识一个元组，而其子集不能，则称该属性组为<strong>候选码</strong></p>
<p>若一个关系有多个候选码，则选定其中一个为<strong>主码</strong>（primary key）</p>
<p>例：关系（SUPERVISOR，MAJOR，POSTGRADUATE）中，假设 POSTGRADUATE 不会重名，则可以作为SMP关系的主码，用下划线表示 <u>POSTGRADUATE</u></p>
<p><code>全码（all-key）</code>：关系模式的所有属性是这个关系模式的候选码</p>
</li>
</ul>
<hr>
<h2 id="关系模式"><a href="#关系模式" class="headerlink" title="关系模式"></a>关系模式</h2><p>关系的描述称为<strong>关系模式</strong>，表示为<code>R(U,D,DOM,F)</code>，简记为<code>R(U)</code>或<code>R(A1,A2, ... ,An)</code>（A为属性名）</p>
<p>R：关系名</p>
<p>U：组成该关系的属性名集合</p>
<p>D：U中属性所来自的域</p>
<p>DOM：属性向域的映像集合</p>
<p>F：属性间数据的依赖关系集合</p>
<hr>
<h2 id="关系数据库-1"><a href="#关系数据库-1" class="headerlink" title="关系数据库"></a>关系数据库</h2><p>在关系模型中，实体以及实体间的练习都是用关系来表示的</p>
<p><strong>关系数据库的型</strong>也称为<strong>关系数据库模式</strong>，是对关系数据库的描述</p>
<p><strong>关系数据库的值</strong>是这些关系模式在某一时刻对应的关系的集合，通常称为<strong>关系数据库</strong></p>
<hr>
<h1 id="关系操作"><a href="#关系操作" class="headerlink" title="关系操作"></a>关系操作</h1><h2 id="基本关系操作"><a href="#基本关系操作" class="headerlink" title="基本关系操作"></a>基本关系操作</h2><p>增（insert）删（delete）查（query）改（update）</p>
<p>查询：选择、投影、连接、除、并、差、交、笛卡尔积，其中选择、投影、并、差、笛卡尔积是5种基本操作</p>
<p>操作的对象和结果都是集合，这种操作方式也称为一次一集合的方式。而非关系数据库模型的数据操作方式则为一次一记录的方式</p>
<hr>
<h2 id="关系数据语言的分类"><a href="#关系数据语言的分类" class="headerlink" title="关系数据语言的分类"></a>关系数据语言的分类</h2><p>分为三类：</p>
<ol>
<li><strong>关系代数</strong>语言：关系操作能力用代数方式表示，如 ISBL</li>
<li><strong>关系演算</strong>语言：关系操作能力用逻辑方式表示，其中又分为元组关系演算语言（ALPHA、QUEL）和域关系演算语言（如 QBE）</li>
<li>具有关系代数和关系演算<strong>双重特点</strong>的语言：如 SQL</li>
</ol>
<hr>
<h1 id="关系的完整性"><a href="#关系的完整性" class="headerlink" title="关系的完整性"></a>关系的完整性</h1><p>关系模型的完整性规则是对关系的某种约束条件，也就是说关系的值随着时间变化应该满足一些约束条件</p>
<p>关系模型汇总有三类完整性约束：实体完整性、参照完整性、用户定义的完整性</p>
<h2 id="实体完整性"><a href="#实体完整性" class="headerlink" title="实体完整性"></a>实体完整性</h2><p>若属性A是基本关系R的主属性，则A不能取空值</p>
<h2 id="参照完整性"><a href="#参照完整性" class="headerlink" title="参照完整性"></a>参照完整性</h2><p>设 F 是基本关系 R 的一个或一组属性，但不是关系 R 的码， Ks 是基本关系 S 的主码。如果 F 与 Ks 相对应，则称 F 是 R 的<strong>外码</strong>（foreign key），并称基本关系R为<strong>参照关系</strong>，基本关系S为<strong>被参照关系</strong>或目标关系</p>
<p>例：</p>
<blockquote>
<p>学生（<u>学号</u>，姓名，性别，专业号，年龄）</p>
</blockquote>
<blockquote>
<p>专业（<u>专业号</u>，专业名）</p>
</blockquote>
<p>这两个关系之间存在<strong>属性的引用</strong>，即学生关系引用了专业关系的主码“专业号”。此时学生关系的“专业号”属性与专业关系的主码“专业号”相对应，因此<strong>“专业号”属性是学生关系的外码</strong>。这里专业关系是被参照关系，学生关系为参照关系。</p>
<p><img src="/blog/2024/03/28/SqlServer/image-20240510211625957.png" alt="image-20240510211625957"></p>
<p>参照完整性规则（定义外码与主码之间的引用规则）：若属性（或属性组）F 是基本关系 R 的外码，它与基本关系 S 的主码 Ks 相对应（基本关系 R 和 S 不一定是不同的关系），则对于 R 中每个元组在 F 上的值必须：</p>
<ul>
<li>或者取空值（F中的每个属性值均为空值，即<strong>外码中的每个属性值均为空值</strong>）</li>
<li>或者等于S中某个元组的主码值（以上面的例子为例，<strong>学生关系</strong>中每个元组的“专业号”属性只能取空值（未分配专业）或非空值（必须是<strong>专业关系</strong>中某个元组的“专业号”值））</li>
</ul>
<p>对于上面的例子：即”专业号“属性只能取两类值：</p>
<ul>
<li>空值：表示尚未给该学生分配专业</li>
<li>非空值：这时该值必须是专业关系中某个元组的”专业号“值，表示该学生不可能分配到一个不存在的专业中</li>
</ul>
<h2 id="用户定义的完整性"><a href="#用户定义的完整性" class="headerlink" title="用户定义的完整性"></a>用户定义的完整性</h2><p>针对某一具体关系数据库的约束条件，它反映某一具体应用所涉及的数据必须满足的语义要求。例如：某个属性必须取唯一值，某个非主属性不能取空值等。</p>
<p>继续前面的例子：定义学生姓名不能取空值，学生的成绩取值范围可以定义在0~100之间…</p>
<hr>
<h1 id="关系代数"><a href="#关系代数" class="headerlink" title="关系代数"></a>关系代数</h1><h2 id="集合运算"><a href="#集合运算" class="headerlink" title="集合运算"></a>集合运算</h2><ul>
<li><p>并：<code>R∪S</code></p>
</li>
<li><p>差：<code>R-S</code>，属于R但是不属于S</p>
</li>
<li><p>交：<code>R∩S = R-(R-S)</code></p>
</li>
<li><p>笛卡尔积：广义的笛卡尔积，其中的元素是元组</p>
<p>两个分别为 n 目和 m 目的关系 R 和 S 的笛卡尔积是一个  (n+m)  列的<strong>元组的集合</strong>。元组的前n列是关系R的一个元组。若R有k<sub>1</sub>个元组，S有k<sub>2</sub>个元组，则关系R和关系S的笛卡尔积有k<sub>1</sub>*k<sub>2</sub>个元组。记作：<code>R×S = &#123;tr⌒ts | tr ∈R ∧ ts ∈S&#125;</code></p>
<p>就下面这张表而言，其笛卡尔积为 R 的每一行与 S 的每一行拼接成 R×S 的每一行</p>
</li>
</ul>
<p><img src="/blog/2024/03/28/SqlServer/Screenshot_2024-04-07-08-34-08-817_com.orion.notein-edit.jpg" alt="Screenshot_2024-04-07-08-34-08-817_com.orion.notein-edit"></p>
<h2 id="关系运算"><a href="#关系运算" class="headerlink" title="关系运算"></a>关系运算</h2><ol>
<li><p>选择（限制）：在关系R中选择满足给定条件的诸<strong>元组</strong>。σ<sub>F</sub>(R) &#x3D; {t | t ∈ R∧F(t) &#x3D; &#39;真&#39;}，其中F表示选择条件，是一个逻辑表达式，取 true 或 false</p>
<p><img src="/blog/2024/03/28/SqlServer/Screenshot_2024-04-07-08-50-48-722_com.orion.notein-edit.jpg" alt="Screenshot_2024-04-07-08-50-48-722_com.orion.notein-edit"></p>
</li>
<li><p>投影：从R中选择出若干<strong>属性列</strong>组成新的关系。Π<sub>A</sub>(R) &#x3D; {t[A] | t∈R}，其中A为R中的属性列</p>
<p><img src="/blog/2024/03/28/SqlServer/Screenshot_2024-04-07-08-52-13-115_com.orion.notein-edit.jpg" alt="Screenshot_2024-04-07-08-52-13-115_com.orion.notein-edit"></p>
</li>
<li><p>连接：从两个关系的<strong>笛卡尔积</strong>中选取属性间满足一定条件的元组</p>
<p>等值连接：选取属性值相等的那些元组</p>
<p>自然连接：要求两个关系中进行比较的分量必须是同名的属性组，并在结果中把重复的属性列去掉<br><img src="/blog/2024/03/28/SqlServer/Screenshot_2024-04-07-08-57-38-317_net.gsantner.markor-edit.jpg" alt="Screenshot_2024-04-07-08-57-38-317_net.gsantner.markor-edit"></p>
</li>
<li><p>除：设关系R除以关系S的结果为关系T，则T<strong>包含所有在R但不在S中的属性及其值，且T的元组与S的元组的所有组合都在R中</strong><br><img src="/blog/2024/03/28/SqlServer/Screenshot_2024-04-07-09-23-20-782_com.orion.notein-edit.jpg" alt="Screenshot_2024-04-07-09-23-20-782_com.orion.notein-edit"></p>
</li>
</ol>
<hr>
<h1 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h1><p>SQL功能：</p>
<ul>
<li>数据定义：CREATE、DROP、ALTER</li>
<li>数据查询：SELECT</li>
<li>数据操纵：INSERT、UPDATE、DELETE</li>
<li>数据控制：GRANT、REVOKE</li>
</ul>
<h2 id="数据定义"><a href="#数据定义" class="headerlink" title="数据定义"></a>数据定义</h2><table>
<thead>
<tr>
<th>操作对象</th>
<th>创建</th>
<th>删除</th>
<th>修改</th>
</tr>
</thead>
<tbody><tr>
<td>模式</td>
<td>CREATE SCHEMA</td>
<td>DROP SCHEMA</td>
<td></td>
</tr>
<tr>
<td>表</td>
<td>CREATE TABLE</td>
<td>DROP TABLE</td>
<td>ALTER TABLE</td>
</tr>
<tr>
<td>视图</td>
<td>CREATE VIEW</td>
<td>DROP VIEW</td>
<td></td>
</tr>
<tr>
<td>索引</td>
<td>CREATE INDEX</td>
<td>DROP INDEX</td>
<td>ALTER INDEX</td>
</tr>
</tbody></table>
<p>定义模式：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">SCHEMA</span> <span class="token operator">&lt;</span>模式名<span class="token operator">></span> <span class="token keyword">AUTHORIZATION</span> <span class="token operator">&lt;</span>用户名<span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>模式名没指定的话默认是用户名，要创建模式，需要有数据库admin权限或admin给的 CREATE SCHEMA 权限</p>
<p>删除模式：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">SCHEMA</span> <span class="token operator">&lt;</span>模式名<span class="token operator">></span><span class="token operator">&lt;</span><span class="token keyword">CASCADE</span> <span class="token operator">|</span> <span class="token keyword">RESTRICT</span><span class="token operator">></span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>其中 CASCADE 和 RESTRICT 两者必选其一</p>
<p><code>CASCADE</code>（级联）：在删除模式的同时把该模式中所有的数据库对象全部删除</p>
<p><code>RESTRICT</code>（限制）：如果在该模式中已经定义了下属的数据库对象（如表、视图等），则拒绝该删除语句的执行。只有当该模式中没有任何下属的对象时才能执行 DROP SCHEMA 语句</p>
<h3 id="定义基本表"><a href="#定义基本表" class="headerlink" title="定义基本表"></a>定义基本表</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token operator">&lt;</span>表名<span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&lt;</span>列名<span class="token operator">></span><span class="token operator">&lt;</span>数据类型<span class="token operator">></span> <span class="token punctuation">[</span>列级完整性约束条件<span class="token punctuation">]</span>
                  <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>列名<span class="token operator">></span><span class="token operator">&lt;</span>数据类型<span class="token operator">></span> <span class="token punctuation">[</span>列级完整性约束条件<span class="token punctuation">]</span><span class="token punctuation">]</span>
                  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                  <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>表级完整性约束条件<span class="token operator">></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>例：建立一个“学生”表Student：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student
<span class="token punctuation">(</span>Sno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>	<span class="token comment">/*列级完整性约束条件，Sno是主码*/</span>
 Sname <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">,</span>		<span class="token comment">/*Sname取唯一值*/</span>
 Ssex <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 Sage <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span>
 Sdept <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




<hr>
<h2 id="数据查询"><a href="#数据查询" class="headerlink" title="数据查询"></a>数据查询</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">[</span><span class="token keyword">ALL</span> <span class="token operator">|</span> <span class="token keyword">DISTINCT</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span>目标列表达式<span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">></span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> <span class="token operator">&lt;</span>表名或视图名<span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">SELECT</span>语句<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token keyword">AS</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span>别名<span class="token operator">></span>
<span class="token punctuation">[</span><span class="token keyword">WHERE</span> <span class="token operator">&lt;</span>条件表达式<span class="token operator">></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token operator">&lt;</span>列名<span class="token number">1</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token keyword">HAVING</span> <span class="token operator">&lt;</span>条件表达式<span class="token operator">></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token operator">&lt;</span>列名<span class="token number">2</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token operator">|</span> <span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>根据 WHERE 子句的条件表达式从 FROM 子句指定的基本表、视图或派生表中找出满足条件的元组，再按 SELECT 子句中的目标列表达式选出元组中的属性值形成结果表</p>
<p>如果有 GROUP BY 子句，则将结果按 &lt;列名1&gt; 的值进行分组，该属性列值相等的元组为一个组。通常会在每组中作用聚集函数。如果 GROUP BY 子句带 HAVING 短语，则只有满足指定条件的组才予以输出</p>
<p>如果有 ORDER BY 子句，则结果表还要按 &lt;列名2&gt; 的值的升序或降序排序</p>
<h3 id="单表查询"><a href="#单表查询" class="headerlink" title="单表查询"></a>单表查询</h3><h4 id="选择表中的若干列"><a href="#选择表中的若干列" class="headerlink" title="选择表中的若干列"></a>选择表中的若干列</h4><p>查询指定列：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Sname
<span class="token keyword">FROM</span> Student<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>查询全部列：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> Student<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>查询经过计算的值：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span><span class="token string">'Year of Birth:'</span><span class="token punctuation">,</span><span class="token number">2014</span><span class="token operator">-</span>Sage <span class="token punctuation">,</span>LOWER<span class="token punctuation">(</span>Sdept<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> Student<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/blog/2024/03/28/SqlServer/Screenshot_2024-04-17-14-33-00-261_com.orion.notein-edit.jpg" alt="Screenshot_2024-04-17-14-33-00-261_com.orion.notein-edit"></p>
<p>指定别名：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Sname NAME<span class="token punctuation">,</span><span class="token string">'Year of Birth:'</span> BIRTH<span class="token punctuation">,</span><span class="token number">2014</span><span class="token operator">-</span>Sage BIRTHDAY<span class="token punctuation">,</span>LOWER<span class="token punctuation">(</span>Sdept<span class="token punctuation">)</span> DEPARTMENT
<span class="token keyword">FROM</span> Student<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/blog/2024/03/28/SqlServer/Screenshot_2024-04-17-14-33-42-004_com.orion.notein-edit.jpg" alt="Screenshot_2024-04-17-14-33-42-004_com.orion.notein-edit"></p>
<h4 id="选择表中的若干元组"><a href="#选择表中的若干元组" class="headerlink" title="选择表中的若干元组"></a>选择表中的若干元组</h4><p>消除取值重复的行：指定<code>DISTINCT</code>可以去掉结果表中的重复行，如果没指定DISTINCT，则默认为ALL</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> Sno
<span class="token keyword">FROM</span> SC<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>查询满足条件的元组：WHERE子句实现</p>
<p>WHERE查询条件：比较、确定范围（BETWEEN AND, NOT BETWEEN AND）、确定集合（IN, NOT IN）、字符匹配（LIKE, NOT LIKE）、空值（IS NULL, IS NOT NULL）、多重条件（逻辑运算）</p>
<p>比较大小：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sage
<span class="token keyword">FROM</span> Student
<span class="token keyword">WHERE</span> Sage<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>确定范围：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sdept<span class="token punctuation">,</span>Sage
<span class="token keyword">FROM</span> Student
<span class="token keyword">WHERE</span> Sage <span class="token operator">BETWEEN</span> <span class="token number">20</span> <span class="token operator">AND</span> <span class="token number">23</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p>确定集合：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Ssex
<span class="token keyword">FROM</span> Student
<span class="token keyword">WHERE</span> Sdept <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'CS'</span><span class="token punctuation">,</span><span class="token string">'MA'</span><span class="token punctuation">,</span><span class="token string">'IS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p>字符匹配：<code>LIKE</code>，如果匹配串中不含通配符，则可以用<code>=</code>替换；同理，NOT LIKE可以用<code>!=</code>或<code>&lt;&gt;</code>取代</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token punctuation">[</span><span class="token operator">NOT</span><span class="token punctuation">]</span> <span class="token operator">LIKE</span> <span class="token string">'&lt;匹配串>'</span> <span class="token punctuation">[</span>ESACPE <span class="token string">'&lt;换码字符>'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>通配符<code>%</code>：代表任意长度的字符串</li>
<li>通配符<code>_</code>：代表任意单个字符</li>
</ul>
<p>如果查询字符串本身有 % 或 _ ，则要用<code>ESCAPE &#39;&lt;换码字符&gt;&#39;</code>进行转义</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Cno<span class="token punctuation">,</span>Ccredit
<span class="token keyword">FROM</span> Course
<span class="token keyword">WHERE</span> Cname <span class="token operator">LIKE</span> <span class="token string">'DB\_Design'</span> <span class="token keyword">ESCAPE</span> '\'<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>这样<code>_</code>就不会被解释为通配符</p>
<p>涉及空值的查询：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Sno<span class="token punctuation">,</span>Cno
<span class="token keyword">FROM</span> SC
<span class="token keyword">WHERE</span> Grade <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>多重条件查询：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Sname
<span class="token keyword">FROM</span> Student
<span class="token keyword">WHERE</span> Sdept<span class="token operator">=</span><span class="token string">'CS'</span> <span class="token operator">AND</span> Sage<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<hr>
<h4 id="ORDER-BY子句"><a href="#ORDER-BY子句" class="headerlink" title="ORDER BY子句"></a>ORDER BY子句</h4><p>可用指定ASC升序或DESC降序，默认值为升序</p>
<hr>
<h4 id="聚集函数"><a href="#聚集函数" class="headerlink" title="聚集函数"></a>聚集函数</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>    统计元组个数
<span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token keyword">DISTINCT</span> <span class="token operator">|</span> <span class="token keyword">ALL</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span>列名<span class="token operator">></span><span class="token punctuation">)</span>    统计一列中值的个数
<span class="token function">SUM</span><span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token keyword">DISTINCT</span> <span class="token operator">|</span> <span class="token keyword">ALL</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span>列名<span class="token operator">></span><span class="token punctuation">)</span>    计算一列值的总和（此列必须是数值型）
<span class="token function">AVG</span><span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token keyword">DISTINCT</span> <span class="token operator">|</span> <span class="token keyword">ALL</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span>列名<span class="token operator">></span><span class="token punctuation">)</span>    计算一列值的平均值（此列必须是数值型）
<span class="token function">MAX</span><span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token keyword">DISTINCT</span> <span class="token operator">|</span> <span class="token keyword">ALL</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span>列名<span class="token operator">></span><span class="token punctuation">)</span>    求一列值中的最大值
<span class="token function">MIN</span><span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token keyword">DISTINCT</span> <span class="token operator">|</span> <span class="token keyword">ALL</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span>列名<span class="token operator">></span><span class="token punctuation">)</span>    求一列值中的最小值<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>当聚集函数遇到空值时，除<code>COUNT(*)</code>外，都跳过空值而只处理非空值，<code>COUNT(*)</code>是对元组进行计数，某个元组的一个或部分列取空值不影响统计结果</p>
<p>注：WHERE子句是不能用聚集函数作为条件表达式的，聚集函数只能用于 SELECT 子句和 GROUP BY 中的 HAVING 子句</p>
<hr>
<h4 id="GROUP-BY-子句"><a href="#GROUP-BY-子句" class="headerlink" title="GROUP BY 子句"></a>GROUP BY 子句</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Cno<span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span>Sno<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> SC
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Cno<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>查询结果按 Cno 的值分组，所以具有相同 Cno 值的元组为一组</p>
<hr>
<h3 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h3><ul>
<li><p>等值与非等值连接查询</p>
<p>连接条件&#x2F;连接谓词：<code>[&lt;表名1.&gt;]&lt;列名1&gt;&lt;比较运算符&gt;[&lt;表名2&gt;.]&lt;列名2&gt;</code></p>
<p>当连接运算符为 &#x3D; 时，称为<strong>等值连接</strong>，其它为非等值连接</p>
<p>连接谓词中的列名称为<strong>连接字段</strong>，字段类型必须是可比的</p>
<p>例：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Student<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>SC<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> Student<span class="token punctuation">,</span>SC
<span class="token keyword">WHERE</span> Student<span class="token punctuation">.</span>Sno<span class="token operator">=</span>SC<span class="token punctuation">.</span>Sno <span class="token comment">-- 将Student与SC中同一学生的元组连接起来</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2024/03/28/SqlServer/image-20240511012650424.png" alt="image-20240511012650424"></p>
<p><img src="/blog/2024/03/28/SqlServer/image-20240511012704952.png" alt="image-20240511012704952"></p>
<p><img src="/blog/2024/03/28/SqlServer/image-20240511012516767.png" alt="image-20240511012516767"></p>
</li>
<li><p>自身连接</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">FIRST</span><span class="token punctuation">.</span>Cno<span class="token punctuation">,</span><span class="token keyword">SECOND</span><span class="token punctuation">.</span>Cpno
<span class="token keyword">FROM</span> Course <span class="token keyword">FIRST</span><span class="token punctuation">,</span>Course <span class="token keyword">SECOND</span>
<span class="token keyword">WHERE</span> <span class="token keyword">FIRST</span><span class="token punctuation">.</span>Cpno<span class="token operator">=</span><span class="token keyword">SECOND</span><span class="token punctuation">.</span>Cno<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


</li>
<li><p>外连接：悬浮元组填NULL</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Student<span class="token punctuation">.</span>Sno<span class="token punctuation">,</span>Sname<span class="token punctuation">,</span>Ssex<span class="token punctuation">,</span>Sage<span class="token punctuation">,</span>Sdept<span class="token punctuation">,</span>Cno<span class="token punctuation">,</span>Grade
<span class="token keyword">FROM</span> Student <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> SC <span class="token keyword">ON</span> <span class="token punctuation">(</span>Student<span class="token punctuation">.</span>Sno<span class="token operator">=</span>SC<span class="token punctuation">.</span>Sno<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


</li>
<li><p>多表连接：先进行两个表的连接操作，再将其连接结果与第三个表进行连接</p>
</li>
</ul>
<hr>
<h3 id="嵌套查询"><a href="#嵌套查询" class="headerlink" title="嵌套查询"></a>嵌套查询</h3><p>查询块：<code>SELECT-FROM-WHERE</code>语句</p>
<p>嵌套查询：查询块套查询块</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sage
<span class="token keyword">FROM</span> Student
<span class="token keyword">WHERE</span> Sno <span class="token operator">IN</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> Sno
<span class="token keyword">FROM</span> SC
<span class="token keyword">WHERE</span> Cno<span class="token operator">=</span><span class="token string">'2'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<hr>
<h3 id="集合查询"><a href="#集合查询" class="headerlink" title="集合查询"></a>集合查询</h3><p>SELECT 语句的查询结果是<strong>元组的集合</strong>，所以多个SELECT语句的结果可进行集合操作</p>
<p>并操作<code>UNION</code></p>
<p>交操作<code>INTERSECT</code></p>
<p>差操作<code>EXCEPT</code></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> Sname<span class="token punctuation">,</span>Sage
<span class="token keyword">FROM</span> SC
<span class="token keyword">WHERE</span> Cno<span class="token operator">=</span><span class="token string">'1'</span>
<span class="token keyword">UNION</span>
<span class="token keyword">SELECT</span> Sno
<span class="token keyword">FROM</span> SC
<span class="token keyword">WHERE</span> Cno<span class="token operator">=</span><span class="token string">'2'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<hr>
<h3 id="基于派生表的查询"><a href="#基于派生表的查询" class="headerlink" title="基于派生表的查询"></a>基于派生表的查询</h3><hr>
<h2 id="数据更新"><a href="#数据更新" class="headerlink" title="数据更新"></a>数据更新</h2><hr>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>从一个或几个基本表（或视图）导出的表。它与基本表不同，是一个<strong>虚表</strong></p>
<p>就像一个窗口，能看到数据库中自己感兴趣的数据及其变化</p>
<h3 id="定义视图"><a href="#定义视图" class="headerlink" title="定义视图"></a>定义视图</h3><p>建立视图：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> <span class="token operator">&lt;</span>视图名<span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>列名<span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>列名<span class="token operator">></span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">AS</span> <span class="token operator">&lt;</span>子查询<span class="token operator">></span>
<span class="token punctuation">[</span><span class="token keyword">WITH</span> <span class="token keyword">CHECK</span> <span class="token keyword">OPTION</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>删除视图：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> <span class="token operator">&lt;</span>视图名<span class="token operator">></span> <span class="token punctuation">[</span><span class="token keyword">CASCADE</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h3 id="查询视图"><a href="#查询视图" class="headerlink" title="查询视图"></a>查询视图</h3><h3 id="更新视图"><a href="#更新视图" class="headerlink" title="更新视图"></a>更新视图</h3><h3 id="视图的作用"><a href="#视图的作用" class="headerlink" title="视图的作用"></a>视图的作用</h3><hr>
<h1 id="数据库完整性"><a href="#数据库完整性" class="headerlink" title="数据库完整性"></a>数据库完整性</h1><p>指数据的正确性和相容性</p>
<h2 id="实体完整性-1"><a href="#实体完整性-1" class="headerlink" title="实体完整性"></a>实体完整性</h2><p>在 CREATE TABLE 中用<code>PRIMARY KEY</code>定义，对单属性构成的码有两种说明方法，一种是定义为列级约束条件，另一种是定义为表级约束条件；对多属性构成的码只有后者</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student
    <span class="token punctuation">(</span>Sno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>    <span class="token comment">/*在列级定义主码*/</span>
    Sname <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    Ssex <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Sage <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span>
    Sdept <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>或者</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student
    <span class="token punctuation">(</span>Sno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Sname <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    Ssex <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Sage <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span>
    Sdept <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">)</span>    <span class="token comment">/*在表级定义主码*/</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>实体完整性检查和违约处理：</p>
<p>用 PRIMARY KEY 定义了关系的主码后，每当用户程序对基本表插入一条记录或对主码列进行更新操作时，关系数据库管理系统将自动进行检查：</p>
<ol>
<li>检查主码值是否唯一，如果不唯一则拒绝插入或修改</li>
<li>检查主码的各个属性是否为空，只要有一个为空就拒绝插入或修改</li>
</ol>
<p>检查记录中的主码值：全表扫描，但是需要建立索引（如B+树索引）</p>
<hr>
<h2 id="参照完整性-1"><a href="#参照完整性-1" class="headerlink" title="参照完整性"></a>参照完整性</h2><p>在CREATE TABLE中用<code>FOREIGN KEY</code>定义哪些为外码，用<code>REFERENCES</code>指明这些外码参照哪些表的主码</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> SC
    <span class="token punctuation">(</span>Sno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    Cno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    Grade <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">,</span>Cno<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">/*在表级定义实体完整性*/</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Sno<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Student<span class="token punctuation">(</span>Sno<span class="token punctuation">)</span>    <span class="token comment">/*在表级定义参照完整性*/</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>Cno<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Student<span class="token punctuation">(</span>Cno<span class="token punctuation">)</span>    <span class="token comment">/*在表级定义参照完整性*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>拒绝（NO ACTION）执行：不允许该操作执行，该策略一般设置为默认策略</p>
<p>级联（CASCADE）操作：当删除或修改被参照表的一个元组导致与参照表的不一致时，删除或修改参照表中的所有导致不一致的元组</p>
<p>设置为空值</p>
<hr>
<h1 id="数据库安全性"><a href="#数据库安全性" class="headerlink" title="数据库安全性"></a>数据库安全性</h1><h2 id="安全标准"><a href="#安全标准" class="headerlink" title="安全标准"></a>安全标准</h2><p>TCSEC&#x2F;TDI 安全级别划分：</p>
<table>
<thead>
<tr>
<th>安全级别</th>
<th>定义</th>
</tr>
</thead>
<tbody><tr>
<td>A1</td>
<td>验证设计</td>
</tr>
<tr>
<td>B3</td>
<td>安全域</td>
</tr>
<tr>
<td>B2</td>
<td>结构化保护</td>
</tr>
<tr>
<td>B1</td>
<td>标记安全保护（这个级别的产品才被认为是真正意义上的安全产品）</td>
</tr>
<tr>
<td>C2</td>
<td>受控的存取保护。如Windows 2000、Oracle 7</td>
</tr>
<tr>
<td>C1</td>
<td>自主安全保护。能够实现对用户和数据的分离，进行自主存取控制（DAC）</td>
</tr>
<tr>
<td>D</td>
<td>最小保护。例如DOS，具有操作系统的基本功能，如文件系统、进程调度等</td>
</tr>
</tbody></table>
<p>CC 评估保证级（EAL）的划分：</p>
<table>
<thead>
<tr>
<th>评估保证级</th>
<th>定义</th>
<th>TCSEC安全级别（近似相当）</th>
</tr>
</thead>
<tbody><tr>
<td>EAL1</td>
<td>功能测试</td>
<td></td>
</tr>
<tr>
<td>EAL2</td>
<td>结构测试</td>
<td>C1</td>
</tr>
<tr>
<td>EAL3</td>
<td>系统地测试和检查</td>
<td>C2</td>
</tr>
<tr>
<td>EAL4</td>
<td>系统地设计、测试和复查</td>
<td>B1</td>
</tr>
<tr>
<td>EAL5</td>
<td>半形式化设计和测试</td>
<td>B2</td>
</tr>
<tr>
<td>EAL6</td>
<td>半形式化验证的设计和测试</td>
<td>B3</td>
</tr>
<tr>
<td>EAL7</td>
<td>形式化验证的设计和测试</td>
<td>A1</td>
</tr>
</tbody></table>
<hr>
<h2 id="安全性控制"><a href="#安全性控制" class="headerlink" title="安全性控制"></a>安全性控制</h2><p><img src="/blog/2024/03/28/SqlServer/image-20240509165145753.png" alt="image-20240509165145753"></p>
<h3 id="用户身份鉴别"><a href="#用户身份鉴别" class="headerlink" title="用户身份鉴别"></a>用户身份鉴别</h3><p>用户标识（username + UID）</p>
<ol>
<li>静态口令鉴别</li>
<li>动态口令鉴别</li>
<li>生物特征鉴别</li>
<li>智能卡鉴别</li>
</ol>
<hr>
<h3 id="存取控制"><a href="#存取控制" class="headerlink" title="存取控制"></a>存取控制</h3><p>C2级的数据管理系统支持<strong>自主存取控制（DAC）</strong>，B1级的数据库管理系统支持<strong>强制存取控制（MAC）</strong></p>
<ol>
<li>定义用户权限，并将用户权限登记到数据字典中</li>
<li>合法权限检查</li>
</ol>
<hr>
<h3 id="自主存取控制方法"><a href="#自主存取控制方法" class="headerlink" title="自主存取控制方法"></a>自主存取控制方法</h3><p>用户权限由两个要素构成：<strong>数据库对象</strong>和<strong>操作类型</strong></p>
<p>在数据库系统中，定义存取权限称为<strong>授权</strong>（authorization）</p>
<p>在非关系系统中，用户只能对数据进行操作，存取控制的数据库对象也仅限于数据本身</p>
<p>在关系数据库系统中，存取控制的对象不仅有数据本身（基本表中的数据、属性列上的数据），还有数据库模式（包括数据库、基本表、视图和索引的创建等）</p>
<hr>
<h3 id="授权：授予与收回"><a href="#授权：授予与收回" class="headerlink" title="授权：授予与收回"></a>授权：授予与收回</h3><p><code>GRANT</code>语句：向用户授予权限</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">GRANT</span> <span class="token operator">&lt;</span>权限<span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>权限<span class="token operator">></span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">ON</span> <span class="token operator">&lt;</span>对象类型<span class="token operator">></span> <span class="token operator">&lt;</span>对象名<span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>对象类型<span class="token operator">></span> <span class="token operator">&lt;</span>对象名<span class="token operator">></span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">TO</span> <span class="token operator">&lt;</span>用户<span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>用户<span class="token operator">></span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>SQL标准允许具有 WITH GRANT OPTION 的用户把相应权限或其子集传递授予其他用户，但不允许循环授权，即被授权者不能把权限再授回给授权者或者其祖先</p>
<p>例：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span>
<span class="token keyword">ON</span> <span class="token keyword">TABLE</span> Student
<span class="token keyword">TO</span> U1<span class="token punctuation">;</span>
<span class="token comment">-- 把查询Student表的权限授给用户U1</span>

<span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span>
<span class="token keyword">ON</span> <span class="token keyword">TABLE</span> Student<span class="token punctuation">,</span>Course
<span class="token keyword">TO</span> U2<span class="token punctuation">,</span>U3<span class="token punctuation">;</span>
<span class="token comment">-- 把对Student表和Course表的全部操作权限授予用户U2和U3</span>

<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span>
<span class="token keyword">ON</span> <span class="token keyword">TABLE</span> SC
<span class="token keyword">TO</span> <span class="token keyword">PUBLIC</span><span class="token punctuation">;</span>
<span class="token comment">-- 把对表SC的查询权限授予所有用户</span>

<span class="token keyword">GRANT</span> <span class="token keyword">UPDATE</span><span class="token punctuation">(</span>Sno<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">SELECT</span>
<span class="token keyword">ON</span> <span class="token keyword">TABLE</span> Student
<span class="token keyword">TO</span> U4<span class="token punctuation">;</span>
<span class="token comment">-- 把查询Student表和修改学生学号的权限授给用户U4</span>

<span class="token keyword">GRANT</span> <span class="token keyword">INSERT</span>
<span class="token keyword">ON</span> <span class="token keyword">TABLE</span> SC
<span class="token keyword">TO</span> U5
<span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span><span class="token punctuation">;</span>
<span class="token comment">-- 把对表SC的INSERT权限授予U5用户，并允许将此权限再授予其他用户</span>

<span class="token keyword">GRANT</span> <span class="token keyword">INSERT</span>
<span class="token keyword">ON</span> <span class="token keyword">TABLE</span> SC
<span class="token keyword">TO</span> U6<span class="token punctuation">;</span>
<span class="token comment">-- U5授予U6权限，但是没给传播的权限，因此U6不能再传播此权限</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>REVOKE</code>语句：收回已经授予用户的权限</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">REVOKE</span> <span class="token operator">&lt;</span>权限<span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>权限<span class="token operator">></span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">ON</span> <span class="token operator">&lt;</span>对象类型<span class="token operator">></span> <span class="token operator">&lt;</span>对象名<span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>对象类型<span class="token operator">></span> <span class="token operator">&lt;</span>对象名<span class="token operator">></span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span> <span class="token operator">&lt;</span>用户<span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">&lt;</span>用户<span class="token operator">></span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token keyword">CASCADE</span><span class="token operator">|</span><span class="token keyword">RESTRICT</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>例：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">REVOKE</span> <span class="token keyword">UPDATE</span><span class="token punctuation">(</span>Sno<span class="token punctuation">)</span>
<span class="token keyword">ON</span> <span class="token keyword">TABLE</span> Student
<span class="token keyword">FROM</span> U4<span class="token punctuation">;</span>
<span class="token comment">-- 把用户U4修改学生学号的权限收回</span>

<span class="token keyword">REVOKE</span> <span class="token keyword">SELECT</span>
<span class="token keyword">ON</span> <span class="token keyword">TABLE</span> SC
<span class="token keyword">FROM</span> <span class="token keyword">PUBLIC</span><span class="token punctuation">;</span>
<span class="token comment">-- 收回所有用户对表SC的查询权限</span>

<span class="token keyword">REVOKE</span> <span class="token keyword">INSERT</span>
<span class="token keyword">ON</span> <span class="token keyword">TABLE</span> SC
<span class="token keyword">FROM</span> U5 <span class="token keyword">CASCADE</span><span class="token punctuation">;</span>
<span class="token comment">-- 把用户U5对SC表的INSERT权限收回</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>从上面的例子可以发现，用户可以”自主“地决定将数据的存取权限授予何人、决定是否也将”授权“的权限授予别人</p>
<p>因此称这样的存取控制是自主存取控制</p>
<p><code>CREATE USER</code>语句：创建数据库模式的权限</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token operator">&lt;</span>username<span class="token operator">></span> <span class="token punctuation">[</span><span class="token keyword">WITH</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>DBA<span class="token operator">|</span>RESOURCE<span class="token operator">|</span><span class="token keyword">CONNECT</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>只有系统的超级用户才有权创建一个新的数据库用户</li>
<li>新创建的数据库用户有三种权限：CONNECT、RESOURCE和DBA，默认是CONNECT权限</li>
</ul>
<p>权限与可执行的操作如下表：</p>
<table>
<thead>
<tr>
<th>拥有的权限</th>
<th>CREATE USER</th>
<th>CREATE SCHEMA</th>
<th>CREATE TABLE</th>
<th>登录数据库，执行数据查询和操纵</th>
</tr>
</thead>
<tbody><tr>
<td>DBA</td>
<td>可以</td>
<td>可以</td>
<td>可以</td>
<td>可以</td>
</tr>
<tr>
<td>RESOURCE</td>
<td>不可以</td>
<td>不可以</td>
<td>可以</td>
<td>可以</td>
</tr>
<tr>
<td>CONNECT</td>
<td>不可以</td>
<td>不可以</td>
<td>不可以</td>
<td>可以，但必须拥有相应权限</td>
</tr>
</tbody></table>
<hr>
<h3 id="数据库角色"><a href="#数据库角色" class="headerlink" title="数据库角色"></a>数据库角色</h3><p>数据库角色是被命名的一组与数据库操作相关的权限，角色是权限的集合</p>
<ol>
<li><p>角色的创建</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> ROLE <span class="token operator">&lt;</span>角色名<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>刚创建的角色是空的，可以用<code>GRANT</code>给角色授权，和上面授权一样</p>
</li>
<li><p>将一个角色授予其他的角色或用户，同上</p>
</li>
<li><p>收回同上</p>
</li>
</ol>
<hr>
<h3 id="强制存取控制方法"><a href="#强制存取控制方法" class="headerlink" title="强制存取控制方法"></a>强制存取控制方法</h3><p>敏感度标记：绝密（Top Secret，TS）、机密（Secret，S）、可信（Confidential，C）、公开（Public，P）</p>
<hr>
<h2 id="视图机制"><a href="#视图机制" class="headerlink" title="视图机制"></a>视图机制</h2><p>例：建立计算机系学生的视图，把对该视图的 <strong>SELECT 权限</strong>授予王平，把该视图上的<strong>所有操作权限</strong>授予张明</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> CS_Student
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> Student
<span class="token keyword">WHERE</span> Sdept<span class="token operator">=</span><span class="token string">'CS'</span><span class="token punctuation">;</span>
<span class="token comment">/*先建立视图CS_Student*/</span>

<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span>
<span class="token keyword">ON</span> CS_Student
<span class="token keyword">TO</span> 王平<span class="token punctuation">;</span>
<span class="token comment">/*王平只能检索计算机系学生的信息*/</span>

<span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span>
<span class="token keyword">ON</span> CS_Student
<span class="token keyword">TO</span> 张明<span class="token punctuation">;</span>
<span class="token comment">/*具有检索和增删改计算机系学生信息的所有权限*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<hr>
<h2 id="审计"><a href="#审计" class="headerlink" title="审计"></a>审计</h2><p>审计——数据库管理系统达到 C2 以上安全级别必不可少的一项指标</p>
<p>审计功能把用户对数据库的所有操作自动记录下来放入审计日志中</p>
<ol>
<li><p>审计事件</p>
<ul>
<li>服务器事件</li>
<li>系统权限</li>
<li>语句事件</li>
<li>模式对象事件</li>
</ul>
</li>
<li><p>审计功能</p>
<ul>
<li>基本功能</li>
<li>提供多套审计规则</li>
<li>提供审计分析和报表功能</li>
<li>审计日志管理功能</li>
<li>系统提供查询审计设置及审计记录信息的专门视图</li>
</ul>
</li>
<li><p>AUDIT 语句和 NOAUDIT 语句</p>
<p>前者用来设置审计功能，后者则取消审计功能</p>
<p>例：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">AUDIT <span class="token keyword">ALTER</span><span class="token punctuation">,</span><span class="token keyword">UPDATE</span>
<span class="token keyword">ON</span> SC<span class="token punctuation">;</span>
<span class="token comment">-- 对修改SC表结构或修改SC表数据的操作进行审计</span>

NOAUDIT <span class="token keyword">ALTER</span><span class="token punctuation">,</span><span class="token keyword">UPDATE</span>
<span class="token keyword">ON</span> SC；
<span class="token comment">-- 取消对SC表的审计</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>审计设置以及审计日志一般都存储在数据字典中。必须把审计开关打开（audit_trail &#x3D; true），才能在系统表 SYS_AUDITTRAIL 中看到审计信息</p>
</li>
</ol>
<hr>
<h2 id="数据加密"><a href="#数据加密" class="headerlink" title="数据加密"></a>数据加密</h2>
    </div>
    
    
    
    
    
    
    
</div>

            </div>
            </transition>
            
            <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
            </transition>
            
        </div>
        <script src="/blog/js/main.js"></script>
        
        




         
        
    <div id="vcomments"></div>
    
        <script src="/blog/js/lib/valine.min.js"></script>
            <script>
                new Valine({
                    el: '#vcomments',
                    app_id: 'U9mZLKunkRUTcBFthjXPjnZE-9Nh9j0Va',
                    app_key: 'SzWOnY0PWLGNuL6jW8TZYc7j',
                    visitor: 'true',
                    placeholder: '写点什么吧(●ˇ∀ˇ●)',
                    serverURLs: 'https://u9mzlkun.lc-cn-n1-shared.com',
                });
            </script>

        <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 雲流のLowest World
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;C1oudfL0w0
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

    <script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/blog/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":290},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>

